﻿_Z_43=function(){throw Error.notImplemented()},_Z_43.prototype={normal:0,subtotl:1},_Z_43.registerEnum("_Z_43"),_Z_42=function(){throw Error.notImplemented()},_Z_42.prototype={normal:0,hover:1,selected:2,none:3},_Z_42.registerEnum("_Z_42"),_Z_260=function(){throw Error.notImplemented()},_Z_260.prototype={normal:0,notBind:1,asyncBind:2},_Z_260.registerEnum("_Z_260"),Sys.GridFilterArgs=function(t){Sys.GridFilterArgs.initializeBase(this),this._filter=t},Sys.GridFilterArgs.prototype={get_filter:function(){return this._filter}},Sys.GridFilterArgs.registerClass("Sys.GridFilterArgs",_Z_162),_Z_280=function(t,e,i){this._grid=t,this._toBottom=e,this._direction=i},_Z_280.prototype={get_toBottom:function(){return this._toBottom},get_direction:function(){return this._direction},get_visibleColumns:function(){return this._grid.get_visibleColumns()}},_Z_280.registerClass("_Z_280",Sys.EventArgs),_Z_192=function(t,e,i,n,o,s){_Z_192.initializeBase(this),this._isHover=t,this._clientX=e,this._clientY=i,this._column=n,this._event=o,this._rowIndex=s},_Z_192.prototype={get_isHover:function(){return this._isHover},get_rowIndex:function(){return this._rowIndex},get_clientX:function(){return this._clientX},get_clientY:function(){return this._clientY},get_column:function(){return this._column},get_event:function(){return this._event}},_Z_192.registerClass("_Z_192",Sys.EventArgs),_Z_193=function(t,e){_Z_193.initializeBase(this),this._rowNo=t,this._rowFlag="",this._rowData=e,this._hasSetRowNo=!1},_Z_193.prototype={get_rowNo:function(){return this._rowNo},set_rowNo:function(t){this._rowNo=t,this._hasSetRowNo=!0},get_rowData:function(){return this._rowData}},_Z_193.registerClass("_Z_193",Sys.EventArgs),_Z_31=function(t,e,i,n){_Z_31.initializeBase(this),this._rowIndex=t,this._value=e,this._oldValue=i,this._valueChanged=!1,this._focusColumn=null,this._column=n},_Z_31.prototype={get_column:function(){return this._column},get_rowIndex:function(){return this._rowIndex},get_focusColumn:function(){return this._focusColumn},set_focusColumn:function(t){this._focusColumn=t},get_oldValue:function(){return this._oldValue},get_value:function(){return this._value},set_value:function(t){this._value=t,this._valueChanged=!0},get_valueChanged:function(){return this._valueChanged}},_Z_31.registerClass("_Z_31",_Z_162),_Z_194=function(t,e){_Z_194.initializeBase(this),this._width=t,this._height=e,this._caption=null},_Z_194.prototype={set_size:function(t,e){this._width=t,this._height=e},get_size:function(){return{width:this._width,height:this._height}},get_caption:function(){return this._caption},set_caption:function(t){this._caption=t}},_Z_194.registerClass("_Z_194",_Z_162),_Z_195=function(t,e,i){_Z_195.initializeBase(this,[t,e,i]),this._cancel=!1,this._pageUrl="",this._pageParams=null},_Z_195.prototype={set_cancel:function(t){return this._cancel=t},get_cancel:function(){return this._cancel},set_pageUrl:function(t){return this._pageUrl=t},get_pageUrl:function(){return this._pageUrl},set_pageParams:function(t){return this._pageParams=t},get_pageParams:function(){return this._pageParams},set_callBack:function(t){this._callBack=t},get_callBack:function(){return this._callBack}},_Z_195.registerClass("_Z_195",_Z_31),_Z_196=function(t,e,i){_Z_196.initializeBase(this),this._rowIndex=t,this._columnIndex=e,this._column=i},_Z_196.prototype={get_rowIndex:function(){return this._rowIndex},get_columnIndex:function(){return this._columnIndex},get_column:function(){return this._column}},_Z_196.registerClass("_Z_196",_Z_162),_Z_161=function(t,e){_Z_161.initializeBase(this),this._rowIndex=t,this._type=e},_Z_161.prototype={get_rowIndex:function(){return this._rowIndex},get_rowState:function(){return this._type},set_fontColor:function(t){this._fontColor=t},set_bgColor:function(t){this._bgColor=t},set_style:function(t){this._style=t},set_cssClass:function(t){this._cssClass=t}},_Z_161.registerClass("_Z_161",Sys.EventArgs),_Z_197=function(t,e,i,n){_Z_197.initializeBase(this,[t,n]),this._isSelected=e,this._rowNo=i,this._rowFlag="",this._rowNoSetted=!1},_Z_197.prototype={get_isSelected:function(){return this._isSelected},get_rowNo:function(){return this._rowNo},set_rowNo:function(t){this._rowNo=t,this._rowNoSetted=!0}},_Z_197.registerClass("_Z_197",_Z_161),_Z_198=function(t,e,i,n,o){_Z_198.initializeBase(this,[t,o]),this._columnIndex=e,this._column=i,this._cell=n},_Z_198.prototype={get_columnIndex:function(){return this._columnIndex},get_column:function(){return this._column},get_cell:function(){return this._cell}},_Z_198.registerClass("_Z_198",_Z_161),_Z_199=function(t){_Z_199.initializeBase(this),this._control=null,this._item=t},_Z_199.prototype={set_control:function(t){this._control=t},get_control:function(){return this._control},get_item:function(){return this._item},set_properties:function(t){this._properties=t},get_properties:function(){return this._properties}},_Z_199.registerClass("_Z_199",_Z_162),_Z_200=function(t,e){_Z_200.initializeBase(this),this._data=t,this._rowIndex=e},_Z_200.prototype={get_data:function(){return this._data},set_data:function(t){this._data=t},get_rowIndex:function(){return this._rowIndex},set_cancel:function(t){this._cancel=t}},_Z_200.registerClass("_Z_200",Sys.EventArgs),_Z_201=function(t,e,i,n,o){_Z_201.initializeBase(this),this._rowIndex=t,this._value=e,this._text=i,this._isPrint=n,this._isEditor=o},_Z_201.prototype={get_rowIndex:function(){return this._rowIndex},get_value:function(){return this._value},get_text:function(){return this._text},set_text:function(t){this._text=t},set_hint:function(t){this._hint=t},get_cssClass:function(){return this._cssClass},set_cssClass:function(t){this._cssClass=t},get_isPrint:function(){return this._isPrint},get_isEditor:function(){return this._isEditor}},_Z_201.registerClass("_Z_201",Sys.EventArgs),_Z_202=function(t,e,i){_Z_202.initializeBase(this),this._rowIndex=t,this._column=e,this.event=i},_Z_202.prototype={get_rowIndex:function(){return this._rowIndex},get_event:function(){return this.event},get_column:function(){return this._column}},_Z_202.registerClass("_Z_202",Sys.EventArgs),_Z_203=function(t){_Z_203.initializeBase(this),this._rowIndex=t},_Z_203.prototype={get_rowIndex:function(){return this._rowIndex}},_Z_203.registerClass("_Z_203",_Z_162),_Z_204=function(t,e,i){_Z_204.initializeBase(this),this._loadedItems=t,this._appendItemIndex=e,this._decimalField=i},_Z_204.prototype={modifyOrAppendItems:function(t,e){if(t){if(!e)throw Error.argumentNull("keyField");for(var i=this._loadedItems,n=i.length,o=function(t){for(var o=0;o<n;o++){var s=i[o];if(s){var r=s.data;if(r&&r[e]==t[e])return s}}return null},s=function(t,e){if(t&&e)for(var i in t)e[i]=t[i]},r=this._appendItemIndex,l=0,a=t.length;l<a;l++){var h=t[l];if(u=o(h))u.__isLoadedItem||(s(h,u.data),u.__isLoadedItem=!0);else{var d={};d.data=h,d.__isLoadedItem=!0,i[r]=d,r++}}var _=this._decimalField;if(_)for(var l=0,a=i.length;l<a;l++){var u=i[l];if(u){var c=u.data;c&&!u.__isLoadedItem&&(c[_]=null,u.__isLoadedItem=!0)}}}}},_Z_204.registerClass("_Z_204",Sys.EventArgs),_Z_205=function(t){_Z_205.initializeBase(this),this._column=t},_Z_205.prototype={get_column:function(){return this._column}},_Z_205.registerClass("_Z_205",_Z_162),_Z_160=function(t){_Z_160.initializeBase(this),this._column=t},_Z_160.prototype={get_column:function(){return this._column}},_Z_160.registerClass("_Z_160",_Z_162),_Z_159=function(t,e,i,n,o){_Z_159.initializeBase(this),this._rowIndex=t,this._buttonIndex=e,this._buttonValue=i,this._buttonText=n,this._event=o},_Z_159.prototype={get_rowIndex:function(){return this._rowIndex},get_buttonIndex:function(){return this._buttonIndex},get_buttonValue:function(){return this._buttonValue},get_buttonText:function(){return this._buttonText},get_event:function(){return this._event}},_Z_159.registerClass("_Z_159",Sys.EventArgs),_Z_158=function(t,e){_Z_158.initializeBase(this),this._column=t,this._oldCaptionElement=e,this._newCaptionElement=null},_Z_158.prototype={get_column:function(){return this._column},get_oldCaptionElement:function(){return this._oldCaptionElement},set_newCaptionElement:function(t){this._newCaptionElement=t},get_newCaptionElement:function(){return this._newCaptionElement}},_Z_158.registerClass("_Z_158",Sys.EventArgs),_Z_262=function(t,e){this._column=t,this._footer=e},_Z_262.prototype={get_column:function(){return this._column},set_footer:function(t){this._footer=t},get_footer:function(){return this._footer}},_Z_262.registerClass("_Z_262",Sys.EventArgs),Sys.UI.Controls.Grid=function(t){Sys.UI.Controls.Grid.initializeBase(this,[t]),this._visible=!0,this._readOnly=!0,this._reportRowNo=!0,this._defaultRowCount=10,this._maxRowCount=-1,this._lazyPageSize=0,this._lazyIndex=0,this._pageSize=10,this._columnsParams=[],this._mergeRowColumns=[],this._showHeader=!0,this._maxHeaderLevel=1,this._showRowNo=!0,this._showLines=!0,this._checkEnabled=!0,this._allowMouseWheel=!0,this._defaultFrozenColumnCount=0,this._allowPopup=$settings.GridDefaultAllowPopup,this._allowConfig=$settings.GridDefaultAllowConfig,this._allowFrozen=$settings.GridDefaultAllowFrozen,this._allowCopy=$settings.GridDefaultAllowCopy,this._allowFilter=$settings.GridDefaultAllowFilter,this._allowResize=$settings.GridDefaultAllowResize,this._showRowIndicator=$settings.GridDefaultShowRowIndicator,this._useCustomScrollBar=$settings.UseCustomScrollBar,this._dropDownNumericButton=$settings.GridPagerDropDownNumericButton,this._scrollUsePageSize=$settings.GridDefaultScrollUsePageSize,this._lazyPageSize=$settings.GridLazyPageSize,this._rowNoColumnCaption=$settings.GridRowNoColumnCaption,this._saveConfig=!0,this._showScrollBar=!0,this._useEvenRowColor=!0,this._useHoverRowColor=!0,this._allColumnWidth=0,this._selectionDelayTimer=0,this._minHeight=100,this._maxHeight=0,this._autoMaxRowCount=0,this._rowNoColumnWidth=$gridExt.getRowNoColumnWidth(),this._mouseHoverTime=50,this._wordWrap=!1,this._scrollBarWidth=$settings.GridDefaultScrollBarWidth,this._strongFocus=!0,this._rowNoMaxWidth=$settings.GridDefaultRowNoMaxWidth,this._configID=0,this._enabled=!0,this.defaultShowEditor=$settings.GridDefaultShowEditor,this._showPrintSummaryText=!0,this._changedRowDatas=[],this._newRowDatas=[],this._deleteRowDatas=[],this._state=_Z_43.normal,this._subtotalRowFlag="__subtotal",this._primaryKey="",this._resizeMode=_Z_241.all},Sys.UI.Controls.Grid.prototype={initialize:function(){Sys.UI.Controls.Grid.callBaseMethod(this,"initialize"),this.get_form()._hasFlexBlock=!0,this.get_form()._hasGrid=!0,$craba._initEnabledlay(this),this._createFilterBar()},dispose:function(t){if(this._clearScrollTimer(),Sys.Browser.isFirefox&&this._gridScrollToStart(),$gridExt.closePopup(),delete this._columnsParams,delete this._designColumnsDisplayOrder,delete this._changedRowDatas,delete this._newRowDatas,delete this._deleteRowDatas,this._scrollBar&&this._scrollBar.dispose(),this._filterBar&&this._filterBar.dispose(),this._colGroup=null,this._header&&($clearHandlers(this._header),this._header=null,this._configCell&&($clearHandlers(this._configCell),this._configCell=null)),this._body&&($clearHandlers(this._body),this._body=null),this._footer&&($clearHandlers(this._footer),this._footer=null),this._documentKeyDownHandler&&($common.removeKeyDownHandler(document,this._documentKeyDownHandler),this._documentKeyDownHandler=null),this._processDragEvent(!1),this._disposeFrozen(!1),this._clearExpandRow(),this._focusedColumn=null,this._rowDeleteColumn=null,this._activeColumn=null,this._loadedItems&&(delete this._loadedItems,this._loadedItems=null,this._multiSelectColumn=null),this._columns){for(var e=0,i=this._columns.length;e<i;e++){var n=this._columns[e];n&&n.dispose()}delete this._columns}if(this._dataController&&(this._dataController.dispose(),this._dataController=null),this._clearMouseHoverTimer(),this._followPager=null,this._summaryItems=null,this._rowsEnabled&&delete this._rowsEnabled,this._preloadItems&&delete this._preloadItems,this._dataSource&&delete this._dataSource,this._cacheData&&delete this._cacheData,this._configDataChanged){var o=this.findForm();if(o){var s=!o.get_isAsync();try{this._internalSaveConfig(s)}catch(r){}}}delete this._configData,t&&$removeNode(this.get_element().parentNode),Sys.UI.Controls.Grid.callBaseMethod(this,"dispose")},_disposeFrozen:function(t){this._frozenColGroup=null,this._frozenHeaderBar&&($clearHandlers(this._frozenHeaderTable),this._frozenConfigCell&&($clearHandlers(this._frozenConfigCell),this._frozenConfigCell=null),t&&($removeNode(this._frozenHeaderBar),this._frozenHeaderBar=null)),this._frozenBody&&(this._frozenRowsTable=null,this._frozenRows=null,t&&($removeNode(this._frozenBody),this._frozenBody=null)),this._frozenFooterBar&&($clearHandlers(this._frozenFooter),this._frozenFooter=null,t&&($removeNode(this._frozenFooterBar),this._frozenFooterBar=null))},doFormInit:function(){if(this.get_visible()&&!this._body){var t=this.get_element(),e=(t.offsetWidth,t.offsetHeight,$common.getChildrenByTagName(t,"div")),i=0,n=this.get_showScrollBar();if(this.get_showHeader()){var o=this._headerBar=e[i];i++;var s=this._header=$common.getFirstChildByTagName(o,"table");this._maxHeaderLevel>1&&(this._colGroup=$common.getFirstChildByTagName(s,"colgroup")),this._headerHeight=s.offsetHeight,$common.addResizeHandler(s,this._headerResize,this),this.get_allowConfig()&&$common.addContextMenuHandler(s,this._headerContextMenu,this);h=this._headerRow=$common.getTableFirstRow(s);if(n){d=this._headerSpacer=$common.getLastChildByTagName(h,"td");$dom.addCssClass(d,"GridHeaderSpacer")}this.get_showRowNo()&&(this._noTd=$common.getFirstChildByTagName(h,"td"),this.get_allowResize()&&$common.addMouseOverHandler(this._noTd,this._rowNoOver,this))}var r=this._body=e[i];if(r.tabIndex=0,i++,this.get_showFooter()){var l=this._footerBar=e[i],a=this._footer=$common.getFirstChildByTagName(l,"table");$common.addMouseOverHandler(a,this._footerMouseOver,this);var h=this._footerRow=$common.getTableFirstRow(a),d=this._footerSpacer=$common.getLastChildByTagName(h,"td");this.get_showRowNo()&&(this._footerNo=$common.getFirstChildByTagName(h,"td")),$dom.addCssClass(d,"GridFooterSpacer")}this.isFrozenGrid()&&(this._createFrozenHeaderTable(),this._createFrozenFooterTable());var _=this._rowsTable=$common.createTable(0);_.className="GridTable";var u=this._allColumnWidth;_.style.width=n?(u>0?u:this._getAllColumnWidth())+"px":"100%",this._createColumns(),this.resetColumnStretch(null,!0),this._initColumnSort();var c=this._rows=$common.createTBody(),g=this._getFirstColumnExpandCount();g>0&&this._initColumnExpands(),_.appendChild(c),r.appendChild(_),this.isFrozenGrid()&&this._createFrozenBody(),this.get_afterCreateRows()||this._initDataRows(),0==g&&this._initColumnExpands(),this._refreshRowNoColumnCaption(),this._initGridShowMax(),this._refreshFrozenHeaderHeight(!0),this._initFilterBar(),this._bindGridBar(),this._initOverlaySize(),this._initGridEvents(),this._init=!0}},doFormLoaded:function(){if(this._init){if(this._autoPagerPageSize&&!this.hasConfigPageSize()){var t=parseInt(this._body.clientHeight/this.getRowHeight());this.set_pageSize(t)}if(this.get_dataBindType()==_Z_260.asyncBind){var e=this.findPager();e&&e.refresh()}this.get_afterCreateRows()&&this._initDataRows(),this._initPagerData(),this.isFrozenGrid()&&(this._setFrozenStyle(),this._initFrozenFilterBar())}},_rowNoOver:function(t){0!=this.get_rowNoMaxWidth()&&$gridExt.bindColumnResizer(this.get_noColumn())},get_noColumn:function(){if(!this.get_showRowNo())return null;if(0==this.get_rowNoMaxWidth())return null;var t=this._noColumn;return t||(t=this._noColumn=new _Z_110(this)),t},get_rowNoMaxWidth:function(){return this._rowNoMaxWidth&&"string"==typeof this._rowNoMaxWidth&&(this._rowNoMaxWidth=parseInt(this._rowNoMaxWidth)),this._rowNoMaxWidth?this._rowNoMaxWidth:0},set_rowNoMaxWidth:function(t){this._rowNoMaxWidth=t},get_afterCreateRows:function(){return this._afterCreateRows||this._dataSource&&this._dataSource.length>500},set_afterCreateRows:function(t){this._afterCreateRows=t},get_dataBindType:function(){return this._dataBindType},set_dataBindType:function(t){this._dataBindType=t},_initPagerData:function(){var t=this.findPager();t&&(t.get_hasSummary()&&this._dataSource&&t.refreshSummary(),t.savePageItemCount())},get_needSummary:function(){return this._needSummary},set_needSummary:function(t){this._needSummary=t},_bindGridBar:function(){if(this._body&&this._useCustomScrollBar){var t=this.get_element();$dom.addCssClass(t.parentNode,"UserScrollBar");var e=this._scrollBar=_Z_81.create(this._body,t);this._frozenBody&&$common.addTouchStartHandler(this._frozenBody,e._onTouchstart,e),e._allowMouseWheel=this._allowMouseWheel,e._mouseWheelScroll=!1,this._refreshFrozenBodyHeight(),this._refreshScrollBar()}},doFormResized:function(){this.resetColumnStretch(),this.isFrozenGrid()&&this._setFrozenStyle()},resetColumnStretch:function(t,e){if(this._stretchColumns&&0!=this._stretchColumns.length&&!(this._element.offsetWidth<5)){for(var i=this._stretchColumns.length,n=[],o=0;o<i;o++){(a=this._stretchColumns[o]).get_visible()&&n.push(a)}i=n.length;var s=this._useCustomScrollBar?0:this.get_scrollBarWidth(),r=this._element.offsetWidth-this._getAllColumnWidth(!0)-s,l=parseInt(r/i);l=Math.max(l,90);for(o=0;o<i;o++){var a=n[o],h=a.get_width();this._internalSetStretchColumnWidth(a,Math.max(l,a.get_minWidth()),h,!0,t,e)}}},_addStretchColumns:function(t){var e=this._stretchColumns;e||(e=this._stretchColumns=[]),e.push(t)},_createFrozenBody:function(){if(!this._frozenRowsTable){frozenTable=this._frozenRowsTable=$common.createTable(0);var t=this._frozenRows=$common.createTBody();frozenTable.appendChild(t);var e=this._frozenBody;e||(e=this._frozenBody=$common.createClassDiv("GridBody Frozen"),this.get_element().appendChild(e)),e.appendChild(frozenTable)}},_createFrozenHeaderTable:function(){if(this._header){var t=this._frozenHeaderBar;t||(t=this._frozenHeaderBar=$common.createClassDiv("GridHeaderBar Frozen"),this.get_element().appendChild(t)),this._frozenHeaderTable&&($clearHandlers(this._frozenHeaderTable),$removeNode(this._frozenHeaderTable));var e=this._frozenHeaderTable=this._header.cloneNode(!0);if(e.style.height=this._header.offsetHeight+"px",this._bindRowNoEvent(e,!0),this._createFrozenColumn(),this._maxHeaderLevel>1){var i=this._frozenColGroup=$common.getFirstChildByTagName(e,"colgroup"),n=$common.getChildrenByTagName(i,"col"),o=this._getFrozenColumnRealCount();this.get_showRowNo()||o--;for(var s=n.length-1;s>o;s--)$removeNode(n[s])}if($common.addResizeHandler(e,this._headerResize,this),this.get_allowConfig()&&$common.addContextMenuHandler(e,this._headerContextMenu,this),t.appendChild(e),this.get_showRowNo()&&this.get_allowResize()){var r=$common.getTableFirstRow(e),l=this._frozenNoTd=r.firstChild;$common.addMouseOverHandler(l,this._rowNoOver,this)}}},_bindRowNoEvent:function(t,e){if(this.get_allowConfig()){var i=$common.getFirstChildByClassName(t,"RowNoConfigIcon",!0);i&&(e?this._frozenConfigCell=i:this._configCell=i,i.title="列配置",$common.addClickHandler(i,this.config,this))}},get_configCell:function(){return this._frozenConfigCell?this._frozenConfigCell:this._configCell},_createFrozenFooterTable:function(){if(this._footer){var t=this._frozenFooterBar;t||(t=this._frozenFooterBar=$common.createClassDiv("GridFooterBar Frozen"),this.get_element().appendChild(t));var e=$common.getFirstChildByTagName(t,"table");e&&$removeNode(e);for(var i=this._frozenFooter=this._footer.cloneNode(!0),n=this._frozenFooterRow=$common.getTableFirstRow(i),o=$common.getChildrenByTagName(n,"td"),s=this._getFrozenColumnRealCount(),r=o.length-1;r>s;r--)$removeNode(o[r]);this._frozenFooterNo=o[0],$common.addMouseOverHandler(i,this._footerMouseOver,this),t.appendChild(i)}},_getMultiRows:function(){var t=$common.getTableBody(this._header),e=[];return t&&(e=$common.getChildrenByTagName(t,"tr")),e.length},_createFrozenColumn:function(){var t=0,e=[],i=this.get_frozenColumnCount(),n=$common.getTableBody(this._frozenHeaderTable),o=this.get_showRowNo(),s=[];n&&(s=$common.getChildrenByTagName(n,"tr"));for(g=0;g<s.length;g++){var r=s[g],l=$common.getChildrenByTagName(r,"td");if(0==g){o&&l.shift();for(var a=0,h=0;h<l.length;h++){f=l[h];if(h>=i)$removeNode(f);else{var d=f.colSpan,_=f.rowSpan;d>1?a+=d:_<this._maxHeaderLevel&&a++}}e.push(a)}else{for(var a=e.pop(),u=0,c=0,h=0;h<l.length;h++){var d=(f=l[h]).colSpan,_=f.rowSpan;d>1&&(a-=d-1),h>=a?($removeNode(f),c++):d>1?u+=d:_<this._maxHeaderLevel-g&&u++}c==l.length&&($removeNode(r),t++),e.push(u)}}if(t>0){s=$common.getChildrenByTagName(n,"tr");for(var g=0;g<s.length;g++)for(var r=s[g],l=$common.getChildrenByTagName(r,"td"),h=0;h<l.length;h++){var f,_=(f=l[h]).rowSpan;f.style.height=20*_-_-1+"px"}}},_setFrozenStyle:function(){var t=this._frozenBody,e=this.get_showScrollBar(),i=this._frozenHeaderBar?this._frozenHeaderBar.style:null,n=t.style,o=this._frozenFooterBar?this._frozenFooterBar.style:null,s=this._body.offsetWidth-120,r=this._getAllFrozenColumnWidth(),l=s>r?r:s,a=$dom._getCurrentStyle(this.get_element()),h=parseInt(a.paddingLeft),d=parseInt(a.paddingTop);h=h?parseInt(h):0,d=d?parseInt(d):0,i&&(i.top=d+"px",i.left=h+"px",i.display="block",i.width=l+"px",this._frozenHeaderTable.style.width=r+"px",d+=this._frozenHeaderBar.clientHeight),this._filterBar&&(d+=this._filterBar.get_height(),this._filterBar.resetWidth()),n&&(n.top=d+"px",n.left=h+"px",n.width=l+"px",n.display="block",this._frozenRowsTable.style.width=e?r+"px":"100%",this._refreshFrozenBodyHeight(),d+=this._body.offsetHeight),o&&(o.top=d+"px",o.left=h+"px",o.display="block",o.width=l+"px",this._frozenFooter.style.width=r+"px")},_setFrozenVisible:function(t){this._frozenBody&&this._getFrozenVisible()!=t&&($dom.setVisible(this._frozenBody,t),this._frozenHeaderBar&&$dom.setVisible(this._frozenHeaderBar,t),this._frozenFilterBar&&$dom.setVisible(this._frozenFilterBar,t),this._frozenFooterBar&&$dom.setVisible(this._frozenFooterBar,t))},_getFrozenVisible:function(){return!!this._frozenBody&&$dom.getVisible(this._frozenBody)},_refreshFrozenHeaderHeight:function(t){var e=this._frozenHeaderTable;if(e&&this._frozenBody){var i=this._header.offsetHeight;e.style.height=i+"px",this._frozenHeaderBar.style.height=this._headerBar.offsetHeight+"px",t||this._setFrozenStyle()}},_refreshFrozenBodyHeight:function(){if(this._frozenBody){var t=this._body.clientHeight;this._frozenBody.style.height=t+"px"}},_initGridEvents:function(){var t=this.get_element();$common.addMouseMoveHandler(t,this._tableMouseMove,this),$common.addMouseUpHandler(t,this._tableMouseUp,this),$common.addMouseDownHandler(t,this._tableMouseDown,this),$common.addDblClickHandler(t,this._tableDblClick,this),this._allowMouseWheel&&$common.addMouseWheelHandler(t,this._tableMouseWheel,this);var e=this._body;$common.addMouseLeaveHandler(e,this._bodyMouseOut,this),$common.addScrollHandler(e,this._bodyScroll,this),$common.addContextMenuHandler(e,this._gridContextMenu,this),this._documentKeyDownHandler=$common.addKeyDownHandler(document,this._documentKeyDown,this)},get_useBodyMenu:function(){return this._useBodyMenu},set_useBodyMenu:function(t){this._useBodyMenu=t},_initBeforeDrag:function(){if(!(this._dragDatas&&this._dragDatas.length>0)){var t=this.createDragDatas();if(this._dragDatas=t,this._dragField){for(var e=t.length,i="[",n=0;n<e&&n<2;n++){var o=t[n][this._dragField];n>0&&(i+=","),i+=o}e>2&&(i+="..."),this._dragTexts=i+"]"}}},createDragDatas:function(){var t=this._dragIndex=this.get_selectedRowIndex(),e=[];if(this._allowMultiSelectedRow)for(var i=0,n=this._multiRowIndexs.length;i<n;i++){var o=this._multiRowIndexs[i];this._appendDragData(o,e),this.setRowVisible(o,!1)}else this._appendDragData(t,e),this.setRowVisible(t,!1);return e},_appendDragData:function(t,e){var i=this.findRowData(t);i&&e.push(i)},_initDrag:function(t){this.get_dragOrSelect()&&(this._startPos={x:t.clientX,y:t.clientY},this._processDragEvent(!1),this._processDragEvent(!0))},_processDragEvent:function(t){this.get_dragOrSelect()&&(t?this._mouseMoveHandler||(this._mouseMoveHandler=$common.addMouseMoveHandler(document,this._dragMove,this),this._mouseUpHandler=$common.addMouseUpHandler(document,this._endDrag,this)):(this._mouseMoveHandler&&($common.removeMouseMoveHandler(document,this._mouseMoveHandler),$common.removeMouseUpHandler(document,this._mouseUpHandler),this._mouseMoveHandler=null,this._mouseUpHandler=null),this._hideDragBlock()))},_dragMove:function(t){var e={x:t.clientX,y:t.clientY};if(!(!_Z_238.IsDraging&&Math.abs(e.y-this._startPos.y)<10&&Math.abs(e.x-this._startPos.x)<10))if(t.cancel(),this.get_allowDrag()){this._initBeforeDrag();var i=this._dragDatas.length;if(!(i<1||(this._moveDragBlockByPos(e),this._isMouseMoving))){this._isMouseMoving=!0,_Z_238.IsDraging=!0,this._checkDrag=!1,this._moveDiv.innerHTML=String.format("拖动<font style='color:#ff0000'>{0}条</font>数据 {1}",i,this._dragTexts),_Z_238.dragMove(t,this);var n=this;setTimeout(function(){n._isMouseMoving=!1},100)}}else this._dragSelectedRow(t)},_emitDragMove:function(t,e){e!=this&&(this._clearStyle(),e._clearScrollTimer&&e._clearScrollTimer());var i=this._getEventTargetRow(t);i&&null!=this._getRowIndex(i)&&this._setSelectedRow(i);var n=this._body,o=$common.getBounds(n),s=t.clientY,r=Math.abs(s-o.y-o.height)<30,l=Math.abs(s-o.y)<30;if(r||l){if(!this._scrollTimer){var a=this._body,h=l?-30:30;this._scrollTimer=setInterval(function(){a.scrollTop+=h},200)}}else this._clearScrollTimer()},_dragSelectedRow:function(t){if(o=this._getEventTargetRow(t)){var e=this._getRowIndex(o);if(!Object.isUndefinedOrNull(e)){this._clearStyle(!0),this._checkDrag=!1;var i=Math.min(this._startRowIndex,e),n=Math.max(this._startRowIndex,e);for(this._multiRowIndexs=[];i<=n;i++){this._multiRowIndexs.push(i);var o=this._getRow(i);this._setRowStyle(o,_Z_42.selected,!0)}}}},_clearScrollTimer:function(){this._scrollTimer&&(clearInterval(this._scrollTimer),this._scrollTimer=null)},_emitDragEnd:function(t,e){},_emitDragLeave:function(t,e){},_moveDragBlockByPos:function(t){var e=this._moveDiv;e||(e=this._moveDiv=$common.createClassDiv("GridDragDiv"),document.body.appendChild(e)),$dom.setVisible(e,!0);var i=getClientScrollPosition();e.style.left=t.x+i.x+10+"px",e.style.top=t.y+i.y+20+"px"},_dragClass:function(t,e){this._element&&$dom.setCssClass(t,this._element.parentNode,e)},cancelDrag:function(){if(this._dragClass(!1,"DropStyle"),!Object.isUndefinedOrNull(this._dragIndex)){var t=this._getRow(this._dragIndex);t&&(this._allowMultiSelectedRow?(this._showDragRows(),this._clearStyle(),this._multiRowIndexs=[]):this.setRowVisible(this._dragIndex,!0),this._setSelectedRow(t),this._dragDatas=null)}},_endDrag:function(t){this._clearScrollTimer(),_Z_238.IsDraging=!1,this._processDragEvent(!1),this.get_allowDrag()&&(this._checkCancelDrag(t)||(_Z_238.endDrag(t,this),this._dragDatas=null))},_checkCancelDrag:function(t){if(!this._dragDatas||0==this._dragDatas.length)return this.cancelDrag(),!0;var e=this.get_selectedRowIndex();return _Z_238._prevDropTarget==this&&(this._dragIndex==e||this._dragIndex==e-1)&&(this.cancelDrag(),!0)},_showDragRows:function(){for(var t=0,e=this._multiRowIndexs.length;t<e;t++){var i=this._multiRowIndexs[t];this.setRowVisible(i,!0)}},_hideDragBlock:function(){this._moveDiv&&$dom.setVisible(this._moveDiv,!1)},getDragData:function(){return Object.clone(this._dragDatas)},_getDragIndex:function(){return this._dragIndex},add_drop:function(t){this.get_events().addHandler("_drop",t),this._allowDrop=!0},remove_drop:function(t){this.get_events().removeHandler("_drop",t),this._allowDrop=!1},get_visible:function(){return this._visible},set_visible:function(t){if(this._visible!=t){if(this._visible=t,this.get_isInitialized()){var e=this.get_element().parentNode;this._setControlAndLabelVisible(e,t),$dom.setVisible(e,t,"flex"),Sys.UI.Controls.Grid.callBaseMethod(this,"set_visible",[t,"flex"]),this._body||(this.doFormInit(),this.doFormLoaded());var i=this.findPager();i&&i.set_visible(t),t&&this._dataChanged&&this.dataChanged()}t&&this._doAdjustRowsTableWidth()}},get_changedRowDatas:function(t){var e=Object.clone(this._changedRowDatas);return t&&this.clearChangedRowDatas(),e},clearChangedRowDatas:function(){this._changedRowDatas=[]},get_newRowDatas:function(t){var e=Object.clone(this._newRowDatas);return t&&this.clearNewRowDatas(),e},clearNewRowDatas:function(){this._newRowDatas=[]},get_deleteRowDatas:function(t){var e=Object.clone(this._deleteRowDatas);return t&&this.clearDeleteRowDatas(),e},clearDeleteRowDatas:function(){this._deleteRowDatas=[]},_appendChangeDatas:function(t){if(t){var e=this.get_dataKey();if(e)return Object.isUndefinedOrNull(t[e])?this._appendNewDatas(t):void Array.addByKey(this._changedRowDatas,t,e);Array.indexOf(this._changedRowDatas,t)>-1||Array.add(this._changedRowDatas,t)}},_appendNewDatas:function(t){t&&(Array.indexOf(this._newRowDatas,t)>-1||this._newRowDatas.push(t))},_appendDeleteDatas:function(t){if(t){var e=this.get_dataKey();e?(Array.addByKey(this._deleteRowDatas,t,e),Array.removeByKey(this._changedRowDatas,t,e)):(this._deleteRowDatas.push(t),Array.remove(this._changedRowDatas,t)),Array.remove(this._newRowDatas,t)}},get_parentElement:function(){return this.get_element().parentNode},set_width:function(t){if(this.get_visible()&&!(t<0)){this._gridScrollToStart();var e=this.get_element().parentNode;$common.setWidth(e,t),$dom.addCssClass(e,"Flex0"),this._doAdjustHeaderSpacer(),this._doAdjustFooterSpacer(),this._refreshFooterWidth(),this._refreshScrollBar(),this.resetColumnStretch(),this._filterBar&&this._filterBar.resetWidth(),this._initOverlaySize()}},set_height:function(t){if(this.get_visible()){var e=0;if(this._headerBar&&(e+=this._headerBar.offsetHeight),this._footerBar&&(e+=this._footerBar.offsetHeight),this._filterBar&&(e+=this._filterBar.get_height()),t>e){this.findPager()&&(t+=this.findPager().get_height()),this.hasXScroll()&&(t+=8),t+=2;var i=this.get_element().parentNode;$common.setHeight(i,t),$dom.addCssClass(i,"Flex0")}this._refreshScrollBar(),this._initOverlaySize()}},set_positionVisible:function(t){if(this._pvisible!==t){this._pvisible=t;var e=this.get_element().parentNode,i=e.parentNode;i&&"TD"==i.tagName&&(e=i),$dom.setVisibleByPosition(e,t),e!=i&&this.findPager()&&$dom.setVisibleByPosition(this.findPager().get_element(),t)}},doResized:function(t){if(!1!==this._pvisible&&this.get_visible()&&("height"==t&&this.isFrozenGrid()&&this._setFrozenStyle(),"width"==t)){var e=this.findPager();e&&e.bindScrollBar()}},getRowHeight:function(){return $settings.GridDefaultRowHeight?$settings.GridDefaultRowHeight:21},get_scrollBarWidth:function(){return this._scrollBarWidth},set_scrollBarWidth:function(t){this._scrollBarWidth=t},get_bindPagerDataSource:function(){return this._bindPagerDataSource},set_bindPagerDataSource:function(t){if(this._bindPagerDataSource=t,this.get_isInitialized()){var e=this.findPager();e&&(e.set_hasDataSource(!0),this._showFooter&&this._init&&e.set_hasSummary(!0))}},get_autoMaxRowCount:function(){return this._autoMaxRowCount},set_autoMaxRowCount:function(t){this._autoMaxRowCount=t,this._autoHeight=!0,this._minHeight=50},get_autoHeight:function(){return this._autoHeight},set_autoHeight:function(t){this._autoHeight=t},get_maxHeight:function(){var t=this._maxHeight;if(this._autoMaxRowCount>0){var e=this._autoMaxRowCount*this.getRowHeight()+this.getOtherHeight();t=Math.max(t,e)}return t},set_maxHeight:function(t){this._maxHeight=t},get_useCustomScrollBar:function(){return this._useCustomScrollBar},set_useCustomScrollBar:function(t){this._useCustomScrollBar=t},get_minHeight:function(){return this._minHeight},set_minHeight:function(t){this._minHeight=t},_headerResize:function(t){var e=this._header.offsetHeight;if(this._body&&e!=this._headerHeight){var i=e-this._headerHeight;$common.setHeight(this._body,this._body.offsetHeight-i),this._headerHeight=e}},_documentKeyDown:function(t){var e=this.get_form();if(e&&!$step._stepShow&&!$app._loadingPage&&this.get_enabled()&&!window.isTeemoPrinting&&!e._hasMDI){var i=$common.findFocusedGrid(e),n=window.focusedControl;if(e&&e.get_isActive()&&i==this||$app.PopupGrid==this){if(n&&n!=i)return;this._rowsKeyDown(t)}}},canFocus:function(){return!this.get_readOnly()||this.get_recordCount()>0},get_followPager:function(){return this._followPager},set_followPager:function(t){this._followPager=t},_getBorderSize:function(t){return $common._getDomCachePadding(this._element,t)},_getLineWidth:function(){return this.get_showLines()?1:0},_doAdjustHeaderSpacer:function(){this.get_showHeader()&&this.get_showScrollBar()&&this._doAdjustHeaderFooterSpacer(this._header,this._headerSpacer)},_doAdjustFooterSpacer:function(){this.get_showFooter()&&this.get_showScrollBar()&&this._doAdjustHeaderFooterSpacer(this._footer,this._footerSpacer)},_doAdjustHeaderFooterSpacer:function(t,e){if(t){var i=0==this.get_columnCount()?this._allColumnWidth:this._getAllColumnWidth();if(!(i<=0)){var n=i+this.get_scrollBarWidth();$common.setWidth(t,n)}}},get_rowNoColumnWidth:function(){var t=this.get_noColumn();if(t&&this._noTd)return t.get_width();var e=this._configData;if(e&&e.ColumnsWidth&&e.ColumnsWidth.rowNo){var i=e.ColumnsWidth.rowNo;return"string"==typeof i&&(i=Number(i)),i}return this._rowNoColumnWidth},set_rowNoColumnWidth:function(t){this._rowNoColumnWidth=t},get_rowNoColumnCaption:function(){var t=this._headerRow;if(t&&this.get_showRowNo()){var e=t.childNodes[0].firstChild.innerHTML;return $common.clearHTMLTag(e)}return""},set_rowNoColumnCaption:function(t){this._rowNoColumnCaption=t,this.get_isInitialized()&&this._refreshRowNoColumnCaption()},_refreshRowNoColumnCaption:function(){var t=this._headerRow,e=this._rowNoColumnCaption;t&&this.get_showRowNo()&&e&&"行号"!=e&&(!this.get_allowConfig()&&e&&e.indexOf("RowNoConfigIcon")>-1&&(e="行号"),$clearHandlers(this._configCell),$clearHandlers(this._frozenConfigCell),t.childNodes[0].innerHTML=e,this._frozenNoTd&&(this._frozenNoTd.innerHTML=e,this._bindRowNoEvent(this._frozenHeaderTable,!0)),this._bindRowNoEvent(this._header))},get_columns:function(){var t=[];this._columns=this._columns?this._columns:[],t.length=this._columns.length;for(var e=j=0;e<t.length;)this._columns[e++]._noUse||(t[j++]=this._columns[e-1]);return t.length=j,t},_createColumns:function(){var t=this._getTdCaches(),e=t.tdCache,i=t.footerTds,n=t.frozenTdCache,o=t.frozenFooterTds,s=this._getFirstColumnCellIndex(),r=!1,l=this._columnsParams,a=l.length,h=this.get_id()+"_column",d=null!=this.findPager(),_={};this._columns=new Array(a);for(var u=this._columnsGspxs?this._columnsGspxs:{},c=0;c<a;c++){var g=l[c],f=e?e[h+c]:null,m=i?i[s+c]:null,C=n?n[h+c]:null,v=o?o[s+c]:null,p=this._createColumn(c,g,f,m,C,v);$settings.AllowGspxPropertys&&u[p.get_name()]&&(p.gspxProp=u[p.get_name()]),this._columns[c]=p;var w=p.get_dataField();_[w]?null!=w&&$common.showError(this.get_id()+"表格存在两列或以上相同的DataField，DataField相同会导致列错位. "+w):_[w]=!0,!r&&p.get_isClientSum()&&(r=!0),p instanceof Sys.UI.Controls.MultiSelectColumn?(d&&(this._loadedItems=[]),this._multiSelectColumn=p):p instanceof Sys.UI.Controls.RowDeleteColumn?this._rowDeleteColumn=p:p instanceof Sys.UI.Controls.ExpandColumn&&(this._rowExpandColumn=p),!d||p.get_readOnly()||this._loadedItems||(this._loadedItems=[])}this._initColumnForzenIndex(),delete _,delete t,delete this._columnsParams,this._hasSummaryColumn=r,!this._dataGroupField&&this._mergeRowColumns.length>0&&(this._useEvenRowColor=!1)},_resetColumnsElements:function(){for(var t=this._getTdCaches(),e=t.tdCache,i=t.footerTds,n=t.frozenTdCache,o=t.frozenFooterTds,s=this._getFirstColumnCellIndex(),r=this._columns.length,l=this.get_id()+"_column",a=0;a<r;a++){var h=e?e[l+a]:null,d=i?i[s+a]:null,_=n?n[l+a]:null,u=o?o[s+a]:null,c=this._columns[a];this._setColumnElements(c,h,d,_,u),c._internalSetElements(c._elements)}delete t},_disposeColumnsHeader:function(t){for(var e=t.length,i=0;i<e;i++){t[i]._internalDisposeHeader()}},_getTdCaches:function(){var t=this.get_showHeader(),e=this._footerRow,i=this._frozenFooterRow,n=this.isFrozenGrid(),o=null,s=null;t&&(o=this._getTdCache(this._header),n&&(s=this._getTdCache(this._frozenHeaderTable)));var r=null;e&&(r=$common.getChildrenByTagName(e,"td"));var l=null;return i&&(l=$common.getChildrenByTagName(i,"td")),{tdCache:o,frozenTdCache:s,footerTds:r,frozenFooterTds:l}},_initColumnForzenIndex:function(){var t=this._header;if(t){for(var e=$common.getTableBody(t).firstChild,i=$common.getChildrenByTagName(e,"td"),n={},o=this._getFirstColumnCellIndex(),s=0,r=0;o<i.length;o++){for(var l=i[o].colSpan,a=0;a<l;a++)n[s]=r,s++;r++}for(var h=this._columns,d=0,_=h.length;d<_;d++){h[d]._frozenIndex=n[d]}}},_getTdCache:function(t){var e={},i=$common.getTableBody(t).firstChild;if(this._maxHeaderLevel>1)for(;null!=i;)this._initTdCache(i,e),i=i.nextSibling;else this._initTdCache(i,e);return e},_initTdCache:function(t,e){for(var i=t.firstChild;null!=i;){var n=i.id;n&&(e[n]=i),i=i.nextSibling}},_createColumn:function(t,e,i,n,o,s,r){var l=e.type,a=e.properties;r&&(l=r.type,(a=r.properties)?a.designWidth||(a.designWidth=100):a={designWidth:100},e=r),l||(l=Sys.UI.Controls.Column,a.readOnly=!0);var h=new l;return this._setColumnElements(h,i,n,o,s),h._grid=this,h._params=e,h._allEvents=e.events,h._index=t,h instanceof Sys.UI.Controls.MultiSelectColumn&&(this._multiSelectColumn=h),_Z_242$_setProperties(h,a),h},_setColumnElements:function(t,e,i,n,o){var s=t._elements;s||(s=t._elements={}),s.header=e,s.footer=i,s.frozenHeader=n,s.frozenFooter=o},_getStartRecordIndex:function(){var t=this.findPager();return t?t.get_pageItemIndex():0},_internalAddCommandColumn:function(t){var e=this._commandColumns;e||(e=this._commandColumns=[]),Array.add(e,t)},_internalDoPagerBeforeRefresh:function(){this._loadedItems&&(this._refreshLoadedItems=!0)},clearLoadedItems:function(){return!!this._loadedItems&&(Array.clear(this._loadedItems),this._refreshLoadedItems=!1,!0)},_initLoadedItems:function(){if(!this._loadedItems)return!1;if(this._refreshLoadedItems)return Array.clear(this._loadedItems),this._refreshLoadedItems=!1,!1;for(var t=this._multiSelectColumn,e=t?t.get_dataField():null,i=this.get_recordCount(),n=this.get_dataController(),o=this._getStartRecordIndex(),s=0;s<i;s++){var r=this._loadedItems[s+o];r||(r={},this._loadedItems[s+o]=r),r.data=n.getRecord(s),r.recordIndex=s,r.data&&e&&(r.selected=!!this.getRowEnabled(s)&&r.data[e])}return!0},get_primaryKey:function(){return this._primaryKey},set_primaryKey:function(t){this._primaryKey=t},get_rowPrimaryKey:function(){return this._rowPrimaryKey},set_rowPrimaryKey:function(t){this._rowPrimaryKey=t},get_dataKey:function(){return this._rowPrimaryKey||this._primaryKey},get_dataGroupField:function(){return this._dataGroupField},set_dataGroupField:function(t){this._dataGroupField=t},_mergeLoadedItems:function(){var t=this.get_primaryKey(),e=this._multiSelectColumn?this._multiSelectColumn.get_dataField():null;if(t&&e){var i=this.get_dataSource(),n=this._loadedItems;if(i)for(var o=0,s=n.length;o<s;o++){var r=n[o];if(r!==undefined&&r.data[t]!==undefined)for(var l=0,a=i.length;l<a;l++){var h=i[l];r.data[t]==h[t]&&(h[e]=r.selected,r.data=h)}}}},_loadCacheDatas:function(){if(this._changedRowDatas&&0!=this._changedRowDatas.length&&this.get_primaryKey()){var t=this.get_primaryKey(),e=this.get_dataSource();e&&Array.forEach(this._changedRowDatas,function(i,n){var o=i[t];o!==undefined&&Array.forEach(e,function(e,n){e[t]==o&&Object.copyTo(i,e)},this)},this)}},_loadPreLoadedRow:function(t){var e=this._loadedItems;if(e&&!this._cachePager){var i=this.get_dataController(),n=this._getStartRecordIndex();this._mergeLoadedItems();if(this.get_events().getHandler("getLoadedItems")){for(o=0;o<t;o++){(s=e[o+n])||((s={}).data=i.getRecord(o),s.recordIndex=o,e[o+n]=s)}e=this._doGetLoadedItems()}for(var o=0;o<t;o++){var s=e[o+n];s&&i.modifyRecord(o,s.data)}}},_checkRelation:function(t,e,i){},_checkMultiSelectColumn:function(){var t=this._multiSelectColumn;t&&!t.get_readOnly()&&t.get_showHeaderCheckBox()&&t._setMultiSelectColumn(this.hasSelectedAll(),this.hasSelected())},hasSelectedAll:function(t){var e=this.get_recordCount();if(0==e)return!1;for(var i=this._checkHasMultiSelectColumn(),n=!1,o=0;o<e;o++)if(!this.isEmptyRow(o)&&this.getRowEnabled(o)&&this._getRowMultiSelectColumnEnabled(o)){var s=this.getRowData(o)[i];if(t){if(s)return!0}else{if(!s)return!1;n=!0}}return n},hasSelected:function(){return this.hasSelectedAll(!0)},_initFrozenDataRows:function(){var t=this.get_dataController().get_recordCount(),e=this.get_rowCount(),i=Math.max(t,e),n=new Sys.StringBuilder,o=this._frozenRowsTable;n.append('<table class="GridTable" border="0" cellpadding="0" style="'+o.style.cssText+'">'),n.append("<tbody>");for(var s=this.get_showRowNo(),r=s?this.get_events().getHandler("getRowNo"):null,l=this._getFrozenColumnRealCount(),a=this.get_allowCopy()?"":'unselectable="on" ',h=0;h<i;h++){var d=h<t;this._addRowFast(n,h,s,r,l,d,a)}n.append("</tbody>"),n.append("</table>"),$removeNode(o);var _=this._frozenBody;_.innerHTML=n.toString();var u=this._frozenRowsTable=_.firstChild;this._frozenRows=u.firstChild},_initDataRows:function(){this._rowsTable&&(this._rowCreated=!1,this._multiRowIndexs=[],this._initRealDataRows(),this.isFrozenGrid()&&this._initFrozenDataRows(),this._refreshColumnInfo(),this._initRowDeleteColumn(),this._afterInitDataRows(),this._rowCreated=!0)},_initRowDeleteColumn:function(){var t=this.get_dataController().get_recordCount(),e=Math.max(t,this.get_defaultRowCount()),i=this._rowDeleteColumn;if(i&&t<e)for(var n=t;n<e;n++){var o=this._getRow(n);i.doInit(o,n)}},_refreshColumnInfo:function(){this._activeColumn&&(this._activeColumn._lastCell=null,this._activeColumn=null);for(var t=this.get_columns(),e=0;e<t.length;e++){t[e]._lastCell=null}},_initRealDataRows:function(){this._rowsEnabled&&delete this._rowsEnabled,this.doBeforeDataBind(),this._mergeGroupDatas(),this._setSelectedRow(null);var t=this.get_dataController().get_recordCount(),e=(this.get_rowCount(),Math.max(t,this.get_defaultRowCount()));this._isLazyPageSize()&&(e=this._lazyPageSize,this._lazyIndex=1),this.get_allowPageCache()?this._loadCacheDatas():this._loadPreLoadedRow(t);var i=new Sys.StringBuilder,n=this._rowsTable,o=n.style.cssText;i.append('<table class="GridTable" border="0" cellspacing="0" cellpadding="0" style="'+o+'">'),i.append("<tbody>");for(var s=this.get_showRowNo(),r=s?this.get_events().getHandler("getRowNo"):null,l=this.get_columnCount(),a=this.get_allowCopy()?"":'unselectable="on" ',h=0;h<e;h++){var d=h<t;this._addRowFast(i,h,s,r,l,d,a)}i.append("</tbody>"),i.append("</table>"),0==e?(this._hasScrollLine=!0,i.append('<div class="ScrollBarLine" style="height:1px;'+o+'"></div>')):this._hasScrollLine=!1,this._clearExpandRow(),$removeNode(n);var _=this._body;_.innerHTML=i.toString();var u=this._rowsTable=_.firstChild;if(this._rows=u.firstChild,this._isLazyPageSize()){var c=this._moreBtn=$common.createClassDiv("MoreText");c.innerHTML="点击此处，继续加载更多数据...(共"+t+"条)",$common.addClickHandler(c,this.showNextMoreRows,this),_.appendChild(c)}this._initCellMerge(),this._initRowMerge(),this._calcColumnsSummary()},_afterInitDataRows:function(){this._activeCell=null,this._selectedRow=null,this._tempRow=null;this.get_dataController().get_recordCount()>0?(this.doAfterDataBind(),this.defaultShowEditor&&this._showFirstRowEditor(),this.doRemoveEmpty()):(this._dataSourceChanging&&this.doSelectionChanged(),this.doBindEmpty());var t=this;asyncCall(function(){t.get_isDisposed()||(t._initGridHeight(),t._internalFrozenRowsHeight(),t._doAdjustRowsTableWidth(),t._refreshScrollBar())}),this._checkMultiSelectColumn(),this._dataSourceChanging=!1},_addRowFast:function(t,e,i,n,o,s,r){var l=this.get_events().getHandler("cellRendering"),a=this._raiseRowRendering(null,!1,e,_Z_42.normal),h=this._getRowStyleFast(e,a,_Z_42.normal,!1);if(t.append('<tr class="'+h+'" _rowIndex="').append(e).append('"'),this._initRowVisible(t,e),t.append(">"),i){var d={rowNo:e},_=this._getRowNoHTMLFast(e,n,d);t.append('<td class="GridBodyRowNoCell" width="').append(this.get_rowNoColumnWidth()).append('">'),t.append(_),t.append("</td>")}for(var u=0;u<o;u++){var c=this.getColumnByIndex(u);if(c){var g=this._getCellStyleFast(e,c,u,!1,_Z_42.normal,s,l,null,a);t.append('<td class="'+g.className+'" ').append(r),t.append('width="').append(c.get_width()),c.get_textAlign()&&t.append('" align="').append(c.get_textAlign()),t.append('" _columnIndex="').append(u).append('"'),g.cssText&&t.append(' style="').append(g.cssText).append('"'),t.append(">"),t.append(c._initCellHTML(e,g.fontColor,s)),t.append("</td>")}}t.append('<td class="GridBodyCell"></td>'),t.append("</tr>")},_initRowVisible:function(t,e){},_raiseRowRendering:function(t,e,i,n){var o=null;if(t){o=$common.getChildrenByTagName(t,"td")[0]}var s=this._getStartRecordIndex()+i,r=null;this._isRowSelectableByIndex(i)&&(r=s+1);var l=this.get_events().getHandler("rowRendering");if(!l)return this.get_showRowNo()&&this._setDefaultRowNo(e,n,o,r,i),null;var a=new _Z_197(i,e,r,n);return l(this,a),r=a.get_rowNo(),o&&r&&this.get_showRowNo()&&(a._rowNoSetted?o.innerHTML='<div class="GridBodyRowNoCellText">'+r+"</div>":this._setDefaultRowNo(e,n,o,r,i)),a},_setDefaultRowNo:function(t,e,i,n,o){if((e==_Z_42.selected||e==_Z_42.none)&&i&&this.get_showRowIndicator()){var s=!1,r=this.get_events().getHandler("getRowNo");if(r&&n&&o<this.get_recordCount()){var l=new _Z_193(n,this.getRowData(o));r(this,l),(s=l._hasSetRowNo)&&(n=l.get_rowNo())}n||(n="&nbsp;"),i.innerHTML=t&&!s?"<div class=\"GridBodyRowNoCellText\"><span class='NoArrow'>&#9658;</span></div>":'<div class="GridBodyRowNoCellText">'+n+"</div>"}},add_beforeDataBind:function(t,e){return this.get_events().addHandler("beforeDataBind",t,e)},remove_beforeDataBind:function(t){this.get_events().removeHandler("beforeDataBind",t)},add_bodyScroll:function(t,e){return this.get_events().addHandler("_bodyScroll",t,e)},remove_bodyScroll:function(t){this.get_events().removeHandler("_bodyScroll",t)},doBeforeDataBind:function(){var t=this.get_events().getHandler("beforeDataBind");t&&t(this)},add_afterDataBind:function(t){this.get_events().addHandler("afterDataBind",t)},remove_afterDataBind:function(t){this.get_events().removeHandler("afterDataBind",t)},add_empty:function(t){this.get_events().addHandler("empty",t)},remove_empty:function(t){this.get_events().removeHandler("empty",t)},add_lazyPageLoaded:function(t){this.get_events().addHandler("lazyPageLoaded",t)},remove_lazyPageLoaded:function(t){this.get_events().removeHandler("lazyPageLoaded",t)},_doLazyPageLoaded:function(t,e){var i=this.get_events().getHandler("lazyPageLoaded");i&&i(this,{startIndex:t,endIndex:e})},doAfterDataBind:function(){var t=this.get_events().getHandler("afterDataBind");t&&t(this)},doRemoveEmpty:function(){$dom.removeCssClass(this.get_element(),"NoData"),this._emptyControl&&(this._emptyControl.clear&&this._emptyControl.clear(!0),this._emptyControl.dispose(),delete this._emptyControl)},doBindEmpty:function(){this._autoHeight||0!=this.get_rowCount()||$dom.addCssClass(this.get_element(),"NoData");var t=this.get_events().getHandler("empty");if(t){var e={isRefresh:this._isRefresh};t(this,e),e.emptyControl&&(this._emptyControl=e.emptyControl,e.emptyControl.appendTo(this._body),delete this._isRefresh)}},add_focus:function(t){this.get_events().addHandler("_focus",t)},remove_focus:function(t){this.get_events().removeHandler("_focus",t)},add_change:function(t,e){this.get_events().addHandler("_change",t,e)},remove_change:function(t){this.get_events().removeHandler("_change",t)},add_columnChanged:function(t,e){this.get_events().addHandler("columnChanged",t,e)},remove_columnChanged:function(t){this.get_events().removeHandler("columnChanged",t)},doChange:function(t,e,i){var n=this.get_events().getHandler("_change");if(n){n(this,new _Z_31(t,i,null,e))}var o=this.get_form();o&&o.doChange(),$common.setTestState("gridChanged")},get_columnCount:function(){var t=this._columns;return t?t.length:0},get_visibleColumnCount:function(){for(var t=0,e=0,i=this.get_columnCount();e<i;e++){this.getColumnByIndex(e).get_visible()&&t++}return t},_getColumnIndexByName:function(t,e){if(!t)return-1;t=t.toLowerCase();for(var i=this.get_columnCount(),n=0;n<i;n++){var o=this.getColumnByIndex(n),s=o.get_name(),r=o.get_dataField();if((s&&s.toLowerCase()==t||r&&r.toLowerCase()==t)&&(!e||o.get_visible()))return n}return-1},getColumn:function(t,e){var i=this.findColumn(t);if(!i&&!e)throw Error.invalidOperation("字段“"+t+"”不存在");return i},findColumn:function(t,e){var i=this._getColumnIndexByName(t,e);return i>=0?this.getColumnByIndex(i):null},getColumnByIndex:function(t){return this._columns[t]},_createNoTd:function(t,e){var i=$common.createTd();return i.className="GridBodyRowNoCell",e&&(i.width=e),t.appendChild(i),i},_createRow:function(t,e){var i=document.createElement("tr");i.className="GridBodyRow",this.get_showRowNo()&&this._createNoTd(i,this.get_rowNoColumnWidth());for(var n=0;n<e;n++){var o=this.getColumnByIndex(n),s=this._createCell(o);i.appendChild(s)}return i.appendChild(this._createTd()),i.setAttribute("_rowIndex",t),i},_createTd:function(t){var e=$common.createTd();return e.className=t?t.get_cellCssClass():"GridBodyCell",e},_createCell:function(t){var e=this._createTd(t);return t.get_visible()?t.get_nullDisplayText()&&(e.innerHTML=t._getEmptyHTML(!0)):e.className+=" dnone",e.width=t.get_width(),e.align=t.get_textAlign(),e.setAttribute("_columnIndex",t.get_index()),e},_addRow:function(t){var e=this._createRow(t,this.get_columnCount());if(this._rows.appendChild(e),this._hasScrollLine){var i=$common.getFirstChildByClassName(this._body,"ScrollBarLine");$removeNode(i),this._hasScrollLine=!1,this.doRemoveEmpty()}if(this._frozenRows){var n=this._createRow(t,this._getFrozenColumnRealCount());this._frozenRows.appendChild(n)}return e},_getRow:function(t){var e=this._rows.childNodes;if(!this._rowExpandColumn||this._isTree)return e[t];for(var i=0,n=e.length;i<n;i++){var o=e[i];if(this._getRowIndex(o)==t)return o}return e[t]},get_rowCount:function(){return $common.getChildrenByTagName(this._rows,"tr").length},_appendRow:function(){var t=this.get_rowCount(),e=this._addRow(t);return this._initRowNo(e,t),this._rowDeleteColumn&&this._rowDeleteColumn.doInit(e,t),e},_getEventTargetRow:function(t){var e=this._getEventRealRow(t);if(!e)return null;var i=t.target;if(i==this._rowsTable)return null;var n=this.get_element();if(e==n){for(var o=0;o<4;o++){if("TD"==i.tagName){e=i.parentNode;break}if(!(i=i.parentNode))break}if(e==n)return null}if(this.isFrozenGrid()){var s=this._getRowIndex(e);e=this._getRow(s)}return e},_getEventRealRow:function(t){var e=this.get_element(),i=t.target;if(this._rowExpandColumn)for(;i&&i!=e;){if("TR"==i.tagName&&i.getAttribute("_isExpandDetail"))return null;i=i.parentNode}if(this._useCustomColumnPlugin)for(;i&&i!=e;){if("TR"==i.tagName)return null!=i.getAttribute("_rowIndex")?i:null;i=i.parentNode}return e},_getEventTargetCell:function(t,e){var i=e.target;if(i.parentNode&&"TD"==i.parentNode.tagName&&(i=i.parentNode),"TD"!=i.tagName&&(i=$common.getFirstParentByTagName(i,"td")),this.isFrozenGrid()){var n=this._getCellColumnIndex(i);if(n<=this._getFrozenColumnRealCount()){var o=$common.getChildrenByTagName(t,"td");this.get_showRowNo()&&n++,n<o.length&&(i=o[n])}}var s=$common.getChildrenByTagName(t,"td"),r=Array.indexOf(s,i);return this.get_showRowNo()&&r--,r>=0?i:null},_focusBody:function(){if(this.get_strongFocus()&&this.get_visible())try{this._body.focus()}catch(t){}},set_strongFocus:function(t){this._strongFocus=t},get_strongFocus:function(){return this._strongFocus},focus:function(t){if(!this.get_isDisposed()){this._focusBody(),Sys.Browser.isIE8&&this._focusRowsTable();var e=this._selectedRow;if(!e&&this.get_rowCount()>0&&(e=this._getRow(0),this._setSelectedRow(e)),e)if(this.get_readOnly())this._focusRowsTable(t);else{this._focusRowFirstCell(e);var i=this._getEditingColumnIndex();if(i>=0)this._focusRowCell(e,i);else{this._focusRowFirstCell(e)||this._focusRowsTable()}}this._notifyFormFocusControl()}},_scrollToTop:function(){var t=this._body;t&&t.scrollTop>0&&(t.scrollTop=0)},_notifyFormFocusControl:function(){var t=this.get_form();if(t){var e=t.get_focusedControl();t.set_focusedControl(this),window.focusedControl=this;var i=this.get_events().getHandler("_focus");i&&e!=this&&i(this)}},setRowsHint:function(t){var e=this._rows;e&&(e.title=t)},setRowHint:function(t,e){this._checkRowIndex(t);this._getRow(t).title=$common.htmlDecode(e)},setRowBgColor:function(t,e){this._setRowCellColor(t,"_bgColor",e)},setRowFontColor:function(t,e){this._setRowCellColor(t,"_fontColor",e)},_setRowCellColor:function(t,e,i){this._checkRowIndex(t);for(var n=this._getRow(t),o=this._getFirstColumnCellIndex(),s=$common.getChildrenByTagName(n,"td"),r=this.get_columnCount(),l=0;l<r;l++){s[o+l][e]=i}this._setRowStyle(n,_Z_42.normal)},setRowColumnBgColor:function(t,e,i){this._checkRowIndex(t);var n=this._getRow(t),e=this._internalGetColumn(e),o=this._getRowCell(n,e.get_index());o._bgColor=i,o._columnBgColor=i,this._setRowStyle(n,_Z_42.normal)},setRowColumnEnabled:function(t,e,i){this._checkRowIndex(t);var n=this._getRow(t);if(!(e=this._internalGetColumn(e)).setEditable)throw Error.invalidOperation("列“"+e.get_dataField()+"”不支持 setRowColumnEnabled");var o=this._getRowCell(n,e.get_index());e.setEditable(i,o)},setRowColumnVisible:function(t,e,i){this._checkRowIndex(t);var n=this._getRow(t),e=this._internalGetColumn(e),o=this._getRowCell(n,e.get_index()).firstChild;o&&o.tagName&&$dom.setCssClass(!i,o,"dnone")},setRowVisible:function(t,e){this._checkRowIndex(t);var i=this._getRow(t);$dom.setVisible(i,e),this.isFrozenGrid()&&(i=this._getFrozenRow(t),$dom.setVisible(i,e))},add_rowMouseHover:function(t){this.get_events().addHandler("rowMouseHover",t)},remove_rowMouseHover:function(t){this.get_events().removeHandler("rowMouseHover",t)},get_mouseHoverRowData:function(){return this._getRowDataByRowElement(this._mouseHoverRow)},_getRowIndex:function(t){var e=t.getAttribute("_rowIndex");return"string"==typeof e?parseInt(e):e},get_mouseHoverRowIndex:function(){return this._mouseHoverRow?this._getRowIndex(this._mouseHoverRow):-1},get_activeRowData:function(){var t=this.get_mouseHoverRowData();return t||this.get_selectedRowData()},add_bodyMouseOut:function(t){this.get_events().addHandler("bodyMouseOut",t)},remove_bodyMouseOut:function(t){this.get_events().removeHandler("bodyMouseOut",t)},_gridScrollToStart:function(){this._noScrollToStart?delete this._noScrollToStart:this._body&&this._body.scrollLeft>0&&(this._body.scrollLeft=0,this._bodyScroll())},_gridScroll:function(){this._body.scrollLeft>0&&(this._body.scrollLeft-=1,this._bodyScroll())},_bodyScroll:function(t){if(!this.get_isDisposed()){var e=this._body.scrollLeft;this._headerBar&&(this._headerBar.scrollLeft=e),this._footerBar&&(this._footerBar.scrollLeft=e),this._filterBar&&this._filterBar.scrollLeft(e),this.isFrozenGrid()&&(this._frozenBody.scrollTop=this._body.scrollTop,this._frozenBody.scrollWidth-2>this._frozenBody.clientWidth&&(this._frozenHeaderBar&&(this._frozenHeaderBar.scrollLeft=e),this._frozenBody.scrollLeft=e,this._frozenFooterBar&&(this._frozenFooterBar.scrollLeft=e)));var i=this._body.scrollTop+this._body.clientHeight==this._body.scrollHeight;i&&this.showNextMoreRows(),t&&this._doScroll(i)}},_doScroll:function(t){var e=this.get_events().getHandler("_bodyScroll");if(e){this._bodyScrollTimer&&(clearTimeout(this._bodyScrollTimer),delete this._bodyScrollTimer);var i="down";this._topV||(this._topV=this._body.scrollTop),this._leftV||(this._leftV=this._body.scrollLeft);var n=this._body.scrollTop,o=this._body.scrollLeft;n<this._topV?i="up":n>this._topV&&(i="down"),o<this._leftV?i="left":o>this._leftV&&(i="right"),this._topV=n,this._leftV=o;var s=this;this._bodyScrollTimer=setTimeout(function(){var n=new _Z_280(s,t,i);e(s,n)},100)}},get_visibleColumns:function(){if(!this._body)return this._columns;var t=this._body.scrollWidth,e=this._body.clientWidth,i=this._body.scrollLeft+e;if(i==t)return this._columns;for(var n=this.get_showRowNo()?this.get_rowNoColumnWidth():0,o=[],s=0,r=this._columns.length;s<r;s++){var l=this._columns[s];if(o.push(l),l.get_visible()&&(n+=l.get_width())>=i)break}return o},_bodyMouseOut:function(t){this._rowsMouseOut(),this._clearMouseOver();var e=this.get_events().getHandler("bodyMouseOut");if(e){e(this,new _Z_192(!1,t.clientX,t.clientY,null,t))}},_tableMouseMove:function(t){if(this._checkEventInTable(t)){this._clearMouseOver();var e=this;e._mouseHoverTimer=setTimeout(function(){if(!e.get_isDisposed()){var i=e._getEventTargetRow(t);e._rowsMouseOut(i),i&&(e._mouseHoverRow=i,e._rowsMouseOver(i,t))}},e._mouseHoverTime)}},_rowsMouseOut:function(t){this._mouseHoverRow&&this._mouseHoverRow!==t&&(this._setRowStyle(this._mouseHoverRow,_Z_42.normal),delete this._mouseHoverRow)},_clearMouseOver:function(){this._mouseHoverTimer&&(clearTimeout(this._mouseHoverTimer),this._mouseHoverTimer=null)},_rowsMouseOver:function(t,e){this.doRowMouseHover(e,t),this._setRowStyle(t,_Z_42.hover),this._doCellWordWrap(t,e)},_doCellWordWrap:function(t,e){if(!this.get_wordWrap()){var i=this._hoverColumn;if(!i){var n=this._getEventTargetCell(t,e);if(!n)return;i=this._getCellColumn(n)}i&&(i.getIsCommandColumn()||i instanceof Sys.UI.Controls.DynamicColumn||this._handleNoWrapTextHint(e))}},doRowMouseHover:function(t,e){var i=null,n=this._getEventTargetCell(e,t);n&&(i=this._getCellColumn(n)),this._hoverColumn=i,i&&i.doMouseOver&&i.doMouseOver(t);var o=this.get_events().getHandler("rowMouseHover");if(o){var s=this._getRowIndex(e);o(this,new _Z_192(!0,t.clientX,t.clientY,i,t,s))}},_handleNoWrapTextHint:function(t){var e=t.target,i=$common.getFirstParentByClassName(e,"GridBodyCell","GridBody");if(i){var n="",o=i.offsetWidth,s=window.__calcWidthDiv;s||(s=window.__calcWidthDiv=$common.createClassDiv("GridBodyCellText GridHintNoWrapCell"),document.body.appendChild(s)),s.innerHTML=e.innerHTML,s.offsetWidth>o&&(n=e.innerHTML,n=$common.clearHTMLTag(n).replace(/&nbsp;/gi," ")),n&&(e._title=n)}},_footerMouseOver:function(t){this._handleNoWrapTextHint(t)},get_mouseHoverTime:function(){return this._mouseHoverTime},set_mouseHoverTime:function(t){this._mouseHoverTime=t},_clearMouseHoverTimer:function(){this._mouseHoverTimer&&(this._mouseHoverTimer=null,clearTimeout(this._mouseHoverTimer),delete this._mouseHoverTimer)},_doShowEditorEvents:function(t){var e=t.target,i=this._getEventTargetRow(t);if(!this._curRow||this._curRow==i)if(i){this._activeRow=i;var n=this._getEventTargetCell(i,t);if(n){var o=this._getCellColumn(n);if(!this._activeColumn||o==this._activeColumn)if(this._activeColumn=o,o)if(o._activeElement=e,this._isRowSelectable(i)){i!=this._selectedRow&&this._setSelectedRow(i),!this.get_readOnly()&&o._isRowAllowEditor(i)?(this._showEditor(n,!1,o),this.setActiveCell(n,o)):(this.setActiveCell(n,o),this._doFocusColumnChange(o));var s=this._multiSelectColumn;s&&s.get_toggleByClickRow()&&!o.getIsCommandColumn()&&!s.get_readOnly()&&o.get_readOnly()&&s.get_visible()&&o!=s&&asyncCall($createDelegate(this,function(){this._toggleSelectedRowSelected()}))}else this.setActiveCell(n,o,!0);else this.setActiveCell(n,o,!0)}}else this._activeRow=null},_doRowClick:function(t,e,i){this._clickTarget=i.target,e=null!==e?e:this._activeRow?this._getRowIndex(this._activeRow):this._selectedRowIndex,this._activeColumn&&this._activeColumn.raiseClick&&this._activeColumn.raiseClick(e,i);var n=this.get_events().getHandler("rowClick");if(n){n(this,new _Z_202(e,t,i))}},_checkEventInTable:function(t,e){return e=e||[this._rowsTable,this._frozenRowsTable],$craba.contains(t.target,e)},_tableMouseWheel:function(t){if(this._checkEventInTable(t)){var e=0,i=t.wheelType,n=this.get_recordCount();i<0?e=this._scrollUsePageSize&&n>30?Sys.UI.Key.pageUp:Sys.UI.Key.up:i>0&&(e=this._scrollUsePageSize&&n>30?Sys.UI.Key.pageDown:Sys.UI.Key.down),e>0&&(t.keyCode=e,this._rowsKeyDown(t))}},_tableMouseUp:function(t){this._checkEventInTable(t,[this._headerBar,this._frozenHeaderBar])?this._doHeaderClick(t):this._checkEventInTable(t)&&(0==t.button?(this._checkDrag&&(this._clearStyle(),this._saveSelectRowIndex(),this._checkDrag=!1),this._isResizing||_Z_238.IsDraging||(this._processDragEvent(!1),this._doRowsMouseUp(t))):this._doRowsMouseUp(t))},_doHeaderClick:function(t){var e=this.get_events().getHandler("headerClick");if(e){var i=t.target;if($dom.hasClass(i,"GridHeaderCaptionText")){for(var n=i.parentNode,o=null,s=!1,r=0,l=this.get_columnCount();r<l;r++)if((o=this.get_columns()[r])._elements.header==n){s=!0;break}s&&e(this,{column:o,event:t})}}},_doRowsMouseUp:function(t){this.endEdit(),this._doShowEditorEvents(t),this._activeColumn&&this._doRowClick(this._activeColumn,null,t),this._prevCell=this._activeCell},_tableMouseDown:function(t){if(this._checkEventInTable(t)&&!this._isResizing){this._initDrag(t),this.get_readOnly()||this._focusBody(),this._activeColumn=null;var e=this._getEventTargetRow(t);if(e){this._checkMultiSelectedRows(t,e),e!=this._selectedRow?(this._setSelectedRow(e,!0),this._curRow=e):this._curRow=null;var i=this._getEventTargetCell(e,t);i&&(this._activeColumn=this._getCellColumn(i)),this._notifyFormFocusControl()}else this._curRow=null;var n=!0;Sys.Browser.isStandard&&(n=!this.get_allowCopy()),(n=n||this.get_allowDrag()||this.get_allowDrop())&&t.cancel(),$craba.raiseMouseDown(t)}},_checkMultiSelectedRows:function(t,e){if(this._allowMultiSelectedRow){var i=this._getRowIndex(e);if(this._startRowIndex=i,t.ctrlKey)this._hasShift=!1,0==this._multiRowIndexs.length&&this._selectedRow!=e&&this._saveSelectRowIndex(),Array.contains(this._multiRowIndexs,i)||this._multiRowIndexs.push(i);else if(t.shiftKey&&this._selectedRow){this._hasShift||(this._firstRow=this._selectedRow),this._hasShift=!0;var n=this._getRowIndex(this._firstRow),o=Math.max(i,n),s=Math.min(i,n);this._clearStyle(),this._multiRowIndexs=[];for(var r=s;r<=o;r++){this._multiRowIndexs.push(r);e=this._getRow(r);this._setRowStyle(e,_Z_42.selected)}}else this._hasShift=!1,Array.contains(this._multiRowIndexs,i)?this._checkDrag=!0:(this._clearStyle(),this._multiRowIndexs=[i],this._checkDrag=!1)}},_saveSelectRowIndex:function(){this._selectedRow?this._multiRowIndexs=[this._selectedRowIndex]:this._multiRowIndexs=[]},_clearStyle:function(t){var e=this._multiRowIndexs.length;if(!(e<2)||t)for(var i=0;i<e;i++){var n=this._multiRowIndexs[i],o=this._getRow(n);this._setRowStyle(o,_Z_42.none,!0)}},get_dragField:function(){return this._dragField},set_dragField:function(t){this._dragField=t},get_allowDrag:function(){return this._allowDrag},set_allowDrag:function(t){this._allowDrag=t,t&&(this._allowMultiSelectedRow=t)},get_dragOrSelect:function(){return this._allowDrag||this._allowMultiSelectedRow},get_allowMultiSelectedRow:function(){return this._allowMultiSelectedRow},set_allowMultiSelectedRow:function(t){this._allowMultiSelectedRow=t},get_allowDrop:function(){return this._allowDrop},set_allowDrop:function(t){this._allowDrop=t},_getCellColumnIndex:function(t){if(!t)return-1;var e=t.getAttribute("_columnIndex");return"string"==typeof e?parseInt(e):e},_getCellColumn:function(t){var e=this._getCellColumnIndex(t);return e>=0?this.getColumnByIndex(e):null},_tableDblClick:function(t){if(!t||this._checkEventInTable(t)){var e=this._selectedRow;if(e&&(!t||this._getEventTargetRow(t)==e)){var i=!0,n=null;if(t){var o=this._getEventTargetCell(e,t);if(o){if(!(n=this._getCellColumn(o)))return;n.CurrentCell=o,n&&(this.get_readOnly()||n.get_immediateEditor()&&(i=!1),i&&!n.get_isEditing()&&(i=!n.doReadOnlyDblClick()),n._hasPage&&(i=!1,delete n._hasPage))}}else{this.get_events().hasEvent("rowEnterPress")&&(this.doRowEnterPress(),i=!1)}i&&this.doRowDblClick(n)}}},add_headerClick:function(t){this.get_events().addHandler("headerClick",t)},remove_headerClick:function(t){this.get_events().removeHandler("headerClick",t)},add_rowEnterPress:function(t){this.get_events().addHandler("rowEnterPress",t)},remove_rowEnterPress:function(t){this.get_events().removeHandler("rowEnterPress",t)},doRowEnterPress:function(t){var e=this.get_events().getHandler("rowEnterPress");if(e){var i=new _Z_162,n=null;try{e(this,i)}catch(s){n=s}var o=i.get_cancel();if(o&&t&&t.cancel(),n)throw n;return o}return!1},add_rowDblClick:function(t){this.get_events().addHandler("rowDblClick",t)},remove_rowDblClick:function(t){this.get_events().removeHandler("rowDblClick",t)},doRowDblClick:function(t){var e=this.get_events().getHandler("rowDblClick");e&&e(this,t)},get_selectedRowIndex:function(){return this._selectedRow?this._getRowIndex(this._selectedRow):-1},set_selectedRowIndex:function(t){this.get_form()&&!this.get_form().get_isDisposed()&&t>=0&&t<this.get_rowCount()&&(this._setSelectedRow(this._getRow(t)),this._clearStyle(!0))},add_selectionChanged:function(t,e){return this.get_events().addHandler("selectionChanged",t,e)},remove_selectionChanged:function(t){this.get_events().removeHandler("selectionChanged",t)},set_selectionDelayTimer:function(t){this._selectionDelayTimer=t},get_selectionDelayTimer:function(){return this._selectionDelayTimer},doSelectionChanged:function(){var t=this.get_events().getHandler("selectionChanged");if(t&&!this._cancelRowChangeHandler){if(this._selectionDelayTimer<=0)return t(this);var e=this;e._selectionDelayTool&&clearTimeout(e._selectionDelayTool),e._selectionDelayTool=setTimeout(function(){t(e),e._selectionDelayTool=null},this._selectionDelayTimer)}},get_selectedRowData:function(t,e){this._closeDropDown(!0);var i=this._getRowDataByRowElement(this._selectedRow);if(!i)return null;if(this.hasMergeRows()&&!t){var n=i[this._dataGroupField];if(!(l=this._mergeGroupData[n]))return e?Object.clone(i):i;if(!this._clickTarget)return i;var o=$common.getFirstParentByClassName(this._clickTarget,"GridBodyCell","GridBodyRow");if(!o)return i;var s=$common.getFirstChildByClassName(o,"MergeCell");if(!s)return i;var r=s.childNodes;return $dom.hasClass(this._clickTarget,"GridBodyCellText")||$dom.hasClass(this._clickTarget,"GridDynamicButtonBody")||(this._clickTarget=this._clickTarget.parentNode),index=Array.indexOf(r,this._clickTarget),index<=0?i:l[index-1]}if(t){var l=[];return l.push(i),this._addMergeRowData(i,l),e?Object.clone(l):l}return e?Object.clone(i):i},clearSelectedRowData:function(){var t=this._selectedRow;if(t){var e=this._getRowIndex(t),i=this.get_dataController().clearRecord(e);this.modifySelectedRowData(i)}this._checkMultiSelectColumn()},_getRowDataByRowElement:function(t){if(!t)return null;var e=this._getRowIndex(t);return this.get_dataController().getRecord(e)},_showFirstRowEditor:function(){var t=this._getRow(0);t&&(this._setSelectedRow(t,!0),this._checkShowImmediateEditor(t))},_checkShowImmediateEditor:function(t){if(!this.get_readOnly()&&!this.get_isDisposed()&&this.defaultShowEditor)for(var e=0,i=this.get_columnCount();e<i;e++){var n=this.getColumnByIndex(e);if(n.get_immediateEditor()){var o=this._getRowCell(t,e);o&&this._doCellBeginEdit(n,o,t,!1)&&n._doShowEditor(o,!1)}}},_setSelectedRow:function(t,e){return!(t&&!this._isRowSelectable(t))&&(this._selectedRow!=t&&(!this._beforeSelectedRow(t)&&(t&&(this._selectedRowIndex=this._getRowIndex(t)),this.refreshSelectedRowStyle(),this._doSelectedRow(t,e),!0)))},_beforeSelectedRow:function(t){if(this._selectedRow){if(this.get_readOnly()||this._hideEditor(),this._doSelectionBeforeChanged())return!0;var e=this._selectedRow;this._selectedRow=t,this._setRowStyle(e,_Z_42.none)}this._selectedRow=t},_doSelectedRow:function(t,e){this._selectedRow&&(e&&!this.get_autoHeight()||this._isChildGrid()||this._scrollSelectedRowToView(),this.doSelectionChanged(),this._doImmediateEditor())},_doImmediateEditor:function(){for(var t=this._selectedRow,e=0,i=this.get_columnCount();e<i;e++){var n=this.getColumnByIndex(e);if(n.get_immediateEditor()){var o=this._getRowCell(t,e);this._doCellBeginEdit(n,o,t,!1)}}},_scrollSelectedRowToView:function(){this.get_showScrollBar()&&$common.scrollToView(this._selectedRow,this._body,this.get_element())},add_selectionBeforeChanged:function(t){this.get_events().addHandler("selectionBeforeChanged",t)},remove_selectionBeforeChanged:function(t){this.get_events().removeHandler("selectionBeforeChanged",t)},_doSelectionBeforeChanged:function(){var t=this.get_events().getHandler("selectionBeforeChanged");if(t&&!this._cancelRowChangeHandler){this._cancelRowChangeHandler=!0;var e=new _Z_162;if(t(this,e),e.get_cancel())return!0;this._cancelRowChangeHandler=!1}return!1},add_selectionColumnChanged:function(t){this.get_events().addHandler("selectionColumnChanged",t)},remove_selectionColumnChanged:function(t){this.get_events().removeHandler("selectionColumnChanged",t)},_blurFromColumn:function(){var t=this;setTimeout(function(){if(!t.get_isDisposed()){var e=!1,i=t.findForm();if(i)if(t.lastAltKey)delete t.lastAltKey;else{var n=i.get_focusedControl();if(n)if(n==t)e=!1;else if(n.get_owner){e=n.get_owner()!=t}else e=!0;else e=null==$common._lastDropDownEdit;if(e){var o=t.get_events().getHandler("selectionColumnChanged");t._hideEditor(),o&&o(t),n||(window.focusedControl=t,i.set_focusedControl(t))}}}},100)},get_owner:function(){return this._owner},set_owner:function(t){this._owner=t},add_pagerPageBeforeChanged:function(t){this.get_events().addHandler("pagerPageBeforeChanged",t)},remove_pagerPageBeforeChanged:function(t){this.get_events().removeHandler("pagerPageBeforeChanged",t)},_internalDoPagerPageBeforeChanged:function(t){this._initLoadedItems();var e=this.get_events().getHandler("pagerPageBeforeChanged");if(e){var i=new _Z_162;return i.pageIndex=t,e(this,i),!i.get_cancel()}return!0},refreshSelectedRowStyle:function(){this._selectedRow&&this._setRowStyle(this._selectedRow,_Z_42.selected)},refreshStyle:function(){for(var t=0,e=this.get_rowCount();t<e;t++){var i=this._getRow(t);this._setRowStyle(i,_Z_42.normal)}},_initRowStyle:function(t){t&&this._setRowStyle(t,_Z_42.normal)},get_activeColumn:function(){return this._activeColumn},get_prevCell:function(){return this._prevCell},get_activeCell:function(){return this._activeCell},setActiveCell:function(t,e,i){if(t!=this._activeCell&&(this._activeCell&&$dom.removeCssClass(this._activeCell,"active"),this._activeColumn=e,this._activeCell=t,$dom.addCssClass(t,"active"),!i)){var n=this.get_events().getHandler("activeCell");n&&n(this)}},add_activeCell:function(t,e){this.get_events().addHandler("activeCell",t,e)},remove_activeCell:function(t){this.get_events().removeHandler("activeCell",t)},add_rowClick:function(t,e){this.get_events().addHandler("rowClick",t,e)},remove_rowClick:function(t){this.get_events().removeHandler("rowClick",t)},get_pageSize:function(){var t=this.findPager();return t&&(this._pageSize=t.get_pageSize()),this._pageSize},set_pageSize:function(t){this._pageSize=t;var e=this.findPager();e&&e.set_pageSize(t)},_focusRowsTable:function(t){if(this.get_strongFocus()&&this._body){var e=this._rowsTable,i=this._body,n=i.scrollTop;asyncCall(function(){try{e.focus(),t?i.scrollTop=0:n>0&&i.scrollTop!=n&&(i.scrollTop=n)}catch(o){}})}},_doEnterKeyDown:function(t,e,i){e?this.doRowEnterPress(t)||this._hasEditor()||this._focusRowFirstCell(i):this._tableDblClick()},_rowsKeyDown:function(t){var e=t.keyCode,i=this.get_readOnly(),n=this._selectedRow,o=!1;!i&&n&&(o=!0);var s=n?this._getRowIndex(n):-1,r=this.get_rowCount(),l=this.get_recordCount(),a=s,h=this.findPager(),d=!1;this.lastAltKey=t.altKey;var _=!1;switch(e){case Sys.UI.Key.left:case Sys.UI.Key.right:break;case Sys.UI.Key.enter:this._doEnterKeyDown(t,o,n),d=!0;break;case Sys.UI.Key.esc:o&&this._hasEditor()&&(this._exitEdit(),d=!1);break;case Sys.UI.Key.up:s>=0&&(a=s-1),_=!0;break;case Sys.UI.Key.down:s>=0&&(a=s+1),_=!0;break;case Sys.UI.Key.pageUp:h&&!h.get_showAll()?(this.endEdit(),h.prevPage(),d=!0):s>=0&&(a=s-this.get_pageSize())<0&&(a=o?0:s-1),_=!0;break;case Sys.UI.Key.pageDown:if(h&&!h.get_showAll())this.endEdit(),h.nextPage(),d=!0;else if(s>=0){var u=this.get_pageSize();u>l&&(u=parseInt(l/4)),(a=s+u)>=l&&(a=o?l-1:s+1)}_=!0;break;case Sys.UI.Key.home:h&&this.get_readOnly()?(this.endEdit(),h.firstPage(),d=!0):i&&(a=0);break;case Sys.UI.Key.end:h&&this.get_readOnly()?(this.endEdit(),h.lastPage(),d=!0):i&&(a=l-1);break;case Sys.UI.Key.del:d=this._doDelKeyDown(t);break;case Sys.UI.Key.space:d=this._doSpaceKeyDown(t,n)}(d=this._moveSelectedRow(a,s,r,l,o,h,d,t,_))?t.cancel():this.doRowKeyDown(t)},_doDelKeyDown:function(t){if(t.ctrlKey||t.altKey||t.shiftKey){if(!this.get_readOnly()&&!this.get_modifyOnly())return this._checkDeleteSelectedRow(),this.focus(),!0}return!1},_doSpaceKeyDown:function(t,e){var i=this._multiSelectColumn;return!(!i||i.get_readOnly()||!i.get_visible()||!this._getHasNoOtherEditColumn())&&(e&&(t.cancel(),this._toggleSelectedRowSelected()),!0)},_getExpandRowIndex:function(t){return this._getRowIndex(t)},_getActiveColumnIndex:function(){var t=this._activeColumn;return t?t.get_index():-1},_moveSelectedRow:function(t,e,i,n,o,s,r,l,a){if(t==e)return r;var h=this._checkChildGrid(t,e,n);if(null!=h)return h;if(-1==t&&null==e?t=i-2:this._isExpandRow(t)?t++:e<0&&null!=e&&(t=0),$settings.GridDefaultChangePageByRecord&&(i=n),t>=0&&t<i){var d=-1;o&&(d=this._getEditingColumnIndex());var _=this._getRow(t),u=this._setSelectedRow(_);if(-1==d&&this._multiSelectColumn&&this._multiSelectColumn.get_strongFocus()&&(d=this._multiSelectColumn.get_index()),d>=0&&this.defaultShowEditor){this._focusRowCellWrap(_,d,null,a)||asyncCall($createDelegate(this,this._mustbeFocusNext))}r=u}else r||!s&&!this._isLazyPageSize(!0)||(t<0?(this.endEdit(),s&&s.prevPage()):t>=n?(this.endEdit(),s&&s.nextPage()):t>=this._lazyIndex*this._lazyPageSize&&this.showNextMoreRows());return r},_isExpandRow:function(t){var e=this._getRow(t);return e&&e.getAttribute("_isExpandDetail")},_mustbeFocusNext:function(){var t=this._selectedRow;t&&(t.children[0].focus(),this._notifyFormFocusControl())},_hasChildGrid:function(){return!!this._expandChildForms&&Object.keys(this._expandChildForms).length>0},_checkChildGrid:function(t,e,i){if(this._hasChildGrid())return!0;if(!this._isChildGrid())return null;var n=this.get_form(),o=n._parentGrid;return-1==t&&0==e?!!this._isFirstTop&&(this._isFirstTop=!1,o.set_selectedRowIndex(n._parentGridRowIndex-1),!0):t>=i?(o.set_selectedRowIndex(n._parentGridRowIndex+1),!0):(this._isFirstTop=!0,this._isFirstBottom=!0,null)},_getHasNoOtherEditColumn:function(){for(var t=0,e=this.get_columnCount();t<e;t++){var i=this.getColumnByIndex(t);if(!(i instanceof Sys.UI.Controls.MultiSelectColumn)&&!i.get_readOnly())return!1}return!0},_exitEdit:function(){this._hideEditor(),this.refreshSelectedRowStyle(),this._focusRowsTable()},add_rowKeyDown:function(t,e){this.get_events().addHandler("rowKeyDown",t,e)},remove_rowKeyDown:function(t){this.get_events().removeHandler("rowKeyDown",t)},doRowKeyDown:function(t){var e=this.get_events().getHandler("rowKeyDown");return!!e&&(!!e(this,t)&&(t.cancel(),!0))},set_scrollUsePageSize:function(t){this._scrollUsePageSize=t},get_scrollUsePageSize:function(){return this._scrollUsePageSize},_headerContextMenu:function(t){this.get_enabled()&&(t.cancel(),this._initHeaderMenu(),this._initColumnVisibleItem(t),this._headerPopupMenu.popupAt(t.clientX-18,t.clientY+10),$common.hideToolTip(3))},_initHeaderMenu:function(){if(!this._headerPopupMenu){var t=[{properties:{text:"列配置",icon:"aicon-shezhi"},events:{click:$createDelegate(this,this._headerColumnConfigItemClick)}},{properties:{text:"隐藏此列",icon:"aicon-yincang"},events:{click:$createDelegate(this,this._headerColumnVisibleItemClick)}}];this.get_allowCollection()&&t.push({properties:{text:"数据汇总",icon:"aicon-shezhi"},events:{click:$createDelegate(this,this._headerColumnDataCollection)}}),this.get_allowSubtotal()&&Array.add(t,{properties:{text:"数据小计",icon:"aicon-shezhi"},events:{click:$createDelegate(this,this._headerColumnDataSubTotal)}}),this._headerPopupMenu=Sys.UI.Controls.Menu.create(this.get_form(),{id:this.get_idPart()+"_headerPopup",items:t})}},_initColumnVisibleItem:function(t){for(var e=t.target;"GridHeader"!=e.className&&"TD"!=e.tagName;)e=e.parentNode;var i=this._headerPopupMenu.get_idPart(),n=this.get_form()[i+"_1"];n.set_visible(!1);var o=e.getAttribute("id");if(o){var s=this.get_id()+"_column",r=parseInt(o.replace(s,""));if(!(isNaN(r)||r>this._columns.length-1||r<0)){var l=this.getColumnByIndex(r);l.get_allowConfig()&&this._checkColumnHide(l)&&(n._column=l,n.set_visible(!0))}}},_headerColumnConfigItemClick:function(t){this.config(!0)},_headerColumnVisibleItemClick:function(t){this._noScrollToStart=!0;var e=t._column;e.set_visible(!1,!0);var i=this.get_frozenColumnCount();i>0&&(e.get_frozenIndex()<i&&this.setFrozenColumnCount(--i),this._internalFrozenRowsHeight()),this._configDataChanged=!0},_checkColumnHide:function(t){for(var e=0,i=this._columns,n=0,o=i.length;n<o;n++){if((l=i[n]).get_visible()&&e++,e>2)break}if(e<=2)return!1;for(var s=t.get_bandIndex(),r=0,n=0,o=i.length;n<o;n++){var l=i[n];if(l.get_bandIndex()==s&&l.get_visible()&&r++,r>1)break}return!(r<=1)},doColumnDataCollection:function(){this.get_allowCollection()&&this._headerColumnDataCollection()},_headerColumnDataCollection:function(t){var e=new Sys.UI.Form(this,0,0,!0);e._targetGrid=this;var i=this.get_form().get_scriptPath().trim(),n=this.findPager(),o={path:i.substring(0,i.length-5),gridId:this.get_id()};e._queryParams=n?n.get_queryParams():{},e.showModal("~/_Sys/UI/Collection/CollectionConfig.gspx",o)},doColumnDataSubTotal:function(){this.get_allowSubtotal()&&this._headerColumnDataSubTotal()},_headerColumnDataSubTotal:function(t){if(this._state!=_Z_43.subtotl){var e=new Sys.UI.Form(this,0,0,!0);e._targetGrid=this;var i=this.get_form().get_scriptPath().trim(),n={path:i.substring(0,i.length-5),gridId:this.get_id()};e.add_closed(function(){e.subtotal&&t&&t.set_text("取消小计")},e),e.showModal($common.getSysUIBaseURI()+"Collection/SubtotalConfig.gspx",n)}else if(t&&t.set_text("数据小计"),this.set_state(_Z_43.normal),null!=this.get_pagerId()){this.get_pager().refresh({__sbutotalModel:1,__cancel:!0})}else{for(var o=this.getData(),s=o.length-1;s>=0;s--)o[s][this._subtotalRowFlag]&&Array.removeAt(o,s);this.dataBind(o)}},_gridContextMenu:function(t){var e=this.get_events().getHandler("contextMenu");if(e){var i=new _Z_162(t);if(i.event=t,e(this,i),i.menu&&(this._customMenu=i.menu),i.get_cancel())return void t.cancel()}if(t.target!=this._body||this._useBodyMenu){this._activeColumn&&this._activeColumn._rightClick(t);this._selectedRow;var n=this.get_popupMenu();if(n){var o=$craba.findControl(n,this.get_form());o.TargetGrid=this,o.popupAt(t.clientX,t.clientY),t.cancel()}}},_hideMenu:function(){this._customMenu&&!this._customMenu.get_isDisposed()&&this._customMenu.hide();var t=this.get_popupMenu();t&&this.get_form()[t]&&this.get_form()[t].hide()},add_contextMenu:function(t,e){this.get_events().addHandler("contextMenu",t,e)},remove_contextMenu:function(t){this.get_events().removeHandler("contextMenu",t)},add_multiSelecting:function(t,e){this.get_events().addHandler("multiSelecting",t,e)},remove_multiSelecting:function(t){this.get_events().removeHandler("multiSelecting",t)},add_multiSelected:function(t,e){this.get_events().addHandler("multiSelected",t,e)},remove_multiSelected:function(t){this.get_events().removeHandler("multiSelected",t)},focusSelectedRowColumn:function(t,e){var i=!0;if(this._body.scrollTop>0){i=$common.findFocusedGrid(this.get_form())!=this}i&&this._focusRowsTable(),this._focusRowColumn(this._selectedRow,t,e)},focusRowColumn:function(t,e){this.set_selectedRowIndex(t),this._focusRowColumn(this._getRow(t),e)},focusNextRowColumn:function(t){var e=this._selectedRow;if(e){var i=this._getNextRow(e);i&&(this._setSelectedRow(i),t=this._internalGetColumn(t),this._focusRowCell(i,t.get_index(),!1,!0))}},_focusRowColumn:function(t,e,i){if(t){var n=(e=this._internalGetColumn(e)).get_index();if(!this._focusRowCell(t,n,!1,!0,i)){var o=this._getNextRow(t);o&&(this._setSelectedRow(o),this._focusRowCell(o,n,!1,!0))}}},_focusNextCell:function(t,e){var i=e?e.parentNode:this._selectedRow;if(i){var n=t.get_index()+1;this._focusRowCellOrNextRow(i,n),this._refreshScrollBar()}},_focusRowCellOrNextRow:function(t,e){if(this.isFrozenGrid()&&e>=this._getFrozenColumnRealCount()){var i=this._getRowIndex(t);t=this._getRow(i)}if(!this._focusRowCell(t,e)){var n=this._getNextRow(t);n?(this._setSelectedRow(n),this._focusRowCell(n,0)):this.endEdit()}},_getNextRow:function(t){var e=this.get_rowCount(),i=!this.get_modifyOnly(),n=i?e:this.get_recordCount(),o=null,s=this._getRowIndex(t);if(s<n-1){if(o=this._getRow(s+1),s==n-2&&i){var r=this._checkAppendRow(e);r&&(this._setRowStyle(r,_Z_42.normal),this.get_showScrollBar()&&$common.scrollToView(r,this._body,this.get_element()))}}else i&&!(o=this._checkAppendRow(e))&&n>0&&(o=this._getRow(0));return o},_checkAppendRow:function(t){var e=this.get_maxRowCount();if(0==e||t<e){var i=this.doRowAdd(t);if("object"==typeof i&&i._cancel)return;var n=this._appendRow();return this._initGridHeight(),!0===i&&this._initRowData(n,t),n}return null},doRowAdd:function(t){var e=this.get_events().getHandler("rowAdd");if(!e)return!1;var i=new _Z_200(null,t);e(this,i);var n=i.get_data();return n?(this._appendNewDatas(n),this.get_dataController().modifyRecord(t,n),!0):i},_refreshPagerInc:function(){var t=this.findPager();if(t&&!t._hasDataSource){var e=this.get_recordCount();t.get_itemCount()!=e&&(t.set_itemCount(e),t._initSummary())}},checkCanAppend:function(){var t=this.get_recordCount(),e=this.get_maxRowCount();if(e>0&&t>=e)throw Error.abort("已达到最大数据行数 "+e)},_focusPrevCell:function(t){var e=t.parentNode,i=this._getCellColumnIndex(t)-1;if(this.isFrozenGrid()&&i==this._getFrozenColumnRealCount()-1){n=this._getRowIndex(e);e=this._getFrozenRow(n)}if(!this._focusRowCell(e,i,!0)){var n,o=null;(n=this._getRowIndex(e))>0&&(o=this._getRow(n-1)),o?(this._setSelectedRow(o),this._focusRowCell(o,this.get_columnCount()-1,!0)):this.focusPrevControl()}return!0},_focusRowCell:function(t,e,i,n,o){if(!this._isRowSelectable(t))return!0;if(!i)return this._doFocusRowCellNext(t,e,this.get_columnCount()-1,n,o);for(var s=this._getFirstColumnCellIndex(),r=$common.getChildrenByTagName(t,"td"),l=e;l>=0;l--){var a=r[s+l];if(this._showEditor(a,!n))return this._doScrollByIndex(l,a,!1),!0}return!1},_doScrollByIndex:function(t,e,i){if(this.isFrozenGrid()){var n=this._getFrozenColumnRealCount();if(i)t==n&&(this._body.scrollLeft="0px");else if(t>n){var o=$common.getBounds(e),s=this._frozenBody.offsetWidth,r=o.x-s;r<0&&(this._body.scrollLeft=-1*r)}}},scrollToColumn:function(t){var e=t.get_headerElement();this._body.scrollLeft=e.offsetLeft+2*e.offsetWidth-this._body.offsetWidth},_focusRowCellWrap:function(t,e,i,n){if(!this._isRowSelectable(t))return!0;var o=this._doFocusRowCellNext(t,e,this.get_columnCount()-1,n);return!o&&e>0&&(o=this._doFocusRowCellNext(t,0,e-1,n)),o},_doFocusRowCellNext:function(t,e,i,n,o){for(var s=this._getFirstColumnCellIndex(),r=$common.getChildrenByTagName(t,"td"),l=e;l<=i;l++){var a=s+l,h=r[a];if(!h)if(l<this._getFrozenColumnRealCount())h=this._getFrozenRowCell(t,l);else{var d=this._getRowIndex(t);t=this._getRow(d),h=this._getRowCell(t,l)}if(!h)return!1;var _=this.getColumnByIndex(a-s);if(_._isRowAllowEditor(t)&&this._showEditor(h,!n,_))return this._doScrollByIndex(l,h,!0),!0;if(!1===o)return!0}return!1},_focusRowFirstCell:function(t){return this._focusRowCell(t,0)},_internalFocusSelectedRowFirstCell:function(){if(this._multiSelectColumn)return!1;var t=this._selectedRow;return t?this._focusRowCell(t,0):void 0},_focusRowLastCell:function(){if(this._multiSelectColumn)return!1;var t=this._selectedRow;return t?this._focusRowCell(t,this.get_columnCount()-1,!0):void 0},add_cellBeginEdit:function(t){this.get_events().addHandler("cellBeginEdit",t)},remove_cellBeginEdit:function(t){this.get_events().removeHandler("cellBeginEdit",t)},add_afterResetConfig:function(t){this.get_events().addHandler("afterResetConfig",t)},remove_afterResetConfig:function(t){this.get_events().removeHandler("afterResetConfig",t)},add_rowRendering:function(t,e){return this.get_events().addHandler("rowRendering",t,e)},remove_rowRendering:function(t){this.get_events().removeHandler("rowRendering",t)},add_cellRendering:function(t,e){return this.get_events().addHandler("cellRendering",t,e)},remove_cellRendering:function(t){this.get_events().removeHandler("cellRendering",t)},_doCellBeginEdit:function(t,e,i,n){if(i||(i=e.parentNode),!i)return!1;!1!==n&&this.setActiveCell(e,t);var o=this._getRowIndex(i),s=this._rowsEnabled;if(s){var r=s[o];if(void 0!==r&&!r)return!1}if(t.getEditable&&!t.getEditable(e))return!1;var l=this.get_events().getHandler("cellBeginEdit");if(l){var a=new _Z_196(o,t.get_index(),t);l(this,a);var h=!a.get_cancel();return t.setEditable&&t.setEditable(h,e),h}return!0},getSelectedRowColumnAllowEdit:function(t){var e=t.column;if(e||(e=t),!e.get_enabled()||e.get_readOnly())return!1;var i=this._getSelectedRowCell(e.get_index());return!!i&&this._doCellBeginEdit(e,i)},add_focusedColumnChanged:function(t){this.get_events().addHandler("focusedColumnChanged",t)},remove_focusedColumnChanged:function(t){this.get_events().removeHandler("focusedColumnChanged",t)},_showEditor:function(t,e,i){if(!i){var n=this._getCellColumnIndex(t);i=this.getColumnByIndex(n)}return!(!i.get_visible()||i.get_readOnly()||e&&!i.get_tabStop())&&(this._activeCell!=t&&this.endEdit(),!!this._doCellBeginEdit(i,t)&&(this._hideMenu(),i._showEditor(t),this._doFocusColumnChange(i),this._notifyFormFocusControl(),!0))},_doFocusColumnChange:function(t){if(this._focusedColumn!=t){this._focusedColumn=t;var e=this.get_events().getHandler("focusedColumnChanged");e&&e(this)}},_hasEditor:function(){for(var t=this.get_columnCount(),e=0;e<t;e++){var i=this.getColumnByIndex(e);if(i&&i._hasEditor())return!0}return!1},_getEditingColumnIndex:function(){t=this.get_activeColumn();if(t)return t.get_readOnly()?-2:t.get_index();var t;return(t=this.get_focusedColumn())?t.get_index():-1},get_focusedColumn:function(){for(var t=this.get_columnCount(),e=0;e<t;e++){var i=this.getColumnByIndex(e);if(i.get_isEditing())return i}return null},endEdit:function(){this._hideEditor()},_postEditValue:function(){this._hideEditor(),this._selectedRow&&this._doSelectionBeforeChanged()},_closeDropDown:function(t){for(var e=this.get_columnCount(),i=0;i<e;i++){this.getColumnByIndex(i)._closeDropDown(t)}delete $common._lastDropDownEdit},_hideEditor:function(t){for(var e=this.get_columnCount(),i=0;i<e;i++){var n=this.getColumnByIndex(i);n&&(t&&n._clearChanged(),n._hideEditor())}this._selectedRow&&(this._selectedRow.style.height="")},_getFirstColumnCellIndex:function(){return this.get_showRowNo()?1:0},_getSelectedRowCell:function(t){return this._getRowCell(this._selectedRow,t)},getRowCell:function(t,e){this._checkRowIndex(t);var i=this._getRow(t),e=this._internalGetColumn(e);return this._getRowCell(i,e.get_index())},_getRowCell:function(t,e){if(!t)return null;if(this._mergeRowColumns.length>0&&!this._dataGroupField){for(var i=0,n=t.childNodes.length;i<n;i++){var o=t.childNodes[i];if(this._getCellColumnIndex(o)==e)return o}return null}var s=this._getFirstColumnCellIndex()+e;return s>=0&&s<t.childNodes.length?t.childNodes[s]:void 0},_checkRowStyle:function(t,e){return!this._allowMultiSelectedRow||e==_Z_42.selected||!Array.contains(this._multiRowIndexs,t)},_setGroupRowStyle:function(t,e){if(t.__rowIndex!==undefined)for(var i=t.parentNode.childNodes,n=!1,o=0,s=i.length;o<s;o++){var r=i[o];if(r!=t){if(r.__rowIndex===t.__rowIndex)r.className=e;else if(n)break}else n=!0}},_setRowStyle:function(t,e,i){var n=this._getRowIndex(t);if(i||this._checkRowStyle(n,e)){var o=this.get_columnCount(),s=this._getFirstColumnCellIndex(),r=n<this.get_recordCount()||this._useCustomRendering,l=r?this.get_events().getHandler("cellRendering"):null,a=$common.getChildrenByTagName(t,"td"),h=(e==_Z_42.selected||t==this._selectedRow)&&!this.get_hideSelection(),d=this._getFrozenRow(n),_=d||t,u=this._raiseRowRendering(_,h,n,e),c=this._getRowStyleFast(n,u,e,h);t.className=c,this._setGroupRowStyle(t,c),t!=_&&(_.className=c);for(var g=0,f=s;g<o;g++,f++){var m=a[f];!this._dataGroupField&&this._mergeRowColumns.length>0&&this._getCellColumnIndex(m)===g||this._setCellStyleFast(n,g,a[f],h,e,r,l,u)}}},_initCellStyle:function(t,e){var i=e.parentNode,n=this._getRowIndex(i);this.isFrozenGrid()&&(i=this._getRow(n),e=this._getRowCell(i,t));var o=i==this._selectedRow,s=this.get_events().getHandler("cellRendering");this._setCellStyleFast(n,t,e,o,0,!0,s,null)},_setCellStyleFast:function(t,e,i,n,o,s,r,l){if(i){var a=this.getColumnByIndex(e),h=this._getCellStyleFast(t,a,e,n,o,s,r,i,l);i.className!=h.className&&(i.className=h.className),i.style.cssText=h.cssText?h.cssText:"",this.isFrozenGrid()&&this._initFrozenCellStyle(t,e,h)}},_getFrozenRowCell:function(t,e){if(!t)return null;if(e>this._getFrozenColumnRealCount())return null;var i=$common.getChildrenByTagName(t,"td"),n=this._getFirstColumnCellIndex()+e;return n>=0&&n<i.length?i[n]:null},_getFrozenRow:function(t){if(!this._frozenRows)return null;return $common.getChildrenByTagName(this._frozenRows,"tr")[t]},_initFrozenCellStyle:function(t,e,i){if(!(e>this._getFrozenColumnRealCount())){var n=this._getFrozenRow(t);if(n){var o=this._getFrozenRowCell(n,e);o&&(o.className=i.className,o.style.cssText=i.cssText?i.cssText:"")}}},get_useEvenRowColor:function(){return this._useEvenRowColor},set_useEvenRowColor:function(t){this._useEvenRowColor=t},get_useEvenHeaderColor:function(){return this._useEvenHeaderColor},set_useEvenHeaderColor:function(t){this._useEvenHeaderColor=t},get_useHoverRowColor:function(){return this._useHoverRowColor},set_useHoverRowColor:function(t){this._useHoverRowColor=t},get_hoverRowColor:function(){return this._hoverRowColor},set_hoverRowColor:function(t){this._hoverRowColor=t},get_useMultiRowCaption:function(){return this._useMultiRowCaption},set_useMultiRowCaption:function(t){this._useMultiRowCaption=t},get_useCustomRendering:function(){return this._useCustomRendering},set_useCustomRendering:function(t){this._useCustomRendering=t},_getRowStyleFast:function(t,e,i,n){var o="GridBodyRow";if(n)o+=" active";else if(i==_Z_42.hover);else if((i==_Z_42.normal||i==_Z_42.none||!this.get_useHoverRowColor())&&(this.get_readOnly()||this.get_modifyOnly())&&this.get_useEvenRowColor()){t%2==1&&(o+=" even")}return e&&e._cssClass&&(o+=" "+e._cssClass),o},_getCellStyleFast:function(t,e,i,n,o,s,r,l,a){var h={};if(h.className="",h.cssText="",e.renderRowCellSkin(t,l,h),!e.get_enabled()||!this.get_enabled())return h.className+=e.get_cellCssClass()+"disabled",e.get_visible()||(h.className+=" dnone"),h;s||(s=this._useCustomRendering);var d=!1;o!=_Z_42.normal&&o!=_Z_42.none&&this.get_useHoverRowColor()||(d=!0);var _=null;return this.get_showEditStyle()&&e.get_showEditStyle()&&!e.get_readOnly()&&(_=new _Z_198(t,i,e,l,o)).set_cssClass("DefaultEditor"),s&&r&&r(this,_=_||new _Z_198(t,i,e,l,o)),a&&this.setArgsStyle(h,a,d),_&&(this.setArgsStyle(h,_,d),_._cssClass&&(h.className+=" "+_._cssClass)),h.fontColor&&(h.cssText+=";color:"+h.fontColor),h.bgColor&&!n&&(h.cssText+=";background-color:"+h.bgColor),h.className=e.get_cellCssClass()+h.className,e.get_visible()||(h.className+=" dnone"),h},setArgsStyle:function(t,e,i){e._fontColor&&(t.fontColor=e._fontColor),i&&e._bgColor&&(t.bgColor=e._bgColor),e._style&&(t.cssText=e._style)},get_recordCount:function(){return this.get_dataController().get_recordCount()},get_showEditStyle:function(){return this._showEditStyle},set_showEditStyle:function(t){this._showEditStyle=t},_isRowSelectable:function(t){return this._isRowSelectableByIndex(this._getRowIndex(t))&&!t.getAttribute("_isExpandDetail")},_isRowSelectableByIndex:function(t){return!this.get_readOnly()&&!this.get_modifyOnly()||t<this.get_recordCount()},add_getRowNo:function(t,e){return this.get_events().addHandler("getRowNo",t,e)},remove_getRowNo:function(t){this.get_events().removeHandler("getRowNo",t)},_initRowNo:function(t,e){if(this.get_showRowNo()){var i=this.get_events().getHandler("getRowNo");this._initRowNoFast(t,e,i)}},_initRowNoFast:function(t,e,i){var n=this._getRowNoHTMLFast(e,i);$common.getChildrenByTagName(t,"td")[0].innerHTML='<div class="GridBodyRowNoCellText">'+n+"</div>"},_getRowNoHTMLFast:function(t,e,i){var n,o=this._getStartRecordIndex()+t;if(this._isRowSelectableByIndex(t)){if(n=o+1,e&&t<this.get_recordCount()){var s=new _Z_193(n,this.findRowData(t));e(this,s),n=s.get_rowNo()}}else n="&nbsp;";return i?(i.rowNo=n,'<div class="GridBodyRowNoCellText">'+n+"</div>"):n},selectedRowColumnDataChanged:function(t){this._notifyColumnDataChanged(this._selectedRow,t)},_internalGetColumn:function(t,e){return"string"==typeof t&&(t=this.getColumn(t,e)),t},_notifyColumnDataChanged:function(t,e){e=this._internalGetColumn(e);var i=this._getRowCell(t,e.get_index());i&&(e._hideEditor(),e.initCellHTML(this._getRowIndex(t),i))},_initRowData:function(t,e){this._initRowDataFast(t,e,!1),this.isFrozenGrid()&&this._initRowDataFast(this._getFrozenRow(e),e,!0)},_initRowDataFast:function(t,e,i){var n=this.get_showRowNo(),o=n?this.get_events().getHandler("getRowNo"):null,s=this.get_dataController().get_hasRecord(),r=i?this._getFrozenColumnRealCount():this.get_columnCount(),l=this._getFirstColumnCellIndex();n&&this._initRowNoFast(t,e,o);for(var a=this._columns,h=$common.getChildrenByTagName(t,"td"),d=0,_=l;d<r;d++,_++){var u=h[_],c=a[d];s?c.initCellHTML(e,u):u.innerHTML="&nbsp;"}!s&&this._rowDeleteColumn&&this._rowDeleteColumn.doInit(t,e)},_checkRowIndex:function(t){var e=this.get_rowCount();if(t<0||t>=e)throw Error.invalidOperation(String.format("行索引范围应为 [0-{0}]",e-1))},_checkColumnIndex:function(t){var e=this.get_columnCount();if(t<-1||t>=e)throw Error.invalidOperation(String.format("列索引范围应为 -1 或 [0-{0}]",e-1))},setCellText:function(t,e,i){this._checkRowIndex(t),this._checkColumnIndex(e);var n,o=this._getRow(t);if((n=e<0?this.get_showRowNo()?0:-1:this._getFirstColumnCellIndex()+e)>=0){var s=$common.getChildrenByTagName(o,"td")[n];s.innerHTML=Sys.UI.Controls.Column.getHTML(i),e>=0&&this._initCellStyle(e,s)}},_getAllColumnWidth:function(t){for(var e=0,i=this.get_columnCount(),n=0;n<i;n++){var o=this.getColumnByIndex(n);if(!(!o||t&&o.get_allowStretch())&&o.get_visible()){e+=o.get_width()}}return e+(this.get_showRowNo()?this.get_rowNoColumnWidth():0)},_getAllFrozenColumnWidth:function(t){for(var e=0,i=this._getFrozenColumnRealCount(t),n=0;n<i;n++){var o=this.getColumnByIndex(n);if(o.get_visible()){e+=o.get_width()}}return e+(this.get_showRowNo()?this.get_rowNoColumnWidth():0)},_getFrozenColumnRealCount:function(t){for(var e=this._headerRow,i=t||this.get_frozenColumnCount(),n=$common.getChildrenByTagName(e,"td"),o=0,s=0;s<i;s++){o+=n[this.get_showRowNo()?s+1:s].colSpan}return o},get_dataController:function(){return this._dataController||(this._dataController=new _Z_74(this,this._dataSource),this._dataController.initialize()),this._dataController},get_guid:function(){return this._guid},set_guid:function(t){this._guid=t},get_label:function(){return this._label},set_label:function(t){this._label=t},get_readOnly:function(){return!this.get_enabled()||this._readOnly},set_readOnly:function(t){this._readOnly!=t&&(this._readOnly=t,this.get_isInitialized()&&(t&&this._hideEditor(),this._refreshRowNo(!0),this._internalRefreshNullText())),this._multiSelectColumn&&this._multiSelectColumn.set_readOnly(t),this._rowDeleteColumn&&this._rowDeleteColumn.set_readOnly(t)},get_modifyOnly:function(){return this._modifyOnly},set_modifyOnly:function(t){this._modifyOnly!=t&&(this._modifyOnly=t,this.get_isInitialized()&&this._refreshRowNo())},get_showHeader:function(){return this._showHeader},set_showHeader:function(t){this._showHeader=t},get_maxHeaderLevel:function(){return this._maxHeaderLevel},set_maxHeaderLevel:function(t){this._maxHeaderLevel=t},get_showFooter:function(){return this._showFooter},set_showFooter:function(t){if(this._showFooter!=t&&(this._showFooter=t,this.get_isInitialized())){if(!this._footerBar)throw Error.invalidOperation("Grid没有设置ShowFooter=true");var e=0;if(t||(e=this._footerBar.offsetHeight),$dom.setVisible(this._footerBar,t),t&&(e=this._footerBar.offsetHeight),this._body){var i=this._body.offsetHeight;i=t?i-e:i+e,$common.setHeight(this._body,i)}}},get_showRowNo:function(){return this._showRowNo},set_showRowNo:function(t){this._showRowNo!=t&&(this._showRowNo=t,this.get_isInitialized()&&(t?(this._addRowNoCells(),this._refreshRowNoColumnCaption(),this._refreshRowNo()):this._removeRowNoCells(),this.resetColumnStretch()))},_removeRowNoCells:function(){if(this._noTd){$clearHandlers(this._configCell),$clearHandlers(this._frozenConfigCell),$clearHandlers(this._noTd),$removeNode(this._noTd),delete this._noTd,this._frozenNoTd&&($clearHandlers(this._frozenNoTd),$removeNode(this._frozenNoTd)),this._filterBar&&this._filterBar.removeResetButton();for(var t=0,e=this.get_rowCount();t<e;t++){var i=this._getRow(t);$removeNode(i.firstChild)}this._footerNo&&$removeNode(this._footerNo)}},_addRowNoCells:function(){if(!this._noTd){var t=this.get_rowNoColumnWidth();if(this.get_showHeader()){(o=this._noTd=$common.createTd()).className="GridHeaderCaption",o.align="center",o.width=t,this._headerRow.insertBefore(o,this._headerRow.firstChild),$common.addMouseOverHandler(o,this._rowNoOver,this)}this._filterBar&&this._filterBar._initResetButton();for(var e=0,i=this.get_rowCount();e<i;e++){var n=this._getRow(e);(o=$common.createTd()).className="GridBodyRowNoCell",o.width=t,n.insertBefore(o,n.firstChild)}if(this.get_showFooter()){var o=this._footerNo=$common.createTd();o.className="GridFooterCell",o.width=t,this._footerRow.insertBefore(this._footerNo,this._footerRow.firstChild)}}},get_reportRowNo:function(){return this._reportRowNo},set_reportRowNo:function(t){this._reportRowNo=t},get_showPrintSummaryText:function(){return this._showPrintSummaryText},set_showPrintSummaryText:function(t){this._showPrintSummaryText=t},get_showLines:function(){return this._showLines},set_showLines:function(t){this._showLines=t},get_hideSelection:function(){return this._hideSelection},set_hideSelection:function(t){this._hideSelection=t},isFrozenGrid:function(){return this.get_frozenColumnCount()>0},get_frozenColumnCount:function(){return this._internalGetFrozenColumnCount()},set_frozenColumnCount:function(t){if(this.get_isInitialized())throw Error.invalidOperation("请调用setFrozenColumnCount接口！");this._defaultFrozenColumnCount=t},setFrozenColumnCount:function(t){this._saveFrozenColumnCount(t),this._disposeColumnsHeader(this._columns),t>0?(this._disposeFrozen(!1),this._setFrozenVisible(!0),this._createFrozenHeaderTable(),this._createFrozenBody(),this._createFrozenFooterTable(),this._resetColumnsElements(),this._initFrozenDataRows(),this._internalFrozenRowsHeight(),this._setFrozenStyle(),this._scrollToTop(),this._selectedRow&&this._setRowStyle(this._selectedRow,_Z_42.none)):(this._disposeFrozen(!0),this._resetColumnsElements()),this._asyncFilterBar()},_saveFrozenColumnCount:function(t){this._configData||(this._configData={}),t==this._defaultFrozenColumnCount?delete this._configData.FrozenColumnCount:this._configData.FrozenColumnCount=t,this._configDataChanged=!0},_savePageSize:function(t){this._configData||(this._configData={}),t==this.get_pageSize()?delete this._configData.PageSize:this._configData.PageSize=t,this._configDataChanged=!0},hasConfigPageSize:function(){return!!this._configData&&!!this._configData.PageSize},get_allowConfig:function(){return this._allowConfig},set_allowConfig:function(t){this._allowConfig=t},get_allowPageCache:function(){return this._allowPageCache},set_allowPageCache:function(t){this._allowPageCache=t},get_saveConfig:function(){return this._saveConfig},set_saveConfig:function(t){this._saveConfig=t},get_allowFrozen:function(){var t=this._allowFrozen;return t&&this._dataSource&&this._dataSource.length>$settings.MaxRecordCountToCloseFrozen&&(t=this._allowFrozen=!1,$common.showWarn("温馨提示：由于表格数据过大，冻结列功能已关闭。"),this._rowCreated&&this.setFrozenColumnCount(0)),t},set_allowFrozen:function(t){this._allowFrozen=t},get_allowMouseWheel:function(){return this._allowMouseWheel},set_allowMouseWheel:function(t){this._allowMouseWheel=t},get_allowCopy:function(){return this._allowCopy},set_allowCopy:function(t){if(this._allowCopy=t,this.get_isInitialized()&&Sys.Browser.isIE&&t)for(var e=$common.getElementsByClassName(this._rowsTable,"GridBodyCellText"),i=0,n=e.length;i<n;i++){e[i].removeAttribute("unselectable")}},get_defaultShowEditor:function(){return this.defaultShowEditor},set_defaultShowEditor:function(t){this.defaultShowEditor=t},get_allowFilter:function(){return this._allowFilter},set_allowFilter:function(t){this._allowFilter=t,this.get_isInitialized()&&(this._createFilterBar(),this._initFilterBar())},clearFilter:function(t){this._filterBar&&(t?this._filterBar.clearValue():this._filterBar.doClearFilter())},_initFilterBar:function(){this._filterBar&&this._filterBar.init()},_initFrozenFilterBar:function(){this._filterBar&&this._filterBar._makeFrozenFilterBar()},_createFilterBar:function(){this._allowFilter&&this.get_showHeader()&&!this._filterBar&&(this._filterBar=new _Z_77(this))},get_allowSubtotal:function(){return this._allowSubtotal},set_allowSubtotal:function(t){this._allowSubtotal=t},set_state:function(t){this._state=t,t==_Z_43.normal&&this.remove_cellRendering(this._subtotlCellRendering),t==_Z_43.subtotl&&this.add_cellRendering(this._subtotlCellRendering,this)},_subtotlCellRendering:function(t,e){var i=e.get_rowIndex(),n=this.findRowData(i);n&&n[this._subtotalRowFlag]&&e.set_bgColor("#F7F5F5")},get_allowSort:function(){return this._allowSort},set_allowSort:function(t){this._allowSort!=t&&(this.get_isInitialized()?(t||this.clearSortFlag(),this._allowSort=t,this._reInitColumnsHeader()):this._allowSort=t)},get_clientSort:function(){return this._clientSort},set_clientSort:function(t){this._clientSort=t},get_allowResize:function(){return this._allowResize},set_allowResize:function(t){this._allowResize!=t&&(this._allowResize=t,this.get_isInitialized()&&this._reInitColumnsHeader())},get_allowCollection:function(){return this._allowCollection},set_allowCollection:function(t){this._allowCollection=t},get_showRowIndicator:function(){return this._showRowIndicator},set_showRowIndicator:function(t){this._showRowIndicator=t},_reInitColumnsHeader:function(){for(var t=0,e=this.get_columnCount();t<e;t++){this.getColumnByIndex(t)._internalInitHeader()}},get_showScrollBar:function(){return this._showScrollBar},set_showScrollBar:function(t){this._showScrollBar=t},get_showHScrollBar:function(){return this._showHScrollBar},set_showHScrollBar:function(t){this._showHScrollBar=t},get_allColumnWidth:function(){return this._allColumnWidth},set_allColumnWidth:function(t){this._allColumnWidth=t},get_defaultRowCount:function(){return this._defaultRowCount},set_defaultRowCount:function(t){this._defaultRowCount=t},get_maxRowCount:function(){var t=this._maxRowCount;return t>=0?t:99999},set_maxRowCount:function(t){this._maxRowCount=t},get_lazyPageSize:function(){return this._lazyPageSize},set_lazyPageSize:function(t){this._lazyPageSize=t},_isLazyPageSize:function(t){if(this._cacheData)return!1;if(this._lazyPageSize<=0)return!1;var e=this.get_recordCount(),i=e>this._lazyPageSize;return t&&(i=i&&e>this._lazyIndex*this._lazyPageSize),i},showNextMoreRows:function(t){if(this._isLazyPageSize()){var e=index=this._lazyIndex*this._lazyPageSize,i=e;this._lazyIndex++;for(var n=this._lazyIndex*this._lazyPageSize,o=this.get_showRowNo(),s=o?this.get_events().getHandler("getRowNo"):null,r=this.get_columnCount(),l=this.get_allowCopy()?"":'unselectable="on" ',a=this.get_recordCount(),h=$common.createFragment();e<a&&e<n;e++){var d=e<a,_=new Sys.StringBuilder;this._addRowFast(_,e,o,s,r,d,l);var u=$common.createTBody();u.innerHTML=_.toString(),h.appendChild(u.firstChild),u=null}this._rows.appendChild(h),this.set_selectedRowIndex(i),$dom.setVisible(this._moreBtn,n<a),this._doLazyPageLoaded(index,e),this._refreshScrollBar(!0)}},get_textColor:function(){return this._textColor},set_textColor:function(t){this._textColor=t},get_popupMenu:function(){return this._popupMenu},set_popupMenu:function(t){this._popupMenu=t},get_needRowIndex:function(){return this._needRowIndex},set_needRowIndex:function(t){this._needRowIndex=t},get_wordWrap:function(){return this._wordWrap},set_wordWrap:function(t){this._wordWrap=t},get_columnsParams:function(){return this._columnsParams},set_columnsParams:function(t){this._columnsParams=t},get_columnsGspxs:function(){return this._columnsGspxs},set_columnsGspxs:function(t){this._columnsGspxs=t},_checkHasMultiSelectColumn:function(){var t=this._multiSelectColumn;if(!t)throw Error.invalidOperation("Grid没有选择列！");return t.get_dataField()},_checkHasExpandColumn:function(){var t=this._rowExpandColumn;if(!t)throw Error.invalidOperation("Grid没有折叠列！");return t.get_dataField()},get_selectedRowsData:function(t){for(var e=this.get_needRowIndex(),i=[],n=0,o=this._multiRowIndexs.length;n<o;n++){var s=this._multiRowIndexs[n],r=this.findRowData(s);r&&(e&&(r.__rowIndex=n),i.push(r))}return t?Object.clone(i):i},get_curSelectedItems:function(){for(var t=this._checkHasMultiSelectColumn(),e=this.get_needRowIndex(),i=this.get_recordCount(),n=[],o=0;o<i;o++)if(!this.isEmptyRow(o)){var s=this.getRowData(o);s[t]&&(e&&(s.__rowIndex=o),n.push(s))}return Object.clone(n)},get_selectedItems:function(t,e){this._checkHasMultiSelectColumn();var i=this.get_needRowIndex();if(!this._loadedItems){n=this._getSelectedItems(t);return e?Object.clone(n):n}this._initLoadedItems();for(var n=[],o=this._loadedItems.length,s=0;s<o;s++){var r=this._loadedItems[s];r&&r.selected&&(i&&(r.data.__rowIndex=s),n.push(r.data),t&&this._addMergeRowData(r.data,n))}return e?Object.clone(n):n},_getSelectedItems:function(t){for(var e=this._multiSelectColumn.get_dataField(),i=this.get_recordCount(),n=[],o=this.get_needRowIndex(),s=this.get_dataController(),r=0;r<i;r++){var l=s.getRecord(r);if(l&&e){!!this.getRowEnabled(r)&&l[e]&&(o&&(l.__rowIndex=r),n.push(l),t&&this._addMergeRowData(l,n))}}return n},_addMergeRowData:function(t,e){if(this._dataGroupField){var i=t[this._dataGroupField];if(i!==undefined){var n=this._mergeGroupData[i];if(n)for(var o=0,s=n.length;o<s;o++)e.push(Object.clone(n[o]))}}},deleteSelectedItems:function(){var t=this.get_selectedItems(),e=this.findPager();if(e){for(var i=e.get_itemCount()-t.length,n=e.get_pageIndex(),o=e.get_pageSize();i<o*n+1&&n>0;n--);e.reloadPage(n)}else for(var s=t.length-1;s>-1;s--){var r=t[s];if(r.__rowIndex===undefined)throw Error.abort('删除勾选行的前提是需要设置<Grid NeedRowIndex="true"');this.deleteRow(r.__rowIndex)}},add_getLoadedItems:function(t){this.get_events().addHandler("getLoadedItems",t)},remove_getLoadedItems:function(t){this.get_events().removeHandler("getLoadedItems",t)},_setNeedPreloadItems:function(t){this._needPreloadItems=t},_getPagerPreloadItemDecimalField:function(t){var e=t.get_preloadItemFields();if(e){var i=e.split(",");return i[i.length-1].trim()}return null},_doGetLoadedItems:function(t){var e=this._loadedItems,i=this.findPager(),n=this.get_events().getHandler("getLoadedItems");if(e&&i&&(n||this._needPreloadItems)){e=Array.clone(this._loadedItems);var o=this._getPagerPreloadItemDecimalField(i);if(this._needPreloadItems){var s=this._preloadItems;s||(s=this._preloadItems=i._internalGetPreloadItems());for(var r=0,l=s.length;r<l;r++){var a=(d=s[r]).__rowIndex;if(!e[a]){var h={};h.data=d,e[a]=h}}}if(n){n(this,new _Z_204(e,i.get_itemCount(),o))}if(t&&o)for(r=(l=e.length)-1;r>=0;r--){var d=e[r];d&&d.data&&null==d.data[o]&&(e[r]=null)}}return e},get_allItems:function(){return this.findPager()?(this._loadedItems||(this._loadedItems=[]),this._needPreloadItems||(this._needPreloadItems=!0),this._getLoadedOrAllItems(!0)):this.getData()},resetLoadedItems:function(){var t=this._loadedItems;if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];n&&n.__isLoadedItem&&delete n.__isLoadedItem}},get_loadedItems:function(){return this._getLoadedOrAllItems(!1)},_getLoadedOrAllItems:function(t){if(!this._initLoadedItems())return null;for(var e=this._doGetLoadedItems(t),i=new Array(e.length),n=0,o=this.get_needRowIndex(),s=0,r=i.length;s<r;s++){var l=e[s];l&&l.data&&(o&&(l.data.__rowIndex=s),i[n]=l.data,n++)}return i.length=n,i},_toggleSelectedRowSelected:function(){var t=this.get_selectedRowIndex();if(this.getRowEnabled(t)&&!this.isEmptyRow(t)&&this._getRowMultiSelectColumnEnabled(t)){var e=!this.getRowSelected(t);this._multiSelectColumn.set_value(e),this._internalSetRowSelected(t,e)}},_getRowMultiSelectColumnEnabled:function(t){var e=this._multiSelectColumn,i=e.get_index(),n=this._getRow(t),o=this._getRowCell(n,i);return!!e.getEditable(o)},getSelectedRowSelected:function(){return this.getRowSelected(this.get_selectedRowIndex())},setSelectedRowSelected:function(t){this.setRowSelected(this.get_selectedRowIndex(),t)},getRowSelected:function(t){this._checkRowIndex(t);var e=this._checkHasMultiSelectColumn();return this.getRowData(t)[e]},_isColumnInFrozen:function(t){return t.get_index()<this._getFrozenColumnRealCount()},setRowSelected:function(t,e){this._internalSetRowSelected(t,e),this._checkMultiSelectColumn()},_internalSetRowSelected:function(t,e){var i=this._checkHasMultiSelectColumn();if(!this._multiSelectColumn.get_readOnly()){this._isColumnInFrozen(this._multiSelectColumn)?this._doSetFrozenRowSelected(t,e,i):this._doSetRowSelected(t,e,i)}},getRowEnabled:function(t){var e=this._rowsEnabled;if(!e)return!0;var i=e[t];return void 0===i||i},setRowEnabled:function(t,e){this._checkRowIndex(t);var i=this._multiSelectColumn;if(i&&!i.get_readOnly()){var n=this._getRow(t),o=this._getFirstColumnCellIndex()+i.get_index(),s=$common.getChildrenByTagName(n,"td")[o];if(s){var r=s.firstChild;r&&r.tagName&&($dom.setEnabled(r,e),r.firstChild.disabled=!e)}}var l=this._rowsEnabled;l||(l=this._rowsEnabled=[]),l[t]=e},_doSetFrozenRowSelected:function(t,e,i){var n=this.getRowData(t);if(n){var o=n[i];if(e!=o){var s=this._multiSelectColumn,r=s.get_index(),l=this._getFrozenRow(t);if(!l&&this._isLazyPageSize())return void s._setCellValue(t,e,!0);var a=this._getFrozenRowCell(l,r);this._raiseSetRowSelected(t,s,a,e,o);var h=this._getRow(t),d=this._getRowCell(h,r);d.firstChild.firstChild.checked=e,$common._changeCheckedStyle(d.firstChild,e)}}},_doSetRowSelected:function(t,e,i){var n=this.getRowData(t);if(n){var o=n[i];if(e!=o){var s=this._multiSelectColumn,r=this._getRow(t);if(!r&&this._isLazyPageSize())return void s._setCellValue(t,e,!0);var l=this._getRowCell(r,s.get_index());this._raiseSetRowSelected(t,s,l,e,o)}}},_raiseSetRowSelected:function(t,e,i,n,o){e._setCellValue(t,n,!0);i.firstChild.firstChild.checked=n,$common._changeCheckedStyle(i.firstChild,n),i==e._lastCell&&e.set_value(n),e._raiseChangeByRowIndex(i,t,n,o)},_doSelectAll:function(t){var e=this._multiSelectColumn;if(e&&!e.get_readOnly()){if(!this._isCheckFirstEditor){var i=this.defaultShowEditor;this.defaultShowEditor=!0,this._showFirstRowEditor(),this._isCheckFirstEditor=!0,this.defaultShowEditor=i}e._hideEditor();var n=this._checkHasMultiSelectColumn(),o=this.get_recordCount();e._isCheckAll=!0;if(this._isColumnInFrozen(e))for(s=0;s<o;s++)(!this._checkEnabled||this.getRowEnabled(s)&&this._getRowMultiSelectColumnEnabled(s))&&this._doSetFrozenRowSelected(s,t,n);else for(var s=0;s<o;s++)(!this._checkEnabled||this.getRowEnabled(s)&&this._getRowMultiSelectColumnEnabled(s))&&this._doSetRowSelected(s,t,n);e._isCheckAll=!1}},isCheckAllClicked:function(){var t=this._multiSelectColumn;return!!t&&t._isCheckAll},selectAll:function(){var t=this;asyncCall(function(){t._doSelectAll(!0),t._checkMultiSelectColumn()})},deselectAll:function(){this.clearLoadedItems(),this._doSelectAll(!1),this._checkMultiSelectColumn()},set_checkEnabled:function(t){this._checkEnabled=t},get_checkEnabled:function(){return this._checkEnabled},get_configID:function(){return this._configID},set_configID:function(t){this._configID=t},get_bands:function(){return this._bands},set_bands:function(t){this._bands=t},get_dataField:function(){return this._dataField},set_dataField:function(t){this._dataField=t},get_dataSource:function(t){return t?Object.clone(this._dataSource):this._dataSource},set_dataSource:function(t){var e=$craba._changeDataToList(t,this);this._saveDataSource(e,e==t)},_saveDataSource:function(t,e){this._dataSource!=t&&this._doBeforeDataSourceChanged(),this._dataSource=t;var i=this.get_dataController();i&&(i.set_supportsObjProp(e),i.clearEditBuffer())},get_columnExpands:function(){return this._columnExpands},set_columnExpands:function(t){this._columnExpands=t,this.get_isInitialized()&&this._initColumnExpands(),this._asyncFilterBar()},get_cellMergeItems:function(){return this._cellMergeItems},set_cellMergeItems:function(t){this._cellMergeItems=t},_doBeforeDataSourceChanged:function(){this._setSelectedRow(null),this._dataSourceChanging=!0},get_pagerId:function(){return this._pagerId},set_pagerId:function(t){this._pagerId=t},get_pagerClientId:function(){var t=this.findPager();return t?t.get_id():null},findPager:function(){var t=this.get_pagerId();return t?this.get_form()[t]:null},get_pager:function(){var t=this.findPager();if(!t)throw Error.invalidOperation("找不到Grid的默认Pager："+this.get_pagerId());return t},dataBind:function(t,e){this._dataBinding=!0;var i=0==this.get_recordCount(),n=this._dataField,o=null,s=!1;if(void 0!==t)o=t,s=!0;else if(n){o=this.get_form().get_dataController().getValue(n),s=!0}if(e&&(this._prevRowIndex=this.get_selectedRowIndex(),this._prevActiveColumn=this.get_activeColumn(),this._prevRowIndex>-1&&(this.oldDefaultShowEditor=this.get_defaultShowEditor(),this.set_defaultShowEditor(!1))),s){this.clearLoadedItems(),this.set_dataSource(o);var r=!o||0==o.length;i&&r?this.get_dataController()._dataSource=this._dataSource:this.dataChanged()}if(this.get_allowSort()&&n&&this.clearSortFlag(),this._dataBinding=!1,e&&this._prevRowIndex>-1){this.set_defaultShowEditor(this.oldDefaultShowEditor);var l=this;setTimeout(function(){l.get_isDisposed()||(l.set_selectedRowIndex(l._prevRowIndex),l._prevActiveColumn&&l._prevActiveColumn.focus())},1)}},clear:function(){this._dataBinding=!0,this.dataBind(null),this.refreshPager(!0),this.clearLoadedItems(),this._dataBinding=!1,this._checkMultiSelectColumn()},doSaveData:function(t){this._dataField&&this._internalSaveData(t)},_internalSaveData:function(t){return this._postEditValue(),this._internalControlData(t)},_internalControlData:function(t){var e=this.get_dataController().save();return this._internalSetData(e),t||this._validate(e),e},_internalSetData:function(t){var e=this._dataField;if(e){this.get_form().get_dataController().setValue(e,t)}},saveData:function(t,e){var i=this.get_form();i.setValidationControl(this),this._cancelRowChangeHandler=e;var n=this._internalSaveData(t);return delete this._cancelRowChangeHandler,i.get_validationManager().checkResults(),n},saveColumnsData:function(t){var e=this.cloneData();if(!e)return null;for(var i=[],n=0,o=e.length;n<o;n++){for(var s=e[n],r={},l=0,a=this.get_columns().length;l<a;l++){var h=this.get_columns()[l].get_dataField();h&&(t&&Array.contains(t,h)||(r[h]=s[h]))}i.push(r)}return i},cloneData:function(t){var e=this.saveData(t);return Object.clone(e)},getData:function(t){var e=this.get_readOnly()?this.get_dataSource():this.saveData();return t?Object.clone(e):e},_revalidate:function(t,e,i){var n=this.get_form().get_validationManager(),o=this.get_recordCount();if(0!=o){for(var s=this.get_columnCount(),r=t,l=-1,a=n.getChildValidationNode(this._dataField),h=e;h<o;h++){var d=i?i[h].__rowIndex:h;for(h>e&&(r=0);r<s;r++)if(this._doValidateColumnByIndex(n,a,d,r),!n.get_isValid()&&-1==l){l=r;break}if(!n.get_isValid()){this.set_selectedRowIndex(d);break}}this._validateColumnIndex=l}},_validate:function(t){var e=this.get_form().get_validationManager(),i=this.get_label();i||(i="明细");var n=e.validate(this._dataField,t,i,null,this);this._validateColumnIndex=0,n&&e.get_isValid()&&this._revalidate(0,0,this.get_needRowIndex()?t:null)},_doValidateColumnByIndex:function(t,e,i,n){var o=this.getColumnByIndex(n),s=this.get_dataController().getCellValue(i,o);this._doValidateColumn(t,e,i,o,s)},_doValidateColumn:function(t,e,i,n,o){var s=n.get_dataField();if(s){var r=n.get_caption(),l="第"+(i+1)+"行 ";t.validate(s,o,r,l,this,e)}},_validateColumn:function(t,e,i){var n=this.get_form().get_validationManager(),o=n.getChildValidationNode(this._dataField);this._doValidateColumn(n,o,t,e,i)},dataChanged:function(){this._dataChanged=!0,this.get_dataController()._dataSource=this._dataSource,this.get_isInitialized()&&this.get_visible()&&(this.get_allowPageCache()||(this.clearChangedRowDatas(),this.clearNewRowDatas(),this.clearDeleteRowDatas()),this._initDataRows(),(this._body&&this._body.scrollLeft>0||this._headerBar&&this._headerBar.scrollLeft>0)&&this._bodyScroll(),this._dataChanged=!1,this._scrollToTop(),this._initOverlaySize(),this.refreshPager())},isBinding:function(){return this._dataChanged||!this._init},_mergeGroupDatas:function(){if(this._dataGroupField&&this._dataSource&&!(this._mergeRowColumns.length<1)){this._mergeGroupData={};for(var t=[];this._dataSource.length>0;){var e=this._dataSource.shift();t.push(e);var i=e[this._dataGroupField];if(i)for(var n=0;n<this._dataSource.length;n++){var o=this._dataSource[n];if(o[this._dataGroupField]===i){o=this._dataSource.splice(n,1)[0],n--;var s=this._mergeGroupData[i];s||(s=this._mergeGroupData[i]=[]),s.push(o)}}}this._dataSource=t,this.get_dataController()._dataSource=t}},hasMergeRows:function(){return!(!this._mergeRowColumns||0==this._mergeRowColumns.length)&&!!this._mergeGroupData},_breakGroupDatas:function(t,e){if(this._dataGroupField&&this._mergeGroupData){var i=e[this._dataGroupField],n=this._mergeGroupData[i];if(n&&0!=n.length)for(var o=0,s=n.length;o<s;o++){var r=n[o];t.push(r)}}},refreshPager:function(t){var e=this.findPager();!e||e.get_hasDataSource()&&!t||e.init(this.get_recordCount())},_refreshScrollBar:function(t){var e=this._scrollBar;e&&$craba.asyncFun(this,function(){e._showBar(t)},50,"scrollBar")},_initGridHeight:function(){if(this.get_autoHeight()&&!$app.PopupGrid){var t=this;asyncCall(function(){if(!t.get_isDisposed()){var e=t._rowsTable.offsetHeight;if(0!=e){var i=(e+=t.getOtherHeight())>t.get_minHeight()?e:t.get_minHeight(),n=t.get_maxHeight();n>0&&i>n&&(i=n),t.set_height(i)}}})}},getOtherHeight:function(){var t=0;return this._headerBar&&(t+=this._headerBar.offsetHeight),this._allowFilter&&(t+=this._filterBar.get_height()),this._footerBar&&(t+=this._footerBar.offsetHeight),t},refresh:function(t){void 0!==t&&this.set_dataSource(t),this.dataChanged()},add_newRecord:function(t){this.get_events().addHandler("newRecord",t)},remove_newRecord:function(t){this.get_events().removeHandler("newRecord",t)},_internalNewRecord:function(t){var e=this.get_events().getHandler("newRecord");if(e){e(this,new _Z_200(t));for(var i in t){var n=this.findColumn(i);n&&(n._hasEditor()||this.selectedRowColumnDataChanged(n))}}},appendRowData:function(t,e){this._appendNewDatas(t);var i,n=this.findPager();if(n&&!n.get_isLastPage()?this._internalLastPageThenAppendRowData(n,t):n?this.get_dataController().get_recordCount()+1>n.get_pageSize()?this._internalLastPageThenAppendRowData(n,t):i=this._internalAppendRowData(t):i=this._internalAppendRowData(t,e),!this._isBatch)return i?this._getRowIndex(i):void 0},_internalLastPageThenAppendRowData:function(t,e){var i=e.__rowIndex;if(i>=0){t.incItemCount();var n=t.get_pageSize(),o=Math.floor(i/n);t.gotoPage(o,$createDelegate(this,function(){var t=this._getRow(i-o*n);this._setSelectedRow(t)}))}else t.lastPage($createDelegate(this,function(){var i=this.get_dataController().indexOfRecord(e);if(i<0)this._internalAppendRowData(e);else{t.incItemCount();var n=this._getRow(i);this._setSelectedRow(n)}}))},_internalAppendRowData:function(t,e){var i=this._doAppendRow();return this._initNewRowData(i,t,e),this._endBatch(null,"append"),i},_initNewRowData:function(t,e,i,n){var o=this._getRowIndex(t);if(i||this._hideEditor(),n||this.get_dataController().modifyRecord(o,e),this._initRowData(t,o),!i){this._initRowStyle(t),this._tempRow=t;var s=this;$craba.asyncFun(this,function(){s.get_isDisposed()||s._tempRow&&(s._setSelectedRow(s._tempRow),s._tempRow=null)},10,"__srow")}var r=this.findPager();r&&r.incItemCount(),this._changeFrozenRowHeight(o)},_doAppendRow:function(){var t,e=this.get_recordCount(),i=this.get_rowCount();if(i>e){for(var n=0;n<i;n++)if(this.isEmptyRow(n))return this._getRow(n)}else t=this._appendRow();return t},appendRow:function(){var t=this._appendRow();return this._setSelectedRow(t),this._getRowIndex(t)},insertRowData:function(t,e,i){if(0==this.get_rowCount())return this.appendRowData(e),0;this._appendNewDatas(e),this._checkRowIndex(t),this.get_dataController().insertRecord(t,e);var n=this._doInsertRow(t);return this._initNewRowData(n,e,this._isBatch,!0),this._isBatch?void 0:(this._setSelectedRow(n),this._endBatch(t,"insert"),this._getRowIndex(n))},batchDeleteRow:function(t){Array.removeRepeatString(t),t.length<1||(t.sort(function(t,e){return e-t}),this._isBatch=!0,Array.forEach(t,function(t){this.deleteRow(t)},this),delete this._isBatch,this._resetRowIndex(t.pop()),this._gridScroll(),this._endBatch(null,"delete"))},batchInsertRowData:function(t,e){if(0!=e.length){var i=null==this.get_events().getHandler("cellRendering");this._isBatch=!0;for(var n=t,o=$common.createFragment(),s=0;s<e.length;s++){var r=e[s];this.get_dataController().insertRecord(t,r);var l=this._doInsertRow(t);o.appendChild(l),this._initNewRowData(l,r,i,!0),t++}var a=this._getRow(n);this._rows.insertBefore(o,a),this._resetOffsetRowIndex(t,!0),delete this._isBatch,this._endBatch(null,"batchInsert")}},batchAppendRowData:function(t,e){this._isBatch=!0;for(var i=0;i<t.length;i++)this.appendRowData(t[i],!1!==e);delete this._isBatch,this._endBatch(null,"batchAppend")},batchModifyRowData:function(t,e,i){var n=Object.isUndefinedOrNull(t);$common.checkTips(n&&!this.get_primaryKey(),"按主键修改的时候Grid必须配置PrimaryKey属性"),this._isBatch=!0;for(var o=0;o<e.length;o++){var s=e[o];n&&(t=this._getKeyRowIndex(s))<0||(this._doModifyRowData(t,s,!1!==i),t++)}delete this._isBatch,this._endBatch(null,"batchModify")},_getKeyRowIndex:function(t){var e=this.get_primaryKey(),i=t[e];if(Object.isUndefinedOrNull(i))return-1;for(var n=this.get_dataController().save(),o=0,s=n.length;o<s;o++){if(n[o][e]==i)return o}return-1},_endBatch:function(t,e){this._isBatch||(this._calcColumnsSummary(),this._checkMultiSelectColumn(),this.doChange(t,e),this._initGridHeight(),this._internalFrozenRowsHeight())},insertRow:function(t){return this.get_recordCount()<=0?this.appendRowData({}):this.insertRowData(t,{})},_doInsertRow:function(t){var e=this._createRow(t,this.get_columnCount());if(!this._isBatch){var i=this._getRow(t);this._resetOffsetRowIndex(t),this._rows.insertBefore(e,i)}if(this._frozenRows){var n=this._createRow(t,this._getFrozenColumnRealCount());i=this._getFrozenRow(t),this._frozenRows.insertBefore(n,i)}return e},_isValidRecordIndex:function(t){var e=this.get_recordCount();return t>=0&&t<e},_checkRecordIndex:function(t){if(!this._isValidRecordIndex(t)){var e=this.get_recordCount();throw Error.invalidOperation(String.format("行记录索引范围应为 [0-{0}]，当前:{1}",e-1,t))}},isEmptyRow:function(t){if(t>=0&&t<this.get_recordCount()){var e=this.get_dataController().getRecord(t);return this._isEmptyData(e)}return!0},_isEmptyData:function(t){if(!t)return!0;for(var e in t)if(null!=t[e])return!1;return!0},findRowData:function(t,e){var i=this._isValidRecordIndex(t)?this.get_dataController().getRecord(t):null;return e?Object.clone(i):i},getRowData:function(t,e){this._checkRecordIndex(t);var i=this.get_dataController().getRecord(t);return e?Object.clone(i):i},modifyCellValue:function(t,e,i){var n={};n[e]=i,this.modifyCellsValue(t,[e],n)},modifyCellsValue:function(t,e,i){this._checkRecordIndex(t);var n=this._getRow(t);Array.forEach(e,function(e){var o=this._internalGetColumn(e,!0),s=i?i[e]:null;o?this._refreshCellValue(n,t,o,s):this.get_dataController().doSetCellValueByField(t,null,e,s)},this),this._calcColumnsSummary(e),this._checkMultiSelectColumn(),this.doChange(t,"modify"),this._internalFrozenRowsHeight()},modifyRowData:function(t,e,i,n,o){this.endEdit(),this._checkRecordIndex(t),this._doModifyRowData(t,e,o)},_doModifyRowData:function(t,e,i){this._setDefaultData(t,e),this._appendChangeDatas(e),this.get_dataController().modifyRecord(t,e);var n=this._getRow(t);this._initRowData(n,t),i||this._setRowStyle(n,_Z_42.normal),this._endBatch(t,"modify")},_setDefaultData:function(t,e){if(!this._isEmptyData(e))for(var i=this.get_columnCount(),n=0;n<i;n++){var o=this.getColumnByIndex(n),s=o.get_dataField();if(s&&"undefined"==typeof e[s]){var r=o.getDefaultValue();r!=undefined&&(e[s]=r)}}},modifySelectedRowData:function(t){var e=this._selectedRow;if(!e)throw Error.invalidOperation("没有选中行");this._doModifyRowData(this._getRowIndex(e),t)},deleteSelectedRow:function(){var t=this._selectedRow;t&&this.deleteRow(this._getRowIndex(t))},_refreshRowNo:function(t){if(this.get_showRowNo())for(var e=0,i=this.get_rowCount();e<i;e++){var n=this._getRow(e);this._initRowNo(n,e),t&&this._setRowStyle(n,_Z_42.normal)}},_resetOffsetRowIndex:function(t,e){for(var i=this.get_rowCount()-1;i>=t;i--){var n=e?i:i+1;this._initRowIndex(this._getRow(i),n);var o=this._getFrozenRow(i);o&&this._initRowIndex(o,n)}},_resetRowIndex:function(t){for(var e=this.get_rowCount(),i=t;i<e;i++){this._initRowIndex(this._getRow(i),i);var n=this._getFrozenRow(i);n&&this._initRowIndex(n,i)}},_resetColumnIndex:function(t){for(var e=this.get_columnCount(),i=this.get_rowCount(),n=0;n<i;n++)for(var o=this._getRow(n),s=t;s<e;s++){var r=this._getRowCell(o,s);r&&r.setAttribute("_columnIndex",s)}},_initRowIndex:function(t,e){this._initRowNo(t,e),t.setAttribute("_rowIndex",e)},_checkDeleteSelectedRow:function(){var t=this._selectedRow;t&&this._internalCheckDeleteRow(this._getRowIndex(t))},_internalCheckDeleteRow:function(t){var e=this.get_events().getHandler("rowDeleting");if(e){var i=new _Z_203(t);if(e(this,i),i.get_cancel())return!1}return this._mergeRowColumns.length>0?(this.get_dataController().deleteRecord(t),this.doRowDeleted(),this.doChange(t,"delete"),this.refresh(this.getData())):this.deleteRow(t),!0},deleteRow:function(t,e){var i=this.isEmptyRow(t);this._deleteRowElement(t,e)&&(i?this._initGridHeight():(this._deletePagerRecord(t),this.doRowDeleted(),this._endBatch(t,"delete")))},_deleteRowElement:function(t,e){var i=null,n=this.get_rowCount();if((t>=0||t<n)&&(i=this._getRow(t)),!i)return!1;var o=this.get_dataController().getRecord(t);o&&this._appendDeleteDatas(o),this._hideEditor(),this.get_dataController().deleteRecord(t),n--,this._cancelRowChangeHandler=e,this._isBatch||this._setSelectedRow(null);var s=null,r=this.get_modifyOnly();if(n>0||r){$removeNode(i);var l=this._getFrozenRow(t);if(l&&$removeNode(l),this._isBatch)return;this._resetRowIndex(t);var a=this.get_readOnly()||r?this.get_recordCount():this.get_rowCount();if(a>0){h=t<a?t:t-1;s=this._getRow(h)}}else{var h=0;s=this._getRow(h),this._initRowData(s,h)}return this._gridScroll(),this._setSelectedRow(s),this._cancelRowChangeHandler=!1,!0},_deletePagerRecord:function(t){var e=this.findPager();e&&(e._hasSummaryLoaded=!1,e.deleteRecord(this._getStartRecordIndex()+t),e.get_pageCount()<=1?e.decItemCount():e.get_isLastPage()?this.get_recordCount()>0?e.decItemCount():e.prevPage():e.reloadPage(null,$createDelegate(this,function(){var e=this.get_recordCount();if(e>0){var i=Math.min(t,e-1);this.set_selectedRowIndex(i)}})))},add_rowDeleting:function(t){this.get_events().addHandler("rowDeleting",t)},remove_rowDeleting:function(t){this.get_events().removeHandler("rowDeleting",t)},add_rowAdd:function(t){this.get_events().addHandler("rowAdd",t)},remove_rowAdd:function(t){this.get_events().removeHandler("rowAdd",t)},add_rowDeleted:function(t){this.get_events().addHandler("rowDeleted",t)},remove_rowDeleted:function(t){this.get_events().removeHandler("rowDeleted",t)},doRowDeleted:function(){var t=this.get_events().getHandler("rowDeleted");t&&t(this)},findRow:function(t,e,i){var n=!1;this._prevName==t&&this._prevValue==e&&-1!==this._prevIndex&&(n=!0),this._prevName=t,this._prevValue=e;for(var o=0,s=this.get_recordCount();o<s;o++){var r=this.getRowData(o)[t];if(i){if(!Object.isUndefinedOrNull(r)&&r.toString().toLowerCase().indexOf(e.toString().toLowerCase())>-1){if(n&&this._prevIndex>=o)continue;return this._prevIndex=o}}else if(r==e)return this._prevIndex=o}return this._prevIndex=-1},filterRows:function(t){if(this._cacheData?this.get_dataController()._dataSource=this._cacheData:this._cacheData=this.get_dataSource(),t&&0!=t.items.length){var e=[];this.locateRowToCache(e,t.items,!0);var i=Object.clone(e);this.refresh(i)}else this.refresh(this._cacheData)},locateRow:function(t,e,i){var n=this.findRow(t,e,i);return n>=0&&this.set_selectedRowIndex(n),n},locateRowToCache:function(t,e,i){for(var n=0,o=this.get_recordCount();n<o;n++){for(var s=this.getRowData(n),r=!1,l=0,a=e.length;l<a;l++){var h=e[l],d=h.dataField,_=h.value,u=s[d];if(i&&h.type!=_Z_73.equals){if(Object.isUndefinedOrNull(u)||!(u.toString().toLowerCase().indexOf(_.toString().toLowerCase())>-1)){r=!1;break}r=!0}else{if(u!=_){r=!1;break}r=!0}}r&&t.push(s)}},moveUpSelectedRow:function(){var t=this.get_selectedRowIndex();if(!(t<=0)){var e=t-1;if(!this.isEmptyRow(t)&&!this.isEmptyRow(e)){var i=this.getRowData(t),n=this.getRowData(e);this.modifyRowData(e,i),this.modifyRowData(t,n),this.set_selectedRowIndex(e)}}},moveDownSelectedRow:function(){var t=this.get_selectedRowIndex();if(!(t>=this.get_recordCount()-1)){var e=t+1;if(!this.isEmptyRow(t)&&!this.isEmptyRow(e)){var i=this.getRowData(t),n=this.getRowData(e);this.modifyRowData(e,i),this.modifyRowData(t,n),this.set_selectedRowIndex(e)}}},_initRowMerge:function(){var t=this._mergeRowColumns;if(!(t.length<1||this._dataGroupField)){!function(){for(var e=0;e<t.length;e++)t[e].__prevCell=null}();for(var e=[],i=0,n=0;n<this.get_recordCount();n++){var o=this.findRowData(n),s=this.findRowData(n+1);if(!s)break;for(var r=this._getRow(n),l=this._getRow(n+1),a=0;a<t.length;a++){var h=t[a],d=h.__prevCell,_=h.get_dataField();if(o[_]==s[_]){c=null;d?c=d:(c=this._getRowCell(r,h.get_index()),(d=h.__prevCell=c).rowSpan=1),c.rowSpan=c.rowSpan+1;var u=this._getRowCell(l,h.get_index());e.push(u),r.__rowIndex=l.__rowIndex=i}else i++,h.__prevCell=null}}for(n=0;n<e.length;n++){var c=e[n];$removeNode(c)}}},_initCellMerge:function(t){if(this._cellMergeItems){this._rowsTable.style.tableLayout="";for(var e=this._cellMergeItems,i=0,n=e.length;i<n;i++){var o=e[i],s=o.rowIndex,r=this._getRow(s);if(r){var l=this.getColumn(o.fromColumn);if(!l.get_visible())throw Error.invalidOperation("列“"+o.fromColumn+"”不可见");for(var a=this.getColumn(o.toColumn),h=this.getColumn(o.displayColumn),d=0,_=0,u=l.get_index(),c=this.get_columnCount(),g=u;g<c;g++){if((f=this.getColumnByIndex(g)).get_visible()&&(_+=f.get_width(),d++),f==a)break}for(g=u;g<c;g++){var f=this.getColumnByIndex(g);if(g==u){if((C=this._getRowCell(r,g)).colSpan=d,C.width=_,!t){C.innerHTML=h.internalGetCellHTML(s),o.textAlign&&(C.firstChild.style.textAlign=o.textAlign);var m=o.textBgColor;m&&(C._bgColor=m,C.style.backgroundColor=m)}}else if(f.get_visible()){var C=this._getRowCell(r,u+1);$removeNode(C)}if(f==a)break}}}}},add_summaryLoaded:function(t){this.get_events().addHandler("summaryLoaded",t)},remove_summaryLoaded:function(t){this.get_events().removeHandler("summaryLoaded",t)},getSummaryValue:function(t){var e=this._summaryItems;if(e){var i=e[t];if(i)return i.value}return null},set_summaryItems:function(t){this._summaryItems=t;var e=this._summaryItemPrefix;e||(e=this._summaryItemPrefix=["","最小 ","最大 ","平均 ","计数 ",""]);var i=!1;for(var n in t){var o=this.findColumn(n);if(o&&o.get_useServerSum()){var s=t[n],r=e[s.summaryKind],l=s.value,a=s.formatString;o._setHasServerSum(!0),this._setColumnSummary({column:o,value:l,formatString:a,prefix:r,isServerSum:!0}),i=!0}}i||this.clearAllSummary();var h=this.get_events().getHandler("summaryLoaded");h&&h(this)},clearAllSummary:function(){for(var t=this.get_columns(),e=0,i=t.length;e<i;e++){var n=t[e];n.set_summaryValue(""),n.set_footer("")}},_setColumnSummary:function(t){var e=t.column,i=t.value,n=t.formatString,o=t.prefix,s=t.digitDatas,r=(t.isServerSum,!$settings.NumberColumnFormatNumber),l=Sys.UI.Controls.NumberColumn.isInstanceOfType(e);if(!l&&e.getIsNumberType&&(l=e.getIsNumberType()),l&&(r=!e.get_formatNumber()),!l||r)return e.set_summaryValue(i),void e.set_footer(i);var a=e.get_decimalDigits(!0);s&&!Object.isUndefinedOrNull(s[e.get_dataField()])&&(a=s[e.get_dataField()]);var h=!1;if(a<=0&&(h=!0,a=e.get_decimalScale()),null!=i&&$settings.UseBigNumber&&"undefined"!=typeof math)return i=math.round(i,a),e.set_summaryValue(i),void e.set_footer(i);var d="",_=!1;if(null!=i){var u=(d=i.toString()).indexOf(".");u<0||d.substring(u+1).length<9?(i=parseFloat(i),isNaN(i)?(i=d,l=!1):d=n?i.format(n,!!l&&e.get_displayThousandSeperator()):l?e.formatNumber(i):i.toString()):_=!0,d=(o=o||"")+d}l&&null!=i&&a>0&&(_?(i=i.toFixed(a),h&&(i=i.trimEndChar("0").trimEndChar("\\.")),"-0"==i&&(i="0"),d=i):i=Math.roundTo(i,a)),e.set_summaryValue(i),e.set_footer(d)},get_canSummary:function(){return this._hasSummaryColumn&&(this.get_showFooter()||this._hasSummaryChanged)},_calcColumnsSummary:function(t){if(this.get_canSummary()){for(var e={},i=this.get_columnCount(),n=0,o=[],s=0;s<i;s++){(d=(u=this.getColumnByIndex(s)).get_dataField())&&u.get_isClientSum()&&!u.get_useServerSum()&&(t&&!Array.contains(t,d)||(e[d]=null,Array.add(o,u),n++))}if(0!=n){this._calcLoadedItemsSummary(e,o);for(var r=$settings.NumberColumnFormatNumber?null:{},l=this.get_recordCount(),a=0;a<l;a++){var h=this.getRowData(a);h&&this._calcRowSummary(h,e,o,r)}delete o;for(var d in e){var _=e[d],u=this.getColumn(d);null!=_&&(0!=_||l>0)?this._setColumnSummary({column:u,value:_,digitDatas:r}):(u.set_summaryValue(0),u.set_footer(""))}this._summaryChanged()}}},_isValueNeedSum:function(t){return null!=t&&""!==t},_calcRowSummary:function(t,e,i,n){if(this.dataNeedSum(t)){var o=-1;for(var s in e){var r=this.get_dataController()._doGetObjProp(t,s);if(o++,this._isValueNeedSum(r)){null==e[s]&&(e[s]=0);var l=null;i&&(r=(l=i[o]).loadEditValue(r));var a=e[s],h=this.getColumnMath(l);if(h)a=h.eval(a+"+"+r).toString();else if(a+=parseFloat(r),n&&r&&l&&l.get_formatNumber&&l.get_formatNumber()){var d=n[s];Object.isUndefinedOrNull(d)&&(d=0),n[s]=Math.max(d,$craba.getDecimalDigits(r))}e[s]=a}}}},_calcLoadedItemsSummary:function(t,e){var i=this._doGetLoadedItems();if(i){var n=this._getStartRecordIndex(),o=n+this.get_recordCount(),s=0;for(var r in t){var l=e[s];if(l.get_summaryKind()!=_Z_156.sumPage){for(var a=this.getColumnMath(l),h=0,d=i.length;h<d;h++)if(!(h>=n&&h<o)){var _=i[h];if(_){var u=_.data;if(u&&this.dataNeedSum(u)){var c=this.get_dataController()._doGetObjProp(u,r);if(this._isValueNeedSum(c)){null==t[r]&&(t[r]=0);var g=t[r];a?g=a.eval(g+"+"+c).toString():g+=parseFloat(c),t[r]=g}}}}s++}}}},getColumnMath:function(t){var e=30;return t&&t.get_decimalPrecision&&(e=t.get_decimalPrecision()),$common.getBigMath(e)},add_getFooterHTML:function(t){this.get_events().addHandler("getFooterHTML",t)},remove_getFooterHTML:function(t){this.get_events().removeHandler("getFooterHTML",t)},add_summaryChanged:function(t){this.get_events().addHandler("summaryChanged",t),this._hasSummaryChanged=!0},remove_summaryChanged:function(t){this.get_events().removeHandler("summaryChanged",t),delete this._hasSummaryChanged},_summaryChanged:function(){var t=this.get_events().getHandler("summaryChanged");t&&t(this)},_calcColumnSummary:function(t){var e=t.get_dataField();if(e){var i=this._getPagerPreloadItemsSum(t),n=!0;-1==i&&(n=!1,i=0);for(var o=t.get_formatNumber&&t.get_formatNumber()?null:{},s=0,r=this.get_recordCount();s<r;s++){var l=this.getRowData(s);if(l&&this.dataNeedSum(l)){var a=this.get_dataController()._doGetObjProp(l,e);if(this._isValueNeedSum(a)){a=t.loadEditValue(a);var h=this.getColumnMath(t);if(h)i=h.eval(i+"+"+a).toString();else if(i+=parseFloat(a),o&&a){var d=o[e];Object.isUndefinedOrNull(d)&&(d=0),o[e]=Math.max(d,$craba.getDecimalDigits(a))}n=!0}}}0!=i||n||(i=null),this._setColumnSummary({column:t,value:i,digitDatas:o}),this._summaryChanged()}},_getPagerPreloadItemsSum:function(t){if(t.get_summaryKind()==_Z_156.sumPage)return-1;var e=this._doGetLoadedItems();if(!e)return-1;for(var i=0,n=!1,o=t.get_dataField(),s=this._getStartRecordIndex(),r=s+this.get_recordCount(),l=0,a=e.length;l<a;l++)if(!(l>=s&&l<r)){var h=e[l];if(h){var d=h.data;if(d&&this.dataNeedSum(d)){var _=d[o];this._isValueNeedSum(_)&&(i+=parseFloat(_),n=!0)}}}return n?i:-1},dataNeedSum:function(t){return!0},clearSortFlag:function(){this.get_allowSort()&&this._clearSort(null)},_clearSort:function(t){for(var e=this.get_columnCount(),i=0;i<e;i++){var n=this.getColumnByIndex(i);n!=t&&n._clearSort()}},get_sortColumn:function(){return this._sortColumn},_initColumnSort:function(){!this.findPager()&&this._sortColumn&&this._doSortData(this._sortColumn)},_doSortData:function(t){var e=t.get_isSortAscending();this.get_dataController().sortBy(t,e)},_doSort:function(){var t=this.findPager();if(!t||this.get_clientSort())this._doClientSort();else{var e=this.getSortedOrders();t._internalRefreshSort(e)}},_doClientSort:function(){for(var t=this.get_columnCount(),e=0;e<t;e++){var i=this.getColumnByIndex(e);if(i.get_isSorted()){this._doSortBy(i);var n=this.get_events().getHandler("noPagerAfterSort");if(n){n(this,new _Z_160(i))}break}}},getSortedOrders:function(){for(var t=[],e=this.get_columnCount(),i=0;i<e;i++){var n=this.getColumnByIndex(i);if(n.get_isSorted()){var o={};o.dataField=n.get_sortField(!0),o.ascending=n.get_isSortAscending(),Array.add(t,o)}}return t},add_noPagerAfterSort:function(t,e){return this.get_events().addHandler("noPagerAfterSort",t,e)},remove_noPagerAfterSort:function(t){this.get_events().removeHandler("noPagerAfterSort",t)},_raisePagerBeforeSort:function(t){var e=this.get_events().getHandler("pagerBeforeSort");if(e){var i=new _Z_205(t);if(e(this,i),i.get_cancel())return!0}return!1},add_pagerBeforeSort:function(t,e){return this.get_events().addHandler("pagerBeforeSort",t,e)},remove_pagerBeforeSort:function(t){this.get_events().removeHandler("pagerBeforeSort",t)},add_columnSort:function(t,e){return this.get_events().addHandler("columnSort",t,e)},remove_columnSort:function(t){this.get_events().removeHandler("columnSort",t)},_doSortBy:function(t){this._postEditValue();var e=this.get_events().getHandler("columnSort");if(e){var i=new _Z_205(t);if(e(this,i),i.get_cancel())return}this._doSortData(t),this.refresh(this.get_dataController().save())},_internalGetColumnVisible:function(t){var e=t.get_designVisible();if(this._configData){var i=this._configData.ColumnsVisible;if(i){var n=i[t.get_name()];void 0!==n&&(e=n)}}return e},_internalSetColumnVisible:function(t,e,i){if(i){this._configData||(this._configData={});var n=this._configData.ColumnsVisible;n||(n=this._configData.ColumnsVisible={});n[t.get_name()]=e}else t.set_designVisible(e);this._gridScrollToStart(),this._refreshColumnVisible(t),this._filterBar&&this._filterBar.set_visible(t,e)},_getColumnVisibleIndex:function(t){for(var e=-1,i=0,n=this.get_columnCount();i<n;i++){var o=this.getColumnByIndex(i);if(o==t)break;o.get_visible()&&e++}return e+1},_adjustGroupColVisible:function(t,e){var i=this._colGroup;if(i){var n=this._getColumnVisibleIndex(t);this.get_showRowNo()&&n++;var o=$common.getChildrenByTagName(i,"col"),s=o[n],r=t.get_width();if(e){(a=document.createElement("col")).width=r,s?i.insertBefore(a,s):i.appendChild(a)}else $removeNode(s);var l=this._frozenColGroup;if(l&&n<=this._getFrozenColumnRealCount())if(o=$common.getChildrenByTagName(l,"col"),s=o[n],e){var a=document.createElement("col");a.width=r,s?l.insertBefore(a,s):l.appendChild(a)}else $removeNode(s)}},_refreshColumnVisible:function(t){var e=this._rowsTable.offsetWidth;this.get_readOnly()||this._hideEditor();var i=t.get_visible(),n=t.get_index(),o=t.get_width();o*=i?1:-1;var s=this.get_showScrollBar();if(this.get_showHeader()){if(s){var r=this._savedHeaderWidth;r?this._savedHeaderWidth=null:r=this._header.offsetWidth,this._setHeadTableWidth(this._header,r+o)}c=t.get_headerElement();$common.setDisplay(c,i);var l=t.get_frozenHeaderElement();l&&(this._refreshFrozenHeaderWidth(o),$common.setDisplay(l,i));var a=t.get_band();a&&this._refreshBand(a,i?1:-1),this._refreshFrozenBodyHeight()}if(this._adjustGroupColVisible(t,i),s)e>0?this._setRowsTableWidth(this._rowsTable,e+o):(this._allColumnWidth=this._allColumnWidth>0?this._allColumnWidth:this._getAllColumnWidth(),this._allColumnWidth+=i?t.get_designWidth():-t.get_designWidth(),this._allColumnWidth>0&&this._setRowsTableWidth(this._rowsTable,this._allColumnWidth));else{var h=this._header.offsetWidth,d=this.get_element();d.style.overflow="hidden",d.style.width=h+"px",this._rowsTable.style.width=this._body.style.width}if(this._setRealColumnVisible(n,i,t),this.isFrozenGrid()&&n+1<=this._getFrozenColumnRealCount()){var _=this._frozenRowsTable.offsetWidth+o,u=this._body.offsetWidth;this._frozenRowsTable.style.width=_+"px",_>u&&(_=u),this._frozenBody.style.width=_+"px",this._setFrozenColumnVisible(n,i,t)}if(s?this._doAdjustHeaderSpacer():this.get_element().style.overflow="",this.get_showFooter()){var c=t.get_footerElement();$common.setDisplay(c,i),this._refreshFooterWidth()}t._control||t.focus()},_setRealColumnVisible:function(t,e,i){for(var n=this.get_rowCount(),o=0;o<n;o++){var s=this._getRow(o);if(!s.getAttribute("_isExpandDetail")){var r=this._getRowCell(s,t);if(r){$dom.setCssClass(!e,r,"dnone");var l=o;this._rowExpandColumn&&!this._isTree&&(l=this._getRowIndex(s)),i.initCellHTML(l,r)}}}},_setFrozenColumnVisible:function(t,e,i){for(var n=this.get_rowCount(),o=0;o<n;o++){var s=this._getFrozenRow(o),r=this._getFrozenRowCell(s,t);$common.setDisplay(r,e),r.innerHTML=i._getCellHTML(o),this._changeFrozenRowHeight(o)}},_refreshFooterWidth:function(){if(this.get_showFooter()){var t=this._header?this._header:this._rowsTable;$common.setWidth(this._footer,t.offsetWidth),this._frozenFooter&&($common.setWidth(this._frozenFooter,this._frozenHeaderTable.offsetWidth),$common.setWidth(this._frozenFooterBar,this._frozenHeaderBar.offsetWidth));for(var e=0,i=this.get_columnCount();e<i;e++){var n=this.getColumnByIndex(e);n&&n.refreshFooterCellWidth()}}},_refreshFrozenHeaderWidth:function(t){var e=this._frozenHeaderTable.offsetWidth+t;this._setHeadTableWidth(this._frozenHeaderTable,e);var i=this._headerBar.offsetWidth;$common.setWidth(this._frozenHeaderBar,e>i?i:e)},_refreshColumnWidth:function(t,e,i){t._hideEditor();var n=e-i;this._refreshColumnHeader(t,i,e),this._setRowsTableWidth(this._rowsTable,this._rowsTable.offsetWidth+n),this._adjustGroupColWidth(t,e);var o=t.get_index();if(this.isFrozenGrid()&&o+1<=this._getFrozenColumnRealCount()){var s=this._frozenRowsTable.offsetWidth+n;$common.setWidth(this._frozenRowsTable,s),this._setFrozenColumnWidth(o,e),this._doAdjustFrozenBodyWidth(s)}this._setRealColumnWidth(o,e),this._initCellMerge(!0),this._doAdjustHeaderSpacer(),this._refreshFooterWidth(),this._gridScroll()},_refreshColumnHeader:function(t,e,i){var n=i-e;if(this.get_showHeader()){this._setHeadTableWidth(this._header,this._header.offsetWidth+n);t.get_headerElement().width=i,t._bandTd&&(t._bandTd.width=t._bandTd.offsetWidth+n);var o=t.get_frozenHeaderElement();o&&(this._refreshFrozenHeaderWidth(n),o.width=i);var s=t.get_band();s&&this._refreshBand(s,2)}},_doAdjustFrozenBodyWidth:function(t){var e=this.get_element().offsetWidth-this._getBorderSize(!1);$common.setWidth(this._frozenBody,t>e?e:t)},_setFrozenColumnWidth:function(t,e){for(var i=this.get_rowCount(),n=0;n<i;n++){var o=this._getFrozenRow(n);if(o){var s=this._getFrozenRowCell(o,t);s&&(s.width=e)}}},_setRealColumnWidth:function(t,e){for(var i=this.get_rowCount(),n=0;n<i;n++){var o=this._getRow(n);if(!o.getAttribute("_isExpandDetail")){var s=this._getRowCell(o,t);s&&(s.width=e,this._changeFrozenRowHeight(n))}}this._refreshFrozenBodyHeight()},_internalFrozenRowsHeight:function(){if(this.isFrozenGrid()){for(var t=this.get_rowCount(),e=0;e<t;e++)this._changeFrozenRowHeight(e);this._refreshFrozenBodyHeight()}},_changeFrozenRowHeight:function(t){var e=this._getRow(t),i=this._getFrozenRow(t);i&&i.offsetHeight!=e.offsetHeight&&(i.style.height=e.offsetHeight+"px")},_adjustGroupColWidth:function(t,e){var i=this._colGroup;if(i&&t.get_visible()){var n=$common.getChildrenByTagName(i,"col"),o=this._getColumnVisibleIndex(t),s=o;this.get_showRowNo()&&s++,t._getVisibleIndex&&(o=s=t._getVisibleIndex());var r=n[s];r.width=e;for(var l=0;l<n.length-1;l++)Sys.Browser.isIE&&(n[l].width=parseInt(n[l].width)-1,n[l].width=parseInt(n[l].width)+1);var a=this._frozenColGroup;a&&o+1<=this._getFrozenColumnRealCount()&&((r=(n=$common.getChildrenByTagName(a,"col"))[s]).width=e)}},_refreshBand:function(t,e){if(!t)throw Error.argumentNull("band");var i=t.element,n=i.style.display,o="none"==n;if("none"==n&&1!=e)return this._header.className=this._header.className,void i.setAttribute("_colSpan",0);var s=t.columns,r=0,l=i.offsetWidth,a=i.colSpan;"0"==i.getAttribute("_colSpan")&&(a=0,i.setAttribute("_colSpan",""));var h=(r=e<2?a+e:a)>0;if($common.setDisplay(i,h),h){if(i.colSpan=r,i.style.width=l+"px",this._setParentBand(t,r-a),o){a=0;for(var d=0,_=s.length;d<_;d++)t.columns[d].get_visible()&&a++;0==a?i.setAttribute("_colSpan",0):i.colSpan=a}}else this._setParentBand(t,r-a);this._header.className=this._header.className},_setParentBand:function(t,e){if(t&&t.parentBands&&0!=e)for(var i=0,n=t.parentBands.length;i<n;i++){var o,s=t.parentBands[i];"0"==s.element.getAttribute("_colSpan")?(o=0,s.element.setAttribute("_colSpan","")):o=s.element.colSpan;var r=o+e;r<=0?(s.element.setAttribute("_colSpan",0),$common.setDisplay(s.element,!1)):$common.setDisplay(s.element,!0),s.element.colSpan=r<=0?1:r,this._setParentBand(s,e)}},_internalGetFrozenColumnCount:function(){if(!this.get_allowFrozen())return 0;var t=this._defaultFrozenColumnCount;if(this._configData){var e=this._configData.FrozenColumnCount;void 0!==e&&(t=e)}return t},_internalGetColumnCaption:function(t){var e=t.get_designCaption();if(!this._configData)return e;var i=this._configData.ColumnsCaption;if(!i)return e;var n=i[t.get_name()];return n||e},_internalGetColumnWidth:function(t){var e=t.get_designWidth();if(this._configData&&(t.get_allowResize()||t.get_allowStretch())){var i=this._configData.ColumnsWidth;if(i){var n=i[t.get_name()];n>0&&(e=n)}}return e},get_configData:function(){return this._configData},set_configData:function(t){this._configData=t},get_lazyPageItem:function(){return this._lazyPageItem},set_lazyPageItem:function(t){this._lazyPageItem=t},_internalSetColumnCaption:function(t,e,i){if(i){this._configData||(this._configData={});var n=this._configData.ColumnsCaption;n||(n=this._configData.ColumnsCaption={});var o=t.get_name();e==t.get_designCaption()?delete n[o]:n[o]=e}else t.set_designCaption(e);t._internalRefreshCaption()},_clearConfigColumnCaption:function(t){if(this._configData){var e=this._configData.ColumnsCaption;if(e){delete e[t.get_name()]}}},_internalSetStretchColumnWidth:function(t,e,i,n,o,s){if(n?this._updateConfigData(t,e):t.set_designWidth(e),s)return this._refreshColumnHeader(t,i,e),this._adjustGroupColWidth(t,e),this._refreshFooterWidth(),void this._doAdjustRowsTableWidth();this._refreshColumnWidth(t,e,i),this._filterBar&&!o&&this._filterBar.set_width(t,e)},_internalSetColumnWidth:function(t,e,i,n,o){this._internalSetStretchColumnWidth(t,e,i,n,o),n&&(this._configDataChanged=!0)},_updateConfigData:function(t,e){this._configData||(this._configData=new Object);var i=this._configData.ColumnsWidth;i||(i=this._configData.ColumnsWidth={});var n=t.get_name();e==t.get_designWidth()?delete i[n]:i[n]=e},_clearColumnWidth:function(t){var e=this._configData;if(e){var i=e.ColumnsWidth;i&&delete i[t]}},_internalSwapColumn:function(t,e){t._hideEditor(),e._hideEditor();var i=t._elements,n=e._elements,o=t.get_index(),s=e.get_index(),r=t.get_frozenIndex(),l=e.get_frozenIndex();t._internalDisposeHeader(),e._internalDisposeHeader(),t._internalSetElements(n,s,l),e._internalSetElements(i,o,r);var a=this._columns;a[o]=e,a[s]=t,this._changeColumnCellColor(t,e),this._refreshColumn(t),this._refreshColumn(e),this._saveColumnsDisplayOrder(),this._filterBar&&this._filterBar.swapColumn(t,e)},_saveColumnsDisplayOrder:function(){this._configData||(this._configData={});for(var t=[],e=this._columns,i=0,n=e.length;i<n;i++){var o=e[i];o._isExpandNew||Array.add(t,o.get_name())}this._configData.ColumnsDisplayOrder=t,this._configDataChanged=!0},_changeColumnCellColor:function(t,e){if(t&&e)for(var i=t.get_index(),n=e.get_index(),o=0,s=this.get_rowCount();o<s;o++){var r=this._getRow(o);if(!r.getAttribute("_isExpandDetail")){var l=this._getRowCell(r,i),a=this._getRowCell(r,n),h=l._fontColor;l._fontColor=a._fontColor,a._fontColor=h}}},_refreshColumn:function(t){var e=t.get_visible(),i=t.get_width();if(this.get_showHeader()){a=t.get_headerElement();$common.setDisplay(a,e),a.width=i,a.align=t.get_headerAlign(),this._adjustGroupColWidth(t,i)}t._internalRefreshCaption(),t._internalRefreshSortOrder();for(var n=t.get_index(),o=0,s=this.get_rowCount();o<s;o++){var r=this._getRow(o);if(!r.getAttribute("_isExpandDetail")){if(a=this._getRowCell(r,n)){$dom.setCssClass(!e,a,"dnone"),a._fontColor="",a.align=t.get_textAlign(),a.width=i,a.setAttribute("_columnIndex",n),this._initCellStyle(n,a);var l=o;this._rowExpandColumn&&!this._isTree&&(l=this._getRowIndex(r)),t.initCellHTML(l,a)}}}if(this.get_showFooter()){var a=t.get_footerElement();$common.setDisplay(a,e),a.width=i,t.doRefreshFooter(),this._refreshFooterWidth()}},_internalRefreshColumnContent:function(t){this._rowCreated&&(t._refreshColumnHTML(),t.doRefreshFooter())},_internalRefreshColumnStyle:function(t){for(var e=t.get_index(),i=0,n=this.get_rowCount();i<n;i++){var o=this._getRow(i),s=this._getRowCell(o,e);this._initCellStyle(e,s)}},_internalRefreshNullText:function(){for(var t=this.get_rowCount(),e=0,i=this.get_columnCount();e<i;e++){var n=this.getColumnByIndex(e);n.get_visible()&&n._nullDisplayText&&n._refreshColumnHTML(t)}},get_designColumnsDisplayOrder:function(){return this._designColumnsDisplayOrder},set_designColumnsDisplayOrder:function(t){this._designColumnsDisplayOrder=t},_internalResetConfig:function(){for(var t=0,e=this.get_columnCount();t<e;t++){var i=this.getColumnByIndex(t);i._isExpand||(i.set_caption(i.get_designCaption(),!0),i.set_width(i.get_designWidth(),!0),i.set_visible(i.get_designVisible(),!0))}this.get_noColumn()&&this.get_noColumn().set_width(this.get_noColumn().get_designWidth(),!0),this._configData&&delete this._configData.FrozenColumnCount;var n=this.get_designColumnsDisplayOrder();n&&this._resetColumnsDisplayOrder(n),this._configData&&(delete this._configData,this._configData=null),this._setFrozenVisible(!1),this.resetColumnStretch(!0);var o=this.get_events().getHandler("afterResetConfig");o&&o(this),this._filterBar&&!this.isFrozenGrid()&&this._filterBar.reset()},_resetColumnsDisplayOrder:function(t){for(var e={},i=0,n=t.length;i<n;i++){d=t[i];e[d]=i}for(var o=this._columns,i=0,n=o.length;i<n;i++){var s=o[i],r=e[s.get_name()];if(s._orderChange=r!=i,!(r>-1)){for(var l=s.get_index(),a=l,h=0;h<t.length;h++){var d=t[h];(r=e[d])<l||!e[d]||(a++,e[d]=a)}e[s.get_name()]=l}}for(var n=o.length,_=new Array(n),i=0;i<n;i++){s=o[i];_[i]=s._elements}o.sort(function(t,i){var n=e[t.get_name()];void 0===n&&(n=0);var o=e[i.get_name()];return void 0===o&&(o=0),n-o}),this._disposeColumnsHeader(this._columns),this._initColumnForzenIndex();for(i=0;i<n;i++){var s=o[i],u=_[i];s._internalSetElements(u,i),s._orderChange&&this._refreshColumn(s)}},_checkConfigData:function(t,e){var i=t[e];return Object.isEmpty(i)?(delete t[e],null):i},_internalSaveConfig:function(t){if(this.get_saveConfig()){var e=this.get_configData();if(e){var i=this._checkConfigData(e,"ColumnsVisible"),n=this._checkConfigData(e,"ColumnsCaption"),o=this._checkConfigData(e,"ColumnsWidth"),s=this._checkConfigData(e,"FrozenColumnCount"),r=this._checkConfigData(e,"PageSize");null==i&&null==n&&null==o&&null==e.ColumnsDisplayOrder&&null==s&&null==r&&(e=null)}var l=this.get_guid()+"_"+this.get_configID();if(this._configDataChanged=!1,!$craba.checkConfig("grid",l,e)){var a=Craba.Web.Script.DataService.create(this.get_form());if(t)try{a.SaveGridConfig(l,e,!0)}catch(h){}else a.SaveGridConfig(l,e,Function.emptyMethod,Function.emptyMethod)}}},config:function(t){if(this.get_visible()){this._hideEditor(),this._setFrozenVisible(!1);var e=new Sys.UI.Form(this._grid);e._grid=this,e._hideNotAllowConfigColumns=t;var i=this;e.add_closed(function(){i._hideEditor()},e),e.showModal($common.getSysUIBaseURI(this.get_form())+"Grid/GridConfig.gspx")}else $common.showHint("亲，不允许对隐藏的表格进行列配置哦！",5)},filter:function(){if(!this.findPager())throw Error.invalidOperation("过滤暂时只支持有分页器的 Grid");var t=$common.getSysUIBaseURI()+"Grid/GridFilter.gspx",e=new Sys.UI.Form(this._grid);e._grid=this,e.showModal(t)},_findBand:function(t){var e=this._bands;if(!e||!t)return null;t=t.toLowerCase();for(var i=0,n=e.length;i<n;i++){var o=e[i],s=o.name;if(s&&s.toLowerCase()==t)return o}return null},_getFirstColumnExpandCount:function(){var t=this._columnExpands,e=t&&t.length>0?t[0]:null;return e&&e.captions?e.captions.length:-1},_initColumnExpands:function(){this._body.scrollLeft>0&&(this._body.scrollLeft=0),this._clearColumnHeadersHighlight();var t=this._columnExpands;if(t)for(var e=0,i=t.length;e<i;e++)this._initColumnExpand(t[e])},expandColumn:function(t,e,i){e||(e=[]),i||(i=[]);var n={name:t,dataFields:e,captions:i};this.set_columnExpands([n])},_initColumnExpand:function(t){var e=t?t.name:null;if(e){var i=this._findBand(e);if(i)this._expandBand(i,t);else{var n=this.findColumn(e);if(!n)throw Error.invalidOperation("列“"+e+"”不存在");var o=n._internalGetChangeHandler();o&&n.add_change(o),this._expandColumn(n,t)}}},_initBand:function(t){if(!t.element){t.element=$get(this.get_id()+"_band"+t.index);for(var e=t.index,i=t.columns=[],n=0,o=this.get_columnCount();n<o;n++){var s=this.getColumnByIndex(n);s.get_bandIndex()==e&&(s.set_groupName(t.caption),Array.add(i,s))}}},getBandByIndex:function(t){var e=this._bands;if(t>=0&&e&&t<e.length){var i=e[t];this._initBand(i);var n=i.parentBands;if(!n){n=i.parentBands=[];for(var o=i.parentBandIndex;o>-1;){var s=e[o];s?(s.element=$get(this.get_id()+"_band"+s.index),n.push(s),o=s.parentBandIndex):o=-1}}return i}return null},_expandBand:function(t,e){this._initBand(t);var i=e.captions,n=e.dataFields,o=e.reportFields;o||(o=[]);var s=i?i.length:0,r=t.expanded;if(!r){r=t.expanded=[t];for(var l=t.columns,a=0,h=l.length;a<h;a++){l[a].set_groupName(t.name)}}for(var d=t.expanded.length,a=0;a<d;a++){var _=a<s;this._initOldBand(r[a],_,a,i[a],n,o[a])}for(a=d;a<s;a++)r[a]=this._addNewBand(t,a,i[a],n,o[a])},_initOldBand:function(t,e,i,n,o,s){var r=t.element;this._savedHeaderWidth=this._header.offsetWidth,$common.setDisplay(r,e),e&&(r.firstChild.innerHTML=n),t.caption=n;for(var l=t.columns,a=l.length,h=0;h<a;h++){var d=l[h],_=d.get_designVisible(),u=e&&_;this._maxHeaderLevel>1&&d.set_groupName(n),d.set_allowConfig(!1),d.set_visible(u,!1),d._isExpand=!0,d._bandVisible=e;var c=o[i*a+h];d.set_dataField(c),u?(d._noUse=!1,this._initColumnReportField(d,d,s,c)):d._noUse=!!_}},_initColumnReportField:function(t,e,i,n){i?t.set_reportField(i+e.get_designCaption()):t.set_reportField(n)},_expandColumn:function(t,e){var i=e.captions,n=e.dataFields,o=e.reportFields;o||(o=[]);var s=i?i.length:0,r=t.expanded,l=t.get_band();r||(r=t.expanded=[t],this._maxHeaderLevel>1&&!l&&t.set_groupName(t.get_name()));for(var a=t.expanded.length,h=l?l.element:null,d=0;d<a;d++){var _=d<s;this._initOldColumn(r[d],_,i[d],n[d],o[d])}h&&(0==s&&h.setAttribute("_colSpan",0),h.colSpan=s<=a?s<=0?1:s:a);for(d=a;d<s;d++){var u=this._addNewColumn(t,d,i[d],n[d],o[d]);u._isExpandNew=!0,r[d]=u}},_initOldColumn:function(t,e,i,n,o){t.get_headerElement().style.overflow="hidden",t.set_visible(e,!0),this._clearConfigColumnCaption(t),e&&(t.set_caption(i,!0),t.set_designCaption(i),t.set_dataField(n),t.set_reportField(o))},_addNewColumn:function(t,e,i,n,o,s){var r=t.get_headerElement(),l=e,a=this._insertTd(r,l,i,!0);a.rowSpan=this._getMultiRows();var h=null,d=t.get_footerElement();d&&(h=this._insertTd(d,l,"",!1));var _=this._insertColumn(t.get_index()+e,t.get_params(),t.get_name(),n,a,h,s);if(_.set_caption(i),s&&s.properties&&s.properties.designCaption?_.set_designCaption(s.properties.designCaption):(this._clearConfigColumnCaption(_),_.set_designCaption(i)),_.set_reportField(o),this._maxHeaderLevel>1){var u=t.get_name(),c=t.get_groupName();_.set_groupName(c||u)}var g=t._internalGetChangeHandler();g&&_.add_change(g);var f=t.get_bandIndex();if(f>=0){var m=this.getBandByIndex(f);_.set_bandIndex(f),_.set_band(m),m.columns[e]=_,this._refreshBand(m,1)}return _.get_visible()||this._refreshColumnVisible(_),this._doAdjustRowsTableWidth(),_},_doAdjustRowsTableWidth:function(){var t=this;$craba.asyncFun(this,function(){t._doAsyncTableWidth()},50,"adjustWidth")},_doAsyncTableWidth:function(){if(!this.get_isDisposed()&&this._rowsTable){this._doAdjustHeaderSpacer(),this._doAdjustFooterSpacer();var t=this._headerRow?this._headerRow.offsetWidth:this.get_width();t<5||this._setRowsTableWidth(this._rowsTable,t)}},_createHeaderTd:function(t,e,i){var n=$common.createTd(),o=i?"GridHeaderCaption":"GridFooterCell";n.className=o,n.width=t.width,n.align=t.align,n.colSpan=t.colSpan,n.rowSpan=t.rowSpan;var s=$common.createClassDiv(o+"Text");return s.innerHTML=e,n.appendChild(s),n},_insertTd:function(t,e,i,n){var o=this._createHeaderTd(t,i,n);o.style.overflow="hidden";var s=t.parentNode,r=$common.getChildrenByTagName(s,"td"),l=Array.indexOf(r,t)+e;return l==r.length?s.appendChild(o):s.insertBefore(o,r[l]),o},_addNewBand:function(t,e,i,n,o){var s=this.get_bands(),r=s&&s.length>0?s.length-1:0,l={},a=t.element,h=(a.offsetWidth,this._insertTd(a,e,i,!0));l.element=h,h.colSpan=t.columns.length,""!=i&&(l.caption=i);var d=0,_=t.columns,u=_.length;l.columns=new Array(u);for(var c=e*u,g=0;g<u;g++){var f=_[g],m=f.get_headerElement(),C=this._insertTd(m,c,f.get_designCaption(),!0),v=null,p=f.get_footerElement();p&&(v=this._insertTd(p,c,"",!1));var w=n[e*u+g];(S=this._insertColumn(f.get_index()+e*u,f.get_params(),f.get_name(),w,C,v)).set_groupName(t.name),this._initColumnReportField(S,f,o,w),S.set_bandIndex(r+e),S.set_band(l),S.set_allowConfig(!1),""!=i&&S.set_groupName(i),S._isExpand=!0,d+=S.get_width()+1,l.columns[g]=S}if(Sys.Browser.isIE8){var y=this._header;this._setHeadTableWidth(y,y.offsetWidth+d)}for(g=0;g<u;g++){var S=l.columns[g];S._internalRefreshCaption(),S.get_visible()||this._refreshColumnVisible(S)}return this._doAdjustRowsTableWidth(),l},_setHeadTableWidth:function(t,e){e<10||(Sys.Browser.isIE8?(t.style.tableLayout="auto",t.style.width=e+"px",t.style.tableLayout="fixed"):t.style.width=e+"px")},_setRowsTableWidth:function(t,e){var i=0==this.get_columnCount()?this._allColumnWidth:this._getAllColumnWidth();if(!(i<=0)){var n=i;if($common.setWidth(t,n),0==this.get_rowCount()){var o=$common.getNextSibling(t);o&&$common.setWidth(o,n)}}},_insertColumn:function(t,e,i,n,o,s,r){for(var l=t,a=this.get_columnCount();l<a;l++){this.getColumnByIndex(l).set_index(l+1)}var h=this._createColumn(t,e,o,s,null,null,r);h.set_dataField(n),r&&r.name?h.set_name(r.name):h.set_name(i+t),h._isNew=!0,Array.insert(this._columns,t,h),h.set_index(t);var d=h.get_width();this._colGroup?this._adjustGroupColVisible(h,!0):o.width=d,s&&(s.width=d);for(var _=this.get_showRowNo()?1:0,l=0,a=this.get_rowCount();l<a;l++){var u=this._getRow(l),c=this._createCell(h),g=$common.getChildrenByTagName(u,"td");t==g.length-_?u.appendChild(c):u.insertBefore(c,g[t+_]),this._initCellStyle(t,c)}return this._initColumnForzenIndex(),h},_clearColumnHeadersHighlight:function(){this._lastHighlightRect&&this._lastHighlightColumn&&(this._doHighlightColumnHeaders(this._lastHighlightColumn,this._lastHighlightRect,!1),this._lastHighlightRect=null)},highlightColumnHeaders:function(t,e){this._lastHighlightRect&&this._doHighlightColumnHeaders(t,this._lastHighlightRect,!1),this._doHighlightColumnHeaders(t,e,!0),this._lastHighlightRect=e,this._lastHighlightColumn=t},_doHighlightColumnHeaders:function(t,e,i){for(var n=(_=this.getColumn(t).get_headerElement()).parentNode,o=$common.getChildrenByTagName(n,"td"),s=Array.indexOf(o,_),r=e.x,l=e.y,a=e.x+e.width-1,h=e.y+e.height-1,d=r;d<=a;d++)for(var _=o[s+d],u=$common.getFirstChildByTagName(_,"div").childNodes,c=l;c<=h;c++){u[c].style.backgroundColor=i?"#FFA535":""}},getRowExpanded:function(t){this._checkRowIndex(t);var e=this._checkHasExpandColumn();return this.getRowData(t)[e]},setExpandAllRows:function(t){if(this._rowExpandColumn){this._rowExpandColumn.set_expandAll(t);for(var e=this.get_recordCount(),i=0;i<e;i++)t?this.expandRow(i):this.collapseRow(i)}},setExpandButtonVisible:function(t,e){if(!(t<0||t>=this.get_recordCount())){this._checkHasExpandColumn();this.getRowEnabled(t)&&(this._rowExpandColumn._setCellValue(t,e?0:-1),this.setRowColumnVisible(t,this._rowExpandColumn,e))}},expandRow:function(t,e,i,n){if(!(t<0||t>=this.get_recordCount())){this.clearSortFlag(),null==this._saveAllowSort&&(this._saveAllowSort=this.get_allowSort()),this.set_allowSort(!1);var o=this._getRow(t);this._refreshCellValue(o,t,this._rowExpandColumn,1);var s=this.get_columnCount(),r=document.createElement("tr");r.setAttribute("_isExpandDetail",1),r.className="GridBodyRow",this.get_showRowNo()&&this._createNoTd(r);for(var l=this._rowExpandColumn.get_index(),a=0;a<=l;a++){this._createNoTd(r).className=this._rowExpandColumn.get_cellCssClass()}var h=this._createNoTd(r);if(h.colSpan=s-l,h.vAlign="top",h.className="GridDetailTd",this._rows.insertBefore(r,o.nextSibling),e){var d=new Sys.UI.Form(this);d._parentGridRowIndex=t,d._parentGrid=this,d._useEsc=!1,d._initClientSize(h,0),d.showPage($common.encodeUrlParams(e,i),h,i),this._appendChildForm(t,d),n&&n.get_callBack()&&n.get_callBack()(h,d)}else n&&n.get_callBack()&&n.get_callBack()(h,null)}},collapseRow:function(t){if(!(t<0||t>=this.get_recordCount())){var e=this._checkHasExpandColumn(),i=this.getRowData(t);if(i){if(1==i[e]){this._removeChildForm(t);var n=this._getRow(t);this._refreshCellValue(n,t,this._rowExpandColumn,0),$removeNode($common.getNextSibling(n)),this._resetSortFlag()}}}},_refreshCellValue:function(t,e,i,n){var o=this._getRowCell(t,i.get_index());i._getDataController().setCellValue(e,i,n),i.initCellHTML(e,o);var s=i.get_index();if(this.isFrozenGrid()&&s+1<=this._getFrozenColumnRealCount()){var r=this._getFrozenRow(e),l=this._getFrozenRowCell(r,s);i.initCellHTML(e,l)}},_isChildGrid:function(){return null!=this.get_form()._parentGrid},_resetSortFlag:function(){this._hasChildGrid()||this.set_allowSort(this._saveAllowSort)},getChildForms:function(){return this._expandChildForms},getChildForm:function(t){var e=this._expandChildForms;return e?e[t]:null},_appendChildForm:function(t,e){var i=this._expandChildForms;i||(i=this._expandChildForms={}),i[t]=e},_removeChildForm:function(t){var e=this._expandChildForms;if(e){var i=e[t];if(i){if(i.close)i.close();else{this.get_form().removeControl(i)}delete e[t]}}},_clearExpandRow:function(){var t=this._expandChildForms;if(t){var e=this.get_form();for(var i in t){var n=t[i];n&&(n.close?n.close():e.removeControl(n))}delete this._expandChildForms,this._resetSortFlag()}},showPopup:function(t,e,i){$gridExt.showPopup(this,t,e,i)},get_allowPopup:function(){return this._allowPopup},set_allowPopup:function(t){this._allowPopup=t},get_autoPagerPageSize:function(){return this._autoPagerPageSize},set_autoPagerPageSize:function(t){this._autoPagerPageSize=t},add_popuping:function(t){this.get_events().addHandler("_popuping",t)},remove_popuping:function(t){this.get_events().removeHandler("_popuping",t)},add_filter:function(t){this.get_events().addHandler("filter",t)},remove_filter:function(t){this.get_events().removeHandler("filter",t)},hasScroll:function(){var t=this._body;return!!t&&(t.scrollWidth>t.clientWidth||t.scrollHeight>t.clientHeight)},hasXScroll:function(){var t=this._body;return!!t&&t.scrollWidth>t.clientWidth},hasYScroll:function(){var t=this._body;return!!t&&t.scrollHeight>t.clientHeight},_initGridShowMax:function(){this._allowPopup&&$gridExt._initGridShowMax(this)},get_enabled:function(){return this._enabled},set_enabled:function(t){this._enabled!=t&&(this._enabled=t,this.get_isInitialized()&&($craba._initEnabledlay(this),this._multiSelectColumn&&this._multiSelectColumn.set_enabled(t),this._rowDeleteColumn&&this._rowDeleteColumn.set_enabled(t),this.refreshStyle()))},_initOverlaySize:function(){if(this._overlay)if(this.hasYScroll()?$common.setWidth(this._overlay,this.get_width()-this.get_scrollBarWidth()):this._overlay.style.width="100%",this.hasXScroll()){var t=this.get_height()-this.get_scrollBarWidth();this._footer&&(t-=this._footer.offsetHeight),$common.setHeight(this._overlay,t)}else this._overlay.style.height="100%"},removeColumn:function(t){var e;if(!(e="number"==typeof t?this._columns[t]:"string"==typeof t?this.findColumn(t):t))throw Error.abort(String.format("当前删除的列（{0}）不存在",t));for(var i=e.get_dataField(),n=(t=e.get_index())+1,o=this.get_columnCount();n<o;n++){this.getColumnByIndex(n).set_index(n-1)}var s=e.get_headerElement();s.parentNode.removeChild(s);var r=e.get_footerElement();r&&r.parentNode&&r.parentNode.removeChild(r);for(var n=0,o=this.get_rowCount();n<o;n++){var l=this._getRow(n),a=this._getRowCell(l,t);l.removeChild(a)}e.dispose(),this._allColumnWidth=1,Array.removeAt(this._columns,t),this._commandColumns&&Array.remove(this._commandColumns,e),this._mergeRowColumns&&Array.remove(this._mergeRowColumns,e),this._removeDisplayOrder(i),this._doAdjustRowsTableWidth(),this._resetColumnIndex(t),this._asyncFilterBar()},insertColumn:function(t,e,i){if("number"!=typeof t)throw Error.abort("第一个参数必须传入索引");e.inited||(e=this._initNewColumnParams(e)),!1!==i&&this._addDisplayOrder(t,e.dataField);var n=this._columns;e.configIndex!==undefined&&e.configIndex<n.length&&(t=e.configIndex);var o=this._columns[t];if(!o)return this.appendColumn(e,!1);var s=this._insertColumnByParams(o,e);return this._resetColumnIndex(t),this._asyncFilterBar(),s.get_visible()&&e.refresh&&s._refreshColumnHTML(),s},_addDisplayOrder:function(t,e){var i=this.get_designColumnsDisplayOrder();i||(i=[]),Array.insert(i,t,e)},_removeDisplayOrder:function(t){var e=this.get_designColumnsDisplayOrder();e&&Array.remove(e,t)},appendColumn:function(t,e){t.inited||(t=this._initNewColumnParams(t));var i=this._columns;if(t.configIndex!==undefined&&t.configIndex<i.length)return this.insertColumn(t.configIndex,t,!1);!1!==e&&this._addDisplayOrder(i.length,t.dataField);var n;if(i.length>0){var o=i[i.length-1];n=this._addNewColumn(o,1,t.caption,t.dataField,t.reportField,t)}else n=this._insertColumnByParams(null,t);return this._asyncFilterBar(),n.get_visible()&&t.refresh&&n._refreshColumnHTML(),n},appendBand:function(t){if("object"==typeof t&&t.columnParams){var e=t.columnParams.length;if(0!=e){for(var i=0,n=0,o=t.columnParams.length;n<o;n++){w=t.columnParams[n];Object.isUndefinedOrNull(w.properties)&&(w.properties={}),Object.isUndefinedOrNull(w.properties.designWidth)&&(w.properties.designWidth=100),i+=w.properties.designWidth}var s=this._columns;if(0!=s.length){var r=!Object.isUndefinedOrNull(t.index),l=s[s.length-1];r&&(l=s[t.index]);var a=l.get_index(),h=l._bandTd?l._bandTd:l.get_headerElement(),d=this._header,_=$common.getTableBody(d),u=_.firstChild,c=0;if(r)for(var g=$common.getPreviousSibling(h);g;)g.colSpan>1&&(c+=g.colSpan),g=$common.getPreviousSibling(g);var f=this._insertTd(h,0,t.caption,!0);f.align="center",f.width=i,f.colSpan=e,f.isBand=!0;for(var m=$common.getChildrenByTagName(u,"td"),n=0,o=m.length;n<o;n++){var C=m[n];C.colSpan>1||C.isBand?C.rowSpan=1:C.rowSpan=2}var v=null,p=this._getMultiRows()>1?_.lastChild:this._expandRow;p?r&&(v=p.childNodes[c]):((p=$common.createTr()).className="GridHeaderRow",_.appendChild(p),this._expandRow=p);for(var n=0,o=t.columnParams.length;n<o;n++){var w,y={width:(w=t.columnParams[n]).properties.designWidth,align:"center",colSpan:1,rowSpan:1},S=this._createHeaderTd(y,"",!0);v?p.insertBefore(S,v):p.appendChild(S);var I=null,R=l.get_footerElement();R&&(I=this._insertTd(R,0,"",!1));var x=this._insertColumn(a,w,w.dataField,w.dataField,S,I,w);x.set_caption(w.caption),x.set_designCaption(w.caption),x.set_reportField(w.reportField),x.set_index(a),x.set_allowConfig(!1),x.set_allowResize(!1),x._bandTd=f,x._bandName=t.name,x.get_visible()||this._refreshColumnVisible(x),a++}this._resetColumnIndex(a),this._asyncFilterBar(),this._refreshFrozenHeaderHeight(),this._doAdjustRowsTableWidth()}}}},removeBand:function(t){for(var e=null,i=[],n=0,o=this._columns.length;n<o;n++){(s=this._columns[n])._bandName==t&&(e=s._bandTd,i.push(s))}if(0!=i.length){for(var n=0,o=i.length;n<o;n++){var s=i[n];this.removeColumn(s)}$removeNode(e);var r=this._header,l=$common.getTableBody(r),a=this._getMultiRows()>1?l.lastChild:this._expandRow;a&&0==a.childNodes.length&&($removeNode(a),delete this._expandRow),this._asyncFilterBar(),this._doAdjustRowsTableWidth()}},_asyncFilterBar:function(){if(this._filterBar){var t=this;t._filterTimer&&clearTimeout(t._filterTimer),t._filterTimer=setTimeout(function(){t._filterBar.reset(),t._filterTimer=null},50)}},_initNewColumnParams:function(t){var e=this._columns;e||(e=this._columns=[]),t&&"object"==typeof t||(t={type:Sys.UI.Controls.TextColumn,caption:"新增列",dataField:"dataField",name:"name",reportField:"reportField"}),Object.isUndefinedOrNull(t.properties)&&(t.properties={}),t.properties.designCaption=t.caption,t.properties.allowFrozen=!1,t.inited=!0;var i=t.dataField,n=this.findColumn(i);if(!n)return t.name=t.dataField,this._checkNewColumnConfig(t),t;for(var o=0,s=t.reportField,r=t.caption;n;)t.dataField=i+"_"+o,t.reportField=s+"_"+o,t.caption=r+"_"+o,t.properties.designCaption=r+"_"+o,t.name=i+"_"+o,n=this.findColumn(t.dataField),o++;return this._checkNewColumnConfig(t),t},_checkNewColumnConfig:function(t){var e=t.dataField,i=this.get_configData();if(i){var n=this._checkConfigData(i,"ColumnsCaption"),o=this._checkConfigData(i,"ColumnsDisplayOrder");if(n&&n[e]&&(t.caption=n[e]),o){var s=Array.indexOf(o,e);s>-1&&(s=this._checkExistIndex(o,s),t.configIndex=s)}}},_checkExistIndex:function(t,e){var i=0,n=0;for(t.length;n<e;n++){var o=t[n];this.findColumn(o)&&i++}return i},_insertColumnByParams:function(t,e){var i=this._headerRow.firstChild,n=1,o=0;t&&(n=0,o=t.get_index(),i=t._bandTd?t._bandTd:t.get_headerElement());var s=this._insertTd(i,n,e.caption,!0);s.rowSpan=this._getMultiRows();var r=null,l=this._footerRow;return l&&(l=this._footerRow.firstChild,t&&(l=t.get_footerElement()),r=this._insertTd(l,n,"",!1)),Object.isUndefinedOrNull(e.properties)&&(e.properties={}),Object.isUndefinedOrNull(e.properties.designWidth)&&(e.properties.designWidth=100),newColumn=this._insertColumn(o,e,e.dataField,e.dataField,s,r,e),newColumn.set_caption(e.caption),e&&e.properties&&e.properties.designCaption?newColumn.set_designCaption(e.properties.designCaption):newColumn.set_designCaption(e.caption),newColumn.set_reportField(e.reportField),newColumn.set_index(o),newColumn.get_visible()||this._refreshColumnVisible(newColumn),this._doAdjustRowsTableWidth(),newColumn},get_expandColumn:function(){return this._rowExpandColumn},get_pagerInnerBlockID:function(){return this._pagerInnerBlockID},set_pagerInnerBlockID:function(t){this._pagerInnerBlockID=t},get_dropDownNumericButton:function(){return this._dropDownNumericButton},set_dropDownNumericButton:function(t){this._dropDownNumericButton=t}},Sys.UI.Controls.Grid.registerClass("Sys.UI.Controls.Grid",Sys.UI.Control),Sys.UI.Controls.Grid.create=function(t,e,i,n,o){var s=e&&e.guid?"$"+e.guid.replace("_","$"):"",r=document.createElement("div");r.className="Grid",r.id=s,e.width&&(r.style.width=e.width+"px",delete e.width),e.height&&(r.style.height=e.height+"px",delete e.height);var l=e.columnsParams,a=l?l.length:0,h=e.showHeader;if(Object.isUndefined(h)&&(h=!0),h){var d=0,_=e.showRowNo;Object.isUndefined(_)&&(_=!0);for(p=0;p<a;p++){var u=(w=l[p]).properties.width;u>0?(w.properties.designWidth=u,delete w.properties.width):(u=w.properties.designWidth)||(u=120,w.properties.designWidth=120),d+=u}var c=$gridExt.getRowNoColumnWidth();_&&(d+=c);var g=document.createElement("div");g.className="GridHeaderBar";var f=$common.createTable(0);f.className="GridHeader",f.style.tableLayout="fixed",f.width=d>0?d:1;var m=$common.createTBody(),C=$common.createTr();C.className="GridHeaderRow";var v=function(t,e,i,n){var o=$common.createTd();o.className="GridHeaderCaption",t&&(o.width=t),o.align=e,n&&(o.id=n);var s=document.createElement("div");s.className="GridHeaderCaptionText",s.innerHTML=i,o.appendChild(s),C.appendChild(o)};_&&v(c,"center","行号");for(var p=0;p<a;p++){var w=l[p];v(w.properties.width?w.properties.width:w.properties.designWidth,"",w.properties.caption?w.properties.caption:w.properties.designCaption,s+"_column"+p)}v(null,"","&nbsp;"),m.appendChild(C),f.appendChild(m),g.style.overflow="hidden",g.appendChild(f),r.appendChild(g)}var y=document.createElement("div");e.hint&&(y.title=e.hint,delete e.hint),y.className="GridBody",r.appendChild(y),t.appendChild(r),o=o||Sys.UI.Controls.Grid;var S=$create(o,e,r,i,n);return S.doFormInit(),S},_Z_75=function(t,e){_Z_75.initializeBase(this,[e]),this._grid=t,this._editBuffer=null},_Z_75.prototype={dispose:function(){delete this._editBuffer,this._grid=null,_Z_75.callBaseMethod(this,"dispose")},get_grid:function(){return this._grid},getCellValue:function(t,e){return this.doGetCellValue(t,e.get_dataField())},getCellText:function(t,e,i){var n=e.get_displayField();return n?i=this.doGetCellValue(t,n):void 0===i&&(i=this.doGetCellValue(t,e.get_dataField())),null!=i?i:""},doGetCellValue:function(t,e){throw Error.notImplemented()},clearEditBuffer:function(){this._editBuffer&&delete this._editBuffer},_getEditBuffer:function(){var t=this._editBuffer;return t||(this._editBuffer=t={}),t},_isEquals:function(t,e,i){var n=e.indexOf(".");if(n>0){var o=e.substring(0,n);e=e.substr(n+1);var s=t[o];return s||(s={},t[o]=s),this._isEquals(s,e,i)}var r=t[e];return!(r&&!Type.isInstanceOfPrimitiveType(i))&&r==i},getRecordList:function(){return this._dataSource},setCellValue:function(t,e,i){this.doSetCellValue(t,e,i)&&this.get_grid().doChange(t,e,i)},doSetCellValue:function(t,e,i){throw Error.notImplemented()},get_hasRecord:function(){return null!=this._dataSource||null!=this._editBuffer},get_recordCount:function(){var t=this.getRecordList();return Math.max(t?t.length:0,this._getRecordCountInEditBuffer())},_getRecordCountInEditBuffer:function(){var t=0,e=this._editBuffer;if(e)for(var i in e)t=Math.max(t,parseInt(i)+1);return t},recordExists:function(t){return this.indexOfRecord(t)>=0},indexOfRecord:function(t){var e=this.getRecordList();if(e)for(var i=e.length,n=0;n<i;n++)if(this.recordEquals(t,e[n]))return n;return this._indexOfRecordInEditBuffer(t)},_indexOfRecordInEditBuffer:function(t){var e=this._editBuffer;if(e)for(var i in e)if(this.recordEquals(t,e[i]))return i;return-1},recordEquals:function(t,e){throw Error.notImplemented()},modifyRecord:function(t,e){var i=this.getRecordList();i&&t<i.length?i[t]=e:this._setRecordInEditBuffer(t,e)},_setRecordInEditBuffer:function(t,e){var i=this._getEditBuffer();if((n=i[t])||void 0!==e&&null!=e)if(n)i[t]=e;else{i[t]=e;var n={};this.doNewRecord(n);for(var o in n)"undefined"==typeof e[o]&&(e[o]=n[o])}},doNewRecord:function(t){for(var e=this.get_grid(),i=e.get_columnCount(),n=0;n<i;n++){e.getColumnByIndex(n).initNewRecord(t)}e._internalNewRecord(t)},getRecord:function(t){var e=this.getRecordList();return e&&t<e.length?e[t]:this._getRecordInEditBuffer(t)},clearRecord:function(t){var e=this.getRecord(t);for(var i in e)delete e[i];return e},_getRecordInEditBuffer:function(t){var e=this._editBuffer;return e?e[t]:null},deleteRecord:function(t){var e=this.getRecordList();if(e&&t<e.length)return Array.removeAt(e,t),void this._moveEditBuffer(t,-1);this._deleteRecordInEditBuffer(t)},_deleteRecordInEditBuffer:function(t){var e=this._editBuffer;e&&(delete e[t],this._moveEditBuffer(t,-1))},insertRecord:function(t,e){var i=this.getRecordList();if(i&&t<i.length)return Array.insert(i,t,e),void this._moveEditBuffer(t,1);this._insertRecordInEditBuffer(t,e)},_insertRecordInEditBuffer:function(t,e){this._moveEditBuffer(t,1),this._setRecordInEditBuffer(t,e)},_moveEditBuffer:function(t,e){var i=this._editBuffer;if(i){var n=[];for(var o in i){var s=parseInt(o);s>=t&&Array.add(n,s)}if(n.sort(function(t,e){return t-e}),e>0)for(r=n.length-1;r>=0;r--){l=i[o=n[r]];delete i[o],i[o+e]=l}else for(var r=0;r<n.length;r++){var l=i[o=n[r]];delete i[o],i[o+e]=l}}},save:function(){throw Error.notImplemented()},sortBy:function(t,e){for(var i=this.get_recordCount(),n=new Array(i),o=new Array(i),s=0,r=0;r<i;r++)o[s]=this.getRecord(r),n[s]=s,s++;o.length=s;var l=function(t){return isNaN(t)||"number"!=typeof t},a=Sys.UI.Controls.NumberColumn.isInstanceOfType(t),h=Sys.UI.Controls.CheckBoxColumn.isInstanceOfType(t),d=function(t){for(var e in t)return!1;return!0},_=!0;if(n.sort($createDelegate(this,function(i,n){if(a){var o=this.getCellValue(i,t),s=this.getCellValue(n,t);if(null==o){r=this.getRecord(i);d(r)||(o=0)}if(null==s){var r=this.getRecord(n);d(r)||(s=0)}return l(o)?1:l(s)?-1:e?o-s:s-o}if(h){var o=this.getCellValue(i,t),s=this.getCellValue(n,t);return o=o?1:0,s=s?1:0,e?o-s:s-o}var u=t.getCellText(i),c=t.getCellText(n);return u?c?(_=!1,e?u.toString().localeCompare(c,"zh"):c.toString().localeCompare(u,"zh")):(_=!1,-1):1})),h||a||!_)for(r=0;r<i;r++)if(r<s){var u=o[n[r]];this.modifyRecord(r,u)}else this.modifyRecord(r,null)}},_Z_75.registerClass("_Z_75",_Z_222),_Z_74=function(t,e){_Z_74.initializeBase(this,[t,e])},_Z_74.prototype={doGetCellValue:function(t,e){if(!e)return null;var i,n=this._editBuffer;if(n&&(i=n[t])){var o=this._doGetObjProp(i,e);if(void 0!==o)return o}var s=this._dataSource;return(i=s&&t<s.length?s[t]:null)?this._doGetObjProp(i,e):null},doSetCellValue:function(t,e,i){var n=e?e.get_dataField():null;return this.doSetCellValueByField(t,e,n,i)},doSetCellValueByField:function(t,e,i,n){if(!i)return!1;var o=!1,s=this._dataSource,r=null;if(s&&t<s.length)(r=s[t])?o=!this._isEquals(r,i,n):(r={},s[t]=r,this.doNewRecord(r),o=!0),this._doSetObjProp(r,i,n);else{var l=this._getEditBuffer();(r=l[t])?o=!this._isEquals(r,i,n):(o=null!=n)&&(r={},l[t]=r,t>=this._editBufferLength&&(this._editBufferLength=t+1),this.doNewRecord(r)),r&&this._doSetObjProp(r,i,n)}return o&&e&&e.doValueChanged&&e.doValueChanged(r),o},recordEquals:function(t,e){var i=t.id,n=e.id;if(i&&n)return i==n;for(var o in t){var s=t[o],r=e[o];if(s!=r)return!(!Date.isInstanceOfType(s)||!Date.isInstanceOfType(r))&&s.getTime()==r.getTime()}return!0},save:function(){var t=this._grid.get_needRowIndex(),e=this._dataSource;if(e)for(a=(e=Array.clone(e)).length-1;a>=0;a--){var i=e[a],n=!0;if(i)for(var o in i)if("__rowIndex"!=o){n=!1;break}n?Array.removeAt(e,a):t&&(i.__rowIndex=a)}else e=[];var s=this._editBuffer;if(s){var r=[];for(var l in s)Array.add(r,parseInt(l));r.sort(function(t,e){return t-e});for(var a=0;a<r.length;a++){var h=s[l=r[a]],d={},_=!1;for(var o in h){var u=h[o];d[o]=u,null==u||_||(_="string"!=typeof u||u.length>0)}_&&(t&&(d.__rowIndex=l),Array.add(e,d))}}return e}},_Z_74.registerClass("_Z_74",_Z_75),_Z_157=function(){throw Error.notImplemented()},_Z_157.prototype={none:0,ascending:1,descending:2},_Z_157.registerEnum("_Z_157"),_Z_156=function(){throw Error.notImplemented()},_Z_156.prototype={none:0,sum:1,sumPage:2},_Z_156.registerEnum("_Z_156"),_Z_73=function(){throw Error.notImplemented()},_Z_73.prototype={like:0,range:1,equals:2,expression:3},_Z_73.registerEnum("_Z_73"),Sys.UI.Controls.Column=function(){Sys.UI.Controls.Column.initializeBase(this),this._index=-1,this._enabled=!0,this._tabStop=!0,this._allowSort=!0,this._allowConfig=!0,this._allowResize=!0,this._sortOrder=_Z_157.none,this._bandIndex=-1,this._designWidth=85,this._designVisible=!0,this._reportShowFooter=!0,this._allowFilter=!0,this._filterType=_Z_73.like,this._dataSize=0,this._headerAlign="",this._textAlign="",this._valueType=_Z_59._default,this._summaryKind=_Z_156.none,this._useServerSum=!0,this._frozenIndex=-1,this._minWidth=0,this._allowFrozen=!0,this._cssClass="",this._delayInterval=100,this._showEditStyle=!0,this._maxLength=0,this._maxByteLength=0,this._caption="",this._designCaption=""},Sys.UI.Controls.Column.prototype={initialize:function(){Sys.UI.Controls.Column.callBaseMethod(this,"initialize"),this._initHeader(),this._initFooter(),this._initEvents()},dispose:function(){this._disposeControl(),this._disposeHeader(),delete this._elements,this._changeHandler=null,this._enterPressHandler=null,this._getDisplayTextHandler=null,this._params=null,this._allEvents=null,this._grid=null,Sys.UI.Controls.Column.callBaseMethod(this,"dispose")},set_filter:function(t){this._filterValue=t,this.setFilterValue&&this.setFilterValue(t)},get_filter:function(){if(!this._filterControl)return this._filterValue;var t={};return t.dataField=this.get_dataField(),t.value=this._filterControl.get_value(),t.type=this.get_filterType(),this.getFilterValue&&this.getFilterValue(this._filterControl,t),t},setFilterValue:function(t){this._filterControl&&this._filterControl.set_value(t)},get_reportText:function(t){return t},_disposeControl:function(){var t=this._control;if(t){var e=t.get_element()._outerElement;e&&$clearHandlers(e),t.dispose(),this._control=null}this._columnEdit=null},_disposeHeader:function(){this._elements&&this._elements.header&&($clearHandlers(this._elements.header),this._elements.frozenHeader&&$clearHandlers(this._elements.frozenHeader),this._mouseOutAdded=!1,this._mouseOverAdded=!1)},get_nullDisplayText:function(){return this.get_readOnly()?"":this._nullDisplayText},set_nullDisplayText:function(t){this._nullDisplayText=t,this.get_isInitialized()&&this._refreshColumnHTML(this._grid.get_rowCount())},_rightClick:function(t){},get_maxLength:function(){return this._maxLength},set_maxLength:function(t){this._maxLength=t,this._control&&this._control.set_maxLength(t)},get_maxByteLength:function(){return this._maxByteLength},set_maxByteLength:function(t){this._maxByteLength=t,this._control&&this._control.set_maxByteLength(t)},get_cellCssClass:function(){var t=" GridBodyCell ";return this._actived&&(t+=" focus "),t},active:function(){this._active(!0)},deactive:function(){this._active(!1)},_active:function(t){this._actived=t;var e=this.get_headerElement();e&&$dom.setCssClass(t,e,"focus");for(var i=this._grid,n=this.get_index(),o=0,s=i.get_rowCount();o<s;o++){var r=i._getRow(o),l=i._getRowCell(r,n);$dom.setCssClass(t,l,"focus")}t&&i.scrollToColumn(this)},renderRowCellSkin:function(){return null},updated:function(){var t=this.get_langText();null!==t&&this.set_caption(t)},get_headerElement:function(){var t=this._elements;return t?t.header:null},get_frozenHeaderElement:function(){var t=this._elements;return t?t.frozenHeader:null},get_footerElement:function(){var t=this._elements;return t?t.footer:null},refreshFooterCellWidth:function(){var t=this.get_width();if(this._mergeFooterList)for(var e=0,i=this._mergeFooterList.length;e<i;e++){t+=this._mergeFooterList[e].get_width()}var n=this.get_footerElement();$common.setWidth(n,t),this.get_frozenFooterElement()&&$common.setWidth(this.get_frozenFooterElement(),t)},mergeFooters:function(){var t=this._grid;if(t.get_showFooter()){var e=arguments;this._mergeFooterList=[];for(var i=this.get_footerElement(),n=0,o=e.length;n<o;n++){var s=e[n];s=t._internalGetColumn(s),this._mergeFooterList.push(s),s._mergeToColumn=this;var r=s.get_footerElement();i.style.width=s.get_width()+i.offsetWidth+"px",$dom.setVisible(r,!1)}return $dom.addCssClass(i,"MergeFooter"),i}},get_frozenFooterElement:function(){var t=this._elements;return t?t.frozenFooter:null},add_redefineColumnHeader:function(t){this.get_events().addHandler("redefineColumnHeader",t)},remove_redefineColumnHeader:function(t){this.get_events().removeHandler("redefineColumnHeader",t)},_internalDisposeHeader:function(){this._disposeHeader()},_internalSetElements:function(t,e,i){this._elements=t,this._initHeader(),void 0!==e&&(this._index=e),void 0!==i&&(this._frozenIndex=i)},_initFooter:function(){var t=this.get_summaryText();t&&this.set_footer(t)},_initHeader:function(){var t=this.get_headerElement(),e=this.get_frozenHeaderElement();if(t){var i=this.get_headerHint();t._title=null,i&&(t.title=i,e&&(e._title=null,e.title=i));var n=$common.getFirstChildByTagName(t,"div");if(this.get_allowSort()||this.doRedefineColumnHeader(t,n),n&&n.className.indexOf("GridHeaderCaptionText")<0&&(n=n.firstChild),this._elements.captionElement=n,e){var o=$common.getFirstChildByTagName(e,"div");o&&o.className.indexOf("GridHeaderCaptionText")<0&&(o=o.firstChild),this._elements.frozenCaptionElement=o}this.doInitHeaderElements(this._elements),this._doInitOrder(),this._internalInitHeader()}},_doInitOrder:function(){if(this.get_allowSort()){var t=this.get_sortOrder();t!=_Z_157.none&&this._setSortOrder(t)}},doRedefineColumnHeader:function(t,e){if(this._allEvents){var i=this._allEvents.redefineColumnHeader;if(i){var n=new _Z_158(this,e);i(this,n);var o=n.get_newCaptionElement();o&&(e.style.display="none",t.appendChild(o)),delete this._allEvents.redefineColumnHeader}}},doInitHeaderElements:function(t){},_internalInitHeader:function(){var t=this.get_headerElement(),e=this.get_frozenHeaderElement();if(t){var i=!1;this.get_allowSort()&&(i=!0,this._addMouseOutHandler(e||t)),this.get_allowResize()&&(i=!0),i&&this._addMouseOverHandler(e||t)}},_addMouseOutHandler:function(t){this._mouseOutAdded||($common.addMouseOutHandler(t,this._doHeaderMouseOut,this),$common.addMouseUpHandler(t,this._doHeaderMouseUp,this),this._mouseOutAdded=!0)},_addMouseOverHandler:function(t){this._mouseOverAdded||($common.addMouseOverHandler(t,this._doHeaderMouseOver,this),this._mouseOverAdded=!0)},_initEvents:function(){var t=this._allEvents;t&&(this._getDisplayTextHandler=t.getDisplayText),this.getIsCommandColumn()&&this._grid._internalAddCommandColumn(this)},getIsCommandColumn:function(){return!1},doReadOnlyDblClick:function(){var t=this._allEvents;if(t&&this.get_enabled()){var e=t.dblClick;if(!e)return!1;var i=new _Z_162;return e(this,i),i.get_cancel()}},fireEvent:function(t,e){if(!this._allEvents)return!1;var i=this._allEvents[t];e?!i&&this[t]&&(this._allEvents[t]=this[t],this._control&&this._control.add_dblClick(this[t]),delete this[t]):i&&(this._allEvents[t]=null,this[t]=i,this._control&&this._control.remove_dblClick(i))},_doHeaderMouseOver:function(t){this.get_enabled()&&this._grid.get_enabled()&&(this.get_allowSort()&&this._initHeaderActive(!1),$gridExt.bindColumnResizer(this))},_hideResizer:function(){$gridExt.hideSizeGripper()},_doHeaderMouseOut:function(t){this.get_allowSort()&&!this.get_grid().get_useEvenHeaderColor()&&this._initHeaderNormal()},_doHeaderMouseUp:function(t){if("INPUT"!=t.target.tagName&&"IMG"!=t.target.tagName&&t.button==Sys.UI.MouseButton.leftButton&&(this._initHeaderActive(!1),!this._grid._isResizing)){var e=this._sortOrder!=_Z_157.ascending?_Z_157.ascending:_Z_157.descending;this._doSort(e,t)}},_doSort:function(t,e){var i=this.get_grid();i.get_allowSort()&&this.get_dataField()&&(i._raisePagerBeforeSort(this)||(e&&e.ctrlKey&&this.get_isSorted()?this._setSortOrder(_Z_157.none):(i._clearSort(this),this._setSortOrder(t)),i._doSort()))},_initHeaderNormal:function(){var t=this.get_frozenHeaderElement();t||(t=this.get_headerElement());var e=this.get_grid(),i=!e.get_allowSort()||e.get_useEvenHeaderColor();$dom.removeCssClass(t,i?"NoActive":"ActiveColumn")},_initHeaderActive:function(t){var e=this.get_grid(),i=this.get_frozenHeaderElement();i||(i=this.get_headerElement());var n=!this.get_allowSort()||e.get_useEvenHeaderColor()?"NoActive":"ActiveColumn";$dom.addCssClass(i,n)},get_sortOrder:function(){return this._sortOrder},set_sortOrder:function(t){this._sortOrder!=t&&(this._sortOrder=t,this.get_isInitialized()&&this._doSort(t))},get_showEditStyle:function(){return this._showEditStyle},set_showEditStyle:function(t){this._showEditStyle=t},get_isSorted:function(){return this._sortOrder!=_Z_157.none},get_isSortAscending:function(){return this._sortOrder==_Z_157.ascending},_clearSort:function(){this.get_isSorted()&&this._setSortOrder(_Z_157.none)},_clearSortOrder:function(){this._clearSortOrderFast(),this._clearFrozenSortOrderFast(!0)},_clearSortOrderFast:function(t){if(this._elements.sortFlag){var e=this._elements.captionElement,i=this.get_headerElement(),n=this._elements.sortFlag.parentNode;i.appendChild(e),$removeNode(n),this._elements.sortFlag=null}},_clearFrozenSortOrderFast:function(){if(this.get_frozenHeaderElement()&&this._elements.frozenSortFlag){var t=this._elements.frozenCaptionElement,e=this.get_frozenHeaderElement(),i=this._elements.frozenSortFlag.parentNode;e.appendChild(t),$removeNode(i),this._elements.frozenSortFlag=null}},_internalRefreshSortOrder:function(){this._setSortOrder(this.get_sortOrder())},_createSortFlag:function(){var t=this._elements.sortFlag;if(t||!this.get_isSorted())return t;var e=this.get_headerElement(),i=$common.createClassDiv("SortOrder"),n=this._elements.captionElement;i.appendChild(n);var o=$common.createClassDiv("GridHeaderSortShape");return i.appendChild(o),t=this._elements.sortFlag=o,e.appendChild(i),n.className=n.className,e.className=e.className,e.style.filter="",t},_createFrozenFlag:function(t){var e=this._elements.frozenSortFlag,i=this.get_frozenHeaderElement();if(!i||e||!this.get_isSorted())return e;var n=$common.getFirstChildByClassName(i,"GridHeaderSortShape",!0);if(!n){var o=$common.createClassDiv("SortOrder"),s=this._elements.frozenCaptionElement;o.appendChild(s),n=t.cloneNode(!0),o.appendChild(n),i.appendChild(o)}return e=this._elements.frozenSortFlag=n},_setSortOrder:function(t){this._grid._sortColumn=this,this._sortOrder=t;var e=this._createSortFlag(),i=this._createFrozenFlag(e),n="";switch(t){case _Z_157.none:return void this._clearSortOrder();case _Z_157.ascending:n=$common.getGlyphDivHTML("sortShape",1);break;case _Z_157.descending:n=$common.getGlyphDivHTML("sortShape",0)}e.innerHTML=n,i&&(i.innerHTML=n),this._grid._refreshFrozenHeaderHeight()},get_minWidth:function(){return this._minWidth},set_minWidth:function(t){this._minWidth=t},get_mergeSameRow:function(){return this._mergeSameRow},set_mergeSameRow:function(t){this._mergeSameRow=t,this._grid._mergeRowColumns.push(this)},get_tag:function(){return this._tag},set_tag:function(t){this._tag=t},get_allowStretch:function(){return this._allowStretch},set_allowStretch:function(t){this._allowStretch=t,t&&this._grid._addStretchColumns(this)},get_allowFrozen:function(){return this._allowFrozen},set_allowFrozen:function(t){this._allowFrozen=t},get_grid:function(){return this._grid},get_owner:function(){return this._grid},get_form:function(){return this.get_grid().get_form()},get_frozenIndex:function(){return this._frozenIndex},get_isFrozen:function(){var t=this._grid.get_frozenColumnCount();return this._frozenIndex<t},get_index:function(){return this._index},set_index:function(t){this._index=t;var e=this.get_headerElement();e&&(e.id=this._grid.get_id()+"_column"+t)},get_bandIndex:function(){return this._bandIndex},set_bandIndex:function(t){this._bandIndex=t},get_band:function(){var t=this._band;return t||this._grid.getBandByIndex(this.get_bandIndex())},set_band:function(t){this._band=t},get_designVisible:function(){return this._designVisible},set_designVisible:function(t){this._designVisible=t,this.get_isInitialized()&&(this._params.properties.designVisible=t)},get_visible:function(){var t=this._visible;return null==t&&(t=this._visible=this._grid._internalGetColumnVisible(this)),t},set_visible:function(t,e){t!=this.get_visible()&&(this._visible=t,this._grid._internalSetColumnVisible(this,t,e),t||this._hideResizer())},set_visibleWithConfig:function(t){var e=this._grid;if(!e._configData)return this.set_visible(t);var i=e._configData.ColumnsVisible;if(!i)return this.set_visible(t);return void 0===i[this.get_name()]?this.set_visible(t):void 0},get_designCaption:function(){return this._designCaption},set_designCaption:function(t){this._designCaption=t},get_caption:function(){return this._grid._internalGetColumnCaption(this)},set_caption:function(t,e){t!=this.get_caption()&&this._grid._internalSetColumnCaption(this,t,e)},get_designReportCaption:function(){var t=this._designReportCaption;return t||(t=this._designCaption)||(t=this.get_caption()),t},set_designReportCaption:function(t){this._designReportCaption=t},get_reportCaption:function(){var t=this._designReportCaption;return t||this.get_caption()},get_reportVisible:function(t){var e=this._reportVisible;return null==e?!!t||this.get_visible():e},set_reportVisible:function(t){this._reportVisible=t},get_isReportFooterField:function(){return this._isReportFooterField},set_isReportFooterField:function(t){this._isReportFooterField=t},get_reportShowFooter:function(){return this._reportShowFooter},set_reportShowFooter:function(t){this._reportShowFooter=t},get_reportField:function(){var t=this._reportField;if(!t){t=this.get_designReportCaption();var e=this.get_bandIndex();if(e>=0){var i=this._grid.getBandByIndex(e);if(i){var n=i.reportField;n||(n=i.caption),t=n+t}else t+=(e+1).toString()}}return t},set_reportField:function(t){this._reportField=t},_internalRefreshCaption:function(){var t=this._elements.captionElement,e=this._elements.frozenCaptionElement;t&&this._refreshCaption(t),e&&this._refreshCaption(e)},get_actionElement:function(){return this._elements.frozenCaptionElement||this._elements.captionElement},_refreshCaption:function(t){var e=this.get_caption();this._grid.get_useMultiRowCaption()?(e=this._getMultiRowCaption(e),t.style.padding="0px"):t.style.padding="";var i=this._elements.captionTextElement;i?i.innerHTML=e||"":t.innerHTML=e||""},_getMultiRowCaption:function(t){for(var e="",i=t.split("｜"),n=this._grid._skinColors.headerLine,o=0,s=i.length;o<s;o++){e+="<div"+(o!=s-1?' style="border-bottom: 1px solid '+n+'"':"")+">"+i[o]+"</div>"}return e},get_summaryValue:function(){return this._summaryValue},set_summaryValue:function(t){this._summaryValue=t},get_footer:function(t){var e=this.get_footerReplaceText();e||(e=this.get_replaceText());var i=Object.isUndefinedOrNull(this._footer)?"":this._footer;if(e){var n=this.get_grid();if(!n.get_readOnly()){for(var o=n.get_rowCount(),s=0;s<o;s++)if(this.getCellText(s)==e)return e;return i}return e}return t?$common.clearHTMLTag(i).trim():i},set_footer:function(t){this._footer=t,this.doRefreshFooter()},doRefreshFooter:function(){this._setFooterText(this.get_footerElement()),this._setFooterText(this.get_frozenFooterElement())},_setFooterText:function(t){if(t){var e=t.firstChild;if(e){var i=this.get_footer(),n=this._grid,o=n.get_events().getHandler("getFooterHTML");if(o){var s=new _Z_262(this,i);o(n,s),i=s.get_footer()}e.innerHTML="NaN"!=i?i:""}}},get_readOnly:function(){return this._readOnly||this._grid.get_readOnly()||!this.get_enabled()},set_readOnly:function(t){this._readOnly=t},get_enabled:function(){return this._enabled},set_enabled:function(t){this._enabled=t,this.get_isInitialized()&&(t||this._hideEditor(),this._grid._internalRefreshColumnStyle(this))},get_tabStop:function(){return this._tabStop},set_tabStop:function(t){this._tabStop=t},get_allowSort:function(){var t=this.get_grid(),e=t.get_allowSort(),i=this._allowSort;return e&&i&&(0==t._mergeRowColumns.length||t._dataGroupField)},set_allowSort:function(t){this._allowSort=t},get_allowConfig:function(){return this._allowConfig},set_allowConfig:function(t){this._allowConfig=t},get_showImage:function(){return this._showImage},set_showImage:function(t){this._showImage=t},get_hint:function(){return this._hint},set_hint:function(t){this._hint=t},get_allowResize:function(){return this.get_grid().get_allowResize()&&this._allowResize},set_allowResize:function(t){this._allowResize=t},get_filterType:function(){return this._filterType},set_filterType:function(t){this._filterType=t},get_params:function(){return this._params},get_control:function(){return this._control},get_name:function(){return this._name},set_name:function(t){this._name=t},get_groupName:function(){return this._groupName},set_groupName:function(t){this._groupName=t},get_sortField:function(t){return this._sortField&&t?this._sortField:this._dataField},set_sortField:function(t){this._sortField=t},get_dataField:function(){return this._dataField},set_dataField:function(t){this._dataField=t},get_displayField:function(){return this._displayField},set_displayField:function(t){this._displayField=t},get_dataSize:function(){return this._dataSize},set_dataSize:function(t){this._dataSize=t},get_designWidth:function(){return this._designWidth},set_designWidth:function(t){this._designWidth=t},get_width:function(){return this._grid._internalGetColumnWidth(this)},set_width:function(t,e){var i=this.get_width();t!=i&&this._grid._internalSetColumnWidth(this,t,i,e)},get_headerAlign:function(){return this._headerAlign},set_headerAlign:function(t){this._headerAlign=t},get_textAlign:function(){return this._textAlign},set_textAlign:function(t){this._textAlign=t},get_valueType:function(){return this._valueType},set_valueType:function(t){this._valueType=t},get_cssClass:function(){return this._cssClass},set_cssClass:function(t){this._cssClass=t},get_summaryKind:function(){return this._summaryKind},set_summaryKind:function(t){this._summaryKind=t,t!=_Z_156.none&&(this._useServerSum=!1),this._grid._init&&t!=_Z_156.none&&(this._grid._hasSummaryColumn=!0)},get_summaryText:function(){return this._summaryText},set_summaryText:function(t){this._summaryText=t},get_headerHint:function(){return this._headerHint},set_headerHint:function(t){this._headerHint=t},createEdit:function(){var t=$common.createInput();return t.type="text",t.setAttribute("spellcheck",!1),t.setAttribute("autocomplete","new-text"),t.id=this._grid.get_id()+"_"+this.get_name(),t},getControlType:function(){throw Error.notImplemented()},get_immediateEditor:function(){return!1},_hasEditor:function(){return null!=this._lastCell},get_isEditing:function(){return this._hasEditor()},_getCellRowIndex:function(t){var e=t.parentNode;return this._grid._getRowIndex(e)},_revalidate:function(t){var e=this._grid.get_form().get_validationManager();e.checkResultsVisible(this._grid)&&e.checkResultsVisible(this)&&(this._grid._revalidate(this.get_index(),t),this._hideEditor(),e.checkResults())},_refreshColumnHTML:function(t){var e=this._grid;if(e._init){var i=this.get_index(),n=t||e.get_recordCount();e._isLazyPageSize()&&(n=Math.min(n,e._lazyIndex*e._lazyPageSize));for(var o=0;o<n;o++){var s=e._getRow(o),r=e._getRowCell(s,i);this.initCellHTML(o,r)}}},_refreshRowHTML:function(){for(var t=this._grid,e=this.get_index(),i=t.get_rowCount(),n=0;n<i;n++){var o=t._getRow(n),s=t._getRowCell(o,e);this.initCellHTML(n,s)}},initCellHTML:function(t,e){if(this._lastCell&&this._lastCell==e&&this._control){var i=this.doInitControlValue(t);this.doAfterInitControlValue(i)}else{var n=this._getCellHTML(t,e._fontColor);e.innerHTML=n}},refreshCellHTML:function(t,e){this._lastCell&&this._lastCell==e||(e.innerHTML=this._getCellHTML(t,e._fontColor))},doAfterInitControlValue:function(t){this._lastValue=t},_instantValidate:function(){var t=this._control;t&&t.doInstantValidate&&t.doInstantValidate()},_closeDropDown:function(t){var e=this._control;e&&e.get_droppedDown&&e.get_droppedDown()&&e.closeUp()},_raiseBrowserBlur:function(t){var e=this._control;e&&t&&"function"==typeof e.doBlur&&e.doBlur()},_removeCellEdit:function(t){try{if(Sys.Browser.isChrome)t.removeChild(this._columnEdit);else{var e=this._columnEdit.parentNode;e&&e.removeChild(this._columnEdit)}}catch(i){}},_hideEditor:function(){var t=this._lastCell;if(t&&(this._closeDropDown(),this._instantValidate(),this._raiseBrowserBlur(Sys.Browser.isIE||Sys.Browser.isFirefox),this._removeCellEdit(t),t.parentNode)){var e=this._grid;e._initCellStyle(this.get_index(),t);var i,n=this._changed,o=e._getRowIndex(t.parentNode);if(n)if(this._initArgs)n=this._hideCustomEditor(o);else{i=this._lastValue;var s;(s=this.getControlValue(this._control,o))!=i&&(s=this._saveCellValue(t,s,o)),"boolean"!=typeof s||i||(i=!1),n=s!=i}this._lastCell=null,this.initCellHTML(o,t),this._onHideEditor(o,t,s),n&&this._raiseChange(t,s,i),this._raiseBlur(),this._doEditorHideEvent(),t._rowIndex!=undefined&&this._grid._changeFrozenRowHeight(t._rowIndex)}},_hideCustomEditor:function(t){var e=this.get_grid();if(!e.findRowData(t))return!1;var i=this._initArgs.control.saveData(),n=this._initArgs.oldData;e.modifyCellsValue(t,this._initArgs.dataFields,i);return!Object.isEqual(i,n,this._initArgs.dataFields)},_showEditor:function(t){this._doShowEditor(t,!0)},_doShowEditor:function(t,e){if(this.get_visible()&&(t=this._exchangeFrozenCell(t),this._checkLastCell(t))){this._refreshCell(t);var i=t.clientWidth?t.clientWidth:t.width,n=t.clientHeight;if(!i)throw Error.invalidOperation("取不到列的宽度: "+this.get_name());if(this._allEvents&&this._allEvents.editorInit){if(!this._doShowCustomEditor(t,i,n))return;this._doEditorShowEvent(t)}else{var o=this._createElement();this._initEditorElement(t,o,i,n),this._control||this._initEditorControl(o),this._initControlSize(i,n),this._doEditorShowEvent(t),this._initControlValue(t),e&&this._doFocus()}this._lastCell=t,this._active=!0,this._changed=!0,t._rowIndex!=undefined&&this._grid._changeFrozenRowHeight(t._rowIndex)}},_doShowCustomEditor:function(t,e,i){var n;if(this._initArgs)n=this._initArgs.control,t.appendChild(n.get_element());else{var o={cellWidth:e,cellHeight:i,cell:t};if(!1===this._allEvents.editorInit(this,o))return!1;if(!(n=o.control)||!n.get_element)throw Error.invalidOperation("editorInit事件业务必须指定args.control");if(!n.saveData)throw Error.invalidOperation("editorInit事件中传递的args.control必须是容器控件");if(!o.dataFields)throw Error.invalidOperation("editorInit事件中必须传递编辑框DataField集合给平台完成数据绑定");this._initArgs=o,this._isCustomEditor=!0,this._stopEvent(n.get_element())}var s=this.get_grid(),r=s.findRowData(s.get_selectedRowIndex());return this._initArgs.oldData=Object.clone(r),n.dataBind(this._initArgs.oldData),!0},_doEditorShowEvent:function(t){var e=this._editorShowHandler;e&&e(this,{cell:t})},_doEditorHideEvent:function(){var t=this._editorHideHandler;t&&t(this)},add_editorShow:function(t){this.get_events().addHandler("editorShow",t)},add_editorHide:function(t){this.get_events().addHandler("editorHide",t)},_checkLastCell:function(t){var e=this._lastCell;if(e){if(t==e)return this._doFocus(),!1;this._hideEditor()}return!0},_refreshCell:function(t){var e=t.firstChild;e&&"INPUT"==e.tagName?(e.style.display="none",asyncCall(function(){$clearHandlers(e),$removeNode(e)})):t.innerHTML=""},_onHideEditor:function(t,e,i){},get_bounds:function(){var t=this._grid._getSelectedRowCell(this._index);return t?(t=this._exchangeFrozenCell(t),$dom.getBounds(t)):this._control?this._control.get_bounds():null},focus:function(){if(!this.get_readOnly()&&!this.getIsCommandColumn()&&this._index>=0){var t=this._grid._getSelectedRowCell(this._index);if(!t)return;if(this._hideEditor(),!this._grid._doCellBeginEdit(this,t))return;this._showEditor(t)}},_doFocus:function(){var t=this._control;t&&(asyncCall(function(){t.focus(!0)}),this._grid._notifyFormFocusControl())},_internalGetChangeHandler:function(){var t=this._changeHandler;if(!t){var e=this._allEvents;if(e&&(t=e.change),null==t&&this._events&&this.get_grid()._isDress){var i=this._events._list._change;i.length>0&&(t=i[0])}}return t},_isRowAllowEditor:function(t){return!0},_initControlSize:function(t,e){var i=this._control.get_element();if(i._outerElement){t=(t-=this._getControlButtonWidth())<1?1:t,this._initControlWidth(i,t),$common.setHeight(i,e),$common.setLineHeight(i,e)}},_initControlWidth:function(t,e){$common.setWidth(t,e)},_getControlButtonWidth:function(){return $craba.editorButtonWidth},_initEditorElement:function(t,e,i,n){this._initControlWidth(e,i),$common.setHeight(e,n),$common.setLineHeight(e,n),t.appendChild(e)},_initEditorControl:function(t){var e={};e.tabOnEnter=!1,e.isInPlace=!0,this.initProps(e);var i=this._allEvents;i?(this._editorShowHandler=i.editorShow,this._editorHideHandler=i.editorHide,this._changeHandler=i.change,this.needHandleEnterPress()&&(this._enterPressHandler=i.enterPress,delete i.enterPress),delete i.change,delete i.getDisplayText,delete i.filterRendering,delete i.editorShow,delete i.editorHide):(i={},this._changeHandler=null,this._enterPressHandler=null),this._blurHandler=i.blur,i.blur=$createDelegate(this,this._blur),i.focus=$createDelegate(this,this._focus),this.needHandleKeyDown()&&(i.keyDown=$createDelegate(this,this.doKeyDown));var n=this._control=$create(this.getControlType(),e,t,i,this._grid.get_form(),!0),o=t._outerElement;this._columnEdit=t,o&&(this._columnEdit=o,$craba.cloneStyle(t,o,["height","lineHeight"])),this._setEditorActive(),n.column=this,this.handleControl(this._control),this._stopEvent(this._columnEdit)},_stopEvent:function(t){$common.addMouseOverHandler(t,this._stopPropagation),$common.addMouseOutHandler(t,this._stopPropagation),$common.addMouseDownHandler(t,this._stopPropagation),$common.addMouseUpHandler(t,this._stopPropagation)},_createElement:function(){if(this._columnEdit)return this._columnEdit;var t=this.createEdit();return"text"!=t.type&&"image"!=t.type?t:($dom.addCssClass(t,"CellEdit"),t)},_exchangeFrozenCell:function(t){var e=this._grid;if(!e.isFrozenGrid())return t;var i=t.parentNode,n=this.get_index(),o=e._getRowIndex(i),s=e._getFrozenRow(o);return n<e._getFrozenColumnRealCount()&&(t=e._getFrozenRowCell(s,n)),t._rowIndex=o,t},_stopPropagation:function(t){_Z_238.IsDraging||t.stopPropagation()},initProps:function(t){t.delayTime=this.get_delayTime(),t.nullDisplayText=this.get_nullDisplayText()},get_delayTime:function(){return this._delayInterval},set_delayTime:function(t){this._delayInterval=t},_setEditorActive:function(){$dom.addCssClass(this._columnEdit,"activeEditor")},handleControl:function(t){t.add_change($createDelegate(this,this._change))},focusNextCell:function(){this.get_isDisposed()||this._grid._focusNextCell(this,this._lastCell)},focusPrevCell:function(){return this._grid._focusPrevCell(this._lastCell)},doKeyDown:function(t){var e=!1,i=this._grid;i._activeColumn=this;switch(t.keyCode){case Sys.UI.Key.enter:i.doRowEnterPress(t)||this.doTabOnEnter(),e=!0;break;case Sys.UI.Key.tab:t.shiftKey&&this.focusPrevCell()?e=!0:$settings.GridDefaultOnTabNext&&this.focusNextCell()&&(e=!0);break;case Sys.UI.Key.right:this._grid.doRowKeyDown(t)||(e=this._handleLeftRight(!0,!1));break;case Sys.UI.Key.left:this._grid.doRowKeyDown(t)||(e=this._handleLeftRight(!1,!1));break;case Sys.UI.Key.end:e=this._handleLeftRight(!0,!0);break;case Sys.UI.Key.home:e=this._handleLeftRight(!1,!0)}e&&t.cancel()},_handleLeftRight:function(t,e){this._grid._isRightKey=t;var i=this._control;if(!i)return!1;var n=0,o=i.get_isTextEdit();if(o&&(n=i.get_caretPos()),i.get_droppedDown&&i.get_droppedDown())return!1;if(t){var s=0;if(o){i.get_selectionText()&&(n=0),s=i.get_text().length}if(!o||n==s||i.get_readOnly())return e?this._grid._focusRowLastCell():(this.focusNextCell(),!0)}else if(!o||0==n)return e?this._grid._internalFocusSelectedRowFirstCell():this.focusPrevCell();return!1},_raiseBlur:function(){this._blurHandler&&1==this._active&&this._blurHandler(this._control)},_focus:function(t){this._active||(this._active=!0,this._grid._activeColumn=this,this._changed=!0)},set_hasPopup:function(t){this._hasPopup=t},_blur:function(t){this._hasPopup?this._hasPopup=!1:(this._raiseBlur(),this._active=!1,this._grid._blurFromColumn())},_change:function(t,e){var i=this._lastCell;if(i){this._instantValidate();var n=this._lastValue,o=this._grid._getRowIndex(i.parentNode),s=this._saveCellValue(i,undefined,o);s!=n&&this._lastCell&&this._raiseChange(i,s,n,e),this._cloneLastValue()}},add_change:function(t,e){this._mastAdd=!0===e,this.get_events().addHandler("_change",t)},remove_change:function(t){this.get_events().removeHandler("_change",t)},add_click:function(t){this.get_events().addHandler("_click",t)},remove_click:function(t){this.get_events().removeHandler("_click",t)},_raiseChange:function(t,e,i,n){this._raiseChangeByRowIndex(t,null,e,i,n)},_raiseChangeByRowIndex:function(t,e,i,n,o){if(!this.get_isDisposed()){var s=this._grid,r=s.get_form();if(!r||!r.get_isDisposing()){null==e&&(e=t?this._getCellRowIndex(t):s.get_mouseHoverRowIndex());var l=new _Z_31(e,i,this._lastValueClone?this._lastValueClone:n,this);this._changeHandler&&this._changeHandler(this,l);var a=this.get_events().getHandler("_change");if(!a||!this._mastAdd&&this._changeHandler||a(this,l),l.get_cancel()){if(this._changed=!1,this._saveCellValue(t,n,e),this.initCellHTML(e,t),o&&o.set_cancel)return o.set_cancel(!0)}else{l.get_valueChanged()&&(i=l.get_value(),this._saveCellValue(t,i,e),this.initCellHTML(e,t)),t&&this._revalidate(e),this.doChanged(i,n,e,l),this._checkCalcSummary();var h=l.get_focusColumn();h&&asyncCall(function(){s.focusRowColumn(e,h)})}}}},doChanged:function(t,e,i,n){var o=this._grid,s=o.get_events().getHandler("columnChanged");s&&s(o,n)},_checkCalcSummary:function(){var t=this._grid;if(t.get_canSummary()){this.get_summaryKind()!=_Z_156.none&&(this._hasServerSum&&t._setNeedPreloadItems(!0),t._calcColumnSummary(this))}},get_useServerSum:function(){return this._useServerSum},set_useServerSum:function(t){this._useServerSum=t,!t&&this._hasServerSum&&(this._hasServerSum=!1,this._grid._setNeedPreloadItems(!1))},_setHasServerSum:function(t){this._hasServerSum=t},get_isClientSum:function(){return this.get_summaryKind()!=_Z_156.none},needHandleEnterPress:function(){return!0},needHandleKeyDown:function(){return!0},doTabOnEnter:function(){if(this.needHandleEnterPress()){var t=!0;if(this._enterPressHandler){var e=new _Z_174;this._enterPressHandler(this._control,e),t=e.get_focusNext()}t&&!this.get_isDisposed()&&this.focusNextCell()}},_getDataController:function(){return this._grid.get_dataController()},getCellValue:function(t){return this._getDataController().getCellValue(t,this)},_initControlValue:function(t){var e=t.parentNode,i=this._grid._getRowIndex(e),n=this.doInitControlValue(i);this._lastValue=n,this._cloneLastValue()},doInitControlValue:function(t){var e=this.getCellValue(t);if(e=this.loadEditValue(e),this._control.set_value(e,!0),this.get_displayField()){var i=this.getCellText(t,!1,!0);this._control.set_text(i),this._lastText=i}return this._control.get_value()},getCellText:function(t,e,i){var n=this.getCellValue(t);return this._doGetCellText(t,n,e,i)},get_footerReplaceText:function(){return this._footerReplaceText},set_footerReplaceText:function(t){this._footerReplaceText=t,this.get_isInitialized()&&this.doRefreshFooter()},get_replaceText:function(){return this._replaceText},set_replaceText:function(t,e){this._replaceText=t,this.get_isInitialized()&&!e&&this._grid._internalRefreshColumnContent(this)},_doGetCellText:function(t,e,i,n){var o=this.get_replaceText();if(o)null==e&&(o="");else if(o=this._getDataController().getCellText(t,this,e),o=this.getDisplayText(e,o,t,i),this._getDisplayTextHandler){var s=new _Z_201(t,e,o,i,n);this._getDisplayTextHandler(this,s),o=s.get_text()}return o},_initCellHTML:function(t,e,i){return i?this._getCellHTML(t,e):this._getEmptyHTML(!0)},_getEmptyHTML:function(t){var e="&nbsp;";return t&&this.get_nullDisplayText()&&(e='<span class="nulltext ellipsis">'+this.get_nullDisplayText()+"</span>"),this._grid._useCustomRendering?'<div class="GridBodyCellText">'+e+"</div>":e},_getCellHTML:function(t,e){if(this.get_visible()){var i=this.getCellValue(t),n=this._doGetCellText(t,i);if(!n&&this.get_nullDisplayText())return this._getEmptyHTML(!0);var o=this.getHTML(i,n,t,e);return this._getMergeHtml(o,t)}return this._getEmptyHTML(!1)},_getMergeHtml:function(t,e){var i=this._grid;if(this.get_mergeSameRow()||!i.hasMergeRows())return t;var n=this._getDataController().getRecord(e);if(!n)return t;var o=n[i._dataGroupField],s=i._mergeGroupData[o];if(!s)return t;for(var r=this.get_dataField(),l=0,a=s.length;l<a;l++){var h=s[l],d=$craba.getPropValue(h,r),_=this._doGetCellText(e,d);t+=this.getHTML(d,_,e)}return t='<div class="MergeCell">'+t+"</div>"},internalGetCellHTML:function(t){var e=this.getCellValue(t),i=this._doGetCellText(t,e);return this.getHTML(e,i,t)},getDisplayText:function(t,e){return e},set_textWrap:function(t){this._textWrap=t},get_textWrap:function(){return this._textWrap},_getHtml:function(t){var e=this._grid;return Sys.UI.Controls.Column.getHTML(t,e.get_textColor(),e.get_allowCopy(),this.get_hint(),this._textWrap,this._cssClass)},_getTextBlank:function(t,e){return"string"!=typeof t||this._allowTags||(t=$common.htmlEncode(t)),this._getHtml(t)},set_allowHTML:function(t){this._allowTags=t},get_allowHTML:function(){return this._allowTags},set_allowTags:function(t){this._allowTags=t},get_allowTags:function(){return this._allowTags},getHTML:function(t,e,i){return this._getHtml(e)},initNewRecord:function(t){var e=this.get_dataField();if(e){var i=this.getDefaultValue();void 0!==i&&(t[e]=i)}},getDefaultValue:function(){return undefined},loadEditValue:function(t){return t},saveEditValue:function(t){return t},_setCellValue:function(t,e,i){if(e=this.saveEditValue(e),this._getDataController().setCellValue(t,this,e),i){var n=this._grid,o=n.findRowData(t);o&&n._appendChangeDatas(o)}},_clearChanged:function(){this._changed=!1},getControlValue:function(t,e){return t.get_value()},_saveCellValue:function(t,e,i){t.parentNode;var n=this._control;return e===undefined&&(e=this.getControlValue(n,i)),n.convertType&&(e=n.convertType(e,this.get_valueType())),this._setCellValue(i,e,!0),this._grid._refreshPagerInc(),this._clearChanged(),this._lastValue=e,e},_cloneLastValue:function(){},get_value:function(){var t=this._control;return t?this.getControlValue(t,this._grid.get_selectedRowIndex()):this._lastValue},set_value:function(t,e){var i=this._control;i&&(this.get_displayField()?i.set_text(t):i.set_value(t)),e||(this._lastValue=t,this._changed=!1)},get_allowFilter:function(){return this._allowFilter},set_allowFilter:function(t){this._allowFilter=t},canFilter:function(){return this.get_allowFilter()},_doFilterRendering:function(t,e,i){var n=null;if(this._allEvents&&(n=this._allEvents.filterRendering),n||(n=this.get_events().getHandler("filterRendering")),!n)return!1;var o=new _Z_199(i);n(this,o),this._filterProperties=o.get_properties();var s=o.get_control();return null!=s?(s.appendTo(t),t._isCustomer=!0,!0):o.get_cancel()},add_filterRendering:function(t,e){return this.get_events().addHandler("filterRendering",t,e)},remove_filterRendering:function(t){this.get_events().removeHandler("filterRendering",t)},add_editorInit:function(t,e){return this.get_events().addHandler("editorInit",t,e)},remove_editorInit:function(t){this.get_events().removeHandler("editorInit",t)},add_editorChanged:function(t,e){return this.get_events().addHandler("editorChanged",t,e)},remove_editorChanged:function(t){this.get_events().removeHandler("editorChanged",t)},get_filterControl:function(){return this._filterControl},createFilter:function(t,e){}},Sys.UI.Controls.Column.registerClass("Sys.UI.Controls.Column",_Z_242),Sys.UI.Controls.Column.getHTML=function(t,e,i,n,o,s){t=Object.isUndefinedOrNull(t)?"&nbsp;":t.toString();var r="";e&&(r=" style='color:"+e+";'");var l=i?"":" unselectable='on'",a=n?" title='"+n+"'":"",h=t;if(o){var d=t.split("\r\n");h="";for(var _=0,u=d.length;_<u;_++)h+="<div>"+d[_]+"</div>"}var c="GridBodyCellText";return s&&(c+=" "+s),"<div class='"+c+"'"+l+r+a+">"+h+"</div>"},Sys.UI.Controls.TextColumn=function(){Sys.UI.Controls.TextColumn.initializeBase(this),this._filterChars=null},Sys.UI.Controls.TextColumn.prototype={getControlType:function(){return Sys.UI.Controls.TextEdit},createFilter:function(t,e,i){var n=this.createEdit();n.className="Edit",t.appendChild(n),$dom.addCssClass(t,"TextColumn aicon-chaxun");var o={tabOnEnter:!1,tag:this};$settings.GridFilterEditShowNullText&&(o.nullDisplayText="查询和筛选"),i&&(o.text=i.value),Object.copyTo(this._filterProperties,o);var s={enterPress:$createDelegate(e,e.doFilter)},r=$create(this.getControlType(),o,n,s,this._grid.get_form(),!0);return r._allowDelIcon=!1,e.addControl(r),r},get_dataSize:function(){var t=Sys.UI.Controls.TextColumn.callBaseMethod(this,"get_dataSize");return t>0?t:this.get_maxLength()},get_filterChars:function(){return this._filterChars},set_filterChars:function(t){this._filterChars=t},initProps:function(t){Sys.UI.Controls.TextColumn.callBaseMethod(this,"initProps",[t]),t.maxLength=this.get_maxLength(),t.maxByteLength=this.get_maxByteLength(),t.allowTags=this.get_allowTags();var e=this.get_filterChars();e&&(t.filterChars=e)},getHTML:function(t,e,i){return this._getTextBlank(e,i)}},Sys.UI.Controls.TextColumn.registerClass("Sys.UI.Controls.TextColumn",Sys.UI.Controls.Column),Sys.UI.Controls.NumberColumn=function(){Sys.UI.Controls.NumberColumn.initializeBase(this),this._numberType=_Z_28._float,this._decimalPrecision=$settings.DecimalPrecision,this._decimalScale=$settings.DecimalScale,this._decimalDigits=0,this._textAlign="right",this._headerAlign="center",this._filterType=_Z_73.range,this._showCalculator=$settings.NumberEditDefaultShowCalculator,this._displayZeroToDigits=$settings.DisplayZeroToDigits,this._summarySpliteChar=" ",this._formatNumber=$settings.NumberColumnFormatNumber},Sys.UI.Controls.NumberColumn.prototype={initialize:function(){Sys.UI.Controls.NumberColumn.callBaseMethod(this,"initialize");var t=this._allEvents;if(t){var e=t.click;e&&(this._cssClass+=" HasClick",this.add_click(e))}},_getControlButtonWidth:function(){return this._stepButton?2*$craba.editorButtonWidth:$craba.editorButtonWidth},set_stepButton:function(t){this._stepButton=t},get_stepButton:function(){return this._stepButton},getControlType:function(){return Sys.UI.Controls.NumberEdit},_initControlWidth:function(t,e){this._stepButton?$common.setWidth(t,e-10):Sys.UI.Controls.NumberColumn.callBaseMethod(this,"_initControlWidth",[t,e])},raiseClick:function(t,e){this._stepButton&&!this.get_readOnly()&&this.get_enabled()&&($dom.hasClass(e.target,"jian")?this._control.decValue():$dom.hasClass(e.target,"add")&&this._control.incValue());var i=this.get_events().getHandler("_click");if(i){var n=new _Z_202(t,this);n.event=e,i(this,n)}},createFilter:function(t,e,i){var n=$common.createClassDiv("IntervalBlock");t.appendChild(n);var o=this.createEdit();o.title="起始值",n.appendChild(o);var s;i&&(s=i.value1);var r=this._createFilterControl(o,e,s,1),l=$common.createSpan();l.className="GridFilterLineSpacer",l.innerText="-",n.appendChild(l);var a=this.createEdit();a.title="结束值",n.appendChild(a);var h;i&&(h=i.value2);var d=this._createFilterControl(a,e,h,2);return r._next=d,d._prev=r,r},_createFilterControl:function(t,e,i,n){t.className="Edit",t.style.width="38%";var o={};this.initProps(o);var s={tabOnEnter:!1,tag:this,showCalculator:!1,value:i};$settings.GridFilterEditShowNullText&&(o.nullDisplayText=1==n?"区间":"过滤"),Object.copyTo(s,o,["defaultvalue","stepbutton","showempty"]),Object.copyTo(this._filterProperties,o);var r={enterPress:$createDelegate(e,e.doFilter)},l=$create(this.getControlType(),o,t,r,this._grid.get_form(),!0);return e.addControl(l),l},getFilterValue:function(t,e){var i=t,n=t;i._prev?i=i._prev:n=i._next,e.value1=i.get_value(),e.value2=n.get_value()},setFilterValue:function(t){if(this._filterControl){var e=this._filterControl,i=this._filterControl;e._prev?e=e._prev:i=e._next,e.set_value(t.value1),i.set_value(t.value2)}},set_defaultValue:function(t){this._defaultValue=t},get_defaultValue:function(){return this._defaultValue},get_showEmpty:function(){return this._showEmpty},set_showEmpty:function(t){this._showEmpty=t},get_numberType:function(){return this._numberType},set_numberType:function(t){this._numberType=t,this._control&&this._control.set_numberType(t)},get_preFlagDataField:function(){return this._preFlagDataField},set_preFlagDataField:function(t){this._preFlagDataField=t},get_summarySpliteChar:function(){return this._summarySpliteChar},set_summarySpliteChar:function(t){this._summarySpliteChar=t},get_preFlagData:function(t){var e=this.get_preFlagDataField(),i=this._grid.findRowData(t);return i?Object.isUndefinedOrNull(i[e])||""===i[e]?null:i[e]:null},get_currencyMarker:function(){return this._currencyMarker},set_currencyMarker:function(t){this._currencyMarker=t,this._grid._initialized&&this._refreshColumnHTML()},get_decimalDigits:function(){return this._decimalDigits},set_decimalDigits:function(t){this._decimalDigits=t},get_decimalPrecision:function(){return this._decimalPrecision},set_decimalPrecision:function(t){this._decimalPrecision=t},get_decimalScale:function(){return this._decimalScale},set_decimalScale:function(t){this._decimalScale=t},get_showCalculator:function(){return this._showCalculator},set_showCalculator:function(t){this._showCalculator=t},get_maxValue:function(){return this._maxValue},set_maxValue:function(t){this._maxValue=t},get_minValue:function(){return this._minValue},set_minValue:function(t){this._minValue=t},initProps:function(t){Sys.UI.Controls.NumberColumn.callBaseMethod(this,"initProps",[t]),t.numberType=this.get_numberType(),t.decimalDigits=this.get_decimalDigits(),t.decimalPrecision=this.get_decimalPrecision(),t.decimalScale=this.get_decimalScale(),t.showCalculator=this.get_showCalculator(),t.defaultValue=this.get_defaultValue(),t.showEmpty=this.get_showEmpty(),t.minValue=this.get_minValue(),t.maxValue=this.get_maxValue(),t.stepButton=this.get_stepButton(),t.useSpin=!1,t.stepButton&&(t.clickOnly=!0)},handleControl:function(t){t.add_change($createDelegate(this,this._change)),t.add_enterPress($createDelegate(this,this._doEnterPress))},_doEnterPress:function(t){var e=this.get_minValue();e!=undefined&&parseFloat(this.get_value())<parseFloat(e)&&this.set_value(e);var i=this.get_maxValue();i!=undefined&&parseFloat(this.get_value())>parseFloat(i)&&this.set_value(i)},get_displayThousandSeperator:function(){return this._displayThousandSeperator},set_displayThousandSeperator:function(t){this._displayThousandSeperator=t},get_displayEmptyForZero:function(){return this._displayEmptyForZero},set_displayEmptyForZero:function(t){this._displayEmptyForZero=t},get_displayZeroToDigits:function(){return this._displayZeroToDigits},set_displayZeroToDigits:function(t){this._displayZeroToDigits=t},set_formatNumber:function(t){this._formatNumber=t},get_formatNumber:function(){return this._formatNumber},formatNumber:function(t,e){return $common.formatNumber({value:t,decimalDigits:this.get_decimalDigits(),decimalScale:this.get_decimalScale(),displayThousandSeperator:this.get_displayThousandSeperator(),displayEmptyForZero:this.get_displayEmptyForZero(),displayZeroToDigits:this.get_displayZeroToDigits(),isPrint:e})},getHTML:function(t,e,i){if(!this._stepButton)return Sys.UI.Controls.NumberColumn.callBaseMethod(this,"getHTML",arguments);return'<div class="EditBlock stepBlock"><div class="SkinButton aicon-jian jian stepNum"></div><div class="Edit">'+e+'</div><div class="SkinButton aicon-zengjia add stepNum"></div></div>'},getDisplayText:function(t,e,i,n){var o=this._grid,s=this._getFlag(i),t=this.get_formatNumber()?this.formatNumber(t,n):t;return Object.isUndefinedOrNull(t)||""===t?this._displayEmptyForZero?"":o.isEmptyRow(i)?"":this._defaultValue!==undefined?this._defaultValue:"":s?s+" "+t:t},getControlValue:function(t,e){var i=this._preFlagDataField||this._currencyMarker,n=this._getFlag(e),o=this.get_reportField(),s=Sys.UI.Controls.NumberColumn.callBaseMethod(this,"getControlValue",[t,e]);if(i&&o&&n){this.get_preFlagDataField();this._grid.getRowData(e)[o]=n+" "+s}return s},_getFlag:function(t){var e=this.get_preFlagData(t);return null==e&&(e=this.get_currencyMarker()),e}},Sys.UI.Controls.NumberColumn.registerClass("Sys.UI.Controls.NumberColumn",Sys.UI.Controls.Column),Sys.UI.Controls.FiscalColumn=function(){Sys.UI.Controls.FiscalColumn.initializeBase(this),this._captionsText="万千百十亿千百十万千百十元角分",this._maxValueLength=11,this._activeIndex=0,this._minWidth=200},Sys.UI.Controls.FiscalColumn.prototype={initialize:function(){for(var t=new Sys.StringBuilder,e=0;e<this._maxValueLength;e++){var i=this._maxValueLength-1-e,n='<div class="FiscalBlock #" index="%">{%}</div>'.replace("#","fc"+i).replace(/\%/gi,e);t.append(n)}this._templateHtml=t.toString(),Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"initialize")},dispose:function(){Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"dispose"),delete this._fiscalControl},get_displayThousandSeperator:function(){return!1},renderRowCellSkin:function(t,e,i){i.className+=" FiscalCell"},get_maxValueLength:function(){return this._maxValueLength},set_maxValueLength:function(t){this._maxValueLength=t},get_fullInput:function(){return this._fullInput},set_fullInput:function(t){this._fullInput=t},_internalDisposeHeader:function(){$dom.removeCssClass(this._elements.captionElement,"FiscalCaption"),Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"_internalDisposeHeader")},doInitHeaderElements:function(t){var e=this.get_headerElement();if(e){$dom.addCssClass(t.captionElement,"FiscalCaption");var i=this.fiscalBlock;i||((i=this.fiscalBlock=$common.createClassDiv("FiscalHeader")).innerHTML=this._formatHTML(this._captionsText.substr(this._captionsText.length-this._maxValueLength))),e.appendChild(i)}},_createSortFlag:function(){var t=Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"_createSortFlag");return t&&t.parentNode.appendChild(this.fiscalBlock),t},_clearSortOrderFast:function(t){if(this._elements.sortFlag){Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"_clearSortOrderFast",[t]);var e=t?this.get_frozenHeaderElement():this.get_headerElement(),i=t?this.frozenFiscalBlocks:this.fiscalBlock;e.appendChild(i)}},initProps:function(t){Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"initProps",[t]),this._fullInput?(t.showCalculator=!0,t.decimalPrecision=this._maxValueLength,t.decimalScale=2):(t.showCalculator=!1,t.maxValue=9,t.maxLength=1,t.decimalPrecision=0)},_setFooterText:function(t){if(t){var e=t.firstChild;if(e){var i=this.get_footer();e.style.padding=0,i||(i=""),(i=i.toString()).startsWith("-")?$dom.addCssClass(e,"LessNumber"):$dom.removeCssClass(e,"LessNumber"),e.innerHTML='<div class="FiscalFooter">'+this.getDisplayText(i)+"</div>"}}},_formatHTML:function(t){for(var e=t.split(""),i=this._templateHtml,n=0;n<this._maxValueLength;n++){var o=e[n];o&&"-"!=o||(o=""),i=i.replace("{"+n+"}",o)}return i},getHTML:function(t,e){this._activeElement=null,this._prevActiveElement=null;var i="GridBodyFiscalText";return t<0&&(i+=" LessNumber"),'<div class="'+i+'">'+e+"</div>"},_doGetCellText:function(t,e,i){return i?e:Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"_doGetCellText",[t,e,i])},get_decimalDigits:function(t){return t?this._decimalDigits:this._fullInput?2:0},getDisplayText:function(t,e,i){e=this._formatValue(t,this.get_decimalDigits(!0),this.get_decimalScale(),this.get_displayEmptyForZero(),this.get_displayZeroToDigits());return this._formatHTML(e)},_initCellHTML:function(t,e,i){return this._getCellHTML(t,e)},_removeCellEdit:function(t){try{var e=this._columnEdit.parentNode;e&&e.removeChild(this._columnEdit)}catch(i){}},_checkLastCell:function(t){return this._fullInput?Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"_checkLastCell",[t]):(this._saveActiveIndex(),this._activeElement?this._activeElement.className.indexOf("FiscalBlock")>-1:(this._activeElement=t.firstChild.childNodes[this._activeIndex],!0))},_refreshCell:function(t){this._fiscalControl||(this._fiscalControl=new _Z_72(this)),this._fiscalControl.refreshCell(t)},_initEditorElement:function(t,e,i,n){var o=t;t.firstChild&&(this._fullInput?$dom.setVisible(t.firstChild,!1):o=this._activeElement,i=o.clientWidth,$common.setWidth(e,i),e.style.height=n+"px",e.style.lineHeight=n+"px",o.appendChild(e))},doInitControlValue:function(t){var e=Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"doInitControlValue",[t]);return this._fiscalControl.setValue(),e},getControlValue:function(t,e){return this._fiscalControl.getValue()},focusPrevCell:function(){if(this._fullInput)return Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"focusPrevCell");if(this._activeElement){var t=$common.getPreviousSibling(this._activeElement);if(t)return this._removeCellEdit(this._lastCell),this._activeElement=t,void this._showEditor(this._lastCell)}Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"focusPrevCell")},focusNextCell:function(){if(this._fullInput)return Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"focusNextCell");if(this._activeElement){var t=$common.getNextSibling(this._activeElement);if(t)return this._removeCellEdit(this._lastCell),this._activeElement=t,void this._showEditor(this._lastCell)}Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"focusNextCell")},doKeyDown:function(t){if(this._fullInput)return Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"doKeyDown",[t]);var e=t.keyCode;switch(e){case Sys.UI.Key.backspace:this._control.set_text(""),this.focusPrevCell();break;case Sys.UI.Key.del:this._control.set_text(""),this.focusNextCell()}if(e==Sys.UI.Key.space||e>47&&e<58){var i=this;asyncCall(function(){i.focusNextCell()})}Sys.UI.Controls.FiscalColumn.callBaseMethod(this,"doKeyDown",[t])},_saveActiveIndex:function(){if(this._activeElement)this._activeIndex=parseInt(this._activeElement.getAttribute("index"));else{var t=this.get_grid()._activeColumn;if(t==this||!t)return;this._activeIndex=t.get_index()>this.get_index()?this._maxValueLength-1:0}},_formatValue:function(t,e,i,n,o){if(null==t)return"";var s=t.toString();if("number"!=typeof t&&(t=Number(t)),isNaN(t)||""==s)return"";if(t=Math.abs(t),s=t.toString(),0==t&&n)return"".padLeft(this._maxValueLength-2," ")+"  ";e>0?(e>2&&(e=2),s=Math.roundTo(t,e,!1).format("n"+e)):i>0&&(i>2&&(i=2),s=Math.roundTo(t,i,!1).toString());var r=s.split(/e/i);if(r.length>1){var l=parseInt(r[1]);if(l<0){h=r[0].replace(".","");s="0."+Sys.StringUtils.repeat("0",-1*l-1)+h}else if(l>0){s=(h=r[0].split(".")).join("");var a=h.length>1?h[1].length:0;if(a<l)s+=Sys.StringUtils.repeat("0",l-a);else if(a>l){var h;s=(h=s.substring(0,l+1))+"."+s.substring(l+1,s.length)}}}var d=s.split(".");return s=d.length>1?d[0].padLeft(this._maxValueLength-2," ")+d[1].padRight(2," "):s.padLeft(this._maxValueLength-2," ")+"  "}},Sys.UI.Controls.FiscalColumn.registerClass("Sys.UI.Controls.FiscalColumn",Sys.UI.Controls.NumberColumn),_Z_72=function(t){this._column=t},_Z_72.prototype={refreshCell:function(t){var e=this._column;if(!e.get_fullInput()){var i=e._activeElement;if(this._activeValue=i.innerText,e._control&&e._prevActiveElement){var n=e._control.get_value();null!==n&&(e._prevActiveElement.innerText=n)}e._prevActiveElement=i,i.innerHTML=""}},setValue:function(){if(!this._column.get_fullInput()){this._column._control.set_value(this._activeValue)}},getValue:function(){var t=this._column,e=t._control.get_value();if(t.get_fullInput())return e;null!==e&&(t._activeElement.innerText=e);for(var i=t._activeElement.parentNode,n=$dom.hasClass(i,"LessNumber"),o=i.childNodes,s="",r=!1,l=!1,a=o.length,h=a-2,d=0;d<a;d++){var _=o[d];_==t._activeElement&&r&&null===e&&(_.innerText=0);var u=_.innerText;d<h?u?(r=!0,s+=u):r&&(s+="0"):d==h?u&&(l=!0,s=s+"."+u):u&&(l?s+=u:s=s+".0"+u)}return this._toNumber(s,n)},_toNumber:function(t,e){return t.length>0?e?-1*Number(t):Number(t):0}},Sys.UI.Controls.PercentColumn=function(){Sys.UI.Controls.PercentColumn.initializeBase(this)},Sys.UI.Controls.PercentColumn.prototype={get_readOnly:function(){return!0},getDisplayText:function(t,e){return(e=$common.formatNumber(t,this.get_decimalDigits(),this.get_decimalScale()))?e+"%":e}},Sys.UI.Controls.PercentColumn.registerClass("Sys.UI.Controls.PercentColumn",Sys.UI.Controls.NumberColumn),Sys.UI.Controls.DateColumn=function(){Sys.UI.Controls.DateColumn.initializeBase(this),this._formater="yyyy-MM-dd",this._filterType=_Z_73.range},Sys.UI.Controls.DateColumn.prototype={_closeDropDown:function(t){t||Sys.UI.Controls.DateColumn.callBaseMethod(this,"_closeDropDown")},set_selectOnly:function(t){this._selectOnly=t},get_selectOnly:function(){return this._selectOnly},getControlType:function(){if(this._formater.indexOf(" ")>-1)return Sys.UI.Controls.DateTimeEdit;var t=this._formater.indexOf("yyyy")>-1,e=this._formater.indexOf("MM")>-1,i=this._formater.indexOf("dd")>-1;return t||e||i?Sys.UI.Controls.DateEdit:Sys.UI.Controls.TimeEdit},createFilter:function(t,e,i){var n=this.createEdit();n.className="ButtonEdit Edit SelectOnly",t.appendChild(n);var o={tabOnEnter:!1,selectOnly:this.get_selectOnly(),tag:this};$settings.GridFilterEditShowNullText&&(o.nullDisplayText="按日期过滤"),i&&(o.value=i.value);var s={change:$createDelegate(e,e.doFilter)};this._formater.indexOf(" ")>-1||(o.editKind=_Z_49.date),Object.copyTo(this._filterProperties,o);var r=$create(Sys.UI.Controls.DateRangeEdit,o,n,s,this._grid.get_form(),!0);return e.addControl(r),t._control=r,r},getFilterValue:function(t,e){var i=t.get_date();e.value1=i[0],e.value2=i[1]},setFilterValue:function(t){this._filterControl&&this._filterControl.set_date(t.value1,t.value2)},initProps:function(t){Sys.UI.Controls.DateColumn.callBaseMethod(this,"initProps",[t]),t.valueType=this.get_valueType(),t.selectOnly=this.get_selectOnly(),t.minValue=this.get_minValue(),t.maxValue=this.get_maxValue()},get_minValue:function(){return this._minValue},set_minValue:function(t){this._minValue=t,this.get_isInitialized()&&($craba._initMinMaxDateValue(this),this._control&&this._control.set_minValue(t))},get_maxValue:function(){return this._maxValue},set_maxValue:function(t){this._maxValue=t,this.get_isInitialized()&&($craba._initMinMaxDateValue(this),this._control&&this._control.set_maxValue(t))},getDisplayText:function(t,e,i,n){return"string"==typeof t&&(t=t.indexOf(" ")>5||t.indexOf("T")>5?Date.strToDateTime(t):Date.strToDate(t)),t?t._format(this._formater):""},get_formater:function(){return this._formater},set_formater:function(t){this._formater=t}},Sys.UI.Controls.DateColumn.registerClass("Sys.UI.Controls.DateColumn",Sys.UI.Controls.Column),Sys.UI.Controls.DateTimeColumn=function(){Sys.UI.Controls.DateTimeColumn.initializeBase(this),this._showSecond=!0,this._formater="yyyy-MM-dd HH:mm:ss"},Sys.UI.Controls.DateTimeColumn.prototype={initProps:function(t){Sys.UI.Controls.DateTimeColumn.callBaseMethod(this,"initProps",[t]),t.showSecond=this._showSecond},set_showSecond:function(t){this._showSecond=t,this._formater=t?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd HH:mm"},get_showSecond:function(){return this._showSecond}},Sys.UI.Controls.DateTimeColumn.registerClass("Sys.UI.Controls.DateTimeColumn",Sys.UI.Controls.DateColumn),Sys.UI.Controls.SelectorColumn=function(){Sys.UI.Controls.SelectorColumn.initializeBase(this),this._selectorWidth=0,this._selectorHeight=0,this._selectOnly=!1,this._allowHandInput=!1,this._shortcut=0,this._buttonVisible=!0},Sys.UI.Controls.SelectorColumn.prototype={getControlType:function(){return Sys.UI.Controls.SelectorEdit},get_showMDI:function(){return this._showMDI},set_showMDI:function(t){this._showMDI=t},get_selectorPage:function(){return this._selectorPage},set_selectorPage:function(t){this._selectorPage=t,this._control&&this._control.set_selectorPage(t)},get_clickNotFocus:function(){return this._clickNotFocus},set_clickNotFocus:function(t){this._clickNotFocus=t},get_selectorText:function(){return this._selectorText},set_selectorText:function(t){this._selectorText=t,this.get_isInitialized()&&this._refreshColumnHTML(this._grid.get_rowCount())},get_buttonVisible:function(){return this._buttonVisible},set_buttonVisible:function(t){this._buttonVisible=t},get_selectorWidth:function(){return this._selectorWidth},set_selectorWidth:function(t){this._selectorWidth=t},get_selectorHeight:function(){return this._selectorHeight},set_selectorHeight:function(t){this._selectorHeight=t},get_selectorType:function(){return this._selectorType},set_selectorType:function(t){this._selectorType=t},get_selectOnly:function(){return this._selectOnly},set_selectOnly:function(t){this._selectOnly=t,this._control&&this._control.set_selectOnly(t)},get_allowHandInput:function(){return this._allowHandInput},set_allowHandInput:function(t){this._allowHandInput=t,this._control&&this._control.set_allowHandInput(t)},get_shortcut:function(){return this._shortcut},set_shortcut:function(t){this._shortcut=t},add_buttonClick:function(t,e){return this.get_events().addHandler("buttonClick",t,e)},remove_buttonClick:function(t){this.get_events().removeHandler("buttonClick",t)},doAfterInitControlValue:function(t){},needHandleEnterPress:function(){return!1},doButtonClick:function(){var t=this.get_events().getHandler("buttonClick");t&&t(this)},add_selectorInit:function(t,e){return this.get_events().addHandler("selectorInit",t,e)},remove_selectorInit:function(t){this.get_events().removeHandler("selectorInit",t)},doSelectorInit:function(t){var e=this.get_events().getHandler("selectorInit");e&&e(this,t)},add_selectorLoaded:function(t,e){return this.get_events().addHandler("selectorLoaded",t,e)},remove_selectorLoaded:function(t){this.get_events().removeHandler("selectorLoaded",t)},doSelectorLoaded:function(t){var e=this.get_events().getHandler("selectorLoaded");e&&e(this,t)},add_selectorSelected:function(t,e){return this.get_events().addHandler("selectorSelected",t,e)},remove_selectorSelected:function(t){this.get_events().removeHandler("selectorSelected",t)},doSelectorSelected:function(t){var e=this.get_events().getHandler("selectorSelected");e&&e(this,t)},add_selectorBeforeSelected:function(t,e){return this.get_events().addHandler("selectorBeforeSelected",t,e)},remove_selectorBeforeSelected:function(t){this.get_events().removeHandler("selectorBeforeSelected",t)},doSelectorBeforeSelected:function(t){var e=this.get_events().getHandler("selectorBeforeSelected");e&&e(this,t)},add_getSelectorPage:function(t,e){return this.get_events().addHandler("getSelectorPage",t,e)},remove_getSelectorPage:function(t){this.get_events().removeHandler("getSelectorPage",t)},initProps:function(t){Sys.UI.Controls.SelectorColumn.callBaseMethod(this,"initProps",[t]),Sys.UI.Controls.SelectorColumn.copyProps(this,t)},get_filterChars:function(){return this._filterChars},set_filterChars:function(t){this._filterChars=t},getControlValue:function(t,e){var i=t.get_value();return Object.isUndefinedOrNull(i)?null:i},getInputAction:function(){return"选择"},getHTML:function(t,e,i){var n=this._getTextBlank(e,i);return this._toButtonHtml(n)},_initCellHTML:function(t,e,i){return i||this._selectorText?this._getCellHTML(t,e):this._getEmptyHTML(!0)},_toButtonHtml:function(t){var e=!this.get_readOnly();return e&&this._selectorText?t+='<div class="Button SelectorButton">'+this._selectorText+"</div>":e&&(t+='<div class="SelectorButton aicon-gengduotianchong"></div>'),t},_getEmptyHTML:function(t){var e=Sys.UI.Controls.SelectorColumn.callBaseMethod(this,"_getEmptyHTML",[t]);return this._toButtonHtml(e)},renderRowCellSkin:function(t,e,i){i.className+=" SelectorCell"},raiseClick:function(t,e){this._control&&this._lastCell&&e.target.tagName&&$dom.hasClass(e.target,"SelectorButton")&&this._control.doButtonClick()},doValueChanged:function(t){var e=this.get_dataField();t&&this.get_displayField()&&null===t[e]&&(t[this.get_displayField()]="")}},Sys.UI.Controls.SelectorColumn.registerClass("Sys.UI.Controls.SelectorColumn",Sys.UI.Controls.Column),Sys.UI.Controls.SelectorColumn.copyProps=function(t,e){e.displayField=t.get_displayField(),e.selectorPage=t.get_selectorPage(),e.selectorType=t.get_selectorType(),e.selectorWidth=t.get_selectorWidth(),e.selectorHeight=t.get_selectorHeight(),e.buttonVisible=t.get_buttonVisible(),e.clickNotFocus=t.get_clickNotFocus(),e.showMDI=t.get_showMDI();var i=t.get_selectOnly();e.selectOnly=i,i&&(e.readOnly=!0),e.allowHandInput=t.get_allowHandInput(),e.shortcut=t.get_shortcut();var n=t.get_maxByteLength();n>0&&(e.maxByteLength=n),e.allowTags=t.get_allowTags();var o=t.get_filterChars();o&&(e.filterChars=o)},_Z_71=function(){_Z_71.initializeBase(this),this._items=null,this._dropDownStyle=_Z_24.dropDown,this._dataValueField="value",this._dataTextField="text"},_Z_71.prototype={set_selectOnly:function(t){this._selectOnly=t},get_selectOnly:function(){return this._selectOnly},createFilter:function(t,e,i){var n=this.createEdit();n.className="ButtonEdit Edit",t.appendChild(n);var o={};this.initProps(o);var s={tabOnEnter:!1,tag:this};$settings.GridFilterEditShowNullText&&(s.nullDisplayText="下拉过滤"),i&&(s.value=i.value),Object.copyTo(s,o),Object.copyTo(this._filterProperties,o);var r=$create(this.getControlType(),o,n,this._getFilterEvents(e),this._grid.get_form(),!0);return e.addControl(r),t._control=r,r},_getFilterEvents:function(t){return{change:$createDelegate(t,t.doFilter)}},get_dropDownStyle:function(){return this._dropDownStyle},set_dropDownStyle:function(t){this._dropDownStyle=t},initProps:function(t){_Z_71.callBaseMethod(this,"initProps",[t]),t.items=this.get_items(),t.dataValueField=this.get_dataValueField(),t.dataTextField=this.get_dataTextField(),t.dropDownStyle=this.get_dropDownStyle(),t.selectOnly=this.get_selectOnly(),t.valueType=this.get_valueType(),this._enabledField&&(t.enabledField=this._enabledField)},getDefaultValue:function(){return this._defaultValue},get_defaultValue:function(){return this._defaultValue},set_defaultValue:function(t){this._defaultValue=t},get_items:function(){return this._items},set_items:function(t,e){if(this._items=t,this.get_isInitialized()){if(this._hasEditor()&&!e&&this._hideEditor(),this.get_control()){var i=this.get_control(),n=i.get_value();i.set_items(t),i.set_value(n)}this._filterControl&&this._filterControl.set_items(Object.clone(t))}},get_itemData:function(){var t=this.get_items();if(!t)return null;for(var e=this.get_dataValueField(),i=this.get_dataTextField(),n={},o=0,s=t.length;o<s;o++){var r=t[o],l=r[e],a=this._getItemText(r[i]);n[l]=a}return n},_getItemText:function(t){return t},get_hasItems:function(){var t=this.get_items();return t&&t.length>0},get_dataValueField:function(){return this._dataValueField},set_dataValueField:function(t){this._dataValueField=t},get_dataTextField:function(){return this._dataTextField},set_dataTextField:function(t){this._dataTextField=t},get_enabledField:function(){return this._enabledField},set_enabledField:function(t){this._enabledField=t},add_dropDown:function(t){this.get_events().addHandler("dropDown",t)},remove_dropDown:function(t){this.get_events().removeHandler("dropDown",t)},doDropDown:function(){var t=this.get_events().getHandler("dropDown");t&&t(this)},getInputAction:function(){return"选择"}},_Z_71.registerClass("_Z_71",Sys.UI.Controls.Column),Sys.UI.Controls.DropDownColumn=function(){Sys.UI.Controls.DropDownColumn.initializeBase(this),this._filterType=_Z_73.equals},Sys.UI.Controls.DropDownColumn.prototype={getControlType:function(){return Sys.UI.Controls.DropDownEdit},doTabOnEnter:function(){this._control&&this._control.get_droppedDown()||Sys.UI.Controls.DropDownColumn.callBaseMethod(this,"doTabOnEnter")},initProps:function(t){Sys.UI.Controls.DropDownColumn.callBaseMethod(this,"initProps",[t]),t.maxLength=this.get_maxLength()},getFilterValue:function(t,e){var i=t.get_value();e.value1=i,e.value2=i},_change:function(t,e){Sys.UI.Controls.DropDownColumn.callBaseMethod(this,"_change",[t,e]),this._hideEditor()},getDisplayText:function(t,e){return this.get_dropDownStyle()==_Z_24.dropDownEdit||this._valueType==_Z_59.string?e:$craba.getItemTextByValue(this.get_items(),this.get_dataValueField(),this.get_dataTextField(),t)},getCellValue:function(t){var e=Sys.UI.Controls.DropDownColumn.callBaseMethod(this,"getCellValue",[t]);return void 0===e?this.getDefaultValue():e}},Sys.UI.Controls.DropDownColumn.registerClass("Sys.UI.Controls.DropDownColumn",_Z_71),Sys.UI.Controls.DropDownCheckColumn=function(){Sys.UI.Controls.DropDownCheckColumn.initializeBase(this)},Sys.UI.Controls.DropDownCheckColumn.prototype={getControlType:function(){return Sys.UI.Controls.DropDownCheckBoxList},_cloneLastValue:function(){this._lastValueClone=Object.clone(this._lastValue)},_getFilterEvents:function(t){return{changed:$createDelegate(t,t.doFilter)}},initProps:function(t){Sys.UI.Controls.DropDownCheckColumn.callBaseMethod(this,"initProps",[t]),t.layoutDirection=Sys.UI.Controls.LayoutDirection.vert,t.columnSplit=1},handleControl:function(t){t.add_changed($createDelegate(this,this._change))},getDisplayText:function(t,e){if(this.get_dropDownStyle()==_Z_24.dropDownEdit)return e;if(!t)return"";if(t.toString().indexOf(",")>0&&(t=t.toString().split(",")),t instanceof Array){for(var i=[],n=0,o=t.length;n<o;n++){(e=$craba.getItemTextByValue(this.get_items(),this.get_dataValueField(),this.get_dataTextField(),t[n]))&&i.push(e)}return i.join(",")}return $craba.getItemTextByValue(this.get_items(),this.get_dataValueField(),this.get_dataTextField(),t)},getCellValue:function(t){var e=Sys.UI.Controls.DropDownCheckColumn.callBaseMethod(this,"getCellValue",[t]);return void 0===e?this.getDefaultValue():e}},Sys.UI.Controls.DropDownCheckColumn.registerClass("Sys.UI.Controls.DropDownCheckColumn",_Z_71),Sys.UI.Controls.ColorDropDownColumn=function(){Sys.UI.Controls.ColorDropDownColumn.initializeBase(this),this._color="#ffffff"},Sys.UI.Controls.ColorDropDownColumn.prototype={createFilter:function(){},getControlType:function(){return this._dropDownStyle==_Z_24.dropDown?Sys.UI.Controls.ColorEdit:Sys.UI.Controls.ColorDropDownEdit},get_color:function(){return this._color},set_color:function(t){this._color=t},initProps:function(t){this._dropDownStyle==_Z_24.dropDownList?Sys.UI.Controls.ColorDropDownColumn.callBaseMethod(this,"initProps",[t]):_Z_71.callBaseMethod(this,"initProps",[t]),t.defaultValue=this._color},getHTML:function(t,e,i){return'<div class="GridBodyCellText" style="background-color:'+t+';">&nbsp;</div>'}},Sys.UI.Controls.ColorDropDownColumn.registerClass("Sys.UI.Controls.ColorDropDownColumn",_Z_71),Sys.UI.Controls.ImageDropDownColumn=function(){Sys.UI.Controls.ImageDropDownColumn.initializeBase(this),this._imageHeight=0,this._allowFilter=!1},Sys.UI.Controls.ImageDropDownColumn.prototype={get_imageHeight:function(){return this._imageHeight},set_imageHeight:function(t){this._imageHeight=t},createEdit:function(){return $common.createClassDiv("ImageEdit")},getControlType:function(){return Sys.UI.Controls.ImageDropDownEdit},initProps:function(t){Sys.UI.Controls.ImageDropDownColumn.callBaseMethod(this,"initProps",[t]),t.imageHeight=this.get_imageHeight()},getDisplayText:function(t,e){var i=$craba.getItemTextByValue(this.get_items(),this.get_dataValueField(),this.get_dataTextField(),t);return $craba.getImage(i,this._imageWidth,this._imageHeight)},getHTML:function(t,e,i){return e||e.toString()?"<div class='ImageCell'>"+e+"</div>":'<div class="GridBodyCellText">&nbsp;</div>'},getCellText:function(t,e){var i=Sys.UI.Controls.ImageDropDownColumn.callBaseMethod(this,"getCellText",[t]);if(!e)return i;var n=$common.getHostUrl(),o=this.getCellValue(t),s=$craba.getItemTextByValue(this.get_items(),this.get_dataValueField(),this.get_dataTextField(),o);return s.indexOf("http")>-1?s:n+"/"+s},_getItemText:function(t){if(t.indexOf("http")>-1)return t;return $common.getHostUrl()+"/"+t}},Sys.UI.Controls.ImageDropDownColumn.registerClass("Sys.UI.Controls.ImageDropDownColumn",_Z_71),Sys.UI.Controls.CheckBoxColumn=function(){Sys.UI.Controls.CheckBoxColumn.initializeBase(this),this._textChecked=null,this._textUnchecked=null,this._skinImage=null,this._displayNull=!0,this._checks={},this._filterType=_Z_73.equals,this._showEditStyle=!1},Sys.UI.Controls.CheckBoxColumn.prototype={_setEditorActive:function(){},get_reportText:function(t){return t?"√":"×"},_checkCalcSummary:function(){},getIsCommandColumn:function(){return!0},_refreshCell:function(t){var e=t.firstChild;e&&e.tagName?(e.style.display="none",asyncCall(function(){$clearHandlers(e.firstChild),$removeNode(e)})):t.innerHTML=""},getControlType:function(){return Sys.UI.Controls.CheckBox},getControlValue:function(t,e){return this._isHide(this._lastValue,e)?this._lastValue:Sys.UI.Controls.CheckBoxColumn.callBaseMethod(this,"getControlValue",[t])},_initEditorElement:function(t,e,i,n){var o=$common.createClassDiv("ChkBoxStyle");o.appendChild(e),t.appendChild(o)},get_textChecked:function(){return this._textChecked},set_textChecked:function(t){this._textChecked=t},get_textUnchecked:function(){return this._textUnchecked},set_textUnchecked:function(t){this._textUnchecked=t},get_displayNull:function(){return this._displayNull},set_displayNull:function(t){this._displayNull=t},get_immediateEditor:function(){return this.get_visible()&&!this.get_readOnly()},createEdit:function(){return $common.createCheckBox()},getEditable:function(t){if(t){var e=t.firstChild;if(e&&e.tagName)return e=e.firstChild,$dom.getEnabled(e)}return!0},setEditable:function(t,e){if(this._lastCell==e&&this._hideEditor(),e){var i=e.firstChild;i&&i.tagName&&($dom.setEnabled(i,t),$dom.setEnabled(i.firstChild,t))}},_isRowAllowEditor:function(t){if(this.get_readOnly())return!1;var e=this._grid._getRowIndex(t);return!this._grid.isEmptyRow(e)&&this._getRowCellEditable(t)},_getRowCellEditable:function(t){var e=this._grid._getRowCell(t,this.get_index());return e=this._exchangeFrozenCell(e),this._getCellEditable(e)},_getCellEditable:function(t){if(t){var e=t.firstChild;if(e&&e.tagName)return e=e.firstChild,$dom.getEnabled(e)&&$dom.getVisible(e)}return!0},getHTML:function(t,e,i){if(this.get_readOnly()){if(this._isHide(t,i))return"";var n=(t=Boolean.convert(t))?1:0,o=this._checks[n];if(!o){var s=this.get_textChecked(),r=this.get_textUnchecked();o=t&&s?this._getHtml(s):!t&&r?this._getHtml(r):$common.getGlyphDivHTML("checkShape",n),this._checks[n]=o}return o}var l=this._grid.getRowEnabled(i)&&this.get_enabled(),a="",h="ChkBoxStyle";this._isHide(t,i)&&(h+=" dnone");var d=2==t||"2"==t;return(t=Boolean.convert(t))&&(a+=" checked",h+=" checked"),l||(a+=" disabled",h+=" disabled"),this.get_readOnly()&&(h+=" readonly"),d&&(h+=" half"),'<div class="'+h+'"><input type="checkbox"'+a+"/></div>"},_isHide:function(t,e){return!!this._grid.isEmptyRow(e)||!this._displayNull&&(void 0===t||null===t)},_checkTarget:function(t){return"INPUT"==t.target.tagName},raiseClick:function(t,e){if(!this.get_readOnly()&&this.get_enabled()&&!this._grid.isEmptyRow(t)&&this._checkTarget(e)){var i=n=this.getCellValue(t),n=this._getRealValue(t,n,e);this._setCellValue(t,n);var o=this._grid,s=this._control;s?(o._mouseHoverRow=this._grid._activeRow,t!=o.get_selectedRowIndex()&&o.set_selectedRowIndex(t),s._changeChecked(n)):(this._lastValue=n,this._raiseChange(null,n,i))}},_getRealValue:function(t,e,i){return!e},set_readOnly:function(t){Sys.UI.Controls.CheckBoxColumn.callBaseMethod(this,"set_readOnly",[t]),this.get_isInitialized()&&(t&&this._hideEditor(),this._refreshColumnHTML())},set_enabled:function(t){this._enabled=t,this.get_isInitialized()&&(t||this._hideEditor(),this._refreshColumnHTML())},createFilter:function(t,e,i){var n=$common.createInput();n.type="text",n.id=this._grid.get_id()+"_"+this.get_name(),n.className="ButtonEdit Edit",t.appendChild(n);var o={tabOnEnter:!1,tag:this,items:this._getFilterItems(),dataValueField:"value",dataTextField:"text"};$settings.GridFilterEditShowNullText&&(o.nullDisplayText="下拉过滤"),i&&(o.value=i.value),Object.copyTo(this._filterProperties,o);var s={change:$createDelegate(e,e.doFilter)},r=$create(Sys.UI.Controls.DropDownEdit,o,n,s,this._grid.get_form(),!0);return e.addControl(r),t._control=r,r},_getFilterItems:function(){return[{text:"是",value:1},{text:"否",value:0}]}},Sys.UI.Controls.CheckBoxColumn.registerClass("Sys.UI.Controls.CheckBoxColumn",Sys.UI.Controls.Column);var $_multiColumn=Sys.UI.Controls.MultiSelectColumn=function(){$_multiColumn.initializeBase(this),this._isCheckAll=!1,this._toggleByClickRow=!1,this._strongFocus=!0,this._showHeaderCheckBox=$settings.GridMultiSelectColumnDefaultShowHeaderCheckBox};$_multiColumn.prototype={initialize:function(){$_multiColumn.callBaseMethod(this,"initialize"),this._changeHandler=this._internalGetChangeHandler()},dispose:function(){var t=$_multiColumn._getCheckBoxElement(this);t&&($clearHandlers(t),this._elements.checkBoxElement=null),$_multiColumn.callBaseMethod(this,"dispose")},_internalSetElements:function(t,e,i){if(t!=this._elements){var n=this._grid._multiSelectColumn._elements;t.checkBoxElement=n.checkBoxElement,t.checkBoxCaptionElement=n.checkBoxCaptionElement,t.frozenCaptionElement=n.frozenCaptionElement,t.frozenCheckBoxElement=n.frozenCheckBoxElement,t.captionTable=n.captionTable}$_multiColumn.callBaseMethod(this,"_internalSetElements",[t,e,i])},get_strongFocus:function(){return this._strongFocus},set_strongFocus:function(t){this._strongFocus=t},get_isCheckAll:function(){return this._isCheckAll},get_toggleByClickRow:function(){return this._toggleByClickRow},set_toggleByClickRow:function(t){this._toggleByClickRow=t},set_readOnly:function(t){if(t!=this._readOnly&&($_multiColumn.callBaseMethod(this,"set_readOnly",[t]),this.get_isInitialized()&&this.get_showHeaderCheckBox())){var e=$_multiColumn._getCheckBoxElement(this);e||($_multiColumn._createHeaderCheckBox(this,this._elements),e=$_multiColumn._getCheckBoxElement(this)),e.style.display=t?"none":""}},get_showHeaderCheckBox:function(){return this._showHeaderCheckBox},set_showHeaderCheckBox:function(t){this._showHeaderCheckBox=t},_refreshCaption:function(t){$_multiColumn._refreshCaption(this,t)},_initCellHTML:function(t,e,i){return this._getCellHTML(t,e)},_onHideEditor:function(t,e,i){this._grid._isTree&&this.get_visible()&&(i==undefined&&(i=this._lastValue),this._grid._checkCellindeterminate(t,e,i))},_initControlValue:function(t){if($_multiColumn.callBaseMethod(this,"_initControlValue",[t]),this._grid._isTree){var e=t.parentNode,i=this._grid._getRowIndex(e),n=this._columnEdit;n.indeterminate=!this._lastValue&&this._grid.hasSelectedChild(i),$common._changeCheckedHalfStyle(n.parentNode,this._lastValue,n.indeterminate)}},doInitHeaderElements:function(t){this.get_readOnly()?$_multiColumn.callBaseMethod(this,"doInitHeaderElements",[t]):$_multiColumn._createHeaderCheckBox(this,this._elements)},_internalDisposeHeader:function(){this._elements.captionElement.style.lineHeight="",$_multiColumn.callBaseMethod(this,"_internalDisposeHeader")},doChanged:function(t,e,i){if($_multiColumn.callBaseMethod(this,"doChanged",arguments),!this._isCheckAll){var n=this.get_grid();n._checkRelation(i,t,!0),n._checkMultiSelectColumn()}},_checkBoxClick:function(t){var e=$_multiColumn._getCheckBoxElement(this);if(e){e._indeterminate?(e.checked=!0,e._indeterminate=!1,$common._changeCheckedHalfStyle(e.parentNode,!0,!1)):$common._changeCheckedHalfStyle(e.parentNode,e.checked,!1),this._initHeaderCheckBoxHint(e);var i=e.checked;this._isCheckAll=i;var n=this.get_grid(),o=this._elements.checkBoxElement;o!=e&&(o.checked=i,$common._changeCheckedHalfStyle(o.parentNode,i,!1));var s=n.get_events().getHandler("multiSelecting");if(s){var r=new _Z_31(-1,i,!i);if(s(n,r),r.get_cancel())return void this._setMultiSelectColumn(!i,!1)}n._doSelectAll(i),(s=n.get_events().getHandler("multiSelected"))&&s(n)}},isChecked:function(){var t=$_multiColumn._getCheckBoxElement(this);return!!t&&t.checked},_initHeaderCheckBoxHint:function(t){t.title=t.checked?"取消本页全选":"本页全选"},_setMultiSelectColumn:function(t,e){var i=$_multiColumn._getCheckBoxElement(this);if(i&&(i.indeterminate=!t&&e,i._indeterminate=i.indeterminate,$common._changeCheckedHalfStyle(i.parentNode,t,i.indeterminate),i.checked!=t)){var n=this._elements.checkBoxElement;n!=i&&(n.checked=t,n.indeterminate=!t&&e,this._initHeaderCheckBoxHint(n),$common._changeCheckedHalfStyle(n.parentNode,t,n.indeterminate)),i.checked=t,this._initHeaderCheckBoxHint(i)}}},$_multiColumn.registerClass("Sys.UI.Controls.MultiSelectColumn",Sys.UI.Controls.CheckBoxColumn),$_multiColumn._createHeaderCheckBox=function(t,e){if(t.get_headerElement()&&t.get_showHeaderCheckBox()){if(e.checkBoxElement){var i=e.checkBoxElement._table;$removeNode(i,!1),e.captionElement.innerHTML="",e.captionElement.appendChild(i)}else{var n=e.captionElement,o=$_multiColumn._getCheckBox(t,e,n,!1);$clearHandlers(e.checkBoxElement),$removeNode(e.checkBoxElement),$common.addClickHandler(o,t._checkBoxClick,t),e.checkBoxElement=o}var s=t.get_frozenHeaderElement(),r=e.frozenCaptionElement;if(s&&r){var l=$_multiColumn._getCheckBox(t,e,r,!0);$clearHandlers(e.frozenCheckBoxElement),$removeNode(e.frozenCheckBoxElement),$common.addClickHandler(l,t._checkBoxClick,t),e.frozenCheckBoxElement=l,t._grid._rows&&t._grid._checkMultiSelectColumn()}else $clearHandlers(e.frozenCheckBoxElement),e.frozenCheckBoxElement=null,e.frozenCaptionElement=null}},$_multiColumn._getCheckBox=function(t,e,i,n){var o=$common.createTable();o.cellPadding="2";var s=$common.createTBody(),r=$common.createTr(),l=$common.createCheckBox(),a=$common.createTd();a.className="ChkBoxStyle",a.appendChild(l),r.appendChild(a);var h=t.get_caption(),d=i.innerHTML;if(d&&"&nbsp;"!=d&&h&&""!=h&&h!=t.get_dataField()){(a=$common.createTd()).innerHTML=h,r.appendChild(a),e.checkBoxCaptionElement=a}return i.innerHTML="",s.appendChild(r),o.appendChild(s),i.appendChild(o),i.style.padding=0,l._table=o,l},$_multiColumn._refreshCaption=function(t,e){var i=t.get_caption();if(t._grid.get_useMultiRowCaption()?(i=t._getMultiRowCaption(i),e.style.padding="0px"):e.style.padding="",t.get_showHeaderCheckBox){var n=t._elements.checkBoxCaptionElement;n&&i!=t.get_dataField()&&(n.innerHTML=i),e.style.lineHeight="0px"}else{var o=t._elements.captionTextElement;o?o.innerHTML=i:e.innerHTML=i}},$_multiColumn._getCheckBoxElement=function(t){var e=t._elements;if(!e)return null;var i=e.checkBoxElement;if(!t.get_isFrozen())return i;var n=e.frozenCheckBoxElement;return n||i},Sys.UI.Controls.MultiCheckBoxColumn=function(){Sys.UI.Controls.MultiCheckBoxColumn.initializeBase(this),this._textField=""},Sys.UI.Controls.MultiCheckBoxColumn.prototype={getHTML:function(t,e,i){if(""==this._textField||""==t||""==e)return"";var n="<div>";try{for(var o=this._grid.getRowData(i)[this._textField].split(","),s=t.split(","),r=0,l=o.length;r<l;r++){var a=parseInt(s[r]);n+='<div style="float:left;">',this.get_readOnly()?n+=$common.getGlyphDivHTML("checkShape FloatLeft",a)+o[r]+"&nbsp;&nbsp;":n+='<input tag="'+r+'" type="checkbox" '+(a?" checked":"")+">"+o[r]+"&nbsp;&nbsp;</input>",n+="</div>"}}catch(h){n+="多复选列解析出错"}return n+="</div>"},_isHide:function(t){return!this._displayNull&&(void 0===t||null==t)},get_textField:function(){return this._textField},set_textField:function(t){this._textField=t},_getRealValue:function(t,e,i){var n=i.target,o=n.getAttribute("tag");if(o==undefined)return e;for(var s=parseInt(o),r=e.split(","),l="",a=n.checked?1:0,h=0,d=r.length;h<d;h++)""!=r[h]&&(l+=s==h?a+",":r[h]+",");return l},_doShowEditor:function(t,e){var i=this._allEvents;i?this._changeHandler=i.change:(i={},this._changeHandler=null,this._enterPressHandler=null)}},Sys.UI.Controls.MultiCheckBoxColumn.registerClass("Sys.UI.Controls.MultiCheckBoxColumn",Sys.UI.Controls.MultiSelectColumn),Sys.UI.Controls.SwitchButtonColumn=function(){Sys.UI.Controls.SwitchButtonColumn.initializeBase(this),this._filterType=_Z_73.equals,this._displayNull=!1,this._checkedValue=$settings.SwitchButtonCheckedValue},Sys.UI.Controls.SwitchButtonColumn.prototype={_getFilterItems:function(){var t={text:"是",value:this._checkedValue},e={text:"否",value:!this._checkedValue};if(this._text){var i=this._text.split(",");t.text=i[1],e.text=i[0]}return[t,e]},get_itemData:function(){for(var t=this._getFilterItems(),e={},i=0,n=t.length;i<n;i++){var o=t[i],s=o.value,r=o.text;e[s]=r}return e},set_checkedValue:function(t){this._checkedValue=t},get_checkedValue:function(){return this._checkedValue},get_reportText:function(t){if(!this._text)return t==this._checkedValue?"√":"×";var e=this._text.split(",");return t==this._checkedValue?e[1]:e[0]},set_text:function(t){this._text=t,this.get_isInitialized()&&this._refreshColumnHTML()},get_text:function(){return this._text},initProps:function(t){t.text=this._text,t.checkedValue=this._checkedValue},get_immediateEditor:function(){return!1},getControlType:function(){return Sys.UI.Controls.SwitchButton},createEdit:function(){return $common.createDiv()},_initEditorElement:function(t,e,i,n){var o="SwitchButton";this._text&&(o+=" hasText"),e.className=o,$dom.addCssClass(e,this._cssClass),t.appendChild(e)},_getCellEditable:function(t){if(t){var e=t.firstChild;if(e&&e.tagName)return $dom.getEnabled(e)&&$dom.getVisible(e)}return!0},getEditable:function(t){if(t){var e=t.firstChild;if(e&&e.tagName)return $dom.getEnabled(e)}return!0},setEditable:function(t,e){if(this._lastCell==e&&this._hideEditor(),e){var i=e.firstChild;i&&i.tagName&&$dom.setEnabled(i,t)}},getControlValue:function(t,e){return Sys.UI.Controls.CheckBoxColumn.callBaseMethod(this,"getControlValue",[t])},_checkTarget:function(t){return t.target.className.indexOf("Switch")>-1},getHTML:function(t,e,i){var n="SwitchButton";this._cssClass&&(n+=" "+this._cssClass),this._isHide(t,i)&&(n+=" dnone");var o=t==this._checkedValue;o&&(n+=" checked");this._grid.getRowEnabled(i)&&this.get_enabled()||(n+=" disabled"),this.get_readOnly()&&(n+=" readonly");var s="";if(this._text&&this._text.indexOf(",")>0){var r=this._text.split(",");s="<span class='SwitchText'>"+(o?r[1]:r[0])+"</span>",n+=" hasText"}return"<div class='"+n+"'>"+s+"<div class='SwitchBlock'></div></div>"}},Sys.UI.Controls.SwitchButtonColumn.registerClass("Sys.UI.Controls.SwitchButtonColumn",Sys.UI.Controls.CheckBoxColumn),Sys.UI.Controls.SearchEditColumn=function(){Sys.UI.Controls.SearchEditColumn.initializeBase(this),this._interval=500},Sys.UI.Controls.SearchEditColumn.prototype={getControlType:function(){return Sys.UI.Controls.SearchEdit},createFilter:function(){},get_targetGrid:function(){return this._gridId},set_targetGrid:function(t){this._gridId=t},get_webMethodName:function(){return this._webMethodName},set_webMethodName:function(t){this._webMethodName=t},get_interval:function(){return this._interval},set_interval:function(t){this._interval=t},initProps:function(t){t.grid=this.get_targetGrid(),t.webMethodName=this.get_webMethodName(),t.interval=this.get_interval()},add_search:function(t){this.get_events().addHandler("_search",t)},remove_search:function(t){this.get_events().removeHandler("_search",t)},add_selected:function(t){this.get_events().addHandler("_selected",t)},remove_selected:function(t){this.get_events().removeHandler("_selected",t)},_initEditorControl:function(t){Sys.UI.Controls.SearchEditColumn.callBaseMethod(this,"_initEditorControl",[t]),this._control.doFormInit()}},Sys.UI.Controls.SearchEditColumn.registerClass("Sys.UI.Controls.SearchEditColumn",_Z_71),Sys.UI.Controls.ExpandColumn=function(){Sys.UI.Controls.ExpandColumn.initializeBase(this)},Sys.UI.Controls.ExpandColumn.prototype={initialize:function(){this._grid._isTree&&(this.set_dataField(this._grid._expandColumnDataField),this.set_name(this._displayField),this.set_allowMultiExpand(!0)),Sys.UI.Controls.ExpandColumn.callBaseMethod(this,"initialize")},createFilter:function(t,e,i){var n=this.createEdit();n.className="Edit",t.appendChild(n);var o={tabOnEnter:!1,tag:this};i&&(o.text=i.value),Object.copyTo(this._filterProperties,o);var s={enterPress:$createDelegate(e,e.doFilter)},r=$create(this.getControlType(),o,n,s,this._grid.get_form(),!0);return e.addControl(r),r},getControlType:function(){return Sys.UI.Controls.TextEdit},get_allowMultiExpand:function(){return this._allowMultiExpand},set_allowMultiExpand:function(t){this._allowMultiExpand=t},get_expandAll:function(){return this._expandAll},set_expandAll:function(t){this._expandAll=t},get_showHeaderExpand:function(){return this._showHeaderExpand},set_showHeaderExpand:function(t){this._showHeaderExpand=t},get_sortField:function(t){return this._sortField&&t?this._sortField:this._displayField?this._displayField:this._dataField},get_dataTextField:function(){return this._displayField},set_dataTextField:function(t){this._displayField=t},get_readOnly:function(){return this._readOnly||!this._displayField},get_textAlign:function(){return this._displayField?"left":"center"},getIsCommandColumn:function(){return!0},_setCellValue:function(t,e){this._getDataController().doSetCellValueByField(t,this,this.get_sortField(),e)},get_designCaption:function(){return this._designCaption==this._dataField?"":this._designCaption},getHTML:function(t,e,i){var e="",n="",o=this._grid.isEmptyRow(i);this._displayField&&(e=this._getDataController().doGetCellValue(i,this._displayField),null!=(n=this._getDataController().doGetCellValue(i,"__expandLevel"))||o||(n=0,this._getDataController().doSetCellValueByField(i,this,"__expandLevel",0)));var s;if(this._getDisplayTextHandler){var r=new _Z_201(i,e,e);this._getDisplayTextHandler(this,r),e=r.get_text(),s=r._hint}if(-1===t||this._grid._isTree&&Object.isUndefinedOrNull(t))return e?this._getText("",n,e,s):"";if(o)return"";!t||this._grid._rowCreated||this._expandAll||(t=0,this._getDataController().doSetCellValueByField(i,this,this._dataField,t));var l=t?"downArrow":"rightArrow";return this._getText(l,n,e,s)},_getText:function(t,e,i,n){i||(i="");var o=n!==undefined?n:$common.clearHTMLTag(i),s="iconfont "+t+" expand"+e;return i||(s+=" margin0"),"<div class='GridExpandCell' title='"+o+"'><span class='"+s+"'></span>"+i+"</div>"},raiseClick:function(t,e){var i=e.target;if(i.parentNode){"TD"==i.parentNode.parentNode.tagName&&(this._isExpanding||(this._isExpanding=!0,this.expandRow(t)))}},expandRow:function(t){var e=this.getCellValue(t),i=e?0:1,n=this.doChangeHandler(t,i,e);if(n){n.get_valueChanged()&&(i=n.get_value());var o=this._grid;1!=i||e?0==i&&1==e&&o.collapseRow(t):(this.get_allowMultiExpand()||o.setExpandAllRows(!1),o.expandRow(t,n.get_pageUrl(),n.get_pageParams(),n)),this._clearExpandingFlag()}},doChangeHandler:function(t,e,i){var n;this._allEvents&&(n=this._allEvents.change),n||(n=this.get_events().getHandler("_change"));var o=new _Z_195(t,e,i);return n&&n(this,o),o.get_cancel()?(this._clearExpandingFlag(),null):o},_clearExpandingFlag:function(){var t=this;setTimeout(function(){t._isExpanding=!1},300)}},Sys.UI.Controls.ExpandColumn.registerClass("Sys.UI.Controls.ExpandColumn",Sys.UI.Controls.Column),Sys.UI.Controls.HyperLinkColumn=function(){Sys.UI.Controls.HyperLinkColumn.initializeBase(this)},Sys.UI.Controls.HyperLinkColumn.prototype={createFilter:function(){},_setEditorActive:function(){},initialize:function(){Sys.UI.Controls.HyperLinkColumn.callBaseMethod(this,"initialize");var t=this._allEvents;if(t){var e=t.click;e&&this.add_click(e)}},get_dataTextField:function(){return this._dataTextField},set_dataTextField:function(t){this._dataTextField=t},getIsCommandColumn:function(){return!0},getHTML:function(t,e,i){var n=!1;if("string"==typeof e&&(n=e.toLowerCase().startsWith("http")),n){var o=e;return this._dataTextField&&(e=this._getDataController().doGetCellValue(i,this._dataTextField)),'<div class="GridBodyCellText LinkColumn"><a href="'+o+'" target="_blank">'+e+"</a></div>"}return'<div class="GridBodyCellText GridBodyCellLinkText">'+e+"</div>"},doClick:function(t,e){var i=this.get_events().getHandler("_click");i&&i(this)}},Sys.UI.Controls.HyperLinkColumn.registerClass("Sys.UI.Controls.HyperLinkColumn",Sys.UI.Controls.TextColumn),Sys.UI.Controls.MemoColumn=function(){Sys.UI.Controls.MemoColumn.initializeBase(this),this._dropDownWidth=0,this._dropDownHeight=0},Sys.UI.Controls.MemoColumn.prototype={getControlType:function(){return _Z_79},get_dropDownWidth:function(){return this._dropDownWidth},set_dropDownWidth:function(t){this._dropDownWidth=t},get_dropDownHeight:function(){return this._dropDownHeight},set_dropDownHeight:function(t){this._dropDownHeight=t},initProps:function(t){t.dropDownWidth=this.get_dropDownWidth(),t.dropDownHeight=this.get_dropDownHeight()},createFilter:function(t,e,i){var n=this.createEdit();n.className="Edit",t.appendChild(n);var o={tabOnEnter:!1,tag:this};i&&(o.text=i.value),Object.copyTo(this._filterProperties,o);var s={enterPress:$createDelegate(e,e.doFilter)},r=$create(Sys.UI.Controls.TextEdit,o,n,s,this._grid.get_form(),!0);return e.addControl(r),r}},Sys.UI.Controls.MemoColumn.registerClass("Sys.UI.Controls.MemoColumn",Sys.UI.Controls.Column),Sys.UI.Controls.ImageColumn=function(){Sys.UI.Controls.ImageColumn.initializeBase(this),this._useResource=!0,this._preview=$settings.ImageColumnPreivew},Sys.UI.Controls.ImageColumn.prototype={initialize:function(){Sys.UI.Controls.ImageColumn.callBaseMethod(this,"initialize");var t=this._allEvents;if(t){var e=t.click;e&&this.add_click(e)}},getIsCommandColumn:function(){return!0},getCellText:function(t,e){var i=Sys.UI.Controls.ImageColumn.callBaseMethod(this,"getCellText",[t]);if(!e||!i)return i;var n=$common.getHostUrl();return i.startsWith("http")||i.indexOf("data:image")>-1?i:(i=this._useResource?$common.getResourceUrl(i,this):this.get_form().convertUrl(i),n+"/"+i)},getHTML:function(t,e,i){if(this._grid.isEmptyRow(i))return"";var n=this.get_imageUrl();if(t&&(n=t.startsWith("data:image/")||t.startsWith("http")?t:this._useResource?$common.getResourceUrl(t,this):this.get_form().convertUrl(t)),!n)return"";var o=this.get_hint();o&&(o=' title="'+o+'"');var s=this._imageWidth,r=s>0?' width="'+s+'"':"",l=this._imageHeight;return"<image referrerPolicy='no-referrer' src=\""+n+'"'+r+(l>0?' height="'+l+'"':"")+o+' style="cursor:pointer"/>'},get_imageUrl:function(){return this._imageUrl},set_imageUrl:function(t){this._imageUrl=t},get_hoverImageUrl:function(){return this._hoverImageUrl},set_hoverImageUrl:function(t){this._hoverImageUrl=t},get_imageWidth:function(){return this._imageWidth},set_imageWidth:function(t){this._imageWidth=t},get_imageHeight:function(){return this._imageHeight},set_imageHeight:function(t){this._imageHeight=t},get_useResource:function(){return this._useResource},set_useResource:function(t){this._useResource=t},get_preview:function(){return this._preview},set_preview:function(t){this._preview=t},raiseClick:function(t,e){var i=this.get_events().getHandler("_click");if(i&&i(this,e),"click"===this._preview){new Sys.ImageViewer({className:"AbsViewer",autoPlay:!0,srcField:this.get_dataField(),autoTimer:3e3,index:"number"==typeof t?t:0}).showImages(this._grid.get_dataController().save())}},doMouseOver:function(t){var e=t.target;if("IMG"==e.tagName){if(!e.hasEvent){var i=this.get_hoverImageUrl(),n=!1;if(e&&i&&(e.src=i,n=!0),"hover"==this._preview){var o=$skin.joinCssClass("GridPreviewImg",this.get_cssClass()),s="<img src='"+e.src+"' class='"+o+"'></img>";$common.showToolTip({x:t.clientX,offset:20},t.clientY-200,s),n=!0}n&&($common.addMouseLeaveHandler(e,this.doMouseOut,this),e.hasEvent=!0)}}else"hover"==this._preview&&$common.hideToolTip()},doMouseOut:function(t){var e=t.target;delete e.hasEvent,$clearHandlers(e);var i=this.get_hoverImageUrl();e&&i&&(e.src=this.get_imageUrl()),"hover"==this._preview&&$common.hideToolTip()}},Sys.UI.Controls.ImageColumn.registerClass("Sys.UI.Controls.ImageColumn",Sys.UI.Controls.Column),_Z_209=function(t,e,i){_Z_209.initializeBase(this),this._rowIndex=t,this._value=e,this._imageIndex=i},_Z_209.prototype={get_rowIndex:function(){return this._rowIndex},get_value:function(){return this._value},get_imageIndex:function(){return this._imageIndex}},_Z_209.registerClass("_Z_209",Sys.EventArgs),Sys.UI.Controls.ImageListColumn=function(){Sys.UI.Controls.ImageListColumn.initializeBase(this),this._imageWidth=0,this._imageHeight=0},Sys.UI.Controls.ImageListColumn.prototype={initialize:function(){Sys.UI.Controls.ImageListColumn.callBaseMethod(this,"initialize");var t=this._allEvents;if(t){var e=t.click;e&&this.add_click(e)}},createFilter:function(){},getIsCommandColumn:function(){return!0},getHTML:function(t,e,i){if(!t)return"";var n=Array.isInstanceOfType(t)?t:t.split(","),o=this._dataHintField,s=[];if(o){var r=this._getDataController().doGetCellValue(i,o);s=Array.isInstanceOfType(r)?r:r.split(",")}for(var l="<div>",a=this._items,h=this._dataValueField,d=this._dataTextField,_=0,u=n.length;_<u;_++){var t=n[_],c=$craba.getItemTextByValue(a,h,d,t);c&&(l+=this._getImageHTML(c,s[_]))}return l+="</div>"},_getImageHTML:function(t,e){var i=this._imageWidth,n=i>0?' width="'+i+'"':null,o=this._imageHeight;return e=e?' title="'+e+'"':"",'<image src="'+t+'"'+n+(o>0?' height="'+o+'"':null)+e+" />"},get_items:function(){return this._items},set_items:function(t){this._items=t},get_hasItems:function(){var t=this.get_items();return t&&t.length>0},get_dataValueField:function(){return this._dataValueField},set_dataValueField:function(t){this._dataValueField=t},get_dataTextField:function(){return this._dataTextField},set_dataTextField:function(t){this._dataTextField=t},get_dataHintField:function(){return this._dataHintField},set_dataHintField:function(t){this._dataHintField=t},get_imageWidth:function(){return this._imageWidth},set_imageWidth:function(t){this._imageWidth=t},get_imageHeight:function(){return this._imageHeight},set_imageHeight:function(t){this._imageHeight=t},raiseClick:function(t,e){var i=this.get_events().getHandler("_click");if(i){var n=e.target;if("IMG"==n.tagName){var o=n.parentNode,s=Array.indexOf(o.childNodes,n),r=this.get_items()[s][this.get_dataValueField()];i(this,new _Z_209(t,r,s))}}}},Sys.UI.Controls.ImageListColumn.registerClass("Sys.UI.Controls.ImageListColumn",Sys.UI.Controls.TextColumn),Sys.UI.Controls.GraphicColumn=function(){Sys.UI.Controls.GraphicColumn.initializeBase(this),this.textField=null,this.imageField=null},Sys.UI.Controls.GraphicColumn.prototype={createFilter:function(){},get_textField:function(){return this.textField},set_textField:function(t){this.textField=t},get_imageField:function(){return this.imageField},set_imageField:function(t){this.imageField=t},getHTML:function(t,e,i){var n="<div>",o=this.imageField,s="";o&&(s=this._getDataController().doGetCellValue(i,o));var r=this.textField,l="";return r&&(l=this._getDataController().doGetCellValue(i,r)),s&&(n+="<img src='"+s+"'/>"),l&&(n+=l),n+="</div>"}},Sys.UI.Controls.GraphicColumn.registerClass("Sys.UI.Controls.GraphicColumn",Sys.UI.Controls.TextColumn),Sys.UI.Controls.IMStatusColumn=function(){Sys.UI.Controls.IMStatusColumn.initializeBase(this),this._dataHintField=null,this._qqField=this._aliIMField=null},Sys.UI.Controls.IMStatusColumn.prototype={createFilter:function(){},getIsCommandColumn:function(){return!1},getHTML:function(t,e,i){var n=this._dataHintField,o="";n&&(o=this._getDataController().doGetCellValue(i,n));var s="";if(this._qqField){(r=this._getDataController().doGetCellValue(i,this._qqField))&&this._items.QQ&&(s+=this._items.QQ.replace(/{imid}/g,r).replace(/{hint}/g,o))}if(this._aliIMField){var r=this._getDataController().doGetCellValue(i,this._aliIMField);r&&this._items.AliIM&&(s+=this._items.AliIM.replace(/{imid}/g,r).replace(/{hint}/g,o))}return s},get_aliIMField:function(){return this._aliIMField},set_aliIMField:function(t){this._aliIMField=t},get_qqField:function(){return this._qqField},set_qqField:function(t){this._qqField=t},get_dataHintField:function(){return this._dataHintField},set_dataHintField:function(t){this._dataHintField=t},get_items:function(){return this._items},set_items:function(t){this._items=t},get_hasItems:function(){var t=this.get_items();return t&&t.length>0}},Sys.UI.Controls.IMStatusColumn.registerClass("Sys.UI.Controls.IMStatusColumn",Sys.UI.Controls.TextColumn),_Z_48=function(){throw Error.notImplemented()},_Z_48.prototype={_float:0,positiveFloat:1,_int:2,positiveInt:3,text:4,date:5,selector:6},_Z_48.registerEnum("_Z_48"),Sys.UI.Controls.DynamicColumn=function(){Sys.UI.Controls.DynamicColumn.initializeBase(this),this._type=_Z_48.text,this._dataValueField=null,this._numberType=_Z_28._float,this._decimalPrecision=0,this._decimalScale=0,this._decimalDigits=0,this._displayThousandSeperator=!1,this._displayEmptyForZero=!1,this._selectorPage=null,this._selectorWidth=0,this._selectorHeight=0,this._selectorType=null,this._filterChars=null,this._selectOnly=!1,this._allowHandInput=!1,this._shortcut=0},Sys.UI.Controls.DynamicColumn.prototype={getControlType:function(){return this._isNumberType()?Sys.UI.Controls.NumberEdit:this._isDateType()?Sys.UI.Controls.DateEdit:this._isSelectorType()?Sys.UI.Controls.SelectorEdit:Sys.UI.Controls.TextEdit},getIsNumberType:function(){return this._isNumberType()},_isIntType:function(){return this._type==_Z_48._int||this._type==_Z_48.positiveInt},_isFloatType:function(){return this._type==_Z_48._float||this._type==_Z_48.positiveFloat},_isNumberType:function(){return this._type>=_Z_48._float&&this._type<=_Z_48.positiveInt},_isDateType:function(){return this._type==_Z_48.date},_isSelectorType:function(){return this._type==_Z_48.selector},get_type:function(){return this._type},set_type:function(t){this._type!=t&&(this._hasEditor()&&this._hideEditor(),this._disposeControl(),this._type=t)},initProps:function(t){Sys.UI.Controls.DynamicColumn.callBaseMethod(this,"initProps",[t]),this._isNumberType()?(t.numberType=this._type,t.decimalPrecision=this.get_decimalPrecision(),t.decimalScale=this.get_decimalScale()):this._isSelectorType()&&Sys.UI.Controls.SelectorColumn.copyProps(this,t)},_checkNumber:function(t){return isNaN(t)?null:t},formatNumber:function(t){return $common.formatNumber(t,this.get_decimalDigits(),this.get_decimalScale(),this.get_displayThousandSeperator(),this.get_displayEmptyForZero())},getDisplayText:function(t,e){if(this._isFloatType())return this.formatNumber(t);if(t&&"string"==typeof t){return this._parseSelectorValue(t)[1]}return e},_parseSelectorValue:function(t){var e=["",""];if(t){var i=t.split("|");2==i.length?(e[0]=i[0],e[1]=i[1]):e[1]=i[0]}return e},loadEditValue:function(t){var e;if(this._isFloatType())e=this._checkNumber(parseFloat(t));else if(this._isIntType())e=this._checkNumber(parseInt(t));else if(this._isDateType())e=(e=t?Date.strToDate(t):null)||new Date;else if(this._isSelectorType()){var i=this._parseSelectorValue(t);(e=new Object)[this.get_dataValueField()]=i[0],e[this.get_dataTextField()]=i[1]}else e=t;return e},saveEditValue:function(t){return this._isDateType()?Date.dateToStr(t):this._isSelectorType()?t[this.get_dataValueField()]+"|"+t[this.get_dataTextField()]:null!=t?t.toString():""},convertValue:function(t){var e=this.loadEditValue(t);return this.saveEditValue(e)},get_numberType:function(t){return this._numberType},set_numberType:function(t){this._numberType=t},get_decimalPrecision:function(){return this._decimalPrecision},set_decimalPrecision:function(t){this._decimalPrecision=t},get_decimalDigits:function(){return this._decimalDigits},set_decimalDigits:function(t){this._decimalDigits=t},get_decimalScale:function(){return this._decimalScale},set_decimalScale:function(t){this._decimalScale=t},get_displayThousandSeperator:function(){return this._displayThousandSeperator},set_displayThousandSeperator:function(t){this._displayThousandSeperator=t},get_displayEmptyForZero:function(){return this._displayEmptyForZero},set_displayEmptyForZero:function(t){this._displayEmptyForZero=t},get_dataValueField:function(t){return this._dataValueField},set_dataValueField:function(t){this._dataValueField=t},get_dataTextField:function(t){return this.get_displayField()},set_dataTextField:function(t){this.set_displayField(t)},get_selectorPage:function(){return this._selectorPage},set_selectorPage:function(t){this._selectorPage=t},get_selectorWidth:function(){return this._selectorWidth},set_selectorWidth:function(t){this._selectorWidth=t},get_buttonVisible:function(){return this._buttonVisible},set_buttonVisible:function(t){this._buttonVisible=t},get_selectorHeight:function(){return this._selectorHeight},set_selectorHeight:function(t){this._selectorHeight=t},get_selectorType:function(){return this._selectorType},set_selectorType:function(t){if(!t)throw Error.argumentNull("selectorType");this._selectorType=t},get_selectOnly:function(){return this._selectOnly},set_selectOnly:function(t){this._selectOnly=t},get_allowHandInput:function(){return this._allowHandInput},set_allowHandInput:function(t){this._allowHandInput=t},get_shortcut:function(){return this._shortcut},set_shortcut:function(t){this._shortcut=t},get_filterChars:function(){return this._filterChars},set_filterChars:function(t){this._filterChars=t}},Sys.UI.Controls.DynamicColumn.registerClass("Sys.UI.Controls.DynamicColumn",Sys.UI.Controls.Column),_Z_78=function(){_Z_78.initializeBase(this),this._readOnly=!0,this._layoutDirection=Sys.UI.Controls.LayoutDirection.horz},_Z_78.prototype={getIsCommandColumn:function(){return!0},_isRowAllowEditor:function(t){return!1},set_listItems:function(t){this._items=t},get_listItems:function(){return this._items},set_displayNull:function(t){this._displayNull=t},get_displayNull:function(){return this._displayNull},set_layoutDirection:function(t){this._layoutDirection=t},get_layoutDirection:function(){return this._layoutDirection},_rightClick:function(t){this.get_grid()._checkEventInTable(t)&&this.raiseClick(this._grid.get_selectedRowIndex(),t)}},_Z_78.registerClass("_Z_78",Sys.UI.Controls.Column),Sys.UI.Controls.ButtonColumn=function(){Sys.UI.Controls.ButtonColumn.initializeBase(this)},Sys.UI.Controls.ButtonColumn.prototype={getControlType:function(){return Sys.UI.Controls.ButtonEdit},add_buttonClick:function(t,e){return this.get_events().addHandler("buttonClick",t,e)},remove_buttonClick:function(t){this.get_events().removeHandler("buttonClick",t)},getIsCommandColumn:function(){return!1},raiseClick:function(t,e){var i=this.get_events().getHandler("buttonClick");i&&i(this)}},Sys.UI.Controls.ButtonColumn.registerClass("Sys.UI.Controls.ButtonColumn",_Z_78),Sys.UI.Controls.DynamicButtonColumn=function(){Sys.UI.Controls.DynamicButtonColumn.initializeBase(this)},Sys.UI.Controls.DynamicButtonColumn.prototype={get_readOnly:function(){return!0},_initCellHTML:function(t,e,i){return i||!0===this._displayNull?this._getCellHTML(t,e):"&nbsp;"},getHTML:function(t,e,i,n){if(null==e||""==e){var o;if(this._items&&(o=this._items.split(",")),!o||0==o.length)return"";for(var s=[],r=0,l=o.length;r<l;r++){var a=(c=o[r]).split("="),h=a[0],t=a[1],d={};d[h]=t,s.push(d)}o=s}else{if((e=e.toString()).search(/^\[.*\]$/gi)>-1)try{o=$crabaJSON.deserialize(e)}catch(m){}null==o&&(o=[{0:e}])}for(var _=this.get_layoutDirection()==Sys.UI.Controls.LayoutDirection.vert?"_vert":"_horz",u=new Sys.StringBuilder,r=0,l=o.length;r<l;r++){var c=o[r],g=_+" item"+r;for(var h in c){var f=c[h];Object.isUndefinedOrNull(f)||("/t"==f.substring(0,2)?u.append("<span class='"+g+"'>"+f.substring(2)+"</span>"):"<a"==f.substring(0,2)?u.append(f):(u.append("<a href='javascript:void(0);' onclick='return false' _buttonValue='"+h+"' _buttonIndex='"+r+"' class='"+g+"'"),n&&u.append(" style='color:"+n+"'"),u.append(">"+f+"</a>")))}}return _="GridDynamicButtonBody",this._cssClass&&(_+=" "+this._cssClass),"<div class='"+_+"'>"+u.toString()+"</div>"},raiseClick:function(t,e){if(this._allEvents&&this._allEvents.buttonClick&&this.get_enabled()&&this._grid.get_enabled()){var i=e.target;if(!$dom.hasClass(i,"GridBodyCell")&&!$dom.hasClass(i,"GridDynamicButtonBody")){for(;i&&!$dom.hasClass(i.parentNode,"GridDynamicButtonBody");)i=i.parentNode;if(i){var n=e.target;if(("A"!=n.tagName||n==i)&&$craba._checkFastClick(this)){var o=this._grid,s=i.parentNode.parentNode,t=o._getRowIndex(s.parentNode),r=i.getAttribute("_buttonIndex"),l=i.getAttribute("_buttonValue");if(null!=r){var a=i.innerText,h=new _Z_159(t,r,l,a,e);this._allEvents.buttonClick(this,h)}}}}}}},Sys.UI.Controls.DynamicButtonColumn.registerClass("Sys.UI.Controls.DynamicButtonColumn",_Z_78),Sys.UI.Controls.IconColumn=function(){Sys.UI.Controls.IconColumn.initializeBase(this)},Sys.UI.Controls.IconColumn.prototype={get_readOnly:function(){return!0},_initCellHTML:function(t,e,i){return i||!0===this._displayNull?this._getCellHTML(t,e):"&nbsp;"},getHTML:function(t,e,i){var n="";this._grid.getRowEnabled(i)&&this.get_enabled()||(n=" disabled");var o="iconfont";this._cssClass&&(o+=" "+this._cssClass);var s;if(t){if(!(t.indexOf(",")>-1||t.indexOf("=")>-1))return"<div class='"+(o+=" "+t+n)+"' index='0'></div>";s=t.split(",")}else this._items&&(s=this._items.split(","));if(!s||0==s.length)return"";for(var r="<div class='CellIcons "+o+n+"'>",l=0,a=s.length;l<a;l++){var h=s[l].split("="),d=h[1],_=h[0];d.indexOf("disabled")>-1&&(!0,_=""),r+="<div class='"+(d+=" index"+l)+"' title='"+_+"' index='"+l+"'></div>"}return r+="</div>"},raiseClick:function(t,e){if(this.get_enabled()&&this._grid.get_enabled()){var i=e.target,n=i.getAttribute("index");if(n&&!$dom.hasClass(i,"disabled")){var o=$common.getFirstParentByTagName(i,"tr");if(!((t=this._grid._getRowIndex(o))<0)){var s=this._allEvents;if(s){var r=s.click;if(r){var l=i.title||i._title,a=parseInt(n),h=new _Z_159(t,a,l,l,e);Object.copyTo({buttonIndex:a,title:l,rowIndex:t},h),r(this,h)}}}}}}},Sys.UI.Controls.IconColumn.registerClass("Sys.UI.Controls.IconColumn",_Z_78),Sys.UI.Controls.CheckBoxListColumn=function(){Sys.UI.Controls.CheckBoxListColumn.initializeBase(this),this._readOnly=!1,this._dataValueField="id",this._dataTextField="text",this._showHeaderCheckBox=$settings.GridMultiSelectColumnDefaultShowHeaderCheckBox},Sys.UI.Controls.CheckBoxListColumn.prototype={initialize:function(){Sys.UI.Controls.CheckBoxListColumn.callBaseMethod(this,"initialize"),this._changeHandler=this._internalGetChangeHandler(),this._initList()},_initList:function(){if(this._items&&!this._listItems){this._listItems=[];for(var t=this._items.split(","),e=0,i=t.length;e<i;e++){var n=t[e].split("="),o={};o[this._dataValueField]=n[0],o[this._dataTextField]=n[1],this._listItems.push(o)}}},get_showHeaderCheckBox:function(){return this._showHeaderCheckBox},set_showHeaderCheckBox:function(t){this._showHeaderCheckBox=t},doInitHeaderElements:function(t){this.get_readOnly()?Sys.UI.Controls.CheckBoxListColumn.callBaseMethod(this,"doInitHeaderElements",[t]):$_multiColumn._createHeaderCheckBox(this,t)},_checkBoxClick:function(t){var e=$_multiColumn._getCheckBoxElement(this);if(e){e._indeterminate?(e.checked=!0,e._indeterminate=!1,$common._changeCheckedHalfStyle(e.parentNode,!0,!1)):$common._changeCheckedHalfStyle(e.parentNode,e.checked,!1);var i=e.checked,n=this._elements.checkBoxElement;n!=e&&(n.checked=i,$common._changeCheckedHalfStyle(n.parentNode,i,!1)),this.setChecked(i)}},_refreshCaption:function(t){$_multiColumn._refreshCaption(this,t)},getIsCommandColumn:function(){return!0},getHTML:function(t,e,i){if(this._grid.isEmptyRow(i))return"";var n=this._getItems(i);if(!n||0==n.length)return"";var o="",s="";this._grid.getRowEnabled(i)&&this.get_enabled()&&!this.get_readOnly()||(o=" disabled",s+=" disabled");var r="";this._cssClass&&(r+=" "+this._cssClass);for(var l="<div class='CellChk "+r+o+"'>",a=0,h=n.length;a<h;a++){var d=n[a],_=d[this._dataValueField],e=d[this._dataTextField],u=this.get_id()+"_"+i+"_"+_,c="ChkBoxStyle",g=s;this._checkValue(_,t)&&(c+=" checked",g+=" checked"),l+="<div class='"+c+"'><input type='checkbox' _id='"+_+"' id='"+u+"' "+g+"/><label for='"+u+"'>"+e+"</label></div>"}return l+="</div>"},_checkValue:function(t,e){if(!e)return!1;return(","+e+",").indexOf(","+t+",")>-1},raiseClick:function(t,e){if(this.get_enabled()&&!this.get_readOnly()&&this._grid.get_enabled()){var i=this;asyncCall(function(){i._click(t,e)})}},_click:function(t,e){if(!this.get_isDisposed()){var i=e.target;"LABEL"==i.tagName&&(i=$common.getPreviousSibling(i));var n=null;if("INPUT"==i.tagName&&(n=i),n){t=$common.getFirstParentByTagName(n,"tr").getAttribute("_rowIndex");t=parseInt(t);var o=this.getCellValue(t),s=this._getRealValue(t,n);this._setCellValue(t,s),$common._changeCheckedStyle(n.parentNode,n.checked),this._raiseChangeByRowIndex(null,t,s,o)}}},_getRealValue:function(t,e){for(var i=$common.getFirstParentByClassName(e,"CellChk").childNodes,n="",o=0,s=i.length;o<s;o++){var r=i[o].firstChild;r.checked&&(n.length>0&&(n+=","),n+=r.getAttribute("_id"))}return n},_getItems:function(t){var e=null;return this._listItems?e=this._listItems:this._dataSourceField&&(e=this._getDataController().doGetCellValue(t,this._dataSourceField)),e},getRowText:function(t){var e=this.getRowValue(t),i=this._getItems(t);if(!i)return"";for(var n="",o=0,s=i.length;o<s;o++){var r=i[o],l=r[this._dataValueField],a=r[this._dataTextField];this._checkValue(l,e)&&(n.length>0&&(n+=","),n+=a)}return n},getRowValue:function(t){return this._getDataController().doGetCellValue(t,this._dataField)},setRowChecked:function(t,e){var i=this._getItems(t);if(i){var n="";if(e)for(var o=0,s=i.length;o<s;o++){var r=i[o];o>0&&(n+=","),n+=r[this._dataValueField]}this._grid.modifyCellValue(t,this,n)}},setChecked:function(t){for(var e=this._grid.get_recordCount(),i=0;i<e;i++)this.setRowChecked(i,t)},set_dataValueField:function(t){this._dataValueField=t},set_dataTextField:function(t){this._dataTextField=t},set_dataSourceField:function(t){this._dataSourceField=t},get_dataValueField:function(){return this._dataValueField},get_dataTextField:function(){return this._dataTextField},get_dataSourceField:function(){return this._dataSourceField}},Sys.UI.Controls.CheckBoxListColumn.registerClass("Sys.UI.Controls.CheckBoxListColumn",_Z_78),Sys.UI.Controls.RowDeleteColumn=function(){Sys.UI.Controls.RowDeleteColumn.initializeBase(this),this._allowFilter=!1,this._displayNull=!0,this._readOnly=!0,this._normalHtml=$common.getGlyphDivHTML("delShape",0)},Sys.UI.Controls.RowDeleteColumn.prototype={set_readOnly:function(t){this.get_isInitialized()&&this._refreshRowHTML()},set_enabled:function(t){Sys.UI.Controls.RowDeleteColumn.callBaseMethod(this,"set_enabled",[t]),this.get_isInitialized()&&this._refreshRowHTML()},getIsCommandColumn:function(){return!0},get_allowSort:function(){return!1},get_allowResize:function(){return!1},get_displayNull:function(){return this._displayNull},set_displayNull:function(t){this._displayNull=t},_noClick:function(t){return!this._displayNull&&this._grid.isEmptyRow(t)||this._grid.get_readOnly()},getHTML:function(t,e,i){return this._noClick(i)?"":this._normalHtml},doInit:function(t,e){var i=this._grid,n=this.get_index(),o=i._getRowCell(t,n);o&&Sys.UI.Controls.RowDeleteColumn.callBaseMethod(this,"initCellHTML",[e,o])},raiseClick:function(t,e){if(!this._noClick(t)&&$dom.hasClass(e.target,"delShape")){var i=new _Z_162,n=this._allEvents;n&&n.click&&n.click(this,i),i.get_cancel()||this._grid._internalCheckDeleteRow(t)}}},Sys.UI.Controls.RowDeleteColumn.registerClass("Sys.UI.Controls.RowDeleteColumn",Sys.UI.Controls.Column),Sys.UI.Controls.ProgressColumn=function(){Sys.UI.Controls.ProgressColumn.initializeBase(this),this._maxValue=100},Sys.UI.Controls.ProgressColumn.prototype={get_readOnly:function(){return!0},_setEditorActive:function(){},_getPercentValue:function(t,e){t=Math.roundTo(100*t/this._maxValue,2);return e?Math.min(100,t):t},_initCellHTML:function(t,e,i){return i||!0===this._displayNull?this._getCellHTML(t,e):"&nbsp;"},getHTML:function(t,e,i){var n="ProgressBar radius14";this._cssClass&&(n+=" "+this._cssClass);var o='<div class="'+n+'">';return o+='<div class="ProgressValue transition2" style="width:'+(this._getPercentValue(e,!0)+"%")+';"></div>',o+='<span class="ProgressText">'+(e=this._getPercentValue(e)+"%")+"</span></div>"}},Sys.UI.Controls.ProgressColumn.registerClass("Sys.UI.Controls.ProgressColumn",Sys.UI.Controls.Column),Type.registerNamespace("Craba.Web.Script"),Craba.Web.Script.DataService=function(t){Craba.Web.Script.DataService.initializeBase(this,[t])},Craba.Web.Script.DataService.prototype={GetPagerData:function(t,e,i,n,o,s,r,l,a){var h=this._getData(t,e,i,n,o,s);return this._invokeBindData("GetPagerData",h,r,l,a)},GetPartialPagerData:function(t,e,i,n,o,s,r,l,a){var h=this._getData(t,e,i,n,o,s);return this._invokeBindData("GetPartialPagerData",h,r,l,a)},SetQueryState:function(t,e,i,n,o,s,r,l,a,h){var d={pagerId:t,state:e,queryParams:i,getData:n,first:o,count:s,filter:null};return this._invokeBindData("SetQueryState",d,l,a,h)},GetPagerSummary:function(t,e,i,n){return this._invokeBindData("GetPagerSummary",{pagerId:t},e,i,n)},GetRealPagerSize:function(t,e,i,n){return this._invokeBindData("GetRealPagerSize",{pagerId:t},e,i,n)},GetPagerPreloadItems:function(t,e,i,n,o){return this._invokeBindData("GetPagerPreloadItems",{pagerId:t,fields:e},i,n,o)},SaveGridConfig:function(t,e,i,n,o){return this._invokeBindData("SaveGridConfig",{gridId:t,data:e},i,n,o)}},Craba.Web.Script.DataService.registerClass("Craba.Web.Script.DataService",Craba.Web.Script.PagerDataService),Craba.Web.Script.DataService.create=function(t,e){var i=new Craba.Web.Script.DataService(e);return i.set_enableShowWaiting(!1),i.set_form(t),i},Sys.UI.Controls.Pager=function(t){Sys.UI.Controls.Pager.initializeBase(this,[t]),this._showItemCount=!0,this._autoFocus=!0,this._showGotoButton=$settings.GridPagerDefaultShowGotoButton,this._showRefreshButton=$settings.GridPagerDefaultShowRefreshButton,this._pageItemCountData={}},Sys.UI.Controls.Pager.prototype={initialize:function(){Sys.UI.Controls.Pager.callBaseMethod(this,"initialize"),this._getTargetControl()&&this._getTargetControl().get_bindPagerDataSource()&&this.set_hasDataSource(!0),this._service=Craba.Web.Script.DataService.create(this.get_form(),this),this._selectedRowIndex=-1,this._hasDataSource&&this.get_form().addRemoveSessionControls(this)},dispose:function(){this._service&&(this._service._pager=null,this._service=null),this._refreshButton&&$clearHandlers(this._refreshButton),this._scrollBar&&(this._scrollBar.dispose(),this._scrollBar=null),this._summary=null,this._target=null,this._gotoNumberEdit&&(this._gotoNumberEdit.dispose(),this._gotoNumberEdit=null),this._dataSource=null,Sys.UI.Controls.Pager.callBaseMethod(this,"dispose")},doFormInit:function(){var t=this._spring=$common.createClassDiv("Flex1");this.get_element().appendChild(t);var e=this._getTargetControl();e||(this._hasDataSource=!0);var i=e&&e.get_lazyPageItem&&e.get_lazyPageItem()&&this._hasDataSource,n="PagerContent";i&&(n+=" LazyPager");var o=this._contentBlock=$common.createClassDiv(n);this.get_element().appendChild(o),this._createSummary(o),this._createPageSizeEditButton(o),e&&e.get_dropDownNumericButton()?this._initDropPager(o,i):this._initPager(o,i),this._initNavButtons(),i?this.refreshRealPageSize():this._initSummary();var s=this.get_follow(),r=s?this.get_form()[s]:null;r&&(this.followControl=r,r.set_followPager(this)),this._dataChanged(),this._initInnerBlock(),this._formInit=!0},doFormLoaded:function(){this.bindScrollBar()},bindScrollBar:function(){if(!this._scrollBar&&Sys.Browser.isIE){var t=this.get_element();t.scrollWidth-t.offsetWidth<2||(this._scrollBar=_Z_81.create(t,t.parentNode),this._scrollBar.set_xbarOnly(!0),this._scrollBar.set_xbarClass("PagerXBar"),this._scrollBar._showBar())}},_initDropPager:function(t,e){this._createRefreshButton(t),this._homePageButton=this._createPageButtonByClass(t,"homePage",this._homePage,"首页"),this._prevPageButton=this._createPageButtonByClass(t,"prevPage",this._prevPage,"上一页"),this._createPageDrpEdit(t),e||this._createNumericButtons(),this._nextPageButton=this._createPageButtonByClass(t,"nextPage",this._nextPage,"下一页"),this._lastPageButton=this._createPageButtonByClass(t,"lastPage",this._lastPage,"尾页")},_initPager:function(t,e){this._homePageButton=this._createPageButtonByClass(t,"homePage",this._homePage,"首页"),this._prevPageButton=this._createPageButtonByClass(t,"prevPage",this._prevPage);var i=this._pagesCell=$common.createClassDiv("PagerButtons");t.appendChild(i),$common.addClickHandler(i,this._onPageButtonClick,this),e||this._createNumericButtons(),this._nextPageButton=this._createPageButtonByClass(t,"nextPage",this._nextPage),this._lastPageButton=this._createPageButtonByClass(t,"lastPage",this._lastPage,"尾页"),this._createRefreshButton(t),this._createGotoEditButton(t)},_createRefreshButton:function(t){this.get_showRefreshButton()&&this.get_target()&&(this._refreshButton=this._createPageButtonByClass(t,"refresh",this._refreshPage,"刷新"))},_initInnerBlock:function(){var t=this._getTargetControl(),e=t&&t.get_pagerInnerBlockID?t.get_pagerInnerBlockID():"";if(e){var i=this.get_form()[e];if(i){var n=i.get_element();this.get_element().insertBefore(n,this._spring),n.removeAttribute("style")}else $common.showError("Grid找不到PagerInnerBockID="+e+"的控件.")}},get_height:function(){return this.get_element().offsetHeight},refreshPageSize:function(){var t=this._getTargetControl(),e=t.getRowHeight(),i=t._body.clientHeight,n=this.get_pageSize(),o=parseInt(i/e);if(o!=n){this.set_pageSize(o);var s=0,r=t.get_selectedRowIndex(),l=this.get_pageIndex()*n+1+r;s=parseInt(l/o),this._selectedRowIndex=l-s*o-1,this.gotoPage(s)}},get_isRefresh:function(){return this._selectedRowIndex>-1},set_selectedRowIndex:function(t){this._selectedRowIndex=t},get_follow:function(){return this._follow},set_follow:function(t){this._follow=t},get_service:function(){return this._service},get_hasDataSource:function(){return this._hasDataSource},set_hasDataSource:function(t){this._hasDataSource=t},_getTargetControl:function(){var t=this.get_target();return t?this.get_form()[t]:null},_dataChanged:function(){var t=this.get_itemList();if(t){var e=this._getTargetControl();e&&(e._isRefresh=!0,e.refresh(t),this.savePageItemCount())}},_doGotoPageButonClick:function(t){var e=this._gotoNumberEdit.get_value();null!=e?(e!=this.get_pageIndex()+1&&(e<1||e>this.get_pageCount()?$common.showError("输入的页数超出了范围！"):this._gotoPageOnClick(e-1)),this._gotoNumberEdit.focus()):$common.showHint("请输入要跳转的页码",this._gotoNumberEdit)},_doGotoEditEnterPress:function(t){this._doGotoPageButonClick(t)},_checkSetGotoEditButtonVisible:function(){if(this._gotoNumberEdit){var t=this.get_pageCount(),e=t>this.get_numericButtonCount()||this.get_showGotoButton();e=e&&!this._showAll&&t>1,$dom.setVisible(this._gotoBlock,e,"flex")}},_createGotoEditButton:function(t){var e=this._gotoBlock=$common.createClassDiv("GotoBlock");t.appendChild(e);s=$common.createSpan();s.innerText=$settings.GotoPageButtonText||"跳转",e.appendChild(s);var i=$common.createInput();i.className="Edit GotoEdit",e.appendChild(i);var n=this.get_form(),o=$create(Sys.UI.Controls.NumberEdit,{showCalculator:!1},i,null,n,!0);o.set_tabOnEnter(!1),o.set_numberType(_Z_28.positiveInt),o.add_enterPress($createDelegate(this,this._doGotoPageButonClick)),this._gotoNumberEdit=o;var s;(s=$common.createSpan()).innerText="页",e.appendChild(s),this._checkSetGotoEditButtonVisible()},get_showItemCount:function(t){return this._showItemCount},set_showItemCount:function(t){return this._showItemCount=t},get_showGotoButton:function(){return this._showGotoButton},set_showGotoButton:function(t){this._showGotoButton=t},get_showRefreshButton:function(){return this._showRefreshButton},set_showRefreshButton:function(t){this._showRefreshButton=t},get_showAll:function(){return this._showAll},set_showAll:function(t,e){this._showAll=t,this.get_isInitialized()&&!e&&this.refresh()},get_summaryLabel:function(){return this._summaryLabel},set_summaryLabel:function(t){this._summaryLabel=t,this.get_isInitialized()&&this._initSummary()},_initSummary:function(){if(this._summary){var t=this.get_pageCount(),e=this.get_showItemCount()?String.format("({0}条记录)",this.get_itemCount()):"",i=this.get_summaryLabel();i=i?i+" ":"";var n=this.get_showAll()||!this._gotoBlock||0==t?"":String.format("第 {0}/{1} 页",Math.min(this.get_pageIndex()+1,t),t);n&&e&&(e=" "+e),this._summary.innerHTML=i+n+e}},_initNavButtons:function(){if(this._formInit){var t=this.get_pageIndex(),e=this.get_pageCount(),i=this.get_itemCount(),n=t>0,o=t<e-1,s=this._hasDataSource,r=e>0&&s;if($dom.setEnabled(this._prevPageButton,n),$dom.setEnabled(this._nextPageButton,o),this._pageSizeEdit){var l=i>1&&!this._showAll;$dom.setVisible(this._pageSizeSpan,r&&l),this._pageSizeEdit.set_visible(r&&l)}r=e>1&&s,this._pageDrpEdit&&($dom.setVisible(this._pageTextF,r),$dom.setVisible(this._pageTextS,r),this._pageDrpEdit.set_visible(r)),this._pagesCell&&$dom.setVisible(this._pagesCell,r);var a=!this._showAll&&e>1&&s;$dom.setVisible(this._prevPageButton,a),$dom.setVisible(this._nextPageButton,a),this._homePageButton&&($dom.setVisible(this._homePageButton,a),$dom.setVisible(this._lastPageButton,a),$dom.setEnabled(this._homePageButton,n),$dom.setEnabled(this._lastPageButton,o))}},get_hasSummary:function(){return this._hasSummary},set_hasSummary:function(t){this._hasSummary=t},get_autoFocus:function(){return this._autoFocus},set_autoFocus:function(t){this._autoFocus=t},get_itemList:function(){return this._itemList},set_itemList:function(t){this._itemList=t},incItemCount:function(){return this.set_itemCount(this._itemCount+1),this._initSummary(),this._itemCount},decItemCount:function(){if(0!=this._itemCount)return this._itemCount--,this._initSummary(),0==this._itemCount&&this._clearNumericButtons(),this._refreshSummary(),this._itemCount},get_pageCount:function(){return this._hasDataSource?this.get_showAll()?this._itemCount>0?1:0:Math.ceil(this._itemCount/this._pageSize):1},get_pageItemIndex:function(){return this.get_pageIndex()*this.get_pageSize()},get_dynamicPageItemIndex:function(){var t=0,e=this._pageItemCountData;for(var i in e){parseInt(i.replace("index_",""))>=this.get_pageIndex()||(t+=e[i])}return t},savePageItemCount:function(){var t=this._getTargetControl();if(t._isTree){var e=t.get_dataSource();if(e){this._pageItemCountData["index_"+this.get_pageIndex()]=e.length}}},get_isFirstPage:function(){return 0==this.get_pageIndex()},get_isLastPage:function(){var t=this.get_pageCount();return 0==t||this.get_pageIndex()==t-1},firstPage:function(t){this.get_isFirstPage()||this.gotoPage(0,t)},lastPage:function(t){if(this.get_isLastPage())t&&t();else{var e=this.get_pageCount();this.gotoPage(e>0?e-1:0,t)}},prevPage:function(t){this.get_isFirstPage()||this.gotoPage(this.get_pageIndex()-1,t)},nextPage:function(t){this.get_isLastPage()||this.gotoPage(this.get_pageIndex()+1,t)},gotoPage:function(t,e){this._loadPage(t,null,null,this._savedFilter,null,e)},refresh:function(t,e){this._getTargetControl();this._savedFilter=null,t=this._beforeRefresh(t),this._doRefresh(t,null,null,null,e)},filter:function(t,e){this._hasSummaryLoaded=!1,this._doPagerBeforeRefresh(),this._savedFilter=t,this._doRefresh(null,null,t,null,e)},refreshFilter:function(t,e){var i=this.getLastFilter();t=this._beforeRefresh(t),this._doRefresh(t,null,i,null,e)},getLastFilter:function(){var t=this._lastFilter,e=this._getTargetControl();return e&&e._filterBar&&(t=this._lastFilter=e._filterBar.getFilter()),t},getLastSort:function(){return this._lastOrders||null},refreshPage:function(t,e,i,n){Object.isUndefinedOrNull(e)&&(e=this.get_pageIndex()),this._savedFilter=null,t=this._beforeRefresh(t),this._loadPage(e,t,null,n,null,i)},refreshPageRowIndex:function(t,e,i,n){var o=this._getTargetControl();if(o){if(o.get_isDisposed())return;this.set_selectedRowIndex(Object.isUndefinedOrNull(i)?o.get_selectedRowIndex():i)}this.refreshPage(t,e,n)},refreshPageWithLastFilter:function(t,e,i){Object.isUndefinedOrNull(e)&&(e=this.get_pageIndex()),t=this._beforeRefresh(t);var n=this._getTargetControl(),o=n?n._lastFilter:null,s=null;o&&(s={items:[o],append:!1}),this._loadPage(e,t,null,s,null,i)},reloadPage:function(t,e){Object.isUndefinedOrNull(t)&&(t=this.get_pageIndex()),this._doPagerBeforeRefresh(),this.gotoPage(t,e)},partialRefresh:function(t,e){var i=this._getTargetControl();if(i){var n=i.get_primaryKey();$common.checkTips(0==t.length,"部分刷新items参数长度必须大于0"),$common.checkTips(!n,"Grid必须配置PrimaryKey属性"),this._savedPartRefreash(e);var o=this.get_pageIndex(),s={};s[n]=t,this._loadPage(o,s,null,null,null,this.__partSuccessHandler,!0)}},_savedPartRefreash:function(t){this.__onPartSuccess=t,this.__initPartHandler||(this.__partSuccessHandler=$createDelegate(this,this._loadedPartSuccess),this.__initPartHandler=!0)},_loadedPartSuccess:function(t){if(t){var e,i=-1,n=this._getTargetControl(),o=n.get_primaryKey(),s=!1,r=t.fields;if(t.length==undefined){e=t.rows;for(var l=0,a=r.length;l<a;l++)if(r[l]==o){i=l;break}if(-1==i)return $common.showError("请确认返回的数据集字段有对应的primaryKey值");s=!0}else e=t,i=o;if(e&&0!=e.length){var h=!1,d=-1,_=n._dataSource;n._isBatch=!0;for(var u=0,c=e.length;u<c;u++){var g=e[u];if(-1!=(d=this._getKeyRowIndex(o,g[i],_,d))){h=!0;var f={};if(s)for(var m=0,C=r.length;m<C;m++)f[r[m]]=g[m];else f=g;n.modifyRowData(d,f),this.__onPartSuccess&&this.__onPartSuccess(f,d)}else d=-1}delete n._isBatch,h&&n._endBatch(null,"batchModify")}}},_getKeyRowIndex:function(t,e,i,n){for(var o=n+1,s=i.length;o<s;o++){if((r=i[o])[t]==e)return o}for(o=0;o<=n;o++){var r=i[o];if(r[t]==e)return o}return-1},_doRefresh:function(t,e,i,n,o){this._loadPage(0,t,e,i,n,o)},_internalRefreshSort:function(t){this._doPagerBeforeRefresh(),this._lastOrders=t,this._doRefresh(null,t,null,null,null)},_internalRefreshFilter:function(t,e){this._hasSummaryLoaded=!1,this._doPagerBeforeRefresh(),this._savedFilter=t,this._lastFilter=t,this._doRefresh(null,null,t,null,e)},_internalRefreshState:function(t){this._hasSummaryLoaded=!1,this._doRefresh(null,null,null,t,null)},add_pageIndexChanged:function(t){this.get_events().addHandler("pageIndexChanged",t)},remove_pageIndexChanged:function(t){this.get_events().removeHandler("pageIndexChanged",t)},_doPageIndexChanged:function(t){this._pageIndex=t,this._initNavButtons(),this._initNumericButtons();var e=this.get_events().getHandler("pageIndexChanged");e&&e(this)},_getDataItemCount:function(t){return t&&t.dataType&&1==t.dataType?t.rows.length:t.length},get_isLoading:function(){return this._loading},set_serviceOwner:function(t){this._serviceOwner=t},_loadPage:function(t,e,i,n,o,s,r){if(!this._loading&&(this._hasDataSource||this._showAll)){var l=this.get_form();if(l&&!l.get_isDisposed()){var a=this._getTargetControl();if(a)if(a._internalDoPagerPageBeforeChanged(t)){this._beginLoading(a),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null);var h=this.get_id(),d=this.get_showAll()?-1:this.get_pageSize(),_=t*d;this._savedRefreshDatas(t,e,i,n,o,d,s,r);var u=this._dataSource;if(!u){var c=this._initService();return r?void c.GetPartialPagerData(h,e,i,n,_,d,this.__successHandler,this.__faildHandler):o?void c.SetQueryState(h,o,e,!0,_,d,null,this.__successHandler,this.__faildHandler):void c.GetPagerData(h,e,i,n,_,d,this.__successHandler,this.__faildHandler)}for(var g=u.length,f=Math.min(d,g-_),m=[],C=0,v=_;C<f;C++,v++)m[C]=u[v];var p={};p.itemCount=g,p.itemList=m,this.__successHandler(p)}else this._loading=!1;else this._doPageIndexChanged(t)}}},_initService:function(){var t=this._service,e=this.get_form().get_pageTimeout();return e>0&&0==t.get_timeout()&&t.set_timeout(e),this._serviceOwner&&t.set_owner(this._serviceOwner),t},_savedRefreshDatas:function(t,e,i,n,o,s,r,l){this._pageIndex=t,this.__params=e,this.__orders=i,this.__filter=n,this.__state=o,this.__onSuccess=r,this.__partial=l,this.__count=s,this.__initHandler||(this.__successHandler=$createDelegate(this,this._dataSuccessd),this.__faildHandler=$createDelegate(this,this._dataFailed),this.__reloadHandler=$createDelegate(this,this._reloadPage),this.__initHandler=!0)},_dataSuccessd:function(t){if(!this.get_isDisposed()){var e=this._pageIndex,i=this.__onSuccess,n=this.__partial,o=this.__count;if(n)return i(t.itemList),void this.endLoading();var s=i?function(t){this._dataLoaded(t),i()}:this._dataLoaded;if(0==this._getDataItemCount(t.itemList)&&e>0){for(var r=e;e*o>=t.itemCount&&e>0;e--);if(this.endLoading(),e<1||r==e){if(this._pageLoaded)return void $common.alert("服务端数据源已发生改变，请刷新或重新查询！");this._pageLoaded=!0}this._pageIndex=e,asyncCall(this.__reloadHandler)}else this._pageLoaded=!1,$createDelegate(this,s)(t)}},_dataLoaded:function(t){if(this.get_isDisposed())this.endLoading();else{var e=null;try{this.set_itemCount(t.itemCount),this.set_itemList(t.itemList),t.pageIndex&&!isNaN(parseInt(t.pageIndex))&&this.get_pageCount()>t.pageIndex&&(this._pageIndex=t.pageIndex),delete t.itemList;var i=this._getTargetControl();if(i){var n=t.columnExpands;n&&(i._cancelRowChangeHandler=!0,i.refresh(null),i._cancelRowChangeHandler=!1,i.set_columnExpands(n),delete t.columnExpands);var o=t.cellMergeItems;o&&(i.set_cellMergeItems(o),delete t.cellMergeItems),i.set_sizeInfoListCache&&t.sizeInfoList&&(i.set_sizeInfoListCache(t.sizeInfoList),delete t.sizeInfoList)}this._initSummary(),this._initNavButtons(),this._beforeRefreshGrid(),this._dataChanged(),this._checkSetGotoEditButtonVisible(),this._initNumericButtons(),this._checkSelectedRowIndex(),this._refreshSummary(),this.get_autoFocus()&&i&&i.focus&&i==i.get_form().get_focusedControl()&&(i.canFocus&&!i.canFocus()||i.focus(!0))}catch(s){e=s}if(this.endLoading(),$common.setTestState("pagerDataLoaded"),e)throw e}},_refreshSummary:function(){!this._hasSummary||!$settings.GspxResolveCache&&this._hasSummaryLoaded||this.refreshSummary()},_reloadPage:function(){this._doPagerBeforeRefresh(),this._loadPage(this._pageIndex,this.__params,this.__orders,this.__filter,this.__state,this.__onSuccess)},get_preloadItemFields:function(){return this._preloadItemFields},set_preloadItemFields:function(t){this._preloadItemFields=t},_internalGetPreloadItems:function(){var t=this.get_preloadItemFields();if(!t)throw Error.invalidOperation("Pager 没有调用 set_preloadItemFields 指定预加载字段表");var e=this.get_id();window.status="正在加载数据 ...";var i=this._service.GetPagerPreloadItems(e,t,!1);return window.status="",i},get_dataSource:function(){return this._dataSource},dataBind:function(t){void 0!==t&&(this._dataSource=t,t?this.refresh():this.init(0))},deleteRecord:function(t){var e=this._dataSource;e&&Array.removeAt(e,t)},_beforeRefreshGrid:function(){var t=this._getTargetControl();!t||this._selectedRowIndex<0||(t.oldDefaultShowEditor=t.get_defaultShowEditor(),t.set_defaultShowEditor(!1))},_checkSelectedRowIndex:function(){var t=this._getTargetControl();if(t&&this._selectedRowIndex>-1){this._selectedRowIndex>=t.get_rowCount()&&(this._selectedRowIndex=0);var e=this,i=this.get_autoFocus();this.set_autoFocus(!1),t.set_defaultShowEditor(t.oldDefaultShowEditor),asyncCall(function(){t.set_selectedRowIndex(e._selectedRowIndex),e._selectedRowIndex=-1,e.set_autoFocus(i)})}},init:function(t){if(!(t>=0))throw Error.argumentOutOfRange("itemCount",t);this.set_itemCount(t),this._initSummary(),this._initNavButtons(),this._checkSetGotoEditButtonVisible(),this._initNumericButtons()},refreshSummary:function(){var t=this._getTargetControl();if(!t._hasSummaryColumn||t._needSummary){var e=this.get_id();this._hasSummaryLoaded=!0,this._service.GetPagerSummary(e,$createDelegate(this,this._summaryLoaded),$createDelegate(this,this._summaryFailed))}},_summaryLoaded:function(t){var e=this._getTargetControl();e&&e.set_summaryItems(t)},_summaryFailed:function(t){var e=this._getTargetControl();if(e){var i=e.get_form(),n="<p>取合计失败："+t.get_message()+"</p><p style='display:none'>"+this.get_id()+"</p>";$app.showError(Sys.ErrorType.other,n,!1,i)}},refreshRealPageSize:function(){this._summary.innerHTML="页数正在加载，请稍等……";var t=this.get_id();this._clearNumericButtons(),this._service.GetRealPagerSize(t,$createDelegate(this,this._pageSizeLoaded),$createDelegate(this,this._pageSizeFailed))},_pageSizeLoaded:function(t){this._getTargetControl()&&(this._clearLazyPager(),this.set_itemCount(t),this._initSummary(),this._createNumericButtons(),this._initNavButtons(),this.bindScrollBar())},_pageSizeFailed:function(t){this._getTargetControl()&&(this._clearLazyPager(),$common.alert("取真实行数失败："+t.get_message()))},_clearLazyPager:function(){this._contentBlock&&$dom.removeCssClass(this._contentBlock,"LazyPager")}},Sys.UI.Controls.Pager.registerClass("Sys.UI.Controls.Pager",_Z_83),_Z_105=function(){_Z_105.initializeBase(this),this._mouseDownHandler=$createDelegate(this,this._doMouseDown),this._mouseMoveHandler=$createDelegate(this,this._drag),this._mouseUpHandler=$createDelegate(this,this._doMouseUp),this._keyPressHandler=$createDelegate(this,this._doKeyPress),this._mouseDblClickHandler=$createDelegate(this,this._doDblClick),this._draging=!1},_Z_105.prototype={initialize:function(){_Z_105.callBaseMethod(this,"initialize");var t=this._sizeGripper=this._createDiv("ColResizer");document.body.appendChild(t),$common.addMouseDownHandler(t,this._mouseDownHandler),$common.addDblClickHandler(t,this._mouseDblClickHandler),$common.addContextMenuHandler(t,this._doResizerContext,this)},_createDiv:function(t){var e=$common.createClassDiv(t);return Sys.Browser.isIE&&(e.unselectable="on"),e},_getZIndex:function(t){var e=Sys.Application.getLastPopup();if(e&&e.popupAt)return e.get_zIndex()+t;var i=this._column._grid.get_rootForm(!0);return i?i.get_zIndex()+t:this._column.get_form().get_zIndex()+t},_doResizerContext:function(t){t.cancel()},dispose:function(){var t=this._sizeGripper;t&&($clearHandlers(t),$removeNode(t),this._sizeGripper=null),this._sizeSplitter&&($removeNode(this._sizeSplitter),this._sizeSplitter=null),this._mouseDownHandler=null,this._column=null,_Z_105.callBaseMethod(this,"dispose")},initSizeGripper:function(t){this._column=t;var e=this._sizeGripper;e&&(e.style.zIndex=this._getZIndex(2),this._initSizeGripperPosition(e))},_hideSizeGripper:function(){var t=this._sizeGripper;t&&$common.setDisplay(t,!1)},_initSizeGripperPosition:function(t){var e=this._column,i=e.get_frozenHeaderElement(),n=i||e.get_headerElement(),o=$dom.getBounds(n),s=o.x+o.width-6,r=o.y-1,l=o.height+2,a=e.get_grid().get_bounds();s<a.x+a.width?($common.setPosition(t,s,r,12,l),$common.setDisplay(t,!0)):$common.setDisplay(t,!1),this.clearTimer(),this._showTimer=setTimeout(function(){t&&$common.setDisplay(t,!1)},1e3)},_doDblClick:function(t){this._columnAutoWidth(),t.cancel()},clearTimer:function(){this._showTimer&&(clearTimeout(this._showTimer),this._showTimer=null)},_doMouseDown:function(t){this.clearTimer(),this._gripperStartLocation=$common.getLocation(this._sizeGripper),this._mouseStartLocation={x:t.clientX,y:t.clientY},t.preventDefault(),this._startDrag()},_startDrag:function(){this._draging=!0;if(t=this._sizeSplitter)this._initSizeSplitterPosition(t),this._setSizeSplitterVisible(!0);else{var t=this._sizeSplitter=this._createDiv("ColSplitter");this._initSizeSplitterPosition(t),document.body.appendChild(t)}t.style.zIndex=this._getZIndex(1),this._splitterStartLocation=$common.getLocation(this._sizeSplitter),$common.addMouseMoveHandler(document,this._mouseMoveHandler),$common.addMouseUpHandler(document,this._mouseUpHandler),$common.addKeyPressHandler(document,this._keyPressHandler),this._notifyGridResizing(!0)},_notifyGridResizing:function(t){this._column.get_grid()._isResizing=t},_initSizeSplitterPosition:function(t){var e=this._column,i=e.get_frozenHeaderElement(),n=i||e.get_headerElement(),o=$dom.getBounds(n),s=o.x+o.width,r=e.get_grid().get_bounds(),l=r.y+4,a=r.height-8;s<0||l<0||a<0||($common.setPosition(t,s,l,1,a),this._columnLeft=o.x,this._columnNewWidth=0)},_setSizeSplitterVisible:function(t){var e=this._sizeSplitter;e&&$common.setDisplay(e,t)},_drag:function(t){if(this._draging&&!this.get_isDisposed()){var e=t.clientX-this._mouseStartLocation.x,i=this._gripperStartLocation.x+e,n=this._gripperStartLocation.y+t.clientY-this._mouseStartLocation.y;$dom.setLocation(this._sizeGripper,i,n),i=this._splitterStartLocation.x+e,n=this._splitterStartLocation.y;var o=i-this._columnLeft,s=getClientBounds();o>23&&i<s.width&&(this._columnNewWidth=o,$dom.setLocation(this._sizeSplitter,i,n)),t.preventDefault()}},_doMouseUp:function(t){this._endDrag(!1)},_doKeyPress:function(t){27==(t.keyCode?t.keyCode:t.rawEvent.keyCode)&&this._endDrag(!0)},_columnAutoWidth:function(){var t=this._column,e=t.get_grid().get_recordCount();if(e>1e3)$common.alert("记录数大于 1000 后不能自动调整列宽");else{window.status="正在计算列宽 ...";for(var i=0,n=0;n<e;n++){var o=t.getCellText(n),s=String.getByteLength(o);i=Math.max(s,i)}var r=6*i+8,l=6*String.getByteLength(t.get_caption())+10,a=6*String.getByteLength(t.get_footer())+10,h=Math.max(l,a,23);r=Math.max(r,h),r=Math.min(r,512),this._setColumnWidth(r),window.status=""}},_setColumnWidth:function(t){var e=this._column,i=e.get_minWidth();e.set_width(t>i?t:i,!0),e._grid._refreshFrozenHeaderHeight()},_endDrag:function(t){if(!this.get_isDisposed()){this._notifyGridResizing(!1);var e=this._sizeGripper;if(t)$common.setLocation(e,this._gripperStartLocation);else{var i=this._columnNewWidth;i>0&&(i=parseInt(i),this._setColumnWidth(i))}this._setSizeSplitterVisible(!1),$common.removeMouseMoveHandler(document,this._mouseMoveHandler),$common.removeMouseUpHandler(document,this._mouseUpHandler),$common.removeKeyPressHandler(document,this._keyPressHandler),this._draging=!1}}},_Z_105.registerClass("_Z_105",_Z_242),Sys.UI.Controls.TreeGrid=function(t){Sys.UI.Controls.TreeGrid.initializeBase(this,[t]),this._expandIDField="id",this._expandParentIDField="pid",this._expandRootValue=0,this._expandColumnDataField="__haschild",this._expandColumnLevelField="__expandLevel",this._isTree=!0,this._cacheKey="__cache",this._allowCheckRelation=!0,this._childLazyPageSize=$settings.TreeGridLazyPageSize},Sys.UI.Controls.TreeGrid.prototype={get_expandIDField:function(){return this._expandIDField},set_expandIDField:function(t){this._expandIDField=t},get_expandParentIDField:function(){return this._expandParentIDField},set_expandParentIDField:function(t){this._expandParentIDField=t},get_expandRootValue:function(){return this._expandRootValue},set_expandRootValue:function(t){this._expandRootValue=t},get_allowCheckRelation:function(){return this._allowCheckRelation},set_allowCheckRelation:function(t){this._allowCheckRelation=t},_initRowVisible:function(t,e){if(this._rowExpandColumn&&!this._rowExpandColumn.get_expandAll()){var i=this.get_dataController().save();if(i){var n=i[e];n&&0!=n[this._expandColumnLevelField]&&t.append(' style="display:none" ')}}},set_dataSource:function(t){this._isTree&&(this._cachePager&&this._cachePager.set_visible(!1),t&&t.dataType&&1==t.dataType&&(t=$craba._changeDataToList(t,this)),t=this._reBuildData(t)),Sys.UI.Controls.TreeGrid.callBaseMethod(this,"set_dataSource",[t])},_reBuildData:function(t){if(!t)return null;this._createIndex(t);var e=[];return this._buildIndexDatas(this._expandDataIndexs,e,this._expandRootValue,null,!0),0==this._childLazyPageSize&&(this._expandDataIndexs=null),e},set_childLazyPageSize:function(t){this._childLazyPageSize=t},get_childLazyPageSize:function(){return this._childLazyPageSize},_createIndex:function(t){var e=this._expandDataIndexs={};e[this._cacheKey]={};for(var i={},n=0,o=t.length;n<o;n++){i[l=(s=t[n])[this._expandIDField]]=l}for(var n=0,o=t.length;n<o;n++){var s=t[n],r=s[this._expandParentIDField],l=s[this._expandIDField];i[r]===undefined&&(r=this._expandRootValue);var a=e[r];a||(a=e[r]=[]),a.push(s)}t=null,delete t},_buildIndexDatas:function(t,e,i,n,o){var s=t[i];if(s){var r=s.length;o&&n&&this._childLazyPageSize>0&&r>this._childLazyPageSize&&(r=this._childLazyPageSize,t[this._cacheKey][i]={});for(var l=0;l<r;l++){var a=s[l];a[this._expandColumnDataField]===undefined&&(a[this._expandColumnDataField]=-1),e.push(a),n?(a[this._expandColumnLevelField]=n[this._expandColumnLevelField]+1,n[this._expandColumnDataField]=1):a[this._expandColumnLevelField]=0;var h=a[this._expandIDField];a[this._expandParentIDField]!=h&&(""!==h&&h!=this._expandRootValue&&this._buildIndexDatas(t,e,a[this._expandIDField],a,o))}}},_doSortBy:function(t){if(!this._isTree)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_doSortBy",[t]);this._postEditValue();var e=t.get_isSortAscending();this.get_dataController().sortBy(t,e);var i=this.get_dataController().save(),n=this._reBuildData(i);this.get_dataController()._dataSource=n,Sys.UI.Controls.TreeGrid.callBaseMethod(this,"refresh",[n])},_afterInitDataRows:function(){Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_afterInitDataRows"),this._isTree&&this._initCheckRelation()},setFrozenColumnCount:function(t){Sys.UI.Controls.TreeGrid.callBaseMethod(this,"setFrozenColumnCount",[t]),this._isTree&&(this._rowExpandColumn.get_expandAll()||this.setExpandAllRows(!1))},_initCheckRelation:function(){if(this._allowCheckRelation&&this._multiSelectColumn&&this._multiSelectColumn.get_visible()&&!this._multiSelectColumn.get_readOnly()&&!this.get_readOnly()){var t=this._multiSelectColumn.get_dataField();if(t)for(var e=this.get_dataController(),i=this.get_recordCount(),n=0;n<i;n++){var o=e.getRecord(n);o&&(o[t]&&this._checkRelation(n,!0))}}},toggleExpanded:function(t){var e=this._rowExpandColumn;if(!e)throw Error.abort("TreeGrid下必须包含ExpandColumn列.");var i=this.findRowData(t);if(i){var n=i[this._expandColumnDataField];Object.isUndefinedOrNull(n)||-1==n||e.doChangeHandler(t,!n,n)&&(1==n?this.collapseRow(t):this.expandRow(t))}},expandRows:function(t){this._expandParentRows(t,!0)&&this.expandRow(t)},expandRow:function(t){if(this._expandedRows(t,!0)){var e=this._getRow(t);this._refreshCellValue(e,t,this._rowExpandColumn,1),this._initGridHeight(),this.checkShowCachePager(t)}},collapseRow:function(t){if(this._expandedRows(t,!1)){var e=this._getRow(t);this._refreshCellValue(e,t,this._rowExpandColumn,0),this._initGridHeight(),this.setCachePagerVisible(!1)}},_doRowClick:function(t,e,i){e=this._activeRow?this._getRowIndex(this._activeRow):this._selectedRowIndex,Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_doRowClick",[t,e,i]),this._isTree&&this.checkShowCachePager(e)},checkShowCachePager:function(t){if(0!=this._childLazyPageSize&&this._expandDataIndexs){var e=this._expandDataIndexs[this._cacheKey];if(e){var i=this.findRowData(t);if(i){var n=i[this._expandIDField],o=i[this._expandParentIDField];if(e[n]||e[o]){var s=this._expandDataIndexs[n];s||(n=o,s=this._expandDataIndexs[o]);var r=this.findParentRowIndex(t),l=this.findRowData(r);if(l||(l=i,r=t),0!=l[this._expandColumnDataField]){e.curId=n;var a=e[n],h=0;a.rowIndex=r,a.pageIndex!==undefined?h=a.pageIndex:a.pageIndex=0,a.text||(a.text=l[this._rowExpandColumn.get_displayField()]);var d="";a.text&&(d="【"+a.text+"】"),this._createCachePager(),this.setCachePagerVisible(!0),this._cachePager.set_summaryLabel(d+"子级分页器 "),this._cachePager.init(s.length),this._cachePager.set_pageIndex(h)}else this.setCachePagerVisible(!1)}else this.setCachePagerVisible(!1)}else this.setCachePagerVisible(!1)}else this.setCachePagerVisible(!1)}},setCachePagerVisible:function(t){this._cachePager?(this._cachePager.set_visible(t),this._internalFrozenRowsHeight()):this._internalFrozenRowsHeight()},_createCachePager:function(){if(!this._cachePager){var t=this.get_form(),e=this.get_idPart()+"_cachePager",i=$createControl("Pager",{ID:e,CssClass:"PagerBottom",PageSize:this._childLazyPageSize,SummaryLabel:"子级分页器"},t);this.findPager()?i.appendTo(this.get_element()):i.appendTo(this.get_element().parentNode);(this._cachePager=t[e]).add_pageIndexChanged($createDelegate(this,this.doNextChildPage))}},doNextChildPage:function(t){var e=t.get_pageIndex(),i=(t.get_pageSize(),this._expandDataIndexs[this._cacheKey]),n=i.curId,o=i[n];if(o.pageIndex!=e){o.pageIndex=e;var s=this._expandDataIndexs[n],r=e*this._childLazyPageSize,l=r+this._childLazyPageSize,a=o.rowIndex;({})[this._rowExpandColumn.get_displayField()]="";for(var h=r;h<l;h++){a++;var d=this._getRow(a),_=null;this.isFrozenGrid()&&(_=this._getFrozenRow(a));var u=s[h];u?(this.modifyRowData(a,u),d.style.display="",_&&(_.style.display="")):(this.modifyRowData(a,{}),d.style.display="none",_&&(_.style.display="none"))}}},findParentRowIndex:function(t,e){var i=this.findRowData(t);return i?(e=e!==undefined?e:i[this._expandParentIDField],i[this._expandIDField]==e?t:t>-1?(t--,this.findParentRowIndex(t,e)):-1):t},getChildDatas:function(t,e){for(var i=[],n=this.findRowData(t),o=n[this._expandColumnLevelField];n&&(n=this.findRowData(++t))&&n[this._expandColumnLevelField]>o;)i.push(n);return e?i:Object.clone(i)},_expandParentRows:function(t,e){var i=this.findRowData(t);if(!i)return!1;for(var n=i[this._expandColumnLevelField],o=n;0!=o&&t>-1;)(o=(i=this.findRowData(--t))[this._expandColumnLevelField])<n&&this.expandRow(t);return!0},_expandedRows:function(t,e){this._reStart=!0;var i=t,n=this.findRowData(i);if(!n||-1==n[this._expandColumnDataField])return!1;var o=n[this._expandColumnLevelField];n=this.findRowData(++i);for(var s=[];n&&n[this._expandColumnLevelField]>o;){var r=this._getRow(i),l=null;this.isFrozenGrid()&&(l=this._getFrozenRow(i)),0==n[this._expandColumnDataField]&&(i+=this._getChildCount(i)),n=this.findRowData(++i),e?(s.push(r),l&&(l.style.display="")):(r.style.display="none",l&&(l.style.display="none"))}return s.length>0&&(s.length>1e3&&$common.showWarn("数据过大，稍有卡顿，系统正在努力创建中..."),this._reStart=!1,this._doLoopExpandRows(s,500)),!0},_doLoopExpandRows:function(t,e){for(var i=0;t.length>0&&!this._reStart&&!this.get_isDisposed();){if(t.shift().style.display="",i>e){var n=this;setTimeout(function(){n._doLoopExpandRows(t,e)},100);break}i++}0==t.length&&$common.hideTips()},_getChildCount:function(t){return this.getChildDatas(t,!0).length},selectChilds:function(t){this._selectChilds(t,!0,!0)},deselectChilds:function(t){this._selectChilds(t,!1,!0)},_selectChilds:function(t,e,i){var n=this.findRowData(t);if(n&&(i&&this._internalSetRowSelected(t,e),-1!=n[this._expandColumnDataField])){var o=t,s=n[this._expandColumnLevelField];for(n=this.findRowData(++o);n&&n[this._expandColumnLevelField]>s;)this._internalSetRowSelected(o,e),n=this.findRowData(++o)}},get_selectedItems:function(t){var e=Sys.UI.Controls.TreeGrid.callBaseMethod(this,"get_selectedItems");return this._isTree&&t?0==e.length?e:(Array.addRange(e,this.get_indeterItems()),e):e},get_indeterItems:function(){this._checkHasMultiSelectColumn();for(var t=[],e=this._multiSelectColumn,i=0,n=this.get_recordCount();i<n;i++){var o=this._getRow(i);if(this._getRowCell(o,e.get_index()).firstChild.firstChild.indeterminate){var s=this.findRowData(i);if(!s)continue;t.push(s)}}return t},hasSelectedAllChild:function(t,e){if(0==this.get_recordCount())return!1;for(var i=this._checkHasMultiSelectColumn(),n=!1,o=t+1,s=t+this._getChildCount(t);o<=s;o++)if(!this.isEmptyRow(o)&&this.getRowEnabled(o)&&this._getRowMultiSelectColumnEnabled(o)){var r=this.getRowData(o)[i];if(e){if(r)return!0}else{if(!r)return!1;n=!0}}return n},hasSelectedChild:function(t){return this.hasSelectedAllChild(t,!0)},_selectParents:function(t){var e=this._getParentIndex(t);if(!(e<0)){var i=this.hasSelectedAllChild(e);this._internalSetRowSelected(e,i);var n=this._multiSelectColumn,o=this._getRow(e),s=this._getRowCell(o,n.get_index());this._checkCellindeterminate(e,s,i),this._selectParents(e)}},_checkCellindeterminate:function(t,e,i){if(this._allowCheckRelation){var n=e.firstChild.firstChild;n.indeterminate=!i&&this.hasSelectedChild(t),$common._changeCheckedHalfStyle(n.parentNode,n.checked,n.indeterminate)}},set_columnIndeterminate:function(t,e){this._checkRowIndex(t);var i=this._getRow(t);this._checkHasMultiSelectColumn();var n=this._getRowCell(i,this._multiSelectColumn.get_index()).firstChild.firstChild;n.indeterminate=e,$common._changeCheckedHalfStyle(n.parentNode,n.checked,n.indeterminate)},_getParentIndex:function(t){var e=this.findRowData(t);if(!e)return-1;var i=e[this._expandColumnLevelField];if(i<1)return-1;for(var n=i;0!=n&&t>-1;){if(!(e=this.findRowData(--t)))return-1;if((n=e[this._expandColumnLevelField])<i)return t}return-1},_raiseSetRowSelected:function(t,e,i,n,o){if(!this._isTree)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_raiseSetRowSelected",arguments);e._setCellValue(t,n,!0);var s=i.firstChild.firstChild;s.checked=n,n&&(s.indeterminate=!1),i==e._lastCell&&e.set_value(n),$common._changeCheckedHalfStyle(s.parentNode,s.checked,s.indeterminate),e._raiseChangeByRowIndex(i,t,n,o)},_doModifyRowData:function(t,e,i){if(Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_doModifyRowData",arguments),this._isTree&&this._multiSelectColumn){var n=e[this._multiSelectColumn.get_dataField()];this._checkRelation(t,n)}},_checkRelation:function(t,e,i){if(this._isTree){if(i&&e&&this._multiSelectColumn._columnEdit){var n=this._multiSelectColumn._columnEdit;n.indeterminate=!1,$common._changeCheckedHalfStyle(n.parentNode,n.checked,n.indeterminate)}this._allowCheckRelation&&(Object.isUndefinedOrNull(this._startIndex)&&(this._startIndex=t),this._startParent||this._selectChilds(t,e),this._startIndex==t&&(delete this._startIndex,this._startParent=!0,this._selectParents(t),this._startParent=!1))}},_moveSelectedRow:function(t,e,i,n,o,s,r,l,a){if(!this._isTree)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_moveSelectedRow",arguments);for(var h=t>e,d=this._getRow(t),_=!0;d&&_;)(_=!$dom.getVisible(d))&&(d=h?$common.getNextSibling(d):$common.getPreviousSibling(d));return _||(t=this._getRowIndex(d)),Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_moveSelectedRow",arguments)},_setDefaultData:function(t,e){if(!this._isTree)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_setDefaultData",arguments);if(!this._isEmptyData(e)){var i=this.findRowData(t);null!=i&&i[this._expandColumnDataField]!=undefined&&i[this._expandColumnLevelField]!=undefined||((i={})[this._expandColumnLevelField]=0,i[this._expandColumnDataField]=-1),"undefined"==typeof e[this._expandColumnLevelField]&&(e[this._expandColumnLevelField]=i[this._expandColumnLevelField]),"undefined"==typeof e[this._expandColumnDataField]&&(e[this._expandColumnDataField]=i[this._expandColumnDataField]),Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_setDefaultData",[t,e])}},_getStartRecordIndex:function(){if(!this._isTree)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"_getStartRecordIndex");var t=this.findPager();return t?t.get_dynamicPageItemIndex():0},dataNeedSum:function(t){if(!this._isTree)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"dataNeedSum",arguments);var e=t[this._expandColumnLevelField];return e==undefined||0==e},doRowDblClick:function(t){this._isTree&&this.toggleExpanded(this.get_selectedRowIndex()),Sys.UI.Controls.TreeGrid.callBaseMethod(this,"doRowDblClick",[t])},batchInsertRowData:function(t,e,i){if(!this._isTree)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"batchInsertRowData",arguments);for(var n={},o=0,s=e.length;o<s;o++){var r=e[o];(a=r[this._expandParentIDField])||(a=i?i[this._expandIDField]:this._expandRootValue);var l=n[a];l||(l=n[a]=[]),l.push(r)}e=[];var a=this._expandRootValue;i&&(a=i[this._expandIDField]),this._buildIndexDatas(n,e,a,i),Sys.UI.Controls.TreeGrid.callBaseMethod(this,"batchInsertRowData",[t+1,e]),i&&this.modifyCellValue(t,this._rowExpandColumn,1)},deleteChilds:function(t,e){var i=this.findRowData(t);if(e&&Sys.UI.Controls.TreeGrid.callBaseMethod(this,"deleteRow",[t,!0]),i){for(var n=i[this._expandColumnLevelField],o=(i[this._expandParentIDField],e?t:t+1),s=!1,r=this.findRowData(o);r&&r[this._expandColumnLevelField]>n;)s=!0,Sys.UI.Controls.TreeGrid.callBaseMethod(this,"deleteRow",[o,!0]),r=this.findRowData(o);!e&&s&&this.modifyCellValue(t,this._rowExpandColumn,-1)}},deleteRow:function(t,e){var i=this.findRowData(t);if(!this._isTree||!i)return Sys.UI.Controls.TreeGrid.callBaseMethod(this,"deleteRow",arguments);var n=t,o=i[this._expandColumnLevelField],s=i[this._expandParentIDField];for(i=this.findRowData(++n);i&&i[this._expandColumnLevelField]>o;)i[this._expandParentIDField]=s,i[this._expandColumnLevelField]--,this.modifyRowData(n,i),i=this.findRowData(++n);Sys.UI.Controls.TreeGrid.callBaseMethod(this,"deleteRow",arguments)}},Sys.UI.Controls.TreeGrid.registerClass("Sys.UI.Controls.TreeGrid",Sys.UI.Controls.Grid),Sys.UI.Controls.TreeGrid.create=function(t,e,i,n){return Sys.UI.Controls.Grid.create(t,e,i,n,Sys.UI.Controls.TreeGrid)},_Z_77=function(t){this._grid=t,this._barHeight=30,this._blocks=[],this._filterEditors=[],this._isFirst=!0},_Z_77.prototype={dispose:function(){this._disposed||(this._disposed=!0,this._clear())},_clear:function(){for(n=0;n<this._blocks.length;n++){var t=this._blocks[n];if(t._isCustomer){var e=$common.getElementChildControls(t);Array.addRange(this._filterEditors,e)}}for(var i=this._grid.get_form(),n=0;n<this._filterEditors.length;n++){var o=this._filterEditors[n];i.removeControl(o,!0)}this.removeResetButton(),delete this._blocks,delete this._filterEditors},reset:function(){this._disposed||(this._filters=this.getFilter(),this._clear(),this._frozenFilterBar&&($removeNode(this._frozenFilterBar),this._frozenFilterBar=null,$removeNode(this._resetButtonBak),this._resetButtonBak=null),$removeNode(this._element),this._blocks=[],this._filterEditors=[],this._inited=!1,this._isFirst=!1,this.init())},get_height:function(){return this._element?this._element.offsetHeight:this._barHeight},scrollLeft:function(t){this._element.scrollLeft=t},addControl:function(t){this._filterEditors.push(t),t.doFormLoaded&&t.doFormLoaded()},set_width:function(t,e){var i=t._block;if(i){var n=this._grid,o=n._header.offsetWidth;if(this._xBar.style.width=o+"px",this._setBlockWidth(i,e),this._frozenFilterBar&&n._isColumnInFrozen(t)){var s=n._frozenHeaderBar.offsetWidth;this._frozenFilterBar.style.width=s+"px"}}},_setBlockWidth:function(t,e){t.style.width=e+"px",t._control&&t._control.set_width(e-34)},resetWidth:function(){if(this._inited){var t=this._grid;if(this._frozenFilterBar){var e=t._frozenHeaderBar,i=this._frozenFilterBar;i.style.width=e.offsetWidth+"px",i.style.top=e.offsetTop+e.offsetHeight+"px"}}},set_visible:function(t,e){var i=t._block;if(i&&(i.style.display=e?"":"none",this._xBar.style.width=this._grid._header.offsetWidth+"px",e&&t.get_allowFilter()&&"none"==t._createFilterType)){if(t._doFilterRendering(i,this))return void(t._createFilterType="ok");t._filterControl=t.createFilter(i,this),t._createFilterType="ok"}},swapColumn:function(t,e){var i=t._block,n=e._block;if(i&&n){var o=n.parentNode;if(t.get_index()<e.get_index()){s=$common.getNextSibling(i);o.insertBefore(i,n),s?o.insertBefore(n,s):o.appendChild(n)}else{var s=$common.getNextSibling(n);o.insertBefore(n,i),s?o.insertBefore(i,s):o.appendChild(i)}}},hide:function(){this._isShow&&(this._isShow=!1,this._element&&$dom.setVisible(this._element,!1))},show:function(){this._isShow||(this._isShow=!0,this._element&&$dom.setVisible(this._element,!0))},removeResetButton:function(){var t=this._resetButton;$clearHandlers(t),$removeNode(t),delete this._resetButton},_initResetButton:function(){if(!this._resetButton){var t=this._grid;if(t.get_showRowNo()){var e=this._resetButton=this.createBlock();e.title="重置筛选条件",$dom.addCssClass(e,"GridBodyRowNoCell"),e.style.width=$common.pix(t.get_rowNoColumnWidth()),this._xBar.insertBefore(e,this._xBar.firstChild),$common.addClickHandler(e,this._doFilterIconClick,this);var i=$common.createClassSpan("GridFilterIcon SpeedButton icononly aicon-qingkong1");e.appendChild(i),t.get_noColumn()&&(t.get_noColumn()._block=e)}}},init:function(){var t=this._grid;if(!t.get_allowFilter())return this.hide();if(this.show(),!this._inited){this._inited=!0;var e=t._body,i=t.get_element(),n=this._element=$common.createClassDiv("GridFilterBar");i.insertBefore(n,e);var o=this._xBar=$common.createClassDiv("GridFilterXBar");$common.setWidth(o,t._header.offsetWidth),n.appendChild(o),this._initResetButton();for(var s=t.get_columns(),r=0;r<s.length;r++){var l=s[r],a=this.createBlock();if(a.style.width=$common.pix(l.get_width()),o.appendChild(a),this._blocks.push(a),l._block=a,a.style.display=l.get_visible()?"":"none",l._createFilterType="none",l.get_visible()){var h=l.get_dataField(),d=this._getFilterData(h);l._doFilterRendering(a,this,d)?l._createFilterType="ok":l.createFilter&&l.get_allowFilter()&&h&&(l._filterControl=l.createFilter(a,this,d),l._createFilterType="ok")}}this._makeFrozenFilterBar(),this._grid._bodyScroll()}},_getFilterData:function(t){if(!t||!this._filters)return null;var e=this._filters.items;if(!e||e.length<1)return null;for(var i=0,n=e.length;i<n;i++){var o=e[i];if(o.dataField===t)return o}return null},_makeFrozenFilterBar:function(){var t=this._grid;if(t.isFrozenGrid()&&t._getFrozenVisible()){var e=t._frozenBody,i=t.get_element(),n=t._frozenHeaderBar,o=this._frozenFilterBar=t._frozenFilterBar=$common.createClassDiv("GridFilterBar Frozen");if(o.style.top=n.offsetTop+n.offsetHeight+"px",o.style.left=e.style.left,o.style.width=e.offsetWidth+"px",i.insertBefore(o,e),this._resetButton){var s=this._resetButtonBak=this._resetButton.cloneNode(!0);this._xBar.insertBefore(s,this._resetButton),o.appendChild(this._resetButton)}}},_doFilterIconClick:function(t){this.doClearFilter()},clearValue:function(){for(var t=0,e=this._filterEditors.length;t<e;t++){this._filterEditors[t].set_value("",!0)}delete this._filters},doClearFilter:function(t){this.clearValue();if(!this._doFilterHandler(null)){var e=this._grid,i=e.findPager();e.get_lazyPageSize()>0?e._cacheData&&(e.refresh(e._cacheData),delete e._cacheData):i&&(delete i._lastFilter,delete i._savedFilter,i.refreshPage(i.get_queryParams(),null,null,{items:[]}))}},_doFilterHandler:function(t){var e=this._grid,i=e.get_events().getHandler("filter");if(i){var n=new Sys.GridFilterArgs(t);if(i(e,n),n.get_cancel())return!0}return!1},doFilter:function(t){var e=this.getFilter();if(!this._doFilterHandler(e)){var i=this._grid,n=i.findPager();i.get_lazyPageSize()>0?this.doFilterRowsToCache(e):n?n._internalRefreshFilter(e,function(){asyncCall(function(){t.focus()})}):this.doSelectRowByFilter(e)}},getFilter:function(){for(var t={append:!1,items:[]},e=[],i=0;i<this._filterEditors.length;i++){var n=this._filterEditors[i],o=n.get_value();if(void 0!==o&&null!==o&&""!==o&&!(o instanceof Array&&0==o.length)){var s=n.get_tag(),r=s.get_sortField(!0);if(!r)return void $common.showWarn(s.get_caption()+"列没有设置DataField属性，不支持筛选．");if(!(Array.indexOf(e,r)>-1)){e.push(r);var l={};l.dataField=r,l.value=o,l.type=s.get_filterType(),s.getFilterValue&&s.getFilterValue(n,l),t.items.push(l)}}}return 0==e.length?null:t},doSelectRowByFilter:function(t){if(t)for(var e=t.items,i=0,n=e.length;i<n;i++){var o=e[i];if(this._grid.locateRow(o.dataField,o.value,!0)>-1)break}},doFilterRowsToCache:function(t){$common.addStep({control:this._resetButton,html:"亲，点击这里可重置筛选哦"},!0);this._grid.filterRows(t)},createBlock:function(){return $common.createClassDiv("GridFilterBlock")}},_Z_109=function(){},_Z_109.prototype={bindColumnResizer:function(t){if(this._checkInitResizer(t,!0),t._index>0){var e=t._grid.getColumnByIndex(t._index-1);e&&this._checkInitResizer(e)}},hideSizeGripper:function(){this._resizer1&&this._resizer1._hideSizeGripper(),this._resizer2&&this._resizer2._hideSizeGripper()},_checkInitResizer:function(t,e){if(t.get_allowResize()&&!t._grid._isResizing){var i;e?(i=this._resizer1,this._resizer1||(i=this._resizer1=this._createResizer())):(i=this._resizer2,this._resizer2||(i=this._resizer2=this._createResizer())),i.initSizeGripper(t)}},_createResizer:function(){var t=new _Z_105;return t.initialize(),t},getRowNoColumnWidth:function(){return 40},_initGridShowMax:function(t){this._createMaxBtn(t)},_createMaxBtn:function(t){if(!t._maxBtn){var e=t._headerRow;if(e&&t.get_showRowNo()){var i=t._maxBtn=$common.createClassDiv("maxShape iconfont");i.title="点击放大",i._grid=t,e.childNodes[0].appendChild(i),$common.addClickHandler(i,this._doMaxBtnClick,this)}}},_doMaxBtnClick:function(t){var e=t.target._grid;this.showPopup(e,"表格预览")},showMaxButton:function(t,e){t._maxBtn&&$dom.setVisible(t._maxBtn,e)},closePopup:function(){this._popupForm&&(this.showMaxButton(this._curGrid,!0),this._popupForm.dispose(),delete $app.PopupGrid,this._popupForm=null)},showPopup:function(t,e,i,n){if(!$app.PopupGrid)if($app.PopupGrid=t,t.get_visible()){this._curGrid=t,this.showMaxButton(t,!1),t._hideEditor(),t._hideMenu();var o=t.get_element(),s=t._body,r=o.parentNode;this._gridParent=r.parentNode,this._gridNext=r.nextSibling;var l=t.findPager(),a=o.offsetWidth,h=o.offsetHeight,d=0;if(l){h+=d=l.get_element().offsetHeight}var _=t.get_events().getHandler("_popuping");if(_){var u=new _Z_194(i||a,n||h);if(_(t,u),u.get_cancel())return;var c=u.get_size();u.get_caption()&&(e=u.get_caption()),i=c.width,n=c.height}(void 0===i||i<100)&&(i=a+(s.scrollWidth-s.clientWidth)),(void 0===n||n<100)&&(n=h+(s.scrollHeight-s.clientHeight));var g=getClientBounds();i>g.width-30&&(i=g.width-30);var f=d+20+30+20;n>g.height-f&&(n=g.height-f),n<g.height/2&&(n=g.height/2);var m=this._popupForm=new Sys.UI.Form(t);m._hasFlexBlock=!0,m.set_id((new Date).getTime()),e&&m.set_caption(e),m.addHotkey({keyCode:Sys.UI.Key.esc},m.close,m),m.showModal(),m.add_close($createDelegate(this,this._doPopupClose)),$app.addForm(m);var C=m.get_contentElement();$dom.addCssClass(C,"MaxContent"),C.appendChild(r),m.set_width(i),m.set_height(n),m.doHideProgressor()}else $common.showWarn("不支持对隐藏grid的放大功能")},_doPopupClose:function(t){var e=this._curGrid,i=this._gridNext,n=this._gridParent,o=e.get_element().parentNode;delete $app.PopupGrid,n.insertBefore(o,i),e._hideEditor(),e._hideMenu(),this.showMaxButton(e,!0)}},$gridExt=new _Z_109,_Z_110=function(t){this._grid=t,this._minWidth=40,this.init()},_Z_110.prototype={init:function(){var t=this._grid;t._filterBar&&(this._block=t._filterBar._resetButton)},focus:function(){},initCellHTML:function(){},get_allowResize:function(){return!0},get_grid:function(){return this._grid},get_frozenHeaderElement:function(){return this._grid._frozenNoTd},get_headerElement:function(){return this._grid._noTd},get_minWidth:function(){return this._minWidth},get_width:function(){var t=this._grid._noTd,e=t.offsetWidth;return 0==e&&(e=parseInt(t.width)),e},get_name:function(){return"rowNo"},get_designWidth:function(){return this._minWidth},set_width:function(t){var e=this._grid;if(t>e.get_rowNoMaxWidth()){t=e.get_rowNoMaxWidth();var i=e._frozenNoTd?e._frozenNoTd:e._noTd;$common.showHint("温馨提示：行号列最大显示宽度为"+t+"像素",i)}var n=this.get_width();t!=n&&(e._internalSetColumnWidth(this,t,n,!0),e._filterBar&&e._filterBar._resetButtonBak&&(e._filterBar._resetButtonBak.style.width=t+"px"),e._footerNo&&(e._footerNo.width=t),e._frozenFooterNo&&(e._frozenFooterNo.width=t))},_hideEditor:function(){},getCellText:function(){return"11111"},get_caption:function(){return"行号"},get_footer:function(){return"行号"},get_index:function(){return-1},get_band:function(){return null},_getVisibleIndex:function(){return 0}};﻿_Z_80=function(t,e){_Z_80.initializeBase(this,[e]),this._requireMouseEnter=!0,this._requireMouseLeave=!0,this._requireMouseDown=!0,this._requireDblClick=!0,this._requireKeyDown=!0,this._requireMouseUp=!0,this._tabPage=t},_Z_80.prototype={initialize:function(){_Z_80.callBaseMethod(this,"initialize"),this._initButton()},dispose:function(){this._closeButton&&(this._closeButton.dispose(),this._closeButton=null),this._captionElement=null,_Z_80.callBaseMethod(this,"dispose")},_initButton:function(){var t=this.get_tabPage(),e=this.get_element(),i=e.innerHTML;e.innerHTML="",this._addCaptionElement(e,i),t.get_showTabCloseButton()&&this._initCloseButton(e)},get_isMDITab:function(){return this._isMDITab},set_isMDITab:function(t){this._isMDITab=t},_addCaptionElement:function(t,e){var i=this._captionElement=$common.createClassDiv("TabCaptionText");i.innerHTML=e,t.appendChild(i)},_initCloseButton:function(t){var e=this._closeButton=new _Z_23(t,"TabCloseButton aicon-close",!1);e.initialize(),e.add_mouseDown(this._doButtonMouseDown,this),e.add_click(this._doClose,this),e.__form=this.__form},get_tabPage:function(){return this._tabPage},get_selected:function(){return this.get_tabPage().get_selected()},set_selected:function(t){t?this._initSelected():this._initNormal()},get_text:function(){return this._captionElement.innerHTML},set_text:function(t){this._captionElement.innerHTML!=t&&(this._captionElement.innerHTML=t)},doMouseEnter:function(t){this.get_selected()||this._initHover()},_doButtonMouseDown:function(t){t.cancel()},_doClose:function(t,e){this.get_tabPage().close()},doDblClick:function(t){_Z_80.callBaseMethod(this,"doDblClick",[t]),this._doClose()},doMouseLeave:function(t){this.get_selected()||this._initNormal()},doMouseDown:function(t){if(!this.get_selected()){var e=this.get_tabPage();e.get_pageControl().set_selectedTab(e)}},doMouseUp:function(t){if(2==t.button){t.cancel();var e=this.get_tabPage();if(!e)return;var i=e.get_pageControl();if(!i)return;var n=i.get_mdiPanel();if(!n)return;var s=n.get_events().getHandler("tabItemRightClick");s&&s(this,t)}},doKeyDown:function(t){t.keyCode==Sys.UI.Key.enter&&(this.get_selected()||(this.doMouseDown(),t.cancel()))},_showCloseButton:function(t){this._closeButton&&this._closeButton.set_visible(t)},_initNormal:function(){this._internalInit(!1),$settings.TabButtonNormalShowCloseButton?this._showCloseButton(!0):this._showCloseButton(!1)},_initHover:function(){this._showCloseButton(!0)},_initSelected:function(){this._internalInit(!0),this._showCloseButton(!0)},_internalInit:function(t){$Dom.setCssClass(t,this._element,"active")}},_Z_80.registerClass("_Z_80",Sys.UI.Controls.Container),Sys.UI.Controls.TabPage=function(t){Sys.UI.Controls.TabPage.initializeBase(this,[t]),this._selected=!1,this._allowClose=!0,this._isMDITab=!1,this._visible=!0,this._enabled=!0},Sys.UI.Controls.TabPage.prototype={initialize:function(){Sys.UI.Controls.TabPage.callBaseMethod(this,"initialize");var t=this._buttonElement;t||(t=this._buttonElement=$get(this.get_id()+"_button")),t&&$Dom.getVisible(t)&&this._initTabButton(),this._initEnabled(),this.get_pageControl().addTab(this)},doFormResized:function(){},_initTabButton:function(){var t=this._tabButton=new _Z_80(this,this._buttonElement);t.set_form(this.get_form()),t.set_isMDITab(this.get_isMDITab()),t.initialize()},dispose:function(){this._tabButton&&(this._tabButton.dispose(),this._tabButton=null),this._buttonElement=null,this._pageControl=null,Sys.UI.Controls.TabPage.callBaseMethod(this,"dispose")},_refreshFrozen:function(t){t||(t=$craba._checkTabFrozen(this.get_name())),t&&$dom.addCssClass(this._tabButton.get_element(),"aicon-suoding1")},updated:function(){var t=this.get_langText();null!==t&&this.set_caption(t)},doMDIResize:function(t,e,i,n){var s=this._form;s.get_allowResize()&&(console.log("tab resized"),s._doResizeHandler(t,e,i,n))},get_activeControl:function(){return this._activeControl},set_activeControl:function(t){this._activeControl=t},get_textColor:function(){return this._textColor},set_textColor:function(t){this._textColor=t},get_isMDITab:function(){return this._isMDITab},set_isMDITab:function(t){this._isMDITab=t},get_pageControl:function(){var t=this._pageControl;return t||this.get_form()[this._pageControlId]},set_pageControl:function(t){this._pageControl=t},get_buttonElement:function(t){return this._buttonElement},set_buttonElement:function(t){this._buttonElement=t},get_tabButton:function(){return this._tabButton},get_caption:function(){var t=this.get_tabButton();return t?t.get_text():""},set_caption:function(t){var e=this.get_tabButton();if(e){e.set_text(t);var i=this.get_events().getHandler("captionChanged");i&&i(this)}},add_captionChanged:function(t){this.get_events().addHandler("captionChanged",t)},remove_captionChanged:function(t){this.get_events().removeHandler("captionChanged",t)},get_tabPosition:function(){return this.get_pageControl().get_tabPosition()},get_allowClose:function(){return this._allowClose},set_allowClose:function(t){this._allowClose=t},get_showTabCloseButton:function(){return!!this.get_allowClose()&&this.get_pageControl().get_showTabCloseButton()},close:function(t){(this.get_allowClose()||t)&&this.get_pageControl().doTabClose(this)},get_pageControlId:function(){return this._pageControlId},set_pageControlId:function(t){this._pageControlId=t},get_tabIndex:function(){return this.get_pageControl().indexOfTab(this)},get_name:function(){return this._name},set_name:function(t){this._name=$common.removeUrlParam(t,$settings.StaticVersionName)},get_visible:function(){return this._visible},set_visible:function(t){if(this._visible=t,!this._tabButton&&t&&this._buttonElement&&($Dom.setVisible(this._buttonElement,!0),this._initTabButton()),this._tabButton&&this._tabButton.set_visible(t),this.get_isInitialized()){$Dom.setVisible(this.get_element(),t,"flex");var e=this.get_pageControl();if(t&&(this._selected||!e.get_selectedTab()))e.set_selectedTab(this);else{var i=this.get_tabIndex();this._initActiveTab(!1),this._selected&&(e._selectedTab=null,this.set_selected(!1),this._selectedOtherTab(i))}}},_initEnabled:function(){var t=this._enabled;this._tabButton&&this._tabButton.set_enabled(t)},set_enabled:function(t){this._enabled=t,this.get_isInitialized()&&this._initEnabled()},get_enabled:function(){return this._enabled},_selectedOtherTab:function(t){for(var e=this.get_pageControl(),i=e.get_tabs(),n=this;0==n.get_visible()&&(--t<0&&(t=e.get_tabCount()-1),(n=i[t])!=this););n!=this&&e.set_selectedTab(n)},get_selected:function(){return this._selected},set_selected:function(t){this._initFrozen(),this._selected=t,this._selectedChanged()},_initFrozen:function(){if(this._cacheInfo){this.get_pageControl().get_mdiPanel()._initTabPageForm(this,this._cacheInfo.url,this._cacheInfo.caption,this._cacheInfo.params,null),delete this._cacheInfo}},_selectedChanged:function(){var t=this.get_selected();this._tabButton&&this._tabButton.set_selected(t),this._initActiveTab(t)},_initActiveTab:function(t){var e=this.get_element();$Dom.setCssClass(!t,e,"Hided"),t&&$step.popHideStep()},getControls:function(){return this.get_controls()},get_controls:function(){return $common.getElementChildControls(this.get_element())}},Sys.UI.Controls.TabPage.registerClass("Sys.UI.Controls.TabPage",Sys.UI.Control),Sys.UI.Controls.TabContainer=function(t){Sys.UI.Controls.TabContainer.initializeBase(this,[t])},Sys.UI.Controls.TabContainer.prototype={initialize:function(){Sys.UI.Controls.TabContainer.callBaseMethod(this,"initialize"),this.get_pageControl().set_tabContainer(this)},get_pageControl:function(){var t=this._pageControl;return t||this.get_form()[this._pageControlId]},get_pageControlId:function(){return this._pageControlId},set_pageControlId:function(t){this._pageControlId=t}},Sys.UI.Controls.TabContainer.registerClass("Sys.UI.Controls.TabContainer",Sys.UI.Control),_Z_180=function(t,e,i){_Z_180.initializeBase(this),this._oldTab=t,this._newTab=e,this._activeControl=i},_Z_180.prototype={get_oldTab:function(){return this._oldTab},get_newTab:function(){return this._newTab},get_oldTabIndex:function(){var t=this.get_oldTab();return t?t.get_tabIndex():-1},get_newTabIndex:function(){var t=this.get_newTab();return t?t.get_tabIndex():-1},get_activeControl:function(){return this._activeControl},set_activeControl:function(t){this._activeControl=t}},_Z_180.registerClass("_Z_180",_Z_162),_Z_58=function(){throw Error.notImplemented()},_Z_58.prototype={top:0,bottom:1,right:2,left:3},_Z_58.registerEnum("_Z_58"),Sys.UI.Controls.PageControl=function(t){Sys.UI.Controls.PageControl.initializeBase(this,[t]),this._tabs=[],this._showTabHeader=!0,this._tabPosition=_Z_58.top,this._autoFocus=!0},Sys.UI.Controls.PageControl.prototype={initialize:function(){Sys.UI.Controls.PageControl.callBaseMethod(this,"initialize");var t=this.get_element();this._header=$common.getFirstChildByClassName(t,"TabHeader",!1);var e=this.get_showTabHeader()?"TabBody":"TabBodyNoHeader";this._tabBody=$common.getFirstChildByClassName(t,e,!1),this.get_form()._hasPageControl=!0,this.get_form()._hasFlexBlock=!0,this._initHeaderBar(this._header)},dispose:function(){Sys.UI.Controls.PageControl.callBaseMethod(this,"dispose"),this._tabs=null,this._tabButtons=null,this._selectedTab=null,this._header=null,this._tabBody=null,this._tabLeftButton&&(this._tabLeftButton.dispose(),this._tabLeftButton=null),this._tabRightButton&&(this._tabRightButton.dispose(),this._tabRightButton=null),this._mdiPanel=null},_initHeaderBar:function(t){t&&$settings.DefaultMDIMouseWheel&&$common.addMouseWheelHandler(t,this._doMouseWheelHandler,this)},doFormInit:function(){null!=this._initTabIndex&&this._initTabIndex<this.get_tabCount()&&this._internalSetSelectedTabIndex(this._initTabIndex)},_doMouseWheelHandler:function(t){this._tabScroll(t.wheelType)},_tabScroll:function(t){for(var e=this.get_tabCount(),i=this.get_selectedTabIndex()+t;!this.get_tabVisible(i);)(i+=t)<0?i=e-1:i>=e&&(i=0);this.set_selectedTabIndex(i)},get_showTabHeader:function(){return this._showTabHeader},set_showTabHeader:function(t){this._showTabHeader=t,this.get_isInitialized()&&$dom.setCssClass(!t,this._header,"dnone")},get_autoFocus:function(){return this._autoFocus},set_autoFocus:function(t){this._autoFocus=t},get_mdiPanel:function(){return this._mdiPanel},set_mdiPanel:function(t){this._mdiPanel=t},get_tabHeaderHidden:function(){return this._tabHeaderHidden},set_tabHeaderHidden:function(t){this._tabHeaderHidden=t,this.get_isInitialized()&&(this._header.style.visibility=t?"hidden":"")},get_showTabCloseButton:function(){return this._showTabCloseButton},set_showTabCloseButton:function(t){this._showTabCloseButton=t},get_tabPosition:function(){return this._tabPosition},set_tabPosition:function(t){this._tabPosition=t},get_tabs:function(){return this._tabs},get_tabCount:function(){return this._tabs.length},getTab:function(t){return this._tabs[t]},findTabByName:function(t){for(var e=0,i=this.get_tabCount();e<i;e++){var n=this.getTab(e);if(n.get_name()==t)return n}return null},indexOfTab:function(t){return Array.indexOf(this._tabs,t)},addTab:function(t){var e=this._tabs.length;return Array.add(this._tabs,t),e},removeTab:function(t){var e=this.indexOfTab(t),i=e==this.get_tabCount()-1,n=t.get_selected(),s=t.get_element();$removeNode(s);var o=t.get_tabButton();if(o){var r=o.get_element(),a=o._closeButton;a&&(a.get_element().style.backgroundImage=""),$removeNode(r)}if(Array.remove(this._tabs,t),t.dispose(),n){this._selectedTab=null;var l=this.indexOfTab(this._prevTab);l>-1?this.set_selectedTabIndex(l):this.set_selectedTabIndex(i?e-1:e)}},get_selectedTab:function(){return this._selectedTab},set_selectedTab:function(t){if(-1==this.indexOfTab(t))throw Error.argumentOutOfRange("value",t);this._internalSetSelectedTab(t)},_internalSetSelectedTab:function(t){var e=this._selectedTab;if(e!=t){if(null!=e){this.get_autoFocus()&&this._deactivateControls(e);if(o=this.get_events().getHandler("selecting")){if(o(this,r=new _Z_180(e,t,null)),r.get_cancel())return void delete r;delete r}e.set_selected(!1),this._prevTab=e}var i=this.get_form();if(this._selectedTab=t,t){if(t.set_selected(!0),e&&(!t.isShown||t._hasResized)&&!this.get_mdiPanel()){var n=$common.getElementChildControls(t.get_element());i.raiseResize(n,!0),delete t._hasResized}t.isShown=!0}this._scrollTabToVisible(t);var s=i[t.get_activeControl()],o=this.get_events().getHandler("selected");if(o){var r=new _Z_180(e,t,s);o(this,r),s=r.get_activeControl()}s?i._checkFocusControl(s):this.get_autoFocus()&&null!=e&&this._activateControls(t),$common.hideHint("tabChanged")}},_scrollTabToVisible:function(t){if(!this.get_mdiPanel()&&t){var e=t.get_buttonElement(),i=this._getTabCaptions();e.offsetTop>i.offsetHeight?i.scrollTop=e.offsetHeight:i.scrollTop=0}},_deactivateControls:function(t){for(var e=t.get_controls(),i=0,n=e.length;i<n;i++){var s=e[i];s.doFormDeactivate&&s.doFormDeactivate()}},_activateControls:function(t){for(var e=t.get_controls(),i=0,n=e.length;i<n;i++){(s=e[i]).doFormActivate&&s.doFormActivate()}for(var i=0,n=e.length;i<n;i++){var s=e[i];if(Sys.UI.Control.canFocus(s)){asyncCall(function(){s.focus()});break}}},get_selectedTabIndex:function(){var t=this.get_selectedTab();return t?t.get_tabIndex():-1},set_selectedTabIndex:function(t){this._initTabIndex=t,this.get_isInitialized()&&this._internalSetSelectedTabIndex(t)},_internalSetSelectedTabIndex:function(t){if(t<-1||t>=this.get_tabCount())throw Error.argumentOutOfRange("value");this._internalSetSelectedTab(this.getTab(t))},get_tabVisible:function(t){var e=this.getTab(t);return e&&e.get_visible()},set_tabVisible:function(t,e){this.getTab(t).set_visible(e)},add_selecting:function(t,e){return this.get_events().addHandler("selecting",t,e)},remove_selecting:function(t){this.get_events().removeHandler("selecting",t)},add_selected:function(t,e){return this.get_events().addHandler("selected",t,e)},remove_selected:function(t){this.get_events().removeHandler("selected",t)},add_tabClose:function(t,e){return this.get_events().addHandler("tabClose",t,e)},remove_tabClose:function(t){this.get_events().removeHandler("tabClose",t)},doTabClose:function(t){var e=this.get_events().getHandler("tabClose");e&&e(this,t)},set_tabContainer:function(t){this._tabContainer=t},get_tabContainer:function(){return this._tabContainer},_getTabSpace:function(){return this._tabSpace||(this._tabSpace=$common.getFirstChildByClassName(this._header,"TabSpace",!0)),this._tabSpace},_getTabCaptions:function(){return this._tabCaptionsContainer||(this._tabCaptionsContainer=$common.getFirstChildByClassName(this._header,"TabCaptions",!0)),this._tabCaptionsContainer}},Sys.UI.Controls.PageControl.registerClass("Sys.UI.Controls.PageControl",_Z_41),_Z_98=function(t){_Z_98.initializeBase(this,[t])},_Z_98.prototype={initialize:function(){_Z_98.callBaseMethod(this,"initialize"),this.add_selectStart(this._selectStart),this.add_contextMenu(this._contextMenu)},_selectStart:function(t){t.cancel()},_contextMenu:function(t){t.cancel()}},_Z_98.registerClass("_Z_98",_Z_249),Sys.UI.Controls.MenuBar=function(t){Sys.UI.Controls.MenuBar.initializeBase(this,[t]),this._roots=[],this._layoutMode=Sys.LayoutMode.normal,this._groupDirection=Sys.UI.Controls.LayoutDirection.vert,this._layoutDirection=Sys.UI.Controls.LayoutDirection.horz,this._useAutoLayout=!0},Sys.UI.Controls.MenuBar.prototype={initialize:function(){Sys.UI.Controls.MenuBar.callBaseMethod(this,"initialize"),this._useAutoLayout&&(this._rootDom=$common.getElementsByClassName(this._element,"MenuRoots",!0)[0],this._rootSpacer=$common.getElementsByClassName(this._element,"MenuRootSpacer",!0)[0])},dispose:function(t){if(this._windowResizeHandler&&$common.removeResizeHandler(window,this._windowResizeHandler),this._scrollBar&&this._scrollBar.dispose(),t)for(var e=this.get_form(),i=0,n=this._roots.length;i<n;i++)e.removeControl(this._roots[i],t);delete this._roots,delete this._menuMap,this._menus=null;var s=this._menuItemMap;if(s){for(var o in s){s[o].dispose()}delete this._menuItemMap}Sys.UI.Controls.MenuBar.callBaseMethod(this,"dispose")},refresh:function(t){var e=this.get_form(),i=this.get_element(),n=$createControl("MenuBar",{ID:this.get_idPart(),CssClass:i.className.replace("MenuBar","").replace("vert",""),MenuCssClass:this.get_menuCssClass(),MouseHoverShow:this.get_mouseHoverShow(),GroupDirection:this.get_groupDirection()==Sys.UI.Controls.LayoutDirection.vert?"Vert":"Horz",LayoutDirection:this.get_layoutDirection()==Sys.UI.Controls.LayoutDirection.vert?"Vert":"Horz"},e);$createControl("DynamicMenu",{DataSource:t},e,n);var s=i.parentNode,o=$common.getNextSibling(i);e.removeControl(this,!0),o?n.insertBefore(o):n.appendTo(s)},get_useAutoLayout:function(){return this._useAutoLayout},set_useAutoLayout:function(t){this._useAutoLayout=t},get_layoutDirection:function(){return this._layoutDirection},set_layoutDirection:function(t){this._layoutDirection=t},get_layoutMode:function(){return this._layoutMode},set_layoutMode:function(t){var e=this._activeMenu;e&&e.hideMenu(),this._layoutMode=t,this.get_isInitialized()&&($Dom.setCssClass(this.get_showTree(),this.get_element(),"TreeBar"),this._bindScrollBar())},get_activeMenu:function(){return this._activeMenu},get_showTree:function(){return this._layoutMode==Sys.LayoutMode.tree||this._layoutMode==Sys.LayoutMode.treeOnly},get_showTreeOnly:function(){return this._layoutMode==Sys.LayoutMode.treeOnly},get_mouseHoverShow:function(){return this._hoverShow},set_mouseHoverShow:function(t){this._hoverShow=t},get_menuCssClass:function(){return this._menuCssClass},set_menuCssClass:function(t){this._menuCssClass=t},get_menus:function(){return this._menus},set_menus:function(t){this._menus=t},get_groupDirection:function(){return this._groupDirection},set_groupDirection:function(t){this._groupDirection=t},doFormInit:function(t){var e=this._menus;if(e){for(var i=this._menuItemMap={},n="$"+t.get_id()+"$",s=0,o=e.length;s<o;s++)for(var r=e[s].items,a=0,l=r.length;a<l;a++){var h=r[a];if(h.properties.shortcut>0){var _=n+h.id,d=$common.createHiddenDiv();d.id=_;var c=$createFromParams(h,d,t,!0);c.doFormInit(t),i[_]=c}}this._bindScrollBar()}},_bindScrollBar:function(){this._scrollBar&&(this._scrollBar.dispose(),this._scrollBar=null),Sys.Browser.isIE&&this.get_showTree()&&(this._scrollBar=_Z_81.create(this.get_element(),this.get_element().parentNode))},_removeOldMenuItem:function(t){var e=this._menuItemMap;if(e){var i=this.get_form(),n=e[t];if(n){n.get_element();n.doFormUninit(i),i.removeControl(n,!0),delete e[t]}}},_getMenuParams:function(t){var e=this._menuMap;if(!e){e=this._menuMap={};for(var i=this._menus,n=0,s=i.length;n<s;n++){var o=i[n];e[o.id]=o}}var r=e[t];if(!r)throw Error.invalidOperation("找不到菜单 "+t);return r},_getMenu:function(t,e){var i=this._getMenuParams(t),n=this.get_form(),s=new _Z_96($createDelegate(this,this._removeOldMenuItem)),o=e!==undefined?e:this._groupDirection;return s.createFromParams(i,n,"RootMenu",o)},setMenuItemProperty:function(t,e,i){var n=this.get_form()[t];if(n){return n["set_"+e].apply(n,i),!0}var s=this._menus;if(!s)return!1;for(var o=0,r=s.length;o<r;o++)for(var a=s[o].items,l=0,h=a.length;l<h;l++){var _=a[l];if(_.id==t){_.properties[e]=i;break}}},addRoot:function(t){this._roots.push(t)},_addResizeHandler:function(){this._useAutoLayout&&(this._windowResizeHandler=$createDelegate(this,this._windowResize),$common.addResizeHandler(window,this._windowResizeHandler))},_windowResize:function(t){this.get_element()}},Sys.UI.Controls.MenuBar.registerClass("Sys.UI.Controls.MenuBar",_Z_98),_Z_96=function(t){this.onCreateItem=t},_Z_96.prototype={createFromParams:function(t,e,i,n){return n==Sys.UI.Controls.LayoutDirection.horz?this.createFromParamsHorz(t,e,i):this.createFromParamsVert(t,e,i)},createFromParamsHorz:function(t,e,i){var n=new Sys.StringBuilder;this._renderMenuHorz(n,t,e,i);var s=$common.createHiddenDiv();s.innerHTML=n.toString();var o=s.firstChild;s.removeChild(o);var r=$createFromParams(t,o,e);$removeNode(s);for(var a=o.childNodes,l=0,h=0,_=a.length;h<_;h++)l=this.createMenuItem(a[h],t,e,l,r);return r},createFromParamsVert:function(t,e,i){var n=new Sys.StringBuilder;this._renderMenuVert(n,t,e,i);var s=$common.createHiddenDiv();s.innerHTML=n.toString();var o=s.firstChild;s.removeChild(o);var r=$createFromParams(t,o,e);return $removeNode(s),this.createMenuItem(o,t,e,0,r),r},createMenuItem:function(t,e,i,n,s){for(var o=t.firstChild,r=e.items,a=this.onCreateItem;null!=o;){var l=o.id;if(l){var h=r[n];h.properties.shortcut>0&&a&&a(l);var _=$createFromParams(h,o,i);_.doFormInit(i),_._icon=h.renderProps.icon,s.addItem(_),n++}o=$common.getNextSibling(o)}return n},_renderMenuVert:function(t,e,i,n){var s="$"+i.get_id()+"$",o=s+e.id;e.properties&&(n=$skin.joinCssClass(n,e.properties.cssClass)),t.append('<div class="Menu Vert ').append(n).append('" id="').append(o).append('">'),this._renderMenuHeadFoot(t,"thead");for(var r=e.items,a=0,l=r.length;a<l;a++){var h=r[a];this._renderMenuItemVert(t,h,s)}this._renderMenuHeadFoot(t,"tfoot"),t.append("</div>")},_renderMenuHeadFoot:function(t,e){t.append('<div class="').append(e).append('"></div>')},_renderMenuItemVert:function(t,e,i){var n=e.renderProps;n.beginGroup&&(t.append('<div class="MenuSeperator"'),n.hidden&&t.append(' style="display:none"'),t.append("></div>")),this._renderMenuItem(t,e,i)},_renderMenuHorz:function(t,e,i,n){var s="$"+i.get_id()+"$",o=s+e.id;e.properties&&(n=$skin.joinCssClass(n,e.properties.cssClass)),t.append('<div class="Menu Horz ').append(n).append('" id="').append(o).append('">'),this._renderMenuBlockStart(t);for(var r=e.items,a=0,l=r.length;a<l;a++){var h=r[a];this._renderMenuItemHorz(t,h,s)}this._renderMenuBlockEnd(t),t.append("</div>")},_renderMenuBlockStart:function(t){t.append('<div class="ChildBlock">'),this._renderMenuHeadFoot(t,"thead")},_renderMenuBlockEnd:function(t){this._renderMenuHeadFoot(t,"tfoot"),t.append("</div>")},_renderMenuItemHorz:function(t,e,i){e.renderProps.beginGroup&&(this._renderMenuBlockEnd(t),this._renderMenuBlockStart(t)),this._renderMenuItem(t,e,i)},_renderMenuItem:function(t,e,i){var n=e.renderProps,s=i+e.id,o=e.properties,r="MenuItem"+(n.disabled?" disabled":"");o.cssClass&&(r+=" "+o.cssClass),t.append('<div class="').append(r).append('" id="').append(s).append('"'),n.hidden&&t.append(' style="display:none"'),n.disabled&&t.append(' disabled="true"'),t.append(">"),t.append('<span class="MenuSpacerLeft"></span>');var a="MenuImage",l=n.icon,h=$craba.isIconfont(l);h&&(a+=" "+l),t.append('<span class="'+a+'">'),!h&&l&&t.append($craba.createIcon(l,null,this).outerHTML),t.append("</span>"),t.append('<span class="MenuCaption"'),o.hint&&t.append(' title="').append(o.hint).append('"'),t.append(">").append(o.text).append("</span>");var _,d=o.subMenu,c=n.shortcut,r=d?"MenuMore aicon-children":c?"MenuShortcut":"MenuNoMore";d||(_=c?n.shortcut:"&nbsp;"),t.append('<span class="').append(r).append('">').append(_).append("</span>"),t.append('<span class="MenuSpacerRight"></span>'),t.append("</div>")}},_Z_96.registerClass("_Z_96"),_Z_97=function(t){_Z_97.initializeBase(this,[t]),this._requireClick=!0},_Z_97.prototype={doClick:function(t,e){var i=this.get_showPage(),n=this.get_navigateUrl();if(i){var s=$common.getPathParam(i,"closeType");s&&(i=$common.removeUrlParam(i,"closeType"));var o=$common.showPage(this,i,this.get_text(),s);$settings.MDITabCaptionShowIcon&&this._icon&&o.set_icon(this._icon)}else n&&$common.navigateUrl(n,"_blank","get");_Z_97.callBaseMethod(this,"doClick",[t])},get_icon:function(){return this._icon},get_hasAction:function(){return this._showPage||this._navigateUrl},updated:function(){var t=this.get_langText();null!==t&&this.set_text(t)},get_groupDirection:function(){return this._groupDirection},set_groupDirection:function(t){this._groupDirection=t},get_text:function(){return this._text},set_text:function(t){if(this._text=t,this.get_isInitialized()){var e=this.get_element();if(e){var i=$common.getFirstChildByClassName(e,"MenuCaption");i||(i=$common.getFirstChildByClassName(e,"MenuRootCaption")),i&&(i.innerHTML=t)}}},set_cssClass:function(t){},get_cssClass:function(){},get_param:function(){return this._param},set_param:function(t){this._param=t},get_showPage:function(){return this._showPage},set_showPage:function(t){this._showPage=t},set_visible:function(t){this.get_element().style.display=t?"":"none"},get_navigateUrl:function(){return this._navigateUrl},set_navigateUrl:function(t){this._navigateUrl=t},raiseSubMenu:function(t){var e=this.get_events().getHandler("subMenu");e&&e(this,t)},add_subMenu:function(t){this.get_events().addHandler("subMenu",t)},remove_subMenu:function(t){this.get_events().removeHandler("subMenu",t)}},_Z_97.registerClass("_Z_97",_Z_249),Sys.UI.Controls.MenuRoot=function(t){Sys.UI.Controls.MenuRoot.initializeBase(this,[t]),this._requireMouseEnter=!0,this._requireMouseLeave=!0,this._requireMouseDown=!0,this._isActive=!1},Sys.UI.Controls.MenuRoot.prototype={initialize:function(){Sys.UI.Controls.MenuRoot.callBaseMethod(this,"initialize"),this.get_menu()&&(this._documentClickHandler=$createDelegate(this,this._documentClick),this._onFocusoutHandler=$createDelegate(this,this._focusout))},dispose:function(t){Sys.UI.Controls.MenuRoot.activeMenu=null,this._clearEvents();var e=this.get_menu();if(e){var i=this.get_form()[e];i&&(t?this.get_form().removeControl(i,!0):i.dispose())}Sys.UI.Controls.MenuRoot.callBaseMethod(this,"dispose")},doFormInit:function(){this.get_menuBar().addRoot(this)},get_menu:function(){return this._menu},set_menu:function(t){this._menu=t},_getEventTargetMenu:function(t){for(var e=t.target,i=0;i<3;){if(e==this._element)return e;if(!e||!e.tagName)return null;if("BODY"==e.tagName)return null;e=e.parentNode,i++}return null},get_menuBar:function(){var t=this.get_parent();return this._parent||this.set_parent(t),t},get_isActive:function(){return this._isActive},doMouseEnter:function(t){var e=this.get_menuBar();e.get_showTree()||this._isActive||this.get_enabled()&&(this._checkHideOtherMenu()?this.showMenu():this._isActive||e.get_mouseHoverShow()&&this.showMenu())},doMouseLeave:function(t){this.get_menuBar().get_showTree()||this.get_enabled()&&this._isActive&&this._showNormal()},doMouseDown:function(t){Sys.UI.Controls.MenuRoot.callBaseMethod(this,"doMouseDown",[t]);if(this._getEventTargetMenu(t)&&this.get_enabled()&&t.button==Sys.UI.MouseButton.leftButton){var e=this.get_menuBar();e.get_showTree()||!this._isActive?(this._showActive(),this.showMenu()):e.get_mouseHoverShow()||(this.hideMenu(),this._showOver())}},doClick:function(t){Sys.UI.Controls.MenuRoot.callBaseMethod(this,"doClick",[t]);this.get_menuBar().get_showTree()||!this.get_hasAction()&&this.get_menu()||(this._isActive?this.hideMenu():this._showNormal())},_checkHideOtherMenu:function(){var t=this.get_menuBar()._activeMenu;return t!=this&&(t&&t.hideMenu(),null!=t)},_getMenuCaption:function(){return this.get_element().firstChild},_showNormal:function(){this._isActive=!1,this.removeCssClass("MenuRootActive")},_setHoverOrDown:function(t){Sys.UI.Controls.MenuRoot.activeMenu&&Sys.UI.Controls.MenuRoot.activeMenu._showNormal(),Sys.UI.Controls.MenuRoot.activeMenu=this,this.addCssClass("MenuRootActive")},_showOver:function(){this._setHoverOrDown(!1)},_showActive:function(){this._setHoverOrDown(!0)},_getMenuControl:function(){var t=this.get_menu();if(t){var e=this.get_form()[t],i=this.get_menuBar();if(!(e=e||i._getMenu(t))._newInited){var n=i.get_menuCssClass();e._newInited=!0,e._menuCssClass=n,e.addCssClass(n),e.menuBar=i}return e}return null},showMenu:function(){var t=this.get_menuBar(),e=t.get_showTree();$craba._checkHideOtherBar(t),t.activeItem&&$Dom.removeCssClass(t.activeItem.get_element(),"active"),t.get_showTree()?t._activeMenu!==this&&t.get_showTreeOnly()&&this._checkHideOtherMenu():this._isActive=!0,t._activeMenu=this;var i=this._getMenuControl();if(i){if(i.menuItem=this,$Dom.addCssClass(this.get_element(),"Show"),$Dom.setCssClass(!e,i.get_element(),"ShowPopup"),this.raiseSubMenu(i),e)return i.showTree(this);i.get_element().parentNode!==document.body&&(document.body.appendChild(i.get_element()),$Dom.setVisible(i.get_element(),!0),i._expanded=!1);var n=this.get_bounds(),s=n.x,o=n.y+n.height-2,r=t.get_layoutDirection()==Sys.UI.Controls.LayoutDirection.vert||e;r&&(s+=n.width,o-=n.height-2),i.layoutVert=r,i.showAt(s,o),this._bindEvents()}},hideMenu:function(){this._isActive=!1,$Dom.removeCssClass(this.get_element(),"Show");var t=this.get_menuBar();t._activeMenu=null;var e=this._getMenuControl();if(e){if(t.get_showTree())return e.hideTree(this),void this._showNormal();e.hide(),this._showNormal(),this._clearEvents()}},_bindEvents:function(){this._isBindEvents||(this._isBindEvents=!0,$common.addClickHandler(document,this._documentClickHandler),document.attachEvent?document.attachEvent("onfocusout",this._onFocusoutHandler):$common.addBlurHandler(window,this._onFocusoutHandler))},_clearEvents:function(){this._isBindEvents&&(this._isBindEvents=!1,$common.removeClickHandler(document,this._documentClickHandler),document.attachEvent?document.detachEvent("onfocusout",this._onFocusoutHandler):$common.removeBlurHandler(window,this._onFocusoutHandler))},_focusout:function(t){Sys.Browser.isIE?t&&t.toElement&&"IFRAME"==t.toElement.tagName&&this.hideMenu():this.hideMenu()},_documentClick:function(t){if(!this.get_isDisposed()){var e=this._getEventTargetMenu(t);if(!e||!$Dom.hasClass(e,"MenuRoot")){var i=Sys.UI.Controls.MenuItem._getEventTargetMenuItem(t);i&&i.get_hasSubMenu()||(this.hideMenu(),t.cancel())}}}},Sys.UI.Controls.MenuRoot.registerClass("Sys.UI.Controls.MenuRoot",_Z_97),Sys.UI.Controls.Menu=function(t){Sys.UI.Controls.Menu.initializeBase(this,[t]),this._requireMouseOver=!0,this._requireMouseLeave=!0,this._requireClick=!0,this._items=[]},Sys.UI.Controls.Menu.prototype={dispose:function(){this._clearClickHandler(),this._inited&&(this.get_isPopup()&&this._documentClick(),$removeNode(this.get_element())),Sys.UI.Controls.Menu.callBaseMethod(this,"dispose"),delete this._items},get_controls:function(){return $common.getElementChildControls(this.get_element())},addItem:function(t){this._items.push(t)},set_selected:function(t){t&&(this._prevItem&&this._prevItem.removeCssClass("selected"),t.addCssClass("selected"),this._prevItem=t)},get_cssClass:function(){},set_cssClass:function(){},removeChilds:function(t){this._initChildControls();for(var e=this._controls,i=0;i<e.length;i++){var n=e[i];if(n.get_subMenu&&n.get_subMenu()){var s=t[n.get_subMenu()];s&&t.removeControl(s,!0)}t.removeControl(n,!0)}},_initChildControls:function(){this._controls||(this._controls=$common.getElementChildControls(this.get_element()))},_init:function(){this._inited||(document.body.appendChild(this._element),this._inited=!0)},doMouseOver:function(t){if(Sys.UI.Controls.Menu.callBaseMethod(this,"doMouseOver",[t]),!this.menuBar||!this.menuBar.get_showTree()){var e=$common.getFirstParentByClassLevel(t.target,"MenuItem",2);e&&$Dom.getEnabled(e)&&e.control!=this._curItem&&(this._curItem=e.control,this._deactivate(),this._showMenuItemSubMenu(e))}},doMouseLeave:function(t){this.menuBar&&this.menuBar.get_mouseHoverShow()&&(this._activeSubMenu||this.parentMenu||this._documentClick(t))},doClick:function(t,e){var i=$common.getFirstParentByClassLevel(t.target,"MenuItem",2);if(!i||$Dom.getEnabled(i)){if(i){var n=this.get_events().getHandler("_click");n&&n(this,[t,i.control])}$Dom.hasClass(i,"MenuText")?t.cancel():i&&this.menuBar&&this.menuBar.get_showTree()&&(this._curItem=i.control,this._showMenuItemSubMenu(i,e))}else t.cancel()},_calcPopupPosition:function(t,e,i,n,s){var o=getClientBounds(),r=getClientScrollPosition(),a=this.layoutVert;this.menuBar&&(this.menuBar.get_bounds().y,o.height);var l=e;e+2>=o.height?(l=o.height+r.y-n,this.menuItem&&!a&&(l-=this.menuItem.get_height())):e+n>o.height+r.y&&(l=o.height+r.y-n-10),(l=Math.max(l,0))>o.height+r.y&&(l=o.height+r.y-n-10);return{x:this._getNewX(t,i,o,s,a,l),y:l}},_getNewX:function(t,e,i,n,s,o){var r=t;return t+e>i.width&&(n>0?r=t+n-e:this.menuItem&&s?r=i.width-e-this.menuItem.get_width()-2:(r=i.width-e-2,o<0&&(r-=15))),r},add_popup:function(t){this.get_events().addHandler("popup",t)},remove_popup:function(t){this.get_events().removeHandler("popup",t)},popup:function(t,e,i){if(t){var n=$common.getBounds(t.target);0==t.clientX&&0==t.clientY&&(e=!1);var s=!1===e?n.x:t.clientX,o=!1===e?n.y+n.height:n.y+n.height/2,r=!1===i?o:Math.max(o,t.clientY);this.popupAt(s,r),t.stopPropagation()}},popupAt:function(t,e,i,n){var s=this.get_events().getHandler("popup");if(s){var o=new _Z_162;if(s(this,o),o.get_cancel())return}$craba._checkHideOtherPopup(this),this._inited||(this._init(),this._isPopup=!0);var r=this.get_element();0!=r.offsetWidth&&0!=r.offsetHeight||this.show(-2e3,-2e3);var a=this._calcPopupPosition(t,e,r.offsetWidth,r.offsetHeight,i);e!=a.y&&n&&(a.y=a.y-n),a.y<0&&(a.y=0),this.show(a.x,a.y),asyncCall($createDelegate(this,this._bindClickHandler))},_bindClickHandler:function(){this._documentClickHandler||(this._documentClickHandler=$common.addClickHandler(document,this._documentClick,this))},_clearClickHandler:function(){this._documentClickHandler&&($common.removeClickHandler(document,this._documentClickHandler),this._documentClickHandler=null)},_documentClick:function(t){this._clearClickHandler(),this.hide(),window.__lastMenu=null},showTree:function(t){if(this._expanded)return t.hideMenu();this._expanded=!0,this._init();var e=this.get_element(),i=t.get_element();e.parentNode!==i.parentNode&&i.parentNode.insertBefore(e,$common.getNextSibling(i)),$Dom.setVisible(e,!0),window.__lastMenu=this},hideTree:function(t){this._expanded=!1,this._deactivate(),this.get_element()&&$Dom.setVisible(this.get_element(),!1)},showAt:function(t,e){this._init();var i=this.get_element();i.style.height="auto";var n=this._calcPopupPosition(t,e,i.offsetWidth,i.offsetHeight,0);this.show(n.x,n.y)},show:function(t,e){this._init();var i=this.get_element(),n=i.style,s=getClientBounds();n.left=t+"px",n.top=e+"px",n.zIndex=$app.MenuMaxIndex,n.overflow="",n.height="";var o=e+i.scrollHeight;if(o>s.height&&o>s.height+getClientScrollPosition().y){n.overflow="auto";var r=e,a=this.layoutVert;0==r&&this.menuItem&&!a&&(r=this.menuItem.get_height()),n.height=s.height-r+"px",$common.setWidth(i,i.scrollWidth);var l=this._getNewX(t,i.offsetWidth,s,0,a,e);l!=t&&(n.left=l+"px")}window.__lastMenu=this,$craba.hideDropPopup()},_deactivate:function(){null!=this._activeSubMenu&&(this._activeSubMenu.hide(),this._activeSubMenu=null)},hide:function(t){window.__lastMenu==this&&(window.__lastMenu=null),this._curItem=null,this._deactivate(),this._clearClickHandler();var e=this.get_events().getHandler("hide");e&&e(this),this.menuItem&&this.menuItem.removeCssClass("Show"),this.get_element()&&(this.get_element().style.top="-10000px",t&&this.parentMenu&&this.parentMenu.hide&&this.parentMenu.hide(t))},get_isPopup:function(){return this._isPopup},set_isPopup:function(t){this._isPopup=t},_getSubMenu:function(t,e){var i=this.get_form()[e];if(this.get_isPopup())return i;if(!i){var n=t.get_menuRoot();if(n){var s=n.get_menuBar();s&&(i=s._getMenu(e,t.get_groupDirection()))}}return i},_showMenuItemSubMenu:function(t,e){var i=t.control;if(this.menuBar&&this.menuBar.get_showTree()){if(this.menuBar.activeItem&&$Dom.removeCssClass(this.menuBar.activeItem.get_element(),"active"),this.menuBar.activeItem=i,$Dom.addCssClass(t,"active"),e)return;this.menuItem&&this.menuItem._showActive()}var n=i?i.get_subMenu():null;if(n){this.beforeSubMenuHandler(i,n);var s=this._activeSubMenu=this._getSubMenu(i,n);if(s){s.menuBar=this.menuBar,s.menuItem=this.menuItem,s.parentMenu=this,this._menuCssClass&&s.addCssClass(this._menuCssClass),s._init();var o=s.get_element();if(this.menuBar&&this.menuBar.get_showTree())return o.parentNode===document.body&&t.parentNode.insertBefore(o,$common.getNextSibling(t)),$Dom.setVisible(o,!s._isShow),$Dom.setCssClass(!s._isShow,t,"Show"),void(s._isShow=!s._isShow);o.parentNode!==document.body&&($Dom.setVisible(o,!0),document.body.appendChild(o));var r=$Dom.getBounds(t),a=r.x+r.width,l=r.y;s.showAt(a,l),i.raiseSubMenu(s);var h=$Dom.getBounds(o),_=$Dom.getBounds(document.body);a+h.width>_.width&&(a=r.x-h.width),(l=h.y)+h.height>_.height&&(l=r.y-h.height+r.height),l<0&&(l=0),s.show(a,l);var d=parseInt($Dom._getCurrentStyle(this.get_element()).zIndex);isNaN(d)&&(d=0),o.style.zIndex=d+1}}},beforeSubMenuHandler:function(t,e){var i=this.get_events().getHandler("beforeSubMenu");i&&i(this,[t,e])},add_hide:function(t){this.get_events().addHandler("hide",t)},add_beforeSubMenu:function(t,e){this.get_events().addHandler("beforeSubMenu",t,e)}},Sys.UI.Controls.Menu.registerClass("Sys.UI.Controls.Menu",_Z_98),Sys.UI.Controls.Menu.create=function(t,e,i){if(!t)throw Error.argumentNull("form");if(!e)throw Error.argumentNull("properties");if(!e.id)throw Error.argumentNull("properties.id");if(!e.items||0==e.items.length)throw Error.argumentNull("properties.items");var n=e.id;delete e.id;var s=e.items;delete e.items;var o={};o.type=Sys.UI.Controls.Menu,o.properties=e,o.events=i,o.id=n,o.items=s;for(var r=0,a=s.length;r<a;r++){var l=s[r];l.type=Sys.UI.Controls.MenuItem;var h=r;l.id!==undefined&&(h=l.id,delete l.id),l.id=n+"_"+h;var _=l.renderProps={},d=l.properties;d&&d.icon&&(_.icon=d.icon,delete d.icon)}return(new _Z_96).createFromParams(o,t,"NormalMenu")},Sys.UI.Controls.MenuItem=function(t){Sys.UI.Controls.MenuItem.initializeBase(this,[t]),this._subMenu=null,this._shortcut=0},Sys.UI.Controls.MenuItem.prototype={doFormInit:function(t){t.addShortcut(this.get_shortcut(),this.click,this)},doFormUninit:function(t){this.get_enabled()&&t.removeShortcut(this.get_shortcut())},get_menuRoot:function(){var t=this.get_id(),e=t.indexOf("_");if(e>0){var i=t.substr(0,e),n=$find(i);return n&&Sys.UI.Controls.MenuRoot.isInstanceOfType(n)?n:null}return null},doClick:function(t){if(!this.get_hasSubMenu()){var e=this.get_menuRoot();e&&e.get_isActive()&&e.hideMenu()}Sys.UI.Controls.MenuItem.callBaseMethod(this,"doClick",[t,"item"]),window.__lastMenu&&window.__lastMenu.doClick(t,!0)},get_subMenu:function(){return this._subMenu},set_subMenu:function(t){this._subMenu=t},get_cssClass:function(){return this._cssClass},set_cssClass:function(t){this._cssClass=t},get_hasSubMenu:function(){return null!=this._subMenu},get_shortcut:function(){return this._shortcut},set_shortcut:function(t){this._shortcut=t},set_icon:function(t,e){this.setIcon(t,e)},setIcon:function(t,e){var i=$common.getFirstChildByClassName(this.get_element(),"MenuImage");$craba.isIconfont(t)?($dom.removeCssClass(i,e),$dom.addCssClass(i,t),this._icon=t):!t&&i.className.indexOf("aicon-")>-1?i.className="MenuImage":$craba.createIcon(t,i,this)}},Sys.UI.Controls.MenuItem.registerClass("Sys.UI.Controls.MenuItem",_Z_97),Sys.UI.Controls.MenuItem._getEventTargetMenuItem=function(t){var e=$common.getFirstParentByClassLevel(t.target,"MenuItem",2);if(e){var i=e.control;return i&&Sys.UI.Controls.MenuItem.isInstanceOfType(i)?i:null}},_Z_95=function(t){_Z_95.initializeBase(this,[t]),this._windowTitle=document.title},_Z_95.prototype={_internalShowStartPage:function(){var t=this._showPage,e=location.hash;e&&(e.length>0&&"#"==e.charAt(0)&&(e=e.substr(1)),(e=decodeURIComponent(e))&&(this._showPage=e)),this._showPage&&(this._isShowingStartPage=this._showPage==t,asyncCall($createDelegate(this,this.doShowStartPage)))},doShowStartPage:function(){var t=this._showPage;if(this._isShowingStartPage){this.doBeginShowStartPage();var e=t.split(","),i=e.length;if(1==i)this.showPage(t),this.doEndShowStartPage();else{var n=0,s=$createDelegate(this,function(){var t=e[n].trim();this.showPage(t).add_loaded(function(){++n<i?s():this.doEndShowStartPage()},this)});s()}}else{var o=t.indexOf("__Params="),r=null;if(o>0){var a=t.substring(o+"__Params=".length);if(a){(o=a.indexOf("&"))>0&&(a=a.substr(0,o)),a=unescape(a),r=$crabaJSON.deserialize(a,!0)}}this.showPage(t,null,r)}this._showPage=null,this._isShowingStartPage=!1},doBeginShowStartPage:function(){},doEndShowStartPage:function(){},_internalShowPage:function(t,e,i,n,s,o){var r=new t;return r._parentForm=this.get_form(),r.set_pageTimeout(s>0?s:$webManager.get_defaultTimeout()),r.set_clientSize(o),r._loadingElement=this.get_element(),r.showPage(e,i,n),r},_internalSaveLocation:function(t){var e=t?encodeURIComponent(t):"#";if(!(Sys.Browser.isIE&&Sys.Browser.version>=7&&e.length>2046))if($settings.EnableSaveMDIPageLocation)try{location.hash=e,document.title=this._windowTitle}catch(i){}else $common._MDIPageLocation=e},get_showPage:function(){return this._showPage},set_showPage:function(t){this._showPage=t}},_Z_95.registerClass("_Z_95",Sys.UI.Control),Sys.UI.Controls.SDIPanel=function(t){Sys.UI.Controls.SDIPanel.initializeBase(this,[t])},Sys.UI.Controls.SDIPanel.prototype={initialize:function(){Sys.UI.Controls.SDIPanel.callBaseMethod(this,"initialize"),this._internalShowStartPage()},showPage:function(t,e,i){return this._lastForm&&(this._lastForm.dispose(),this._lastForm=null),this._lastForm=this._internalShowPage(Sys.UI.CustomForm,t,this.get_element(),i),this._internalSaveLocation(t),this._lastForm}},Sys.UI.Controls.SDIPanel.registerClass("Sys.UI.Controls.SDIPanel",_Z_95),_Z_94=function(){_Z_94.initializeBase(this),this._isMDIForm=!0},_Z_94.prototype={dispose:function(){var t=(new Date).getTime();this._tabPage=null,_Z_94.callBaseMethod(this,"dispose"),$debug.log("表单释放时间: "+((new Date).getTime()-t))},get_caption:function(){return this._caption},set_caption:function(t){this._caption=t,this._tabPage&&this._tabPage.set_caption(t)},set_icon:function(t){if(this._icon=t,this._tabPage){var e=this._tabPage.get_buttonElement();e&&(t?($dom.removeCssClass(e,$settings.DefaultMDITabIcon),$dom.addCssClass(e,t)):e.className=this._tabPage._getCaptionClass())}},get_element:function(){return this._tabPage?this._tabPage.get_element():null},canClose:function(){if(this._forceClose)return!0;var t=new _Z_177("tab");return this.doClose(t),t.get_canClose()},get_isActive:function(){var t=this._tabPage;return!this.get_form()._hasMDI&&(!$app.get_hasModalPopup()&&!!t&&t.get_selected())},set_isActive:function(t){var e=this._tabPage;t&&e&&e.get_pageControl().set_selectedTab(e)},doCancel:function(){this.close()},close:function(t){this._forceClose=t,this._tabPage&&this._tabPage.close(t)}},_Z_94.registerClass("_Z_94",Sys.UI.CustomForm),Sys.UI.Controls.MDIPanel=function(t){Sys.UI.Controls.MDIPanel.initializeBase(this,[t]),this._pageAllowClose=!0,this._showPageAllowClose=!0,this._showTabHeader=!0,this._activeGroupIndex=0,this._offsetWidth=0},Sys.UI.Controls.MDIPanel.prototype={initialize:function(){Sys.UI.Controls.MDIPanel.callBaseMethod(this,"initialize"),this._removeHistory(),this.get_form().__mainPanel=this,this.get_form()._hasFlexBlock=!0,$settings.CrabaServer&&$Dom.addCssClass(document.body.parentNode,"MDIDocument"),this._tabCaptionChangedHandler=$createDelegate(this,this._tabCaptionChanged),this._windowKeyDownHandler=$common.addKeyDownHandler(document,this._doWindowKeyDown,this),this._initElements()},dispose:function(){this._windowResizeHandler&&($common.removeResizeHandler(this._getResizeElement(),this._windowResizeHandler),this._windowResizeHandler=null),this._windowKeyDownHandler&&($common.removeKeyDownHandler(document,this._windowKeyDownHandler),this._windowKeyDownHandler=null),$clearHandlers(this._barElement);var t=this._pageControl;if(t){for(var e=t.get_tabCount()-1;e>=0;e--){var i=t.getTab(e),n=i._form;n&&(n._tabPage=null),i._form=null,i.dispose()}t.dispose(),this._pageControl=null}this._tabNav&&(this._tabNav.dispose(),this._tabNav=null),this._tabsBlock=null,this._statusBars=null,this._tabCaptionChangedHandler=null,this._pageCache=null,Sys.UI.Controls.MDIPanel.callBaseMethod(this,"dispose")},_removeHistory:function(){history.pushState&&(history.pushState(null,null,document.URL),$addHandler(window,"popstate",function(){history.pushState(null,null,document.URL)}))},doFormInit:function(){this.initFrozenTab(),this._pageGroups&&this._pageGroups.length>0?(this._pageCache={},this._showActivePageGroup()):this._internalShowStartPage()},doFormLoaded:function(){this._initInnerBlock()},_initInnerBlock:function(){var t=this.get_innerBlockID();if(t){var e=this.get_form()[t];if(e){var i=e.get_element();$dom.addCssClass(i,"MDIInnerBlock"),this._barElement.appendChild(i),i.removeAttribute("style")}else $common.showError(String.format(Sys.Res.mdiInner,t))}},initFrozenTab:function(){var t=$userCache.get($craba.frozenTabCacheName);if(t&&0!=t.length)if($settings.FrozenTabMaxCount<1)$userCache.deleteCache($craba.frozenTabCacheName);else{var e=this._tabNav;e||(e=this._tabNav=new _Z_108(this)),e.showFrozenTab(t)}},addStatusBar:function(t){this._statusBars||(this._statusBars=[]),Array.add(this._statusBars,t)},_initElements:function(){var t=this.get_element(),e=t.parentNode;"TD"==e.tagName&&(e.style.padding="0px");var i=$common.getChildrenByTagName(t,"div"),n=this._barElement=i[0],s=this._childsElement=i[1];this._tabsBar=$common.getElementsByClassName(n,"MDITabBar",!0)[0],this._tabsBlock=$common.getFirstChildByTagName(this._barElement,"div");var o=$Dom._getCurrentStyle(s);this._childsPaddingTopBottom=parseInt(o.paddingTop)+parseInt(o.paddingBottom),this._childsPaddingLeftRight=parseInt(o.paddingLeft)+parseInt(o.paddingRight),this._windowResizeHandler=$common.addResizeHandler(this._getResizeElement(),this.raiseResize,this),this._bindBarEvents();var r=this._pageControl=$create(Sys.UI.Controls.PageControl,{showTabCloseButton:!0,autoFocus:!1,mdiPanel:this},s,null,this.get_form(),!0);r.add_selecting(this._doTabSelecting,this),r.add_selected(this._doTabSelected,this),r.add_tabClose(this._doTabClose,this),r._initHeaderBar(n)},_bindBarEvents:function(){$settings.DefaultMDITabContextMenu&&$common.addContextMenuHandler(this._barElement,this._doContextHandler,this),$settings.DefaultMDIContextMenu||$common.addContextMenuHandler(document,this._doDocumentContextHandler,this)},_doDocumentContextHandler:function(t){t.target&&"INPUT"==t.target.tagName||t.cancel()},_doContextHandler:function(t){var e=this._tabNav;e||(e=this._tabNav=new _Z_108(this)),e.raiseContextMenu(t)},_getResizeElement:function(){return window},_doWindowKeyDown:function(t){var e=t.keyCode;if(122==e)return $common.toggleFullScreen(),void t.cancel();var i=t.target;if(e==Sys.UI.Key.tab&&asyncCall(function(){$craba.activeTab(i.control)}),e==Sys.UI.Key.backspace){var n=i.type||i.getAttribute("type");if("text"==n||"number"==n||"textarea"==n||"password"==n){var s=n.readOnly!==undefined&&n.readOnly,o=n.disabled!==undefined&&n.disabeld;(s||o)&&t.preventDefault()}else{i.getAttribute("contenteditable")||t.preventDefault()}}},raiseResize:function(t){if(t){var e=this._childsElement.offsetWidth,i=this._childsElement.offsetHeight;this._resizeCurForm(e,i,0,0);var n=$common.isFullScreen();$dom.setCssClass(n,document.body,"fullscreen"),$craba.raiseMouseDown(t)}},_resizeCurForm:function(t,e,i,n){var s=this._pageControl;if(s){var o=s.get_selectedTab();if(o)for(var r=0,a=s.get_tabCount();r<a;r++){var l=s.getTab(r);l==o?l.doMDIResize(t,e,i,n):l.hasResized=!0}}},add_selected:function(t,e){return this.get_events().addHandler("selected",t,e)},remove_selected:function(t){this.get_events().removeHandler("selected",t)},add_tabItemRightClick:function(t,e){return this.get_events().addHandler("tabItemRightClick",t,e)},remove_tabItemRightClick:function(t){this.get_events().removeHandler("tabItemRightClick",t)},get_offsetWidth:function(){return this._offsetWidth},set_offsetWidth:function(t){this._offsetWidth=t,this.get_isInitialized()&&this.raiseResize(!0)},get_pageAllowClose:function(){return this._pageAllowClose},set_pageAllowClose:function(t){this._pageAllowClose=t},get_showPageAllowClose:function(){return this._showPageAllowClose},set_showPageAllowClose:function(t){this._showPageAllowClose=t},get_pageGroups:function(){return this._pageGroups},set_pageGroups:function(t){this._pageGroups=t},set_showTabHeader:function(t){this._showTabHeader=t,this.get_isInitialized()&&($Dom.setVisible(this._barElement,t),this.raiseResize(!0))},get_showTabHeader:function(){return this._showTabHeader},get_activeGroupIndex:function(){return this._activeGroupIndex},set_activeGroupIndex:function(t){this._activeGroupIndex!=t&&(this._activeGroupIndex=t,this.get_isInitialized()&&this._refreshPageGroup())},get_innerBlockID:function(){return this._innerBlockID},set_innerBlockID:function(t){this._innerBlockID=t},doBeginShowStartPage:function(){this.get_showPageAllowClose()||(this._disableStartPageClose=!0)},doEndShowStartPage:function(){this._disableStartPageClose=!1},doInitNewTabPage:function(t){this._pageAllowClose&&!this._disableStartPageClose||(t.allowClose=!1)},_refreshPageGroup:function(){for(var t=this._pageControl.get_tabs(),e=0,i=t.length;e<i;e++){var n=t[e];n.set_selected(!1);var s=n.get_tabButton();if(s){var o=s.get_element();this._tabsBlock.removeChild(o)}}Array.clear(t),this._showActivePageGroup()},_showActivePageGroup:function(){var t=this.get_pageGroups(),e=this.get_activeGroupIndex();if(t&&!(e<0)){var i=t[e];if(0!=i.length){this.set_showPageAllowClose(!1),this.doBeginShowStartPage();for(var n=this._pageCache,s=this._pageControl,o=0,r=i.length;o<r;o++){var a=i[o],l=a.url,h=$common.encodeUrlParams(l,a.params),_=n[h];_?(this._restoreTabPage(_),0==o&&s.set_selectedTab(_)):(0==o?(this.showPage(l,a.caption,null,a.pageTimeout),_=s.get_selectedTab()):(_=this._createTabPage(l,a.caption))._pageInfo=a,_._fullUrl=h,n[h]=_)}this.doEndShowStartPage()}}},_restoreTabPage:function(t){var e=t.get_tabButton();if(e){var i=e.get_element();this._tabsBlock.appendChild(i)}this._pageControl.addTab(t)},_findTabPage:function(t,e){var i=this.get_form().convertUrl(t);return i=$common.removeUrlParam(i,$settings.StaticVersionName),this._pageControl.findTabByName(i)},_getTabPage:function(t,e){var i=this._findTabPage(t);return i?this._pageControl.set_selectedTab(i):i=this._createTabPage(t,e),i},get_pageCount:function(){return this._pageControl.get_tabCount()},set_activeForm:function(t){for(var e=this._pageControl,i=e.get_tabCount(),n=0;n<i;n++){var s=e.getTab(n);if(s._form==t){e.set_selectedTab(s);break}}},get_activeTab:function(){return this._pageControl.get_selectedTab()},get_activeForm:function(){var t=this._pageControl.get_selectedTab();return t?t._form:null},get_tabs:function(){return this._pageControl.get_tabs()},get_forms:function(){for(var t=this._pageControl,e=t.get_tabCount(),i=new Array(e),n=0;n<e;n++)i[n]=t.getTab(n)._form;return i},_createTabPage:function(t,e){var i=this._pageControl,n=$common.createClassDiv("MDIChild Hided");this._childsElement.appendChild(n);var s=$common.createClassDiv(this._getCaptionClass());s.innerHTML=e,this._tabsBlock.appendChild(s);var o={pageControl:i,buttonElement:s,isMDITab:!0};this.doInitNewTabPage(o);var r=this.get_form(),a=$create(Sys.UI.Controls.TabPage,o,n,null,r,!0),l=r.convertUrl(t);return a.set_name(l),a},_getCaptionClass:function(){var t="MDITabCaption";return $settings.MDITabCaptionShowIcon&&(t+=" "+$settings.DefaultMDITabIcon),t},showContent:function(t,e,i){var n=this._getTabPage(t,e);n.get_element().innerHTML=i,this._pageControl.set_selectedTab(n)},showPage:function(t,e,i,n){var s=this._findTabPage(t),o=this._pageControl;if(s)return o.set_selectedTab(s),s._form;var r=$settings.MaxMDIPageCount;return $common.checkError(o.get_tabCount()>=r,String.format(Sys.Res.mdiTabMax,r)),s=this._createTabPage(t,e),this._initTabPageForm(s,t,e,i,n)},_initTabPageForm:function(t,e,i,n,s){var o=this._showPageInTabPage(t,e,i,n,s);return this._internalSaveLocation(e),t.add_captionChanged(this._tabCaptionChangedHandler),this._scrollNewTabToVisible(),this._pageControl.set_selectedTab(t),t._refreshFrozen(),o},_showPageInTabPage:function(t,e,i,n,s){var o="ClientHeight="+(this._childsElement.offsetHeight-18);o+=",ClientWidth="+(this._childsElement.offsetWidth-30),i||(i="&nbsp;……&nbsp;");var r=this._internalShowPage(_Z_94,e,t.get_element(),n,s,o);return t.set_caption(i),t._form=r,r._tabPage=t,r},_tabsSizeChanged:function(){var t=this._tabNavVisible=$settings.DefaultMDIShowNavButtons&&this._pageControl&&this._pageControl.get_tabCount()>1,e=this._tabNav;t&&!e&&(e=this._tabNav=new _Z_108(this)),e&&e.setBarVisible(t),t&&e.refreshButtons()},_tabCaptionChanged:function(t){this._scrollNewTabToVisible()},_scrollNewTabToVisible:function(){this._tabsSizeChanged();var t=this._tabsBlock;t.scrollLeft=t.scrollWidth,this._tabNav&&this._tabNavVisible&&this._tabNav.refreshButtons()},_calScrollLeft:function(t){for(var e=0,i=this._pageControl,n=0;n<t;n++){e+=i.getTab(n).get_buttonElement().offsetWidth}return e},closePage:function(t){var e=this._findTabPage(t);e&&e.close()},_doTabSelecting:function(t,e){var i=e.get_oldTab()._form;i&&i.blur()},_doTabSelected:function(t,e){var i=e.get_newTab(),n=i._form;if(n){this._internalSaveLocation(n.get_url()),i.hasResized&&(delete i.hasResized,i.doMDIResize());var s=this;return asyncCall(function(){if(n.focus(),s._tabNav&&s._tabNavVisible){var t=s._pageControl.get_selectedTabIndex();s._tabsBlock.scrollLeft=s._calScrollLeft(t),s._tabNav.refreshButtons()}}),void this._doEvent(n,e)}var o=i._pageInfo;if(o){var r=$common.encodeUrlParams(o.url,o.params);this._showPageInTabPage(i,r,o.caption,null,o.pageTimeout)}this._doEvent(i._form,e)},_doEvent:function(t,e){var i=this.get_events().getHandler("selected");i&&i(this,e),t.doActive(),$app.hideBlockPopups()},_doTabClose:function(t,e){var i=e._form;if(!i||!i.get_isLoading()){var n=!0;i&&(n=i.canClose())&&(i._tabPage=null,i.dispose(),e._form=null),n&&(e.remove_captionChanged(this._tabCaptionChangedHandler),t.removeTab(e),this._tabsSizeChanged(),e._fullUrl&&Array.remove(this._pageCache,e._fullUrl))}}},Sys.UI.Controls.MDIPanel.registerClass("Sys.UI.Controls.MDIPanel",_Z_95),_Z_108=function(t){this._mdi=t,this._pageControl=t._pageControl,this._tabsBar=t._barElement,this._captionBar=t._tabsBlock,this.__form=t.__form,this.initialize()},_Z_108.prototype={initialize:function(){var t=this._navBar=$common.createClassDiv("MDINavIcons dnone");this._mdiLeftButton=this._createTabNavButton(t,"aicon-left",this._tabLeft),this._mdiRightButton=this._createTabNavButton(t,"aicon-right",this._tabRight),this._mdiMenuButton=this._createTabNavButton(t,"aicon-shezhi",this._showPopupMenu),this._tabsBar.insertBefore(t,$common.getNextSibling(this._captionBar))},dispose:function(){this._mdiLeftButton&&(this._mdiLeftButton.dispose(),this._mdiLeftButton=null),this._mdiRightButton&&(this._mdiRightButton.dispose(),this._mdiRightButton=null),this._mdiMenuButton&&(this._mdiMenuButton.dispose(),this._mdiMenuButton=null)},showFrozenTab:function(t){var e=this._mdi;Array.forEach(t,function(t){var i=e._createTabPage(t.url,t.caption);i._refreshFrozen(!0),i._cacheInfo=t})},setBarVisible:function(t){$dom.removeCssClass(this._navBar,"dnone"),$Dom.setVisible(this._navBar,t,"flex"),this._mdiMenuButton.set_visible(t)},refreshButtons:function(){var t=this._pageControl,e=t.get_tabCount(),i=t.get_selectedTabIndex(),n=i>0,s=i<e-1,o=this._pageControl.get_tabCount()>5;this._showHelp(o),this._mdiLeftButton.set_visible(o),this._mdiRightButton.set_visible(o),this._mdiLeftButton.set_enabled(n),this._mdiRightButton.set_enabled(s)},_showHelp:function(t){t&&$common.addSteps([{group:"craba",control:{tipsId:"_MDIBar_TabCount",control:this._tabsBar},html:"鼠标在这个区域内滚动可以切换页面哟，试试吧!"},{group:"craba",control:{tipsId:"_MDIBar_TabMenu",control:this._mdiMenuButton},html:"这里可以快捷操作页面，试试吧!"}])},_createTabNavButton:function(t,e,i){var n="Button SpeedButton icononly "+e,s=new _Z_23(t,n,!1);return s.initialize(),s.__form=this.__form,s.add_click(i,this),s.set_visible(!1),s},raiseContextMenu:function(t){if(0!=this._pageControl.get_tabCount()){this._initMdiMenu(),this._refreshMenuText();var e=$Dom.getBounds(t.target);this._mdiTabmenu.popupAt(t.clientX+15,e.y+e.height)}},_showPopupMenu:function(t,e){this._initMdiMenu(),this._refreshMenuText();var i=$Dom.getBounds(e.target);this._mdiTabmenu.popupAt(i.x,i.y+i.height,i.width,i.height),e.stopPropagation()},_refreshMenuText:function(){var t=this._mdi,e=t.get_activeTab();if(e){var i=e.get_caption(),n=e.get_name(),s=e.get_allowClose(),o=$craba._checkTabFrozen(n);e.frozen=o;var r=$userCache.get($craba.frozenTabCacheName),a=r&&r.length>1,l=t.get_form(),h=this._mdiTabmenu.get_idPart(),_=l[h+"_closeTab"],d=l[h+"_frozenTab"],c=l[h+"_refreshTab"];s?(_.set_visible(!0),_.set_text("关闭当前页（"+i+"）"),d.set_visible(!0),d.set_text((o?"解锁":"锁定")+"当前页（"+i+"）"),d.setIcon(o?"aicon-08":"aicon-suoding1",o?"aicon-suoding1":"aicon-08"),c.set_visible(!0),c.set_text("刷新当前页（"+i+"）")):(_.set_visible(!1),d.set_visible(!1),c.set_visible(!1)),l[h+"_frozenAll"].set_visible(a)}},_initMdiMenu:function(){if(!this._mdiTabmenu){var t=[{properties:{text:"全屏切换",visible:!Sys.Browser.isIE,icon:"aicon-fullscreen"},events:{click:$createDelegate($common,$common.toggleFullScreen)}},{id:"frozenTab",properties:{visible:$settings.FrozenTabMaxCount>0,text:"锁定当前页",icon:"aicon-suoding1"},events:{click:$createDelegate(this,this._frozenTab)}},{id:"frozenAll",properties:{visible:!1,text:"全部解锁",icon:"aicon-08"},events:{click:$createDelegate(this,this._frozenAll)}},{id:"closeTab",properties:{text:"关闭当前页",icon:"aicon-close"},events:{click:$createDelegate(this,this._closeNow)}},{id:"refreshTab",properties:{text:"刷新当前页",icon:"aicon-refresh_icon"},events:{click:$createDelegate(this,this._refreshNow)}},{properties:{text:"关闭其它页",icon:"aicon-wendang4"},events:{click:$createDelegate(this,this._closeOther)}},{properties:{text:"关闭所有",icon:"aicon-close-circle"},events:{click:$createDelegate(this,this._closeAll)}}];this._mdiTabmenu=Sys.UI.Controls.Menu.create(this._mdi.get_form(),{id:this._mdi.get_idPart()+"_contextPopup",items:t})}},_closeOther:function(t){var e=this._mdi.get_activeForm();$common.closeAllMDIForms(t,function(t){return t!=e})},_closeAll:function(t){$common.closeAllMDIForms(t,function(t){return!0})},_frozenAll:function(t){$userCache.deleteCache($craba.frozenTabCacheName);var e=this._pageControl.get_tabs();Array.forEach(e,function(t){var e=t.get_tabButton().get_element();$dom.removeCssClass(e,"aicon-suoding1")})},_frozenTab:function(t){var e=this._mdi.get_activeTab();if(e){var i=this._mdi.get_activeForm();if(i){var n=e.get_name(),s=e._form,o=e.get_tabButton().get_element(),r=$userCache.get($craba.frozenTabCacheName);if(r||(r=[]),e.frozen){for(var a=0,l=r.length;a<l;a++){if((h=r[a]).url==n){Array.removeAt(r,a);break}}$dom.removeCssClass(o,"aicon-suoding1"),s._icon&&$dom.addCssClass(o,s._icon)}else{if(r.length>=$settings.FrozenTabMaxCount)return void $common.alert(String.format(Sys.Res.frozenTabTips,$settings.FrozenTabMaxCount));var h={url:n,caption:i.get_caption(),params:i.get_pageParams()};r.push(h),s._icon&&$dom.removeCssClass(o,s._icon),$dom.addCssClass(o,"aicon-suoding1")}$userCache.set($craba.frozenTabCacheName,r)}}},_refreshNow:function(t){var e=this._mdi.get_activeForm();e&&e.refresh()},_closeNow:function(t){$common.closeAllMDIForms(t,function(t){return t.get_isActive()})},_tabLeft:function(t){this._pageControl._tabScroll(-1)},_tabRight:function(t){this._pageControl._tabScroll(1)}},Sys.UI.Controls.StatusBar=function(t){Sys.UI.Controls.StatusBar.initializeBase(this,[t])},Sys.UI.Controls.StatusBar.prototype={doFormInit:function(t){var e=t.__mainPanel;if(!e)throw Error.abort("没有 MDIPanel 的页面不能用 StatusBar");e.addStatusBar(this)},canFocus:function(){return!1},doAdjustWidth:function(t){}},Sys.UI.Controls.StatusBar.registerClass("Sys.UI.Controls.StatusBar",Sys.UI.Controls.Container),_Z_181=function(t,e){_Z_181.initializeBase(this),this._index=t,this._target=e},_Z_181.prototype={get_index:function(){return this._index},get_checked:function(){return this._target.checked},set_checked:function(t){this._target.checked=t},get_target:function(){return this._target}},_Z_181.registerClass("_Z_181",Sys.EventArgs),_Z_93=function(t){_Z_93.initializeBase(this,[t]),this._tabIndex=-1,this._selectedIndex=-1,this._items=[]},_Z_93.prototype={set_dataSource:function(t){this.set_items(t)},get_dataSource:function(){return this.get_items()},get_dataValueField:function(){return this._dataValueField},set_dataValueField:function(t){this._dataValueField=t},get_dataTextField:function(){return this._dataTextField},set_dataTextField:function(t){this._dataTextField=t},get_enabledField:function(){return this._enabledField},set_enabledField:function(t){this._enabledField=t},get_imgField:function(){return this._imgField},set_imgField:function(t){this._imgField=t},get_iconField:function(){return this._iconField},set_iconField:function(t){this._iconField=t},get_cssClassField:function(){return this._cssClassField},set_cssClassField:function(t){this._cssClassField=t},get_selectedField:function(){return this._selectedField},set_selectedField:function(t){this._selectedField=t},set_rows:function(t){this._rows=t},get_rows:function(){return this._rows},get_items:function(t){if(t)return this._items;var e=this._selectedField;if(this._elementList&&e)for(var i=this.get_itemCount(),n=0;n<i;n++){var s=this._items[n];"object"==typeof s&&(s[e]=this.getSelected(n))}return this._items},getItemEnabled:function(t){if(!this._elementList){if(this._enabledField){var e=this.get_items()[t];return"object"!=typeof e||e[this._enabledField]}return!0}var i=this._getEnabledElement(t);return!!i&&$Dom.getEnabled(i)},setItemEnabled:function(t,e){if(this._elementList){var i=this._getEnabledElement(t);i&&$common.setDomEnabled(i,e,!0,!0)}},doInitItemEnabled:function(t,e){if(this._enabledField){var i=this._items[t];if("object"==typeof i){!1===i[this._enabledField]&&$common.setDomEnabled(e,!1,!0,!0)}}},_checkItemIndex:function(t){var e=this.get_itemCount();if(t<0||t>=e)throw Error.invalidOperation(String.format("{0} 值索引范围应为 [0-{1}]，现在是 {2}",this.get_id(),e-1,t))},_getEnabledElement:function(t){},get_itemCount:function(){return this._items?this._items.length:0}},_Z_93.registerClass("_Z_93",_Z_233),Sys.CheckGetDisplayTextEventArgs=function(t,e,i){this._index=t,this._text=e,this._data=i},Sys.CheckGetDisplayTextEventArgs.prototype={get_index:function(){return this._index},get_text:function(){return this._text},set_text:function(t){this._text=t},get_data:function(){return this._data}},_Z_234=function(t){_Z_234.initializeBase(this,[t]),this._layoutDirection=Sys.UI.Controls.LayoutDirection.vert,this._columnSplit=1,this._itemWidth=0},_Z_234.prototype={initialize:function(){_Z_234.callBaseMethod(this,"initialize"),this._items?this.doInitItems():this._items=[]},dispose:function(){this._clearItemList(),delete this._items,_Z_234.callBaseMethod(this,"dispose")},_getFlex:function(){return"inline-flex"},doFormInit:function(){this._inited=!0,this.get_enabled()||$common.setDomEnabled(this.get_element(),this.get_enabled(),!0,!0)},set_enabled:function(t){this.get_enabled()!=t&&(_Z_234.callBaseMethod(this,"set_enabled",[t]),this._inited&&$common.setDomEnabled(this.get_element(),t,!0,!0))},_addTr:function(t){var e=$common.createClassDiv("clear");t.appendChild(e)},doCreateItems:function(){this._elementList=[];var t=this.get_element();t.style.height="auto";var e=this._items.length;if(this._layoutDirection==Sys.UI.Controls.LayoutDirection.vert)for(n=0;n<e;n++)this.doAddVertItem(t,n);else{var i=this.get_columnSplit();if(i<=1)for(n=0;n<e;n++)this.doAddHorzItem(t,n);else for(var n=0;n<e;n++){0==n%i&&n>0&&this._addTr(t),this.doAddVertItem(t,n)}}},doItemClick:function(t){var e=this._elementList,i=t.target,n=this._selectedIndex=Array.indexOf(e,i);if(this.getItemEnabled(n)){var s=new _Z_181(n,i);this.doChange(s)}},_clearItemList:function(){if(this._elementList){for(var t=this.get_itemCount(),e=0;e<t;e++){i=this._elementList[e];$clearHandlers(i)}delete this._elementList}var i;(i=this.get_element()).innerHTML=""},set_items:function(t){this._value=null,this._selectedIndex=-1,this._items=t,this.get_isInitialized()&&(this._clearItemList(),t&&this.doInitItems())},get_layoutDirection:function(){return this._layoutDirection},set_layoutDirection:function(t){this._layoutDirection=t},get_itemWidth:function(){return this._itemWidth},set_itemWidth:function(t){this._itemWidth=t},get_columnSplit:function(){return this._columnSplit},set_columnSplit:function(t){this._columnSplit=t},getSelected:function(t){this._checkItemIndex(t);var e=this._elementList;if(e)return e[t].checked},setSelected:function(t,e){this._checkItemIndex(t);var i=this._elementList;if(i){var n=i[t];this._selectedIndex=t,n.checked=e,this._selectOne=n,this._changeCheckedStyle(n)}},doChange:function(t){_Z_234.callBaseMethod(this,"doChange",[t]),$common._changeCheckedStyle(t.get_target().parentNode,t.get_target().checked)},_changeCheckedStyle:function(t){$common._changeCheckedStyle(t.parentNode,value)},_getEnabledElement:function(t){var e=this._elementList[t];return e?e.parentNode:null},_doGetItemText:function(t){var e=$craba._getItemText(this,t),i=this.get_events().getHandler("getDisplayText");if(i){var n=this.get_items(!0)[t],s=new Sys.CheckGetDisplayTextEventArgs(t,e,n);i(this,s),e=s.get_text()}return e},_addItem:function(t,e,i,n){var s=this.get_id(),o=s+n+i,r=this._doGetItemText(i),a=$common.createClassDiv(e+" ChkBoxStyle");this._itemWidth>0&&(a.style.width=this._itemWidth+"px");var l="radio"==n?$common.createRadioButton(s):$common.createCheckBox();l.id=o,a.appendChild(l);var h=document.createElement("label");return h.className="ellipsis",h.innerHTML=r,h.htmlFor=o,r&&r.length>10&&r.indexOf("</")<0&&r.indexOf("/>")<0&&(h.title=r),a.appendChild(h),t.appendChild(a),this._elementList.push(l),$common.addClickHandler(l,this.doItemClick,this),this.doInitItemEnabled(i,a),a},add_getDisplayText:function(t){this.get_events().addHandler("getDisplayText",t)},remove_getDisplayText:function(t){this.get_events().removeHandler("getDisplayText",t)}},_Z_234.registerClass("_Z_234",_Z_93),Sys.UI.Controls.CheckBoxList=function(t){Sys.UI.Controls.CheckBoxList.initializeBase(this,[t])},Sys.UI.Controls.CheckBoxList.prototype={doAddVertItem:function(t,e){this._addItem(t,"VertItem",e,"check")},doAddHorzItem:function(t,e){this._addItem(t,"HorzItem",e,"check")},doInitItems:function(){this.doCreateItems(),this._initItemsChecked()},_initItemsChecked:function(){for(var t=this.get_itemCount(),e=0;e<t;e++){var i=$craba._getItemValue(this,e),n=this._elementList[e];this._value&&Array.contains(this._value,i)||this._selectedField&&this._items[e][this._selectedField]?n.checked=!0:n.checked=!1,$common._changeCheckedStyle(n.parentNode,n.checked)}},_clearSelectedFieldData:function(){if(this._selectedField)for(var t=this._items.length,e=0;e<t;e++)this._items[e][this._selectedField]=!1},_doSelectAll:function(t){for(var e=this.get_itemCount(),i=0;i<e;i++)this.setSelected(i,t)},selectAll:function(){this._doSelectAll(!0)},deselectAll:function(){this._doSelectAll(!1)},get_isAllSelected:function(){for(var t=this.get_itemCount(),e=0;e<t;e++)if(!this.getSelected(e))return!1;return!0},get_value:function(){for(var t=this.get_itemCount(),e=[],i=0;i<t;i++)if(this.getSelected(i)){var n=$craba._getItemValue(this,i);Array.add(e,n)}return this._valueType==_Z_59.string?e.join(this._getSplitChar()):e},_getSplitChar:function(){return","},get_noConvert:function(){return this._noConvert},set_noConvert:function(t){this._noConvert=t},set_value:function(t,e){if(this._noConvert&&e==undefined&&(e=!0),"string"==typeof t?t=t.split(this._getSplitChar()):"number"==typeof t&&(t=[t]),t instanceof Array){for(var i=[],n=0,s=t.length;n<s;n++){var o=t[n];if(e)i.push(o);else{var r=parseInt(o);isNaN(r)?i.push(o):i.push(r)}}t=i}this._value=t,this._elementList&&(this._clearSelectedFieldData(),this._initItemsChecked())},get_text:function(){for(var t=this.get_itemCount(),e=new Array,i=0;i<t;i++)if(this.getSelected(i)){var n=$craba._getItemText(this,i);Array.add(e,n)}return e}},Sys.UI.Controls.CheckBoxList.registerClass("Sys.UI.Controls.CheckBoxList",_Z_234),Sys.UI.Controls.RadioButtonList=function(t){Sys.UI.Controls.RadioButtonList.initializeBase(this,[t])},Sys.UI.Controls.RadioButtonList.prototype={doItemClick:function(t){var e=t.target;this._selectOne!=e&&(this._selectOne=e,Sys.UI.Controls.RadioButtonList.callBaseMethod(this,"doItemClick",[t]))},doChange:function(t){_Z_234.callBaseMethod(this,"doChange",[t]),$common._resetRadioGroupChecked(t.get_target())},_changeCheckedStyle:function(t){$common._resetRadioGroupChecked(t)},doAddVertItem:function(t,e){this._addItem(t,"VertItem",e,"radio")},doAddHorzItem:function(t,e){this._addItem(t,"HorzItem",e,"radio")},doInitItems:function(){this.doCreateItems();for(var t=this.get_itemCount(),e=0;e<t;e++){var i=$craba._getItemValue(this,e);if(this._value==i||this._selectedIndex==e){var n=this._elementList[e];n.checked=!0,this._selectOne=n,$common._changeCheckedStyle(n.parentNode,!0);break}}},get_text:function(){var t=this.get_selectedIndex();return t>=0?$craba._getItemText(this,t):null},get_value:function(){var t=this.get_selectedIndex();return t>=0?$craba._getItemValue(this,t):null},set_value:function(t){if(this._value=t,this._elementList){for(var e=-1,i=this.get_itemCount(),n=0;n<i;n++){if(t==$craba._getItemValue(this,n)){e=n;break}}this.set_selectedIndex(e)}},get_selectedItem:function(){return this._items[this.get_selectedIndex()]},get_selectedIndex:function(){if(this._elementList){for(var t=this.get_itemCount(),e=0;e<t;e++)if(this.getSelected(e))return e;return-1}return this._selectedIndex},set_selectedIndex:function(t){t<0&&this._selectedIndex>=0&&this.setSelected(this._selectedIndex,!1),this._selectedIndex=t,this._elementList&&t>=0&&this.setSelected(t,!0)},getInputAction:function(){return"选择"}},Sys.UI.Controls.RadioButtonList.registerClass("Sys.UI.Controls.RadioButtonList",_Z_234),Sys.UI.Controls.ListBox=function(t){Sys.UI.Controls.ListBox.initializeBase(this,[t]),this._shiftSelectedIndex=-1,this._requireMouseDown=!0,this._requireKeyDown=!1,this._requireDblClick=!0},Sys.UI.Controls.ListBox.prototype={initialize:function(){Sys.UI.Controls.ListBox.callBaseMethod(this,"initialize"),this._items&&(this._initValueBySelectedIndex(),this._initItems())},_initValueBySelectedIndex:function(){var t=this._selectedIndex;t>=0&&(this._value=$craba._getItemValue(this,t))},getInputAction:function(){return"选择"},_initItems:function(){var t=this.get_element();t.innerHTML="";var e=this.get_itemCount();this._selectedIndex=-1,this._isSelectedArray=new Array(e),this._elementList=[];for(var i=0;i<e;i++){var n=$common.createClassDiv("BoxItem"),s=$common.textToHtml($craba._getItemText(this,i));this._imgField&&(s+="<img src='"+this._getItemImg(i)+"'/>"),$Dom.addCssClass(n,$craba._getItemCssClass(this,i)),$Dom.addCssClass(n,$craba._getItemIcon(this,i)),n.innerHTML=s,t.appendChild(n),this._elementList.push(n)}this._refreshSelected()},_refreshSelected:function(){for(var t=this._value,e=0,i=this.get_itemCount();e<i;e++){var n,s=$craba._getItemValue(this,e);this.get_multiSelect()?(n=$craba._getItemSelected(this,e),n=t&&Array.contains(t,s)||n):n=t==s,this._doSetSelected(e,n)}},_findRow:function(t){var e=t.target;return e==this._element?null:e},_indexOfRow:function(t){return Array.indexOf(this._elementList,t)},_isRowEnabled:function(t){if(!t||!this.get_enabled())return!1;var e=this._indexOfRow(t);return this.getItemEnabled(e)},doDblClick:function(t){var e=this._findRow(t);if(this._isRowEnabled(e)){var i=this.get_events().getHandler("_dblClick");i&&i(this,t)}},doMouseDown:function(t){var e=this._findRow(t);if(this._isRowEnabled(e)){var i=this._indexOfRow(e),n=this.get_multiSelect(),s=t.shiftKey||t.ctrlKey;if(n&&s){if(t.shiftKey)this._shiftSelectedIndex<0&&(this._shiftSelectedIndex=this._selectedIndex),this._selectTo(i);else if(t.ctrlKey){this._shiftSelectedIndex=-1;var o=this.getSelected(i);this.setSelected(i,!o)}}else n&&this._doDeselectAll(),this._selectedIndex>=0&&this._doSetSelected(this._selectedIndex,!1),this._shiftSelectedIndex=-1,this.setSelected(i,!0)}},set_items:function(t){this._items=t,this.get_isInitialized()&&t&&this._initItems()},getSelected:function(t){this._checkItemIndex(t);var e=this._isSelectedArray;return!!e&&e[t]},_doSetSelected:function(t,e){if(this.getItemEnabled(t)){this._checkItemIndex(t),this._isSelectedArray[t]=e;var i=this._elementList[t];$Dom.setCssClass(e,i,"active"),e&&(this._selectedIndex=t)}},setSelected:function(t,e){this._doSetSelected(t,e),this.doChange()},get_selectedIndex:function(){return this._selectedIndex},set_selectedIndex:function(t){this._selectedIndex=t,this.get_isInitialized()&&(this._initValueBySelectedIndex(),this._refreshSelected())},get_multiSelect:function(){return this._multiSelect},set_multiSelect:function(t){this._multiSelect=t},_doSelectAll:function(t,e){for(var i=this.get_itemCount(),n=0;n<i;n++)this._doSetSelected(n,t);e&&this.doChange()},_doDeselectAll:function(){this._doSelectAll(!1,!1)},selectAll:function(){this._doSelectAll(!0,!0)},deselectAll:function(){this._doSelectAll(!1,!0)},get_isAllSelected:function(){for(var t=this.get_itemCount(),e=0;e<t;e++)if(!this.getSelected(e))return!1;return!0},get_value:function(){return this._getSelectedData(!0)},set_value:function(t){this._value=t,this.get_isInitialized()&&this._refreshSelected()},get_text:function(){return this._getSelectedData(!1)},get_selectedItems:function(){for(var t=this.get_itemCount(),e=[],i=0;i<t;i++)this.getSelected(i)&&e.push(this.get_items(!0)[i]);return Object.clone(e)},_getSelectedData:function(t){var e=this.get_itemCount();if(this.get_multiSelect()){for(var i=[],n=0;n<e;n++)if(this.getSelected(n)){var s=t?$craba._getItemValue(this,n):$craba._getItemText(this,n);Array.add(i,s)}return i}for(n=0;n<e;n++)if(this.getSelected(n))return t?$craba._getItemValue(this,n):$craba._getItemText(this,n);return null},_selectTo:function(t){var e=this.get_itemCount();if(0!=e){t<0?t=0:t>=e&&(t=e-1),this._doDeselectAll();for(var i=this._shiftSelectedIndex,n=Math.min(i,t),s=Math.max(i,t),o=n;o<=s;o++)this._doSetSelected(o,!0);this.doChange()}},_getEnabledElement:function(t){var e=this._elementList[t];return e||null}},Sys.UI.Controls.ListBox.registerClass("Sys.UI.Controls.ListBox",_Z_93),Sys.UI.Controls.DropDownCheckBoxList=function(t){Sys.UI.Controls.DropDownCheckBoxList.initializeBase(this,[t]),this._columnSplit=1,this._selectedIndex=-1,this._moveItemIndex=-1,this._items=[],this._itemWidth=100,this._layoutDirection=Sys.UI.Controls.LayoutDirection.vert,this._dropDownStyle=_Z_24.dropDown,this._showOkButton=!0},Sys.UI.Controls.DropDownCheckBoxList.prototype={initialize:function(){Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"initialize"),this._refreshReadOnly()},dispose:function(){this._popup&&(this._popup.dispose(),this._popup=null),this._rows&&delete this._rows,this._items&&delete this._items,Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"dispose")},set_showOkButton:function(t){this._showOkButton=t},get_showOkButton:function(){return this._showOkButton},set_showButtons:function(t){this._showButtons=t,this._icon="aicon-down-circle"},get_showButtons:function(){return this._showButtons},_refreshReadOnly:function(){this._getAllowSearch()?this.get_element().removeAttribute("readOnly"):this.get_element().setAttribute("readOnly","readOnly")},set_noSortValue:function(t){this._noSortValue=t},get_noSortValue:function(){return this._noSortValue},selectAll:function(t){this._popupWindow||(this._popupWindow=this.createPopupWindow()),this._rebuild&&this._popup.dataBind(),this._popup.selectAll(t==undefined||t),this.fastHide()},doFormLoaded:function(){Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doFormLoaded"),this._selectedAll&&this.selectAll(!0)},set_itemWidth:function(t){this._itemWidth=t},get_itemWidth:function(){return this._itemWidth},set_dataSource:function(t){this.set_items(t)},get_dataSource:function(){return this.get_items()},get_items:function(){return this._searchItems?this._searchItems:this._items},set_items:function(t,e){if(t||(t=[]),this._items=t,this._searchItems=null,!1!==e&&(this._value=null,this.set_text("")),delete this._rows,t&&"undefined"==typeof t.length)throw Error.argumentOutOfRange("value",t,"不支持的下拉列表数据类型");this.get_isInitialized()&&this._popup&&(this._rebuild=!0,this._selectedAll=!1),!1===e&&this.set_value(this._value)},get_itemCount:function(){return this.get_items().length},_getSplitChar:function(){return","},get_value:function(t){return this._value||(this._value=[]),t?this._value:this._valueType==_Z_59.string?this._value.join(this._getSplitChar()):this._value},set_value:function(t){if(!t)return this._value=[],this.set_text(""),void this._initItemsChecked();var e=t;Array.isInstanceOfType(t)||(e=t.toString().trim().split(this._getSplitChar()));var i=[],n=this._value=[],s=!0,o=this._getSplitChar();if(this._noSortValue)for(var r=0,a=e.length;r<a;r++){if((u=$craba.getItemIndexByValue(this._items,this.get_dataValueField(),e[r]))>-1){var l=$craba._getItemValue(this,u);n.push(l),l==e[r]&&(i.push($craba._getItemText(this,u)),s=!1)}}else for(var r=0,a=this._items.length;r<a;r++){var h=(d=this._items[r])[this.get_dataValueField()];Object.isUndefinedOrNull(h)||(Array.contains(e,h)||Array.contains(e,h.toString()))&&(n.push(h),i.push(d[this.get_dataTextField()]),s=!1)}if(s&&-1!=t){var _=t?t.toString():"";_=o.concat(_,o);for(var r=0,a=this._items.length;r<a&&(_!==o&&""!==_);r++){var d=this._items[r],c=d[this.get_dataTextField()];c=o.concat(c,o);var u=_.indexOf(c);u<0||(i.push(c),Array.add(n,d[this.get_dataValueField()]))}}this.set_text(i.join(",")),this._initItemsChecked()},set_text:function(t){if(!this._showButtons)return Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"set_text",[t]);var e=this.get_element();if(e.innerHTML="",t){var i=t.split(","),n="";Array.forEach(i,function(t,e){n+='<div class="Button" index="'+e+'">'+t+"<span></span></div>"},this),e.innerHTML=n}},_getAllowHandInput:function(){return this._dropDownStyle==_Z_24.dropDownEdit},doClick:function(t){if(this._showButtons){var e=t.target;if(e.tagName){var i=e.getAttribute("index");i||(i=e.parentNode.getAttribute("index"));var n=e.offsetWidth-t.rawEvent.offsetX<22;if(Object.isUndefinedOrNull(i)||!n)return this.toggleDroppedDown(),void t.stopPropagation();this._value[i];Array.removeAt(this._value,i);var s=this.get_element(),o=s.childNodes[i];$removeNode(o);for(var r=s.childNodes,a=i,l=r.length;a<l;a++)r[a].setAttribute("index",a);this._initItemsChecked(),this._raiseChanged()}}else this._getAllowHandInput()||(this.toggleDroppedDown(),t.stopPropagation())},_initOldValue:function(){this._oldValue=this._value},get_selectedIndex:function(){return this._selectedIndex},set_selectedIndex:function(t){this._selectedIndex=t,t>=0?this.set_text($craba._getItemText(this,t)):this.set_text("")},get_selectedItems:function(){for(var t=this.get_itemCount(),e=[],i=this.get_value(!0),n=0;n<t;n++){var s=this.get_items()[n],o=s[this._dataValueField];Array.contains(i,o)&&e.push(s)}return Object.clone(e)},get_columnSplit:function(){return this._columnSplit},set_columnSplit:function(t){this._columnSplit=t},get_layoutDirection:function(){return this._layoutDirection},set_layoutDirection:function(t){this._layoutDirection=t},_getIsScrolling:function(){var t=this.get_dropDownRows(),e=this._getRowCount();return t>0&&e>t},_getRowCount:function(){var t=this.get_itemCount();return this._layoutDirection==Sys.UI.Controls.LayoutDirection.horz&&this._columnSplit>1&&(t=Math.ceil(t/this._columnSplit)),t},canDropDown:function(){return!0},_baseDoChange:function(t){Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doChange",[t])},doChange:function(t){this._baseDoChange(t)},createPopupWindow:function(){return this._popup=this._popupWindow=new _Z_76(this),this._popup.render()},doInitPopup:function(){var t=this._popup;t&&(this._searchItems||this._rebuild?(this._searchItems=null,this._rebuild=null,t.dataBind(),this._initItemsChecked()):this._searched?(this._searched=!1,this._initItemsChecked()):this.showOkButton()&&this._initItemsChecked(),Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doInitPopup"))},_getScrollDiv:function(){return this._popup._itemContainer},_getPopupScrollWidth:function(){return this._popup._itemContainer.scrollWidth},_getPopupScrollHeight:function(){return this._popup._itemContainer.scrollHeight},isCheckedAll:function(){if(!this._value)return!1;return this.get_itemCount()<=this._value.length&&this._value.length>0},isIndeterminate:function(){return!!this._value&&(!this.isCheckedAll()&&this._value.length>0)},_initItemsChecked:function(){if(this._popup&&this._popup._elementList&&!this._rebuild){var t=this.get_itemCount();this._selectedAll=!0;for(var e=0;e<t;e++){var i=$craba._getItemValue(this,e),n=this._popup._elementList[e];this._value&&Array.contains(this._value,i)?n.checked=!0:(n.checked=!1,this._selectedAll=!1),$common._changeCheckedStyle(n.parentNode,n.checked)}this._selectedAll=this._selectedAll&&t>0,this._popup._setCheckAll(this._selectedAll)}},get_selectedAll:function(){return!!(this._popup&&this._popup._checkAllInputBox?this._popup._checkAllInputBox.checked:this._selectedAll)&&(!this._searchItems||this._searchItems.length==this._items.length)},set_selectedAll:function(t){this._selectedAll=t,this.get_isInitialized()&&this.selectAll(t)},doKeyDown:function(t){this.__keyDown=!0;var e=!0,i=t.keyCode,n=(this.get_droppedDown(),this.get_itemCount()),s=!this._getAllowSearch();if(i!=Sys.UI.Key.esc){switch(this.__keyDown||(this._beforeText=this.get_text()),i){case Sys.UI.Key.tab:case Sys.UI.Key.alt:case Sys.UI.Key.enter:e=!1,this.__keyDown=!1}if(0==n)return s&&e&&t.cancel(),void Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doKeyDown",[t]);s&&e?t.cancel():Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doKeyDown",[t])}},doBlur:function(t){this.get_isDisposed()||(Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doBlur",[t]),(this._drpSearchText||this.__keyDown)&&(this.__keyDown&&(this._value=null,this._searchItems=null,this._popup&&this._popup.dataBind()),this.__keyDown=!1,this._drpSearchText=null,this.set_text("")))},_canBlur:function(){return!this.get_droppedDown()},doKeyUp:function(t){this.__keyDown=!1,Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doKeyUp",[t]);var e=t.keyCode;if(this._getAllowSearch()&&e!=Sys.UI.Key.enter&&e!=Sys.UI.Key.esc&&e!=Sys.UI.Key.tab){var i=this.get_text();i!=this._drpSearchText&&i!=this._beforeText&&(this._value=null,this._searched=!0,this._drpSearchText=i||null,this.get_droppedDown()||this.dropDown(),this._searchItems=this._findItemsByStr(i),delete this._rows,this._popup.dataBind(),Sys.UI.Controls.DropDownCheckBoxList.callBaseMethod(this,"doInitPopup"))}},doKeyPress:function(t){},doRowMouseDown:function(t){t.cancel()},add_changed:function(t,e){return this.get_events().addHandler("_changed",t,e)},remove_changed:function(t){this.get_events().removeHandler("_changed",t)},getItemEnabled:function(t){if(!this._rows){if(this._enabledField){var e=this.get_items()[t];return"object"!=typeof e||e[this._enabledField]}return!0}var i=this._rows[t];return!!i&&$Dom.getEnabled(i)},doInitItemEnabled:function(t,e){var i=this._rows;if(i||(i=this._rows=[]),i.push(e),this._enabledField){var n=this.get_items()[t];if("object"==typeof n){n[this._enabledField]||$common.setDomEnabled(e,!1,!0,!0)}}},get_enabledField:function(){return this._enabledField},set_enabledField:function(t){this._enabledField=t},_getAllowSearch:function(){return this._dropDownStyle==_Z_24.dropDownSearch||this._dropDownStyle==_Z_24.dropDownSearchEdit},set_hideCheckAll:function(t){this._hideCheckAll=t},get_hideCheckAll:function(){return this._hideCheckAll},doCloseUp:function(){this._popup&&this._popup.doCloseUp()},_raiseChanged:function(){var t=this.get_events().getHandler("_changed");t&&t(this),this._initOldValue()},showOkButton:function(){return this._showOkButton&&(this.get_events().hasEvent("_changed")||this.get_events().hasEvent("_change"))}},Sys.UI.Controls.DropDownCheckBoxList.registerClass("Sys.UI.Controls.DropDownCheckBoxList",_Z_99),_Z_76=function(t){_Z_76.initializeBase(this,[t]),this._maxLength=0,this._itemWidth=t.get_itemWidth(),this._elementList=[],this._value=t.get_value(!0)||"",this._popupClassName="CheckBoxListPopup",this._vert=t._layoutDirection==Sys.UI.Controls.LayoutDirection.vert,this._value&&(this._value=t._getSplitChar().concat(this._value,t._getSplitChar()))},_Z_76.prototype={dispose:function(){this._checkAllInputBox&&$clearHandlers(this._checkAllInputBox),this._popupWindow&&($clearHandlers(this._popupWindow),$removeNode(this._popupWindow)),_Z_76.callBaseMethod(this,"dispose")},_clear:function(){},render:function(){this.init(),this.initOkButton();var t=this._popupWindow;return this._vert&&$Dom.addCssClass(t,"Vert"),this.dataBind(),t},initTopBar:function(){_Z_76.callBaseMethod(this,"initTopBar");var t=this._popupWindow,e=this._checkAllInputBox=this._createItem(t,"VertItem ChkAll",-1,"全选",this._edit.isCheckedAll());$common.addClickHandler(e,this.raiseCheckAll,this);var i=$common.createClassDiv("VertItem dflex");t.appendChild(i),i.appendChild(e.parentNode),e.parentNode.className="ChkBoxStyle"},initOkButton:function(){if(this._edit.showOkButton()){var t=this._popupWindow,e=this._edit.get_form(),i=$createControl("Button",{Text:"确认",OnClick:$createDelegate(this,this._doOk)},e,null,!0);i.appendTo(t),this._okBtn=e[i.ID]}},dataBind:function(t){this._itemContainer.innerHTML="",this._elementList=[],this._initHeight(),this._setCheckAll(this._edit.isCheckedAll()),this._createSplitRows(this._itemContainer,this._edit.get_itemCount())},_initHeight:function(){var t=this._itemContainer,e=this._popupWindow,i=this._edit._getIsScrolling(),n=this._getDisplayRows(),s=n*$settings.DefaultItemHeight,o=n<2||this._edit._hideCheckAll;this._searchEdit&&(s+=$settings.DefaultItemHeight+10),o||(s+=$settings.DefaultItemHeight),this._okBtn&&(s+=this._okBtn.get_height()+20),s+=this._edit.getBottomHeight(),t.style.overflow=i?"auto":"hidden",$common.setHeight(e,s+3);this._checkAllInputBox.parentNode.style.display=o?"none":"flex",this._vert||$common.setWidth(e,this._edit.get_columnSplit()*(this._itemWidth+1)+$settings.GridDefaultScrollBarWidth)},_getRowCount:function(){return this._edit._getRowCount()},_clearItemList:function(){if(this._elementList){for(var t=0,e=this._elementList.length;t<e;t++)$clearHandlers(this._elementList[t]);delete this._elementList}},get_maxLength:function(){return this._maxLength},set_maxLength:function(t){this._maxLength=t},_addTr:function(t){var e=$common.createClassDiv("clear");t.appendChild(e)},_createSplitRows:function(t,e){var i=this._edit.get_columnSplit();if(i<=1||this._vert)for(n=0;n<e;n++)this.doAddVertItem(t,n);else for(var n=0;n<e;n++){0==n%i&&n>0&&this._addTr(t),this.doAddHorzItem(t,n)}},_createItem:function(t,e,i,n,s){var o=this._edit,r=$common.createClassDiv(e+" ChkBoxStyle");this._itemWidth>0&&!this._vert&&(r.style.width=this._itemWidth+"px");var a=$common.createCheckBox(),l=o.get_id()+"_check"+i;a.id=l,r.appendChild(a);var h=document.createElement("label");return h.className="ellipsis",h.innerHTML=n,h.htmlFor=l,n.length>10&&(h.title=n),r.appendChild(h),t.appendChild(r),a.index=i,s&&(a.checked=!0,$common._changeCheckedStyle(r,!0)),i>-1&&o.doInitItemEnabled(i,r),a},_addItem:function(t,e,i){var n=$craba._getItemText(this._edit,i),s=$craba._getItemValue(this._edit,i),o=this._edit._getSplitChar(),r=this._value.indexOf(o.concat(s,o))>-1,a=this._createItem(t,e,i,n,r);return this._elementList.push(a),a.parentNode},doPopupClick:function(t){var e="undefined"==typeof t.tagName,i=e?t.target:t;if((!e||"INPUT"==i.tagName)&&1!=i.disabled){var n=this._edit,s=$craba._getItemValue(n,i.index);n._drpSearchText&&(n._drpSearchText=null),this._raiseChange(n,t,e,i)&&(this._okBtn?($common._changeCheckedStyle(i.parentNode,i.checked),this._internalCheckInitCheckAllBox()):(i.checked?Array.add(n.get_value(!0),s):Array.remove(n.get_value(!0),s),n.set_value(n.get_value(!0))),this._okBtn||n._raiseChanged())}},_doOk:function(t){for(var e=this._edit,i=e.get_value(!0)||[],n=[],s=0,o=this._edit.get_itemCount();s<o;s++){if(this._elementList[s].checked){var r=$craba._getItemValue(e,s);n.push(r)}}i.length!=n.length?(e.set_value(n),e._raiseChanged()):Object.isEqual(i,n)||(e.set_value(n),e._raiseChanged())},_raiseChange:function(t,e,i,n){var s=t.get_events().getHandler("_change");if(!s)return!0;t._changeRaised=!0;var o=new _Z_162;return s(t,o),!o.get_cancel()||(i?e.cancel():n.checked=!n.checked,!1)},doAddVertItem:function(t,e){this._addItem(t,"VertItem",e)},doAddHorzItem:function(t,e){this._addItem(t,"HorzItem",e)},raiseCheckAll:function(t){var e=this._checkAllInputBox;e._indeterminate&&(e.checked=!0,e._indeterminate=!1),$common._changeCheckedHalfStyle(e.parentNode,e.checked,!1),this._doSelectAll(e.checked),this._okBtn||this._edit._raiseChanged()},selectAll:function(t){this._doSelectAll(t,!0),this._setCheckAll(t)},_doSelectAll:function(t,e){for(var i=this._edit,n=i.get_items(),s=i._searchItems?Object.clone(i.get_value()):[],o=0,r=n.length;o<r;o++)if(i.getItemEnabled(o)){var a=this._elementList[o];a.checked=t,$common._changeCheckedStyle(a.parentNode,t);var l=$craba._getItemValue(i,o);t?Array.add(s,l):Array.remove(s,l)}!e&&this._okBtn||i.set_value(s)},_doKeyUp:function(t){_Z_76.callBaseMethod(this,"_doKeyUp",[t]),this._edit._initItemsChecked()},_internalCheckInitCheckAllBox:function(){for(var t=!0,e=!1,i=0,n=this._edit.get_itemCount();i<n;i++){var s=this._elementList[i];s.checked&&(e=!0),!s.checked&&this._edit.getItemEnabled(i)&&(t=!1)}this._setCheckAll(t,!t&&e)},_setCheckAll:function(t,e){e=Object.isUndefinedOrNull(e)?this._edit.isIndeterminate():e;var i=this._checkAllInputBox;i.checked=t,i.indeterminate=e,i._indeterminate=e,$common._changeCheckedHalfStyle(i.parentNode,t,e)}},_Z_76.registerClass("_Z_76",_Z_92),Sys.UI.Controls.TreeViewGetNodeDisplayTextEventArgs=function(t){Sys.UI.Controls.TreeViewGetNodeDisplayTextEventArgs.initializeBase(this),this._node=t,this._text=t.get_text()},Sys.UI.Controls.TreeViewGetNodeDisplayTextEventArgs.prototype={get_node:function(){return this._node},get_text:function(){return this._text},set_text:function(t){this._text=t}},Sys.UI.Controls.TreeViewGetNodeDisplayTextEventArgs.registerClass("Sys.UI.Controls.TreeViewGetNodeDisplayTextEventArgs",Sys.EventArgs),_Z_21=function(t){_Z_21.initializeBase(this),this._node=t,this._allowModifyChild=!0,this._allowAddChild=!0,this._allowDeleteChild=!0},_Z_21.prototype={get_node:function(){return this._node},set_allowAddChild:function(t){this._allowAddChild=t},get_allowAddChild:function(){return this._allowAddChild},set_allowDeleteChild:function(t){this._allowDeleteChild=t},get_allowDeleteChild:function(){return this._allowDeleteChild},set_allowModify:function(t){this._allowModifyChild=t},get_allowModify:function(){return this._allowModifyChild}},_Z_21.registerClass("_Z_21",_Z_162),_Z_22=function(t,e,i){_Z_22.initializeBase(this),this._node=t,this._newText=e,this._oldText=i},_Z_22.prototype={get_node:function(){return this._node},get_newText:function(){return this._newText},get_oldText:function(){return this._oldText}},_Z_22.registerClass("_Z_22",_Z_162),_Z_182=function(t){_Z_182.initializeBase(this),this._node=t},_Z_182.prototype={get_node:function(){return this._node}},_Z_182.registerClass("_Z_182",_Z_162),_Z_183=function(t,e,i){_Z_183.initializeBase(this),this._insertNode=e,this._targetNode=t,this._flag=i},_Z_183.prototype={get_insertNode:function(){return this._insertNode},get_targetNode:function(){return this._targetNode},get_flag:function(){return this._flag}},_Z_183.registerClass("_Z_183",_Z_162),_Z_184=function(t,e,i,n){_Z_184.initializeBase(this),this._parentNode=t,this._prevNode=e,this._nextNode=i,this._text=n,this._data=null},_Z_184.prototype={get_parentNode:function(){return this._parentNode},get_prevNode:function(){return this._prevNode},get_nextNode:function(){return this._nextNode},get_text:function(){return this._text},set_text:function(t){this._text=t},set_data:function(t){this._data=t},get_data:function(){return this._data}},_Z_184.registerClass("_Z_184",_Z_162),_Z_185=function(t){_Z_185.initializeBase(this),this._curNode=t,this._defaultValue=""},_Z_185.prototype={get_curNode:function(){return this._curNode},set_defaultValue:function(t){this._defaultValue=t},get_defaultValue:function(){return this._defaultValue}},_Z_185.registerClass("_Z_185",_Z_162),Sys.UI.Controls.TreeView=function(t){Sys.UI.Controls.TreeView.initializeBase(this,[t]),this._requireKeyDown=!0,this._rootNodeText="根",this._readOnly=!0,this._tipText="节点",this._addFlag=0,this._searchNodeList=[],this._nodeTextMaxLength=20,this._expandLevel=100,this._nodeCount=0,this._maxLevel=0},Sys.UI.Controls.TreeView.prototype={initialize:function(){this._rootNode=this._getRootNodeType(),this._rootNode._treeView=this,this.get_form()._hasFlexBlock=!0,Sys.UI.Controls.TreeView.callBaseMethod(this,"initialize");this.get_element();this._dataSource&&this._rootNode._bindData(this._dataSource),this._rootNode.initialize(!0),this._initDrag(),this._initToolBar()},set_showColumns:function(t){this._showColumns=t,t&&(this._selectedNodes=[])},get_showColumns:function(){return this._showColumns},set_rootNodeText:function(t){this._showRootNode=!0,this._rootNodeText=t},get_rootNodeText:function(){return this._rootNodeText},get_showToolBar:function(){return this._showToolBar},set_showToolBar:function(t){if(this._showToolBar=t,this.get_isInitialized()){var e=this.get_element().parentNode;$dom.removeCssClass(e,"ShowEditor"),$dom.removeCssClass(e,"ShowToolBar"),$dom.removeCssClass(e,"ShowEditor_parent"),$dom.removeCssClass(e,"ShowToolBar_parent"),this._initToolBar()}},addCssClass:function(t){var e=this.get_element();"ShowEditor"!=t&&"ShowToolBar"!=t||(e=this.get_element().parentNode),$dom.addCssClass(e,t)},_initToolBar:function(){(this._toolBar||this._showToolBar)&&(this._toolBar||(this._toolBar=new _Z_264(this)),this._toolBar.set_visible(this._showToolBar))},get_toolBar:function(){return this._toolBar},get_outerElement:function(){return this._element},_getRootNodeType:function(){return new _Z_265(this._rootNodeText)},dispose:function(t){this.set_readOnly(!0),this._rootNode&&(this._rootNode.dispose(),this._rootNode=null),this._toolBar&&(this._toolBar.dispose(),this._toolBar=null),this._disposeDragEvents(),t&&$removeNode(this.get_element().parentNode),Sys.UI.Controls.TreeView.callBaseMethod(this,"dispose")},canTabOnEnter:function(){return!1},get_dataSource:function(){return this.get_readOnly()?this._dataSource:(this._dataSource=this._rootNode._getData([]),Object.clone(this._dataSource))},set_dataSource:function(t){this._dataSource=t},get_parentElement:function(){return this.get_element().parentNode},set_width:function(t){$common.setWidth(this.get_element().parentNode,t)},set_height:function(t){$common.setHeight(this.get_element().parentNode,t)},get_rootNode:function(){return this._rootNode},get_showRootNode:function(){return this._showRootNode},set_showRootNode:function(t){this._showRootNode=t},get_hintDataField:function(){return this._hintField},set_hintDataField:function(t){this._hintField=t},get_showCheckBoxes:function(){return this._showCheckBoxes},set_showCheckBoxes:function(t){this._showCheckBoxes=t},get_allowDoubleClickEvent:function(){return this._allowDoubleClickEvent},set_allowDoubleClickEvent:function(t){this._allowDoubleClickEvent=t},get_notUpdateParentCheck:function(){return this._notUpdateParentCheck},set_notUpdateParentCheck:function(t){this._notUpdateParentCheck=t},get_icon:function(){return this._icon},set_icon:function(t){this._icon=t},get_tipText:function(){return this._tipText},set_tipText:function(t){this._tipText=t},get_showIcon:function(){return this._icon},get_selectedNode:function(){return this._selectedNode},set_selectedNode:function(t,e,i){if(this._selectedNode!=t||e){this._deSelectedNode(t),this._selectedNode=t;var n=!1!==e;if(t&&(t.set_selected(!0),n&&(t._nodeElement&&t._nodeElement.scrollIntoView(!1),t.focus())),i)return;this._doSelectionChanged()}},_deSelectedNode:function(t){var e=this._selectedNode;e&&(this.get_showColumns()?this.clearSelect():e.set_selected(!1))},clearSelect:function(t){for(var e=this.get_selectedNodes(),i=e.length-1;i>-1;i--)e[i].set_selected(!1),t&&e[i].collapse();this._selectedNodes=[]},refresh:function(t,e){this._lastEditorNode=null,this._selectedNode=null,this._nodeCount=0,this._removeBtns(),Object.isUndefinedOrNull(t)||this.set_dataSource(t);var i=this._rootNode;i.hasChildren()&&$removeNode(i.getChild(0)._getParentElement()),i.dispose();var n=this;asyncCall(function(){n.get_isDisposed()||((i=n._rootNode=n._getRootNodeType())._treeView=n,i._bindData(n._dataSource),i.initialize(),e&&e())})},locateNodes:function(t,e,i){var n=[];return this._doLocates(n,this.get_rootNode(),t,e,i),n},locateNode:function(t,e,i){var n=e;"string"==typeof e&&(n=e=e?e.toString():e,e&&e.indexOf("<")>=0&&(n=n.replace("<","&lt;")),e&&e.indexOf(">")>=0&&(n=n.replace(">","&gt;"))),this._searchText=n;var s=this._searchText==this._prevSearchText;s||Array.clear(this._searchNodeList);var o=this._doLocate(this.get_rootNode(),t,n,i);return null==o&&s?(Array.clear(this._searchNodeList),this._doLocate(this.get_rootNode(),t,n,i)):(this._prevSearchText=n,o)},_doLocate:function(t,e,i,n){if(this._compareText(t,e,i,n,!0))return this._searchNodeList.push(t),this.set_selectedNode(t,!0),t;for(var s=0,o=t.get_count();s<o;s++){var r=t.getChild(s),a=this._doLocate(r,e,i,n);if(null!=a)return a}return null},_doLocates:function(t,e,i,n,s){this._compareText(e,i,n,s,!1)&&t.push(e);for(var o=0,r=e.get_count();o<r;o++){var a=e.getChild(o);this._doLocates(t,a,i,n,s)}},_compareText:function(t,e,i,n,s){if(s&&this._searchText==this._prevSearchText&&Array.contains(this._searchNodeList,t))return!1;if(!(e instanceof Array))return this._compareText2(t,e,i,n);if(e.length!=i.length)throw Error.abort("locateNode的参数中names和values集合长度不相等");for(var o=0,r=e.length;o<r;o++)if(!this._compareText2(t,e[o],i[o],n))return!1;return!0},_compareText2:function(t,e,i,n){if("function"==typeof e)return e(t,i);var s=t.get_data(),o=s&&"object"==typeof s?s[e]:t.get_text();return n&&void 0!==o&&void 0!==i?o.toLowerCase()==i.toLowerCase():o==i},hasSelectedNode:function(){return null!=this._selectedNode},_internalTreeNodeCheckedChanged:function(){if(this.get_selectedNode()){var t=this.get_events().getHandler("treeNodeCheckedChanged");t&&t(this)}},add_treeNodeCheckedChanged:function(t){this.get_events().addHandler("treeNodeCheckedChanged",t)},remove_treeNodeCheckedChanged:function(t){this.get_events().removeHandler("treeNodeCheckedChanged",t)},doTreeNodeClick:function(t){},add_selectionChanged:function(t){this.get_events().addHandler("selectionChanged",t)},remove_selectionChanged:function(t){this.get_events().removeHandler("selectionChanged",t)},_doSelectionChanged:function(){var t=this.get_events().getHandler("selectionChanged");t&&t(this)},add_treeNodeClick:function(t){this.addCssClass("AllowClick"),this.get_events().addHandler("treeNodeClick",t)},remove_treeNodeClick:function(t){this.get_events().removeHandler("treeNodeClick",t)},_internalTreeNodeClick:function(t){if(this.get_enabled()){var e=this.get_selectedNode();if(e){this.doTreeNodeClick(e);var i=this.get_events().getHandler("treeNodeClick");i&&i(this),t&&t.cancel()}}},add_treeNodeDblClick:function(t){this.get_events().addHandler("treeNodeDblClick",t)},remove_treeNodeDblClick:function(t){this.get_events().removeHandler("treeNodeDblClick",t)},_internalTreeNodeDblClick:function(){var t=this.get_selectedNode();if(t){this.doTreeNodeDblClick(t);var e=this.get_events().getHandler("treeNodeDblClick");e&&e(this)}},doTreeNodeDblClick:function(t){},doKeyDown:function(t){if(this.get_enabled()){var e=!0;switch(t.keyCode){case Sys.UI.Key.left:if(this.hasSelectedNode()){if((s=this.get_selectedNode()).get_expanded())s.collapse();else{(n=s.get_parent())&&(n.isRoot()&&!this.get_showRootNode()&&(n=null),n&&this.set_selectedNode(n))}e=!1}break;case Sys.UI.Key.right:if(this.hasSelectedNode()){if((s=this.get_selectedNode()).get_expanded()){var i=s.get_first();i&&this.set_selectedNode(i)}else s.expand();e=!1}break;case Sys.UI.Key.up:if(this.hasSelectedNode()){var n=(s=this.get_selectedNode()).get_previousSibling();n&&(this.set_selectedNode(n),e=!1)}break;case Sys.UI.Key.down:if(this.hasSelectedNode()){var s=this.get_selectedNode(),o=s.get_nextSibling();o&&(this.set_selectedNode(o),e=!1)}break;case Sys.UI.Key.home:case Sys.UI.Key.pageUp:break;case Sys.UI.Key.end:case Sys.UI.Key.pageDown:break;case Sys.UI.Key.space:this.get_showCheckBoxes()&&this.hasSelectedNode()&&this.get_selectedNode().get_enabled()&&(this.get_selectedNode().toggleChecked(),e=!1),t.stopPropagation();break;case Sys.UI.Key.enter:this._internalTreeNodeClick()}e?Sys.UI.Controls.TreeView.callBaseMethod(this,"doKeyDown",[t]):t.cancel()}},add_getNodeDisplayText:function(t,e){this.get_events().addHandler("getNodeDisplayText",t,e)},remove_getNodeDisplayText:function(t){this.get_events().removeHandler("getNodeDisplayText",t)},_internalGetNodeDisplayText:function(t){var e=this.get_events().getHandler("getNodeDisplayText");if(e){var i=new Sys.UI.Controls.TreeViewGetNodeDisplayTextEventArgs(t);return e(this,i),i.get_text()}return t.get_text()},get_checkedNodes:function(t){if(!this.get_showCheckBoxes())return[];var e=[];return this._getCheckedNodes(this._rootNode,e,t),e},_getCheckedNodes:function(t,e,i){if(t){this._rootNode!=t&&t.get_checked()&&(i?t.get_partialChecked()||e.push(t):e.push(t));var n=t.get_children();if(n)for(var s=0,o=n.length;s<o;s++)this._getCheckedNodes(n[s],e,i)}},get_selectedNodes:function(){return this._selectedNodes?(this._selectedNodes.sort(function(t,e){return t.get_level()-e.get_level()}),this._selectedNodes):[]},get_readOnly:function(){return this._readOnly},set_readOnly:function(t){t&&this.hideEditor(),this._readOnly=t,this._processMouseEvent()},get_nodeTextMaxLength:function(){return this._nodeTextMaxLength},set_nodeTextMaxLength:function(t){this._nodeTextMaxLength=t,this._nodeEdit&&this._nodeEdit.set_maxLength(t)},set_addFlag:function(t){this._addFlag=t},showDefaultEditor:function(t,e){var i=this.get_selectedNode();if(i||(i=this._rootNode.get_nextSibling()),i){for(var n=i.get_parent();n;)n.expand(),n=n.get_parent();asyncCall(function(){i.showEditor()})}},_processMouseEvent:function(){this._readOnly&&(this._disposeControl("_nodePopup"),this._disposeControl("_nodeBtns"))},_disposeControl:function(t){var e=this[t];e&&(e.tagName?$disposeNode(e):(e.clear&&e.clear(!0),e.dispose()),delete this[t])},_getBtnsBlock:function(){if(this._readOnly)return null;if(this._nodeBtns)return this._nodeBtns;var t=this._nodeBtns=$common.createClassDiv("EditorBlock");return this._nodeBtnAdd=this._createButton(t,"aicon-plus",this.doAdd,"add"),this._nodeBtnModify=this._createButton(t,"aicon-bianji6",this.doAdd,"modify"),this._nodeBtnDel=this._createButton(t,"aicon-shanchu1",this._doDelChild),t},_createButton:function(t,e,i,n){var s=new _Z_23(t,e,!1);return s.initialize(),s.add_click(i,this),s.set_tag(n),s.__form=this.__form,s},_createEdit:function(t){var e=$common.createInput();return e.type="text",e.className="Edit NodeEdit",t.appendChild(e),e},hideEditor:function(t){this._editorNode&&this._editorNode.hideEditor()},_hideEditPopup:function(){this._lastEditorNode=null,this._nodePopup&&this._nodePopup.hide()},get_editPopup:function(){return this._nodePopup},doAdd:function(t,e){if(e&&e.cancel(),this._editorNode){this._lastEditorNode=this._editorNode,this._lastText=this._lastEditorNode.get_text(),this._isModify=t.get_tag&&"modify"==t.get_tag(),this._initEditPopup("");var i=this._lastEditorNode,n=new _Z_185(i),s=this.get_events().getHandler("_nodeAddBeforePopup");if(s){if(s(this,n),n.get_cancel())return;this._initEditPopup(n.get_defaultValue())}this.set_selectedNode(i,!1,!0),this._initEditPopupEnabled(),t.get_visible()||(t=i),this._nodePopup.popupAt(t),this._nodeEdit.asyncFocus()}},_initEditPopupEnabled:function(){var t=this._nodeRadio,e="添加";if(this._isModify)e="修改",this._nodeEdit.set_text(this._lastEditorNode.get_text());else{var i=!0,n=t.get_value();1==this._addFlag?(i=!1,n=0):2==this._addFlag&&(i=!1,n=1),t.set_value(n),t.set_enabled(i)}t.set_visible(!this._isModify),this._captionLabel.set_text(e+this._tipText)},_initEditPopup:function(t){if(this._nodePopup)this._nodeEdit.set_text(t);else{var e=this.get_form(),i=this.get_idPart(),n=i+"_editPopup",s=i+"_radio",o=i+"_edit",r=i+"_caption",a=$createControl("PopupBlock",{ID:n,CssClass:"NodeEditPopup"},e,null,!0);$createControl("Label",{ID:r,Text:"添加"+this._tipText,CssClass:"Caption"},e,a);var l=$createControl("FlowPanel",{LayoutDirection:"Vert"},e,a);$createControl("TextEdit",{ID:o,Label:"名称",CssClass:"FlexAuto",Text:t,TabOnEnter:!1,OnEnterPress:$createDelegate(this,this._doOkClick),MaxLength:this._nodeTextMaxLength},e,l),$createControl("RadioButtonList",{ID:s,Label:"层级",ShowBorder:!1,DataSource:[{id:0,text:"同级"+this._tipText},{id:1,text:"子级"+this._tipText}],DataValueField:"id",DataTextField:"text",LayoutDirection:"Horz",Value:0},e,l);var h=$createControl("HBlock",{HAlign:"Right"},e,a);$createControl("Button",{Text:"确认",OnClick:$createDelegate(this,this._doOkClick),CssClass:"SpecialButton"},e,h),$createControl("Button",{CssClass:"mr0",OnClick:$createDelegate(this,this._removeBtns),Text:"取消"},e,h),a.appendTo(document.body),this._nodePopup=e[n],this._nodeRadio=e[s],this._captionLabel=e[r],this._nodeEdit=e[o]}},_doOkClick:function(t,e){var i=this._nodeEdit.get_value();if(""!=i){var n=this._lastEditorNode;if(this._isModify){if((d=this._nodeEdit.get_value())==this._lastText||""==d)return;var s=this.get_events().getHandler("_change");if(s){if(s(this,_=new _Z_22(n,d,this._lastText)),_.get_cancel())return}this._removeBtns();var o=n.get_value();return"string"==typeof o?o=d:o._text=d,void(n._textElement.innerHTML=n.get_text(!0))}var r=1==this._nodeRadio.get_value(),a=r?n:n.get_parent(),l=r?n.get_first():n.get_next(),h=r?null:n,_=this._raiseAddNodeEvent(a,h,l,i);if(_){this._removeBtns();var d=_.get_text(),c=_.get_data(),u={_text:d||i,_data:c},g=new _Z_265(u);a.expand(),h?(g.applyParent(a),g.initialize(),h._afterInsert(g)):l?(g.applyParent(a),g.initialize(),l._beforeInsert(g)):(a.appendChild(g,!0),this.set_selectedNode(g)),this._nodeEdit.set_value("")}}else $common.showHint(this._tipText+"名称不能为空!",this._nodeEdit)},_raiseAddNodeEvent:function(t,e,i,n){var s=new _Z_184(t,e,i,n),o=this.get_events().getHandler("_nodeAdd");return o?(o(this,s),s.get_cancel()?(delete s,null):s):s},_doDelChild:function(t,e){e&&e.cancel();var i=this._editorNode;i&&i.get_parent()&&(this.set_selectedNode(i,!1,!0),this._lastEditorNode=i,this._raiseDelNodeEvent(i)&&this.removeCurNode())},removeCurNode:function(){var t=this._lastEditorNode;t&&t.get_parent()&&(this._removeBtns(),t.get_parent().removeNode(t),this._lastEditorNode=null,this._selectedNode==t&&(this._selectedNode=null))},_raiseDelNodeEvent:function(t){var e=this.get_events().getHandler("_nodeDeleted");if(!e)return!0;var i=new _Z_182(t);return i.button=this._nodeBtnDel,e(this,i),!i.get_cancel()},_removeBtns:function(){var t=this._getBtnsBlock();t&&t.parentNode&&t.parentNode.removeChild(t),this._hideEditPopup()},get_allowDrag:function(){return this._allowDrag},set_allowDrag:function(t){this._allowDrag=t,this._allowDrop=t,this.get_isInitialized()&&(t?this._initDrag():this._disposeDragEvents())},get_allowDrop:function(){return this._allowDrop},set_allowDrop:function(t){this._allowDrop=t},get_isDraging:function(){return this._draging},_disposeDragEvents:function(){this._clearEvent(),this._mouseDownHandler&&($common.removeMouseDownHandler(this.get_element(),this._mouseDownHandler),this._mouseDownHandler=null),this._dragBlock&&($removeNode(this._dragBlock),$removeNode(this._dragLine),this._dragBlock=null)},_initDrag:function(){this._allowDrag&&(this._mouseDownHandler=$common.addMouseDownHandler(this.get_element(),this.doTreeMouseDown,this),this._initDragElement())},_initDragElement:function(){if(!this._dragBlock){var t=this._dragBlock=$common.createClassDiv("TreeDragBlock");t.style.zIndex=$app.getPopupElementZIndex(),document.body.appendChild(t);var e=this._dragLine=$common.createClassDiv("TreeDragLine");e.style.zIndex=$app.getPopupElementZIndex(),document.body.appendChild(e)}},doTreeMouseDown:function(t){if(this.get_enabled()){this._insertNode=null,this._targetNode=null;var e=t.target;e&&e.tagName&&$Dom.hasClass(e,"TextBlock")&&(this._insertNode=e._node,this._startX=t.clientX,this._startY=t.clientY,this._isTimeout=!0,t.cancel(),this.set_selectedNode(this._insertNode),this._mouseMoveHandler||(this._mouseMoveHandler=$common.addMouseMoveHandler(document,this._startDrag,this),this._mouseUpHandler=$common.addMouseUpHandler(document,this._endDrag,this)))}},_startDrag:function(t){t.cancel();var e=t.clientX-this._startX;if(!this._draging&&(Math.abs(e)>12||Math.abs(t.clientY-this._startY)>12)){this._draging=!0,_Z_238.IsDraging=!0,this._dragBlock.innerHTML="",this.hideEditor(),this._hideEditPopup();var i=this._insertNode._nodeElement;this._dragBlock.appendChild(i.cloneNode(!0)),this.get_allowDrop()&&this._insertNode.set_visible(!1)}if(this._isTimeout&&this._draging&&!this.get_isDisposed()){var n=this;n._isTimeout=!1,setTimeout(function(){n._isTimeout=!0},50),this._moveDragBlockByPos(t),_Z_238.dragMove(t,this)}},_moveDragBlockByPos:function(t){var e=this._dragBlock;e.style.display="block",e.style.left=t.clientX-5+"px",e.style.top=t.clientY-5+"px"},_dragMove:function(t){if(this._draging=!0,this._allowDrop){var e=$Dom.getLocation(this.get_element());this._startX||(this._startX=e.x);var i=t.clientX-this._startX,n=t.clientY,s=e.y+this.get_element().offsetHeight;n<e.y+9?(n=e.y+9,this.get_element().scrollTop-=12):n>s-11&&(n=s-11,this.get_element().scrollTop+=12);var o=this._dragLine,r=document.elementFromPoint(e.x+5,n);if("DIV"==r.tagName){for(var a=r.parentNode;a&&!a._node;)a=a.parentNode;if(!a)return void this._refreshWidth(t,e.x);var l=this._targetNode=a._node;this.set_selectedNode(l)}else if(null==this._targetNode)return;var h=this._targetNode._nodeElement,_=$common.getBounds(h),d=$common.getBounds(this._targetNode._textElement);o.style.display="block",this._insertBefore=!1;var c=_.y+_.height;n<_.y+_.height/2&&(c=_.y,this._insertBefore=!0),o.style.top=c+"px";var u=d.x-8;this._insertChild=!1,i>100&&!this._insertBefore&&(u+=d.width/2,this._insertChild=!0),o.style.left=u+"px",this._refreshWidth(t,u,_)}},_refreshWidth:function(t,e,i){if(i)this._dragLine.style.width=i.x+i.width-e+"px";else{var n=t.clientX-e;n=Math.max(100,n),n=Math.min(n,this.get_width()),this._dragLine.style.width=n-10+"px"}},_endDrag:function(t){_Z_238.IsDraging=!1,this._dragBlock.style.display="none",this._dragLine.style.display="none",this._clearEvent(),this._draging&&!this.get_isDisposed()&&(this._draging=!1,_Z_238._prevDropTarget===this?(_Z_238._prevDropTarget=null,this._dragClass(!1,"DropStyle"),this._insertNode&&this._targetNode&&(this._insertBefore?this._targetNode.beforeInsert(this._insertNode):this._insertChild?(this._targetNode.expand(),this._targetNode.insertChild(0,this._insertNode)):this._targetNode.afterInsert(this._insertNode)),this._showDragNode()):_Z_238.endDrag(t,this))},_dragClass:function(t,e){$Dom.setCssClass(t,this._element.parentNode,e)},getDragData:function(){var t=this._insertNode,e=this.saveDatas(t);return Object.clone(e)},_getDragIndex:function(){return null},get_insertFlag:function(){return this._insertBefore?"before":this._insertChild?"child":"after"},_emitDragMove:function(t,e){this._dragMove(t)},_emitDragEnd:function(t,e){this._draging=!1,this._dragBlock.style.display="none",this._dragLine.style.display="none"},_emitDragLeave:function(t,e){this._draging=!1,this._dragBlock.style.display="none",this._dragLine.style.display="none"},cancelDrag:function(){this._showDragNode()},_showDragNode:function(){this._insertNode&&($Dom.setVisible(this._insertNode._nodeElement,!0),this._insertNode._expanded&&$Dom.setVisible(this._insertNode._childrenElement,!0))},_clearEvent:function(){this._mouseMoveHandler&&($common.removeMouseMoveHandler(document,this._mouseMoveHandler),$common.removeMouseUpHandler(document,this._mouseUpHandler),this._mouseMoveHandler=null)},saveDatas:function(t){t||(t=this._rootNode);var e=[];return this._saveDatas(t,e),Object.clone(e)},_saveDatas:function(t,e){e.push(t.get_data());for(var i=t.get_children(),n=0,s=i.length;n<s;n++){var o=i[n];this._saveDatas(o,e)}return e},get_defaultCheckDataField:function(){return this._defaultCheckDataField},set_defaultCheckDataField:function(t){t&&(this._defaultCheckDataField=t)},get_expandLevel:function(){return this._expandLevel},set_expandLevel:function(t){this._expandLevel=t,this.get_isInitialized()&&this.refreshLevel()},refreshLevel:function(t){t||(t=this._rootNode);for(var e=t.get_children(),i=0,n=e.length;i<n;i++){var s=e[i];this.refreshLevel(s),s.refreshLevel()}},set_enabled:function(t){Sys.UI.Controls.TreeView.callBaseMethod(this,"set_enabled",[t]);var e=this.get_selectedNode();e&&e.set_selected(!0)},add_change:function(t,e){return this.get_events().addHandler("_change",t,e)},remove_change:function(t){this.get_events().removeHandler("_change",t)},add_nodeBeginEdit:function(t,e){return this.get_events().addHandler("_nodeBeginEdit",t,e)},remove_nodeBeginEdit:function(t){this.get_events().removeHandler("_nodeBeginEdit",t)},add_nodeAdd:function(t,e){return this.get_events().addHandler("_nodeAdd",t,e)},remove_nodeAdd:function(t){this.get_events().removeHandler("_nodeAdd",t)},add_nodeDeleted:function(t,e){return this.get_events().addHandler("_nodeDeleted",t,e)},remove_nodeDeleted:function(t){this.get_events().removeHandler("_nodeDeleted",t)},add_nodeAddBeforePopup:function(t,e){return this.get_events().addHandler("_nodeAddBeforePopup",t,e)},remove_nodeAddBeforePopup:function(t){this.get_events().removeHandler("_nodeAddBeforePopup",t)},add_exchange:function(t,e){return this.get_events().addHandler("_exchange",t,e)},remove_exchange:function(t){this.get_events().removeHandler("_exchange",t)},add_drop:function(t){this.get_events().addHandler("_drop",t),this._allowDrop=!0},remove_drop:function(t){this.get_events().removeHandler("_drop",t),this._allowDrop=!1},add_toolClick:function(t){this.get_events().addHandler("_toolClick",t)},remove_toolClick:function(t){this.get_events().removeHandler("_toolClick",t)},add_toolSearch:function(t){this.get_events().addHandler("_toolSearch",t)},remove_toolSearch:function(t){this.get_events().removeHandler("_toolSearch",t)},set_visible:function(t){this.get_isInitialized()&&($Dom.setVisible(this.get_element().parentNode,t,""),Sys.UI.Controls.TreeView.callBaseMethod(this,"set_visible",[t,""]))},set_toolBarItems:function(t){this._toolBarItems=t,this.get_isInitialized()&&this._toolBar&&this._toolBar.set_items(t)},get_toolBarItems:function(){return this._toolBarItems},set_positionVisible:function(t){this._pvisible!==t&&(this._pvisible=t,$Dom.setVisibleByPosition(this.get_element().parentNode,t))}},Sys.UI.Controls.TreeView.registerClass("Sys.UI.Controls.TreeView",Sys.UI.Controls.Container),_Z_263=function(t,e){this._node=t,this._buttonName=e},_Z_263.prototype={get_node:function(){return this._node},get_buttonName:function(){return this._buttonName}},_Z_263.registerClass("_Z_263",Sys.EventArgs),_Z_264=function(t){this.tree=t,this.initialize()},_Z_264.prototype={initialize:function(){var t=this.tree,e=t.get_element();$Dom.addCssClass(e.parentNode,"hasTool");var i=t.get_idPart()+"_toolBar",n=t.get_form(),s=$createControl("Block",{ID:i,CssClass:"TreeToolBar"},n);$createControl("Buttons",{ID:i+"btn",DataCssField:"icon",DataHintField:"hint",DataValueField:"type"},n,s);var o=$createControl("Block",{CssClass:"SearchBar"},n,s);$createControl("TextEdit",{ID:i+"edit",CssClass:"FlexAuto",TabStop:!1,TabOnEnter:!1,Hint:"",NullDisplayText:"搜索"+t._tipText},n,o),$createControl("Label",{ID:i+"search",CssClass:"aicon-chaxun"},n,o),s.appendTo(e),s=this._toolBar=n[i],e.parentNode.insertBefore(s.get_element(),e);var r=this.tree.get_toolBarItems()||$settings.TreeToolBarItems,a=this._buttons=n[i+"btn"];a.set_items(r),a.add_click($createDelegate(this,this.doClick));(this._edit=n[i+"edit"]).add_enterPress($createDelegate(this,this.doSearch)),n[i+"search"].add_click($createDelegate(this,this.doSearch))},set_items:function(t){this._buttons.set_items(t)},dispose:function(){},get_element:function(){return this._toolBar.get_element()},doClick:function(t,e,i){var n=e.get_data();"drag"==n.type&&this.doDrag();var s=this.tree.get_events().getHandler("_toolClick");if(s){var o=this.tree,r=o.get_selectedNode();r||"add"!=n.type||(r=o._rootNode.get_nextSibling());s(o,e=new _Z_263(r,n.type))}},doSearch:function(t){var e=this.tree.get_events().getHandler("_toolSearch");if(e){var i=this._edit;e(this.tree,i.get_text()),i.asyncFocus()}},set_visible:function(t){this._toolBar.set_visible(t)},set_text:function(t){this._edit.set_text(t)},doDrag:function(){var t=this.tree.get_allowDrag();this.tree.set_allowDrag(!t)}},_Z_265=function(t,e){this._value=t,this._children=[],this._level=0,this._defaultCheckState=e,this._expanded=!0,this._checkState=0,this._enabled=!0,this._childrenExpanded=!0},_Z_265.prototype={initialize:function(t){this._treeView.get_showColumns()?t?this.doInitColumn():this._initNode():this.doInit()},dispose:function(){this._expandElement&&($clearHandlers(this._expandElement),this._expandElement=null),this._checkElement&&($clearHandlers(this._checkElement),this._checkElement=null),this._textElement&&($clearHandlers(this._textElement),this._textElement=null);for(var t=this.get_count(),e=0;e<t;e++){this.getChild(e).dispose()}this._childrenElement=null,this._nodeElement=null,this._children=[]},get_nodeElement:function(){return this._nodeElement},doInit:function(){this.isRoot()&&!this._treeView.get_showRootNode()||this._initNode(),this.doInitChild()},doInitChild:function(){var t=this.get_count(),e=this._treeView.get_expandLevel()<this._level,i="dselect ChildrenBlock Children"+this._level,n=this._childrenElement=$common.createClassDiv(i);e&&(n.style.display="none",this._expanded=!1,this._childrenExpanded=!1);for(var s=0;s<t;s++)this.getChild(s).initialize();this._getParentElement().appendChild(n),this._expanded||this._initNodeExpand()},doInitColumn:function(){var t=this.get_count();if(0!=t){for(var e="ChildrenBlock Children"+this._level,i=this._childrenElement=$common.createClassDiv(e),n=0;n<t;n++){this.getChild(n).initialize()}if(!(this._level>0)){var s=this._treeView,o=s.get_element();o.appendChild(i),s._levelDivs={};for(n=1;n<s._maxLevel;n++)s._levelDivs[n]=div=$common.createClassDiv("Children0 dnone"),o.appendChild(div)}}},_showColumnChilds:function(t){if(this._childrenElement||this.doInitColumn(),this._childrenElement){var e=this._treeView,i=this._level,n=e._levelDivs[i];if(n){n.innerHTML="",$dom.setCssClass(!t,n,"dnone"),n.appendChild(this._childrenElement);for(var s=i+1;s<e._maxLevel;s++){var o=e._levelDivs[s];$dom.addCssClass(o,"dnone"),o.innerHTML=""}}}},refreshLevel:function(){this._treeView.get_expandLevel()<this._level?this.collapse():this.expand()},_initNode:function(){var t=this._nodeElement=$common.createClassDiv("TreeNode");t._node=this;var e=this._treeView._showColumns;if(!e){var i=this._levelElement=$common.createClassDiv();this._initNodeLevel(),t.appendChild(i);var n=this._expandElement=$common.createDiv();this._initNodeExpand(),t.appendChild(n),$common.addMouseDownHandler(n,this._onExpandMouseDown,this),this._createCheckBox(t)}var s=this._textElement=$common.createClassDiv("TextBlock");s._node=this,s.tabIndex=0,t.appendChild(s),e&&this._createCheckBox(t),$common.addClickHandler(t,this.onNodeClick,this),$common.addDblClickHandler(t,this._onTextDblClick,this),$common.addSelectStartHandler(s,this._onTextSelectStart,this),$common.addMouseOverHandler(s,this._onTextMouseOver,this),$common.addMouseEnterHandler(t,this._onNodeMouseOver,this),$common.addMouseLeaveHandler(t,this._onNodeMouseLeave,this),this._getParentElement().appendChild(t),this.refreshDisplayText(),this._treeView.get_showCheckBoxes()&&(1==this._defaultCheckState&&this.check(!0),2==this._defaultCheckState&&this.togglePartialChecked())},_createCheckBox:function(t){this._treeView.get_showCheckBoxes()&&(this._checkElement=$common.createDiv(),t.appendChild(this._checkElement),this._initNodeCheck(),$common.addClickHandler(this._checkElement,this._onCheckClick,this))},_initExpandElement:function(){},get_textPrefix:function(){return this._textPrefix},set_textPrefix:function(t){this._textPrefix=t,this._textElement&&(this._textElement.innerHTML=this.get_text(!0))},get_treeView:function(){return this._treeView},get_parent:function(){return this._parent},addNode:function(t,e){var i={_text:t,_data:e},n=new _Z_265(i),s=this.get_parent();s.expand(),n.applyParent(s),n.initialize(),this._afterInsert(n)},addChild:function(t,e,i){var n={_text:t,_data:e},s=new _Z_265(n);this.expand(),!i&&this.get_first()?(s.applyParent(this),s.initialize(),this.get_first()._beforeInsert(s)):(this.appendChild(s,!0),this._treeView.set_selectedNode(s))},get_previousSibling:function(){if(this.isRoot())return null;for(var t=this.get_parent(),e=t.get_count(),i=0;i<e&&this!=t.getChild(i);i++);if(0==i)return t.isRoot()&&!t._treeView.get_showRootNode()?null:t;var n=t.getChild(--i),s=n.get_lastVisible();return s||n},get_nextSibling:function(t){if(this.isRoot())return this.get_firstVisible();for(var e=this.get_parent(),i=e.get_count(),n=0;n<i&&this!=e.getChild(n);n++);if(++n==i){if(e.isRoot())return this.get_firstVisible();return(s=t?null:this.get_firstVisible())||e.get_nextSibling(!0)}var s=t?null:this.get_firstVisible();return s||e.getChild(n)},get_value:function(){return this._value},set_value:function(t){t&&(this._value=t,this._textElement.innerHTML=this.get_text(!0))},get_text:function(t){var e=this.get_value();return"string"!=typeof e&&(e=e._text),t&&this._textPrefix?this._textPrefix+e:e},set_text:function(t){this._textElement.innerHTML=t},get_data:function(){var t=this.get_value();return"string"==typeof t?null:t._data},set_data:function(t){var e=this.get_value();Object.isUndefinedOrNull(e)&&(e=this._value={}),"string"!=typeof e&&(e._data=t)},set_enabled:function(t){this._enable!=t&&(this._enabled=t,this.hideEditor(),$Dom.setCssClass(!t,this._nodeElement,"disabled"))},get_enabled:function(){return this._enabled&&this._treeView.get_enabled()},get_count:function(){return this._children.length},getChild:function(t){return this._children[t]},get_children:function(){return this._children},get_first:function(){return this.hasChildren()?this.getChild(0):null},get_firstVisible:function(){return this.get_expanded()?this.get_first():null},get_next:function(){for(var t=this.get_parent(),e=t.get_count(),i=0;i<e&&this!=t.getChild(i);i++);return++i==e?null:t.getChild(i)},get_last:function(){return this.hasChildren()?this.getChild(this.get_count()-1):null},get_lastVisible:function(){return this.get_expanded()?this.get_last():null},hasChildren:function(){return this._children.length>0},appendChild:function(t,e){if(this.hasChildren()){var i=this._children[this._children.length-1];i._next=t,t._prev=i,t._next=null}if(this._children[this._children.length]=t,t.applyParent(this),e){t.initialize(),this._expanded=!1,this.expand();var n=t.get_previousSibling();n&&n!=this&&n.get_parent()._refreshNode()}return t},removeNode:function(t){var e=this;t||(e=this.get_parent(),t=this);var i=t._prev,n=t._next;i&&(i._next=n),n&&(n._prev=i);for(var s=0;s<t.get_count();s++)t.removeNode(t.getChild(s));Array.remove(e._children,t),$removeNode(t._nodeElement),$removeNode(t._childrenElement),e._refreshNode(),t.dispose(),t==this._treeView._selectedNode&&(this._treeView._selectedNode=null)},isRoot:function(){return null==this._parent},applyParent:function(t){if(!t)return!1;this._treeView=t._treeView,this._parent=t,this._level=t._level+1,this._treeView._maxLevel=Math.max(this._level,this._treeView._maxLevel);for(var e=0,i=this._children.length;e<i;e++)this._children[e].applyParent(this);return!0},get_level:function(){var t=this._level;return this._treeView.get_showRootNode()||t--,t},getAncestor:function(t){if(t>=this.get_level()||t<0)return null;for(var e=this.get_parent();e.get_level()>t;)e=e.get_parent();return e},_bindData:function(t){for(var e=0;e<t.length;e++)this._bindOneData(t[e])},_bindOneData:function(t){var e=t[0],i=this._treeView,n=i.get_defaultCheckDataField(),s=this._treeView&&n&&e._data?e._data[n]:null;this._treeView._nodeCount++;var o=new _Z_265(e,s);i.get_showColumns()&&(o._expanded=!1),this.appendChild(o);for(var r=1;r<t.length;r++)o._bindOneData(t[r])},_getData:function(t){for(var e=0;e<this.get_count();e++){var i=[];this._children[e]._getOneData(i),t.push(i)}return t},_getOneData:function(t){t.push(this.get_value());for(var e=0;e<this.get_count();e++){var i=[];this._children[e]._getOneData(i),t.push(i)}},_refreshNode:function(t){this._initNodeLevel(),this._initNodeExpand();for(var e=this.get_count(),i=0;i<e;i++)this.getChild(i)._refreshNode();$Dom.setCssClass(e>0,this._nodeElement,"hasChild"),t&&this.refreshDisplayText()},_getChildrenElement:function(){return this._childrenElement},_getParentElement:function(){var t=this.get_parent();return t?t._getChildrenElement():this.get_treeView().get_element()},_raiseBeginEditNodeEvent:function(){var t=this._treeView,e=new _Z_21(this),i=t.get_events().getHandler("_nodeBeginEdit");return i&&i(t,e),e},showEditor:function(t){if(!this.get_enabled())return!1;if(!_Z_238.IsDraging){var e=this._treeView,i=e._getBtnsBlock();if(!i)return!1;var n=!1,s=this._raiseBeginEditNodeEvent(),o=e._nodeBtnAdd;return s.get_allowAddChild()?(o.set_visible(!0),n=!0):o.set_visible(!1),o=e._nodeBtnModify,s.get_allowModify()&&!s.get_cancel()?(o.set_visible(!0),n=!0):o.set_visible(!1),o=e._nodeBtnDel,s.get_allowDeleteChild()?(o.set_visible(!0),n=!0):o.set_visible(!1),n?(this.get_nodeElement().appendChild(i),e._editorNode=this,e._documentClickHander||(e._documentClickHander=$common.addClickHandler(document,e.hideEditor,e)),!0===t?e.doAdd(e._nodeBtnAdd):!1===t&&e.doAdd(e._nodeBtnModify),!0):!1}},hideEditor:function(){if(this._textElement){var t=this._treeView,e=t._nodeBtns;e&&(t._documentClickHander&&($common.removeClickHandler(document,t._documentClickHander),t._documentClickHander=null),$removeNode(e,!1))}},refreshDisplayText:function(){var t=this._textElement,e=this._treeView,i=e._internalGetNodeDisplayText(this);t.innerHTML=i;var n=e.get_hintDataField();if(n)if("true"!==n.toString().toLowerCase()){var s=this.get_data();s&&(i=s[n])&&(t.title=i)}else t.title=i},_refreshExpanded:function(){if(!this._expanded){var t=this;asyncCall(function(){t._childrenElement.style.display="none"})}},isParent:function(t){for(var e=t.get_parent();e;){if(e==this)return!0;e=e.get_parent()}return!1},set_visible:function(t){$Dom.setVisible(this._nodeElement,t),$Dom.setVisible(this._childrenElement,t)},get_index:function(){return Array.indexOf(this.get_parent()._children,this)},exchange:function(t){if(!t)throw Error.abort("node1.exchange(node2) 两个节点交换必须传入另外一个节点参数");if(this._raiseExchange(this,t,"exchange")){var e=this.isParent(t),i=t.isParent(this);if(e||i){var n=this.get_value();return this.set_value(t.get_value()),void t.set_value(n)}var s=t._childrenElement,o=t._nodeElement,r=this._childrenElement,a=this._nodeElement;o.parentNode.insertBefore(r,o),a.parentNode.insertBefore(s,a),r.parentNode.insertBefore(a,r),s.parentNode.insertBefore(o,s),o._parent=t.get_parent(),a._parent=this.get_parent(),t._exchangeParent(this),this._exchangeParent(t),t._refreshNode(),this._refreshNode()}},beforeInsert:function(t){this._raiseExchange(this,t,"before")&&this._beforeInsert(t)},_beforeInsert:function(t){if(this._nodeElement){var e=this._nodeElement.parentNode;e.insertBefore(t._nodeElement,this._nodeElement),e.insertBefore(t._childrenElement,this._nodeElement),this._processNodeRelation(t);var i=this.get_parent();if(index=Array.indexOf(i._children,this),0==index)t._prev=null,t._next=this,this._prev=t;else{var n=i._children[index-1];n&&(n._next=t),t._prev=n,t._next=this,this._prev=t}Array.insert(i._children,index,t),t.applyParent(i),t._refreshNode(),this._refreshNode(),t._refreshExpanded(),this._treeView.set_selectedNode(t)}},afterInsert:function(t){this._raiseExchange(this,t,"after")&&this._afterInsert(t)},_afterInsert:function(t){var e=this._nodeElement.parentNode,i=this._childrenElement.nextSibling;i!=t._nodeElement&&(e.insertBefore(t._nodeElement,i),e.insertBefore(t._childrenElement,i)),this._processNodeRelation(t);var n=this.get_parent();index=Array.indexOf(n._children,this);var s=n._children.length;if(t._prev=this,index==s-1)t._next=null,this._next=t;else{var o=n._children[index+1];o._prev=t,t._next=o}Array.insert(n._children,index+1,t),t.applyParent(n),t._refreshNode(),t._refreshExpanded(),this._refreshNode(),this._treeView.set_selectedNode(t)},insertChild:function(t,e){e&&this._raiseExchange(this,e,"child")&&this._insertChild(t,e)},_insertChild:function(t,e){this._processNodeRelation(e);var i=this._childrenElement;if(this.hasChildren()){var n=this._children[0],s=n._nodeElement;i.insertBefore(e._nodeElement,s),i.insertBefore(e._childrenElement,s),e._next=n,n._prev=e}else i.appendChild(e._nodeElement),i.appendChild(e._childrenElement),e._prev=null,e._next=null;Array.insert(this._children,t,e),e.applyParent(this),e._refreshNode(),this._refreshNode(!0),e._refreshExpanded(),this._treeView.set_selectedNode(e)},_processNodeRelation:function(t){var e=t.get_parent();if(e){var i=Array.indexOf(e._children,t);i<0||(t._next&&(t._next._prev=t._prev),t._prev&&(t._prev._next=t._next),Array.removeAt(e._children,i),e._refreshNode(!0))}},_raiseExchange:function(t,e,i){var n=this._treeView.get_events().getHandler("_exchange");if(n){var s=new _Z_183(t,e,i);if(n(this,s),s.get_cancel())return!1;delete s}return!0},get_form:function(){return this._treeView.get_form()},_exchangeParent:function(t){var e=t._nodeElement._parent,i=Array.indexOf(e._children,t);if(0==i)if(e._children.length>1){var n=e._children[1];n&&(n._prev=this),this._next=n}else this._prev=null,this._next=null;else{var s=e._children[i-1];s&&(s._next=this),this._prev=s,i==e._children.length-1?this._next=null:(this._next=e._children[i+1],this._next._prev=this)}Array.removeAt(e._children,i),Array.insert(e._children,i,this),this.applyParent(e)},get_expanded:function(){return this._expanded},toggleChildrenExpanded:function(){this.hasChildren()&&(this._childrenExpanded?(this.childrenCollapse(),this._childrenExpanded=!1):(this.childrenExpand(),this._childrenExpanded=!0))},toggleExpanded:function(t){this.hasChildren()&&(this._expanded?this.collapse(t):this.expand(t))},childrenCollapse:function(){for(var t=0,e=this.get_count();t<e;t++){var i=this.getChild(t);i.childrenCollapse(),i.collapse()}},collapse:function(t){this._expanded&&(this._treeView.hideEditor(),this._showChildren(!1,t),this._expanded=!1,this._initNodeExpand())},childrenExpand:function(){for(var t=0,e=this.get_count();t<e;t++){var i=this.getChild(t);i.expand(),i.childrenExpand()}},expand:function(t){!this._expanded||this._treeView.get_showColumns()?(this._expanded=!0,this._initNodeExpand(),this.expandParent(),this._showChildren(!0,t)):this.expandParent()},expandParent:function(){var t=this.get_parent();t&&(t.expand(),this._treeView.get_showColumns()&&this.set_selected(!0))},get_selected:function(){return this._selected},set_selected:function(t){if(this._selected!=t&&(this._selected=t,t)){if(this._treeView._selectedNodes&&this._treeView._selectedNodes.push(this),this._treeView.get_showColumns()&&this._nodeElement){var e=this._nodeElement;setTimeout(function(){e&&e.scrollIntoView(!1)},10)}this.expandParent()}$Dom.setCssClass(this._selected,this._nodeElement,"selected")},focus:function(){if(this._textElement&&$Dom.getVisible(this._textElement))try{this._textElement.focus()}catch(t){}},fadeIn:function(t,e){if($Dom.setVisible(t,!0),$Dom.setOpacity(t,100),e){$Dom.addCssClass(t,"NodeFadeIn DrpOrange"),setTimeout(function(){t&&($Dom.removeCssClass(t,"NodeFadeIn DrpOrange"),$Dom.setOpacity(t,100))},200)}},fadeOut:function(t,e){if(!e)return t.style.display="none";$Dom.addCssClass(t,"NodeFadeOut DrpOrange"),setTimeout(function(){t&&(t.style.display="none",$Dom.removeCssClass(t,"NodeFadeOut DrpOrange"),$Dom.setOpacity(t,0))},200)},_showChildren:function(t,e){var i=this._treeView;i.get_showColumns()?this._showColumnChilds(t):(i._nodeCount>500&&(e=!1),t?this.fadeIn(this._childrenElement,e):this.fadeOut(this._childrenElement,e))},_onExpandMouseDown:function(t){this.toggleExpanded(!0)},_onCheckClick:function(t){var e=this._treeView;e.set_selectedNode(this,!1),this.get_enabled()&&(this.toggleChecked(),e._internalTreeNodeCheckedChanged(this))},toggleChecked:function(t){if(t)if(t){if(1==this._checkState)return;this.check()}else{if(0==this._checkState)return;this.uncheck()}else 0==this._checkState?this.check():this.uncheck()},togglePartialChecked:function(){2!=this._checkState&&(this._checkState=2,this._initNodeCheck())},get_partialChecked:function(){return 2==this._checkState},get_checked:function(){return this._checkState>0},check:function(t){if(this._checkState=1,!t||!this._treeView._notUpdateParentCheck)for(var e=0,i=this.get_count();e<i;e++)this.getChild(e).check();this._initNodeCheck(),this._updateParentCheckState()},uncheck:function(){this._checkState=0;for(var t=0,e=this.get_count();t<e;t++)this.getChild(t).uncheck();this._initNodeCheck(),this._updateParentCheckState()},_initNodeCheck:function(){if(this._checkElement){var t="ChkBoxStyle";1==this._checkState?t=$skin.joinCssClass(t,"checked"):2==this._checkState&&(t=$skin.joinCssClass(t,"half")),this._checkElement.className=t}},_initNodeExpand:function(){this._expandElement&&(this._expandElement.className=this._getNodeExpandCss())},_getNodeExpandCss:function(){var t="ExpandBlock iconfont";if(this.hasChildren()||this._haschild){t+=" "+(this._expanded?"expand":"collapse")}return t},_initNodeLevel:function(){this._levelElement&&(this._levelElement.className="LevelBlock NodeLevel"+this.get_level())},_updateParentCheckState:function(){var t=this.get_parent();if(t&&!this._treeView._notUpdateParentCheck){for(var e=!1,i=!1,n=0,s=t.get_count();n<s;n++){var o=t.getChild(n);o.get_checked()?(e=!0,2==o._checkState&&(i=!0)):i=!0}t._checkState=e?i?2:1:0,t._initNodeCheck(),t._updateParentCheckState()}},_onTextDblClick:function(t){if(t.target==this._nodeElement||t.target==this._textElement){if(!this._treeView._showColumns){var e=this._treeView;if(e.set_selectedNode(this,!1),this.get_enabled()){var i=e.get_allowDoubleClickEvent();this.hasChildren()&&!i&&this.toggleExpanded(!0),e._internalTreeNodeDblClick()}}}},_onTextSelectStart:function(t){t.cancel()},_onTextMouseOver:function(t){this._textElement.scrollWidth>this._textElement.clientWidth&&(this._textElement.title=this._textElement.innerHTML)},_onNodeMouseOver:function(t){this.showEditor()},_onNodeMouseLeave:function(t){this.hideEditor()},onNodeClick:function(t){var e=this._treeView;t&&t.target==this._expandElement||(e._hideEditPopup(),e.set_selectedNode(this,!1),this.get_enabled()&&(e._internalTreeNodeClick(t),e.get_showColumns()&&this._showChildren(!0),t&&(t.cancel(),$craba.raiseMouseDown(t)),e._lastEditorNode=this))},get_element:function(){return this._textElement}},_Z_265.registerClass("_Z_265"),Sys.UI.Controls.NavTreeView=function(t){Sys.UI.Controls.NavTreeView.initializeBase(this,[t]),this._defaultTarget="__mainPanel"},Sys.UI.Controls.NavTreeView.prototype={doTreeNodeClick:function(t){var e=t.get_value(),i=e.target;i||(i=this.get_defaultTarget());var n=e.navUrl;if(i&&n)if("_top"==i){(window.parent?window.parent:window).location=n}else if("_blank"==i)$common.navigateUrl(n);else{var s=window.parent.frames[i];s&&(s.location=n)}},get_defaultTarget:function(){return this._defaultTarget},set_defaultTarget:function(t){this._defaultTarget=t}},Sys.UI.Controls.NavTreeView.registerClass("Sys.UI.Controls.NavTreeView",Sys.UI.Controls.TreeView),Sys.UI.Controls.LazyTree=function(t){Sys.UI.Controls.LazyTree.initializeBase(this,[t]),this._parentNodeShowCheckBox=!0},Sys.UI.Controls.LazyTree.prototype={_getRootNodeType:function(){var t=new Sys.UI.Controls.XTreeNode(this._rootNodeText);return t._expanded=!0,t},get_parentNodeShowCheckBox:function(){return this._parentNodeShowCheckBox},set_parentNodeShowCheckBox:function(t){this._parentNodeShowCheckBox=t},add_nodeExpandedClick:function(t){this.get_events().addHandler("nodeExpandedClick",t)},remove_nodeExpandedClick:function(t){this.get_events().removeHandler("nodeExpandedClick",t)},_internalnodeExpandedClick:function(t){if(t){var e=this.get_events().getHandler("nodeExpandedClick");e&&e(t)}},add_treeNodeCheckBoxClick:function(t){this.get_events().addHandler("treeNodeCheckBoxClick",t)},remove_treeNodeCheckBoxClick:function(t){this.get_events().removeHandler("treeNodeCheckBoxClick",t)},_internaltreeNodeCheckBoxClick:function(t){if(t){var e=this.get_events().getHandler("treeNodeCheckBoxClick");e&&e(t)}}},Sys.UI.Controls.LazyTree.registerClass("Sys.UI.Controls.LazyTree",Sys.UI.Controls.TreeView),Sys.UI.Controls.XTreeNode=function(t){Sys.UI.Controls.XTreeNode.initializeBase(this,[t]),this._haschild=!1,this._expanded=!1},Sys.UI.Controls.XTreeNode.prototype={initialize:function(){Sys.UI.Controls.XTreeNode.callBaseMethod(this,"initialize");var t=this.get_parent();t&&1==t._checkState&&(this._checkState=1,this._initNodeCheck())},_initNode:function(){var t=this.get_data();t&&null!=t.haschild&&(this._haschild=t.haschild),Sys.UI.Controls.XTreeNode.callBaseMethod(this,"_initNode")},_createCheckBox:function(t){var e=this._treeView.get_showCheckBoxes(),i=this._treeView.get_parentNodeShowCheckBox();if(e){var n=this.get_data();e=i||!n.haschild}e&&(this._checkElement=$common.createDiv(),t.appendChild(this._checkElement),this._initNodeCheck(),$common.addClickHandler(this._checkElement,this._onCheckClick,this))},_bindOneData:function(t){var e=new Sys.UI.Controls.XTreeNode(t[0]);t.length>1&&(e._haschild=!0,e._expanded=!0),null!=e._value._data.haschild&&(e._haschild=e._value._data.haschild),null!=e._value._data.checked&&(e._checkState=1==e._value._data.checked?1:0),this.appendChild(e);for(var i=1;i<t.length;i++)e._bindOneData(t[i])},toggleExpanded:function(t){(this.hasChildren()||this._haschild)&&(this._expanded?this.collapse(t):this.expand(t))},_showChildren:function(t,e){t?this.fadeIn(this._childrenElement,e):this.fadeOut(this._childrenElement,e),this._haschild&&!this.hasChildren()&&this._treeView._internalnodeExpandedClick(this)},_onExpandMouseDown:function(t){this._treeView._internalnodeExpandedClick(this),this.toggleExpanded(!0)},_onCheckClick:function(t){var e=this._treeView;e.set_selectedNode(this,!1),this.get_enabled()&&(e._internalTreeNodeCheckedChanged(this),this._value._data.is_used||this.toggleChecked())},toggleChecked:function(){0==this._checkState?this.check():this.uncheck()},check:function(){for(var t=0,e=this.get_count();t<e;t++)if(this.getChild(t)._value._data.is_used)return;this._checkState=1;for(var t=0,e=this.get_count();t<e;t++)this.getChild(t).check();this._initNodeCheck(),this._updateParentCheckState()},uncheck:function(){for(var t=0,e=this.get_count();t<e;t++)if(this.getChild(t)._value._data.is_used)return;this._checkState=0;for(var t=0,e=this.get_count();t<e;t++)this.getChild(t).uncheck();this._initNodeCheck(),this._updateParentCheckState()},initChildren:function(){for(var t=0,e=this.get_count();t<e;t++)this.getChild(t).initialize()}},Sys.UI.Controls.XTreeNode.registerClass("Sys.UI.Controls.XTreeNode",_Z_265),_Z_111=function(t){var e=$common.createPopupTable(1,0);_Z_111.initializeBase(this,[e]),this._items=t,this._moveItemIndex=-1},_Z_111.prototype={initialize:function(){_Z_111.callBaseMethod(this,"initialize"),this._initList()},get_items:function(){return this._items},set_items:function(t){this._items=t},getItem:function(t){return this._items[t]},get_selectedItem:function(){return this.getItem(this._moveItemIndex)},get_itemCount:function(){return this.get_items().length},get_activeBgColor:function(){return this._activeBgColor},set_activeBgColor:function(t){this._activeBgColor=t},get_activeClassName:function(){return this._activeClassName},set_activeClassName:function(t){this._activeClassName=t},_initList:function(){for(var t=this.get_element(),e=this.get_items(),i=this.get_itemCount(),n=$common.createTBody(),s=0;s<i;s++){var o=e[s],r=$common.createTr(),a=$common.createTd();a.appendChild(o.element),r.appendChild(a),r._isRow="true",r._index=s,n.appendChild(r)}t.appendChild(n),$common.addMouseOverHandler(t,this._doRowMouseOver,this),$common.addMouseDownHandler(t,this._doRowMouseDown,this),$common.addMouseUpHandler(t,this._doRowMouseUp,this)},_findRow:function(t){for(var e=t.target;;){if(e._isRow)return e;if(e==document.body||!e.parentNode)return null;e=e.parentNode}},_doRowMouseOver:function(t){var e=this._findRow(t);e&&this._setMoveItemIndex(e._index)},add_selected:function(t){this.get_events().addHandler("selected",t)},remove_selected:function(t){this.get_events().removeHandler("selected",t)},_doRowMouseDown:function(t){var e=this.get_events().getHandler("selected");this._moveItemIndex>=0&&e&&e(this),t.cancel()},_doRowMouseUp:function(t){t.cancel()},_setMoveItemIndex:function(t){this._moveItemIndex!=t&&(this._moveItemIndex>=0&&this._setRowSelected(this._moveItemIndex,!1),this._moveItemIndex=t,this._setRowSelected(this._moveItemIndex,!0))},_setRowSelected:function(t,e){var i=this.getItem(t).element;e?(this._activeBgColor&&(i.style.backgroundColor=this._activeBgColor),$Dom.addCssClass(i,this._activeClassName)):(i.style.backgroundColor="",this.removeCssClass(this._activeClassName))}},_Z_111.registerClass("_Z_111",_Z_249),Sys.UI.Controls.ToolBar=function(t){Sys.UI.Controls.ToolBar.initializeBase(this,[t])},Sys.UI.Controls.ToolBar.registerClass("Sys.UI.Controls.ToolBar",_Z_249),Sys.UI.Controls.LargeToolBar=function(t){Sys.UI.Controls.LargeToolBar.initializeBase(this,[t])},Sys.UI.Controls.LargeToolBar.registerClass("Sys.UI.Controls.LargeToolBar",Sys.UI.Controls.ToolBar),Sys.UI.Controls.ToolItem=function(t){Sys.UI.Controls.ToolItem.initializeBase(this,[t]),this._requireClick=!0,this._shortcut=0},Sys.UI.Controls.ToolItem.prototype={dispose:function(){this._documentClickHandler=null,this._popupElement&&(this._unhook(),$removeNode(this._popupElement),this._popupElement=null),Sys.UI.Controls.ToolItem.callBaseMethod(this,"dispose")},doFormInit:function(t){var e=this.get_shortcut();e>0&&t.addShortcut(e,this.focusThenClick,this)},focusThenClick:function(){this.focus(),this.click()},get_param:function(){return this._param},set_param:function(t){this._param=t},get_shortcut:function(){return this._shortcut},set_shortcut:function(t){this._shortcut=t},get_popupElement:function(){return this._popupElement},set_popupElement:function(t){this._popupElement&&this._unhook(),this._popupElement=t,this._popupElementMouseOverHandler||(this._popupElementMouseOverHandler=$createDelegate(this,this._popupElementMouseOver),this._popupElementMouseOutHandler=$createDelegate(this,this._popupElementMouseOut)),$common.addMouseOverHandler(t,this._popupElementMouseOverHandler),$common.addMouseOutHandler(t,this._popupElementMouseOutHandler),t.style.visibility="hidden"},get_droppedDown:function(){return!!this._popupElement&&(""==this._popupElement.style.visibility||"visible"==this._popupElement.style.visibility)},set_droppedDown:function(t){var e=this._popupElement;if(e)if(this._documentClickHandler||(this._documentClickHandler=$createDelegate(this,this._documentClick)),t){var i=this.get_bounds(),n=$common.calcPopupPosition(i.x,i.y+i.height,e.offsetWidth,e.offsetHeight,i.width,i.height);e.style.left=n.x+"px",e.style.top=n.y+"px",e.style.visibility="",$common.addClickHandler(document,this._documentClickHandler)}else e.style.visibility="hidden",$common.removeClickHandler(document,this._documentClickHandler)},_unhook:function(){if(this._popupElementMouseOverHandler){var t=this._popupElement;$clearHandlers(t),this._popupElementMouseOverHandler=null,this._popupElementMouseOutHandler=null}},dropDown:function(){this.get_droppedDown()||this.set_droppedDown(!0)},closeUp:function(){this.get_droppedDown()&&this.set_droppedDown(!1)},set_text:function(t){var e=this.get_element().firstChild;e&&e.tagName||(e=this.get_element()),e.innerHTML=t},toggleDroppedDown:function(){this.set_droppedDown(!this.get_droppedDown())},get_dropDownMenuId:function(){return this._dropDownMenuId},set_dropDownMenuId:function(t){this._dropDownMenuId=t},doClick:function(t){Sys.UI.Controls.ToolItem.callBaseMethod(this,"doClick",[t]),t&&t.target&&"javascript:void(0);"==t.target.getAttribute("href")&&t.preventDefault();var e=this.get_dropDownMenuId();if(e){var i=this.get_bounds();this.get_form()[e].popupAt(i.x,i.y+i.height,i.width),t.stopPropagation()}},set_visible:function(t){var e=this.get_element();if(e&&$Dom.getVisible(e)!=t){var i=e.previousSibling;if(i){var n=i.firstChild;"LargeToolSeperator"!=n.className&&"ToolSeperator"!=n.className||$Dom.setVisible(i,t)}}Sys.UI.Controls.ToolItem.callBaseMethod(this,"set_visible",[t])},_documentClick:function(t){this.closeUp()},_popupElementMouseOver:function(t){this.dropDown()},_popupElementMouseOut:function(t){this.closeUp()}},Sys.UI.Controls.ToolItem.registerClass("Sys.UI.Controls.ToolItem",_Z_249),Sys.UI.Controls.ToolButton=function(t){Sys.UI.Controls.ToolButton.initializeBase(this,[t])},Sys.UI.Controls.ToolButton.prototype={get_pushed:function(){return this._pushed},set_pushed:function(t){this._pushed=t}},Sys.UI.Controls.ToolButton.registerClass("Sys.UI.Controls.ToolButton",Sys.UI.Controls.ToolItem),Sys.UI.Controls.ToolSpeedButton=function(t){Sys.UI.Controls.ToolSpeedButton.initializeBase(this,[t])},Sys.UI.Controls.ToolSpeedButton.prototype={},Sys.UI.Controls.ToolSpeedButton.registerClass("Sys.UI.Controls.ToolSpeedButton",Sys.UI.Controls.ToolItem),Sys.UI.Controls.ToolTextButton=function(t){Sys.UI.Controls.ToolTextButton.initializeBase(this,[t])},Sys.UI.Controls.ToolTextButton.prototype={get_bgImage:function(){return this._bgImage},set_bgImage:function(t){this._bgImage=t},get_hoverBgImage:function(){return this._hoverBgImage},set_hoverBgImage:function(t){this._hoverBgImage=t},get_text:function(){return this._text},set_text:function(t){this._text=t},get_showPage:function(){return this._showPage},set_showPage:function(t){this._showPage=t},doClick:function(t){Sys.UI.Controls.ToolTextButton.callBaseMethod(this,"doClick",[t]);var e=this.get_showPage();e&&$common.showPage(this,e,this.get_text())}},Sys.UI.Controls.ToolTextButton.registerClass("Sys.UI.Controls.ToolTextButton",Sys.UI.Controls.ToolItem),Sys.UI.Controls.LargeToolButton=function(t){Sys.UI.Controls.LargeToolButton.initializeBase(this,[t])},Sys.UI.Controls.LargeToolButton.prototype={get_text:function(){return this._text},set_text:function(t){this._text=t},get_showPage:function(){return this._showPage},set_showPage:function(t){this._showPage=t},doClick:function(t){Sys.UI.Controls.LargeToolButton.callBaseMethod(this,"doClick",[t]);var e=this.get_showPage();e&&$common.showPage(this,e,this.get_text())},get_icon:function(){return this._icon},set_icon:function(t){this._icon=t;var e=this.get_element();if(e){e.firstChild.src=$common.getResourceUrl(t,this)}}},Sys.UI.Controls.LargeToolButton.registerClass("Sys.UI.Controls.LargeToolButton",Sys.UI.Controls.ToolItem),Sys.UI.Controls.ToolImage=function(t){Sys.UI.Controls.ToolImage.initializeBase(this,[t]),this._navigateUrl=null},Sys.UI.Controls.ToolImage.prototype={get_navigateUrl:function(){return this._navigateUrl},set_navigateUrl:function(t){this._navigateUrl=t,(t||this.get_isInitialized())&&(this.get_element().style.cursor=t?"pointer":"")},get_image:function(){return this._image},set_image:function(t){this._image=t;var e=this.get_element();if(e){e.firstChild.src=$common.getResourceUrl(t,this)}},doClick:function(t){Sys.UI.Controls.ToolImage.callBaseMethod(this,"doClick",[t]);var e=this.get_navigateUrl();e&&$common.navigateUrl(e)}},Sys.UI.Controls.ToolImage.registerClass("Sys.UI.Controls.ToolImage",Sys.UI.Controls.ToolItem),Sys.UI.Controls.ServerStatus=function(t){Sys.UI.Controls.ServerStatus.initializeBase(this,[t]),this._loopTime=5},Sys.UI.Controls.ServerStatus.prototype={dispose:function(){this._timer&&(clearTimeout(this._timer),this._timer=null),Sys.UI.Controls.ServerStatus.callBaseMethod(this,"dispose")},_getDefaultTimeout:function(){return 60*this._loopTime},doFormInit:function(){this._refresh(this.get_visible()?0:this._getDefaultTimeout())},_refresh:function(t){this._timer||(this._timer=setTimeout($createDelegate(this,this._getServerStatus),1e3*t))},set_host:function(t){this._host=t,this._service||(this._service=new Sys.Net.WebServiceProxy);var e="/Craba.Web/Craba.Web.Admin.AdminService.ajax";e=t.trimEndChar("/")+e,this._service.set_path(e)},get_host:function(){return this._host},_getServerStatus:function(){this._service?this._service._invoke("GetServerStatus",{},$createDelegate(this,this._doOk),$createDelegate(this,this._doFailed)):$adminService.GetServerStatus($createDelegate(this,this._doOk),$createDelegate(this,this._doFailed))},_doOk:function(t){this._showStatus(!0,"服务器 "+t),this._refresh(this._getDefaultTimeout())},_doFailed:function(t){this._showStatus(!1,"服务器 离线"),this._refresh(5)},_showStatus:function(t,e){this._timer=null;var i=this.get_element();i.innerHTML=t?"<font face='webdings' color='green'>4</font>":"<font color='red'>■</font>",i.title=e},set_loopTime:function(t){this._loopTime=t,this._defaultTimeout=60*t},get_loopTime:function(){return this._loopTime}},Sys.UI.Controls.ServerStatus.registerClass("Sys.UI.Controls.ServerStatus",Sys.UI.Control),Sys.UI.Controls.NavBar=function(t){Sys.UI.Controls.NavBar.initializeBase(this,[t])},Sys.UI.Controls.NavBar.registerClass("Sys.UI.Controls.NavBar",_Z_249),Sys.UI.Controls.NavBarGroup=function(t){Sys.UI.Controls.NavBarGroup.initializeBase(this,[t]),this._expanded=!0},Sys.UI.Controls.NavBarGroup.prototype={initialize:function(){Sys.UI.Controls.NavBarGroup.callBaseMethod(this,"initialize");var t=this.get_element(),e=this._headerElement=$common.getFirstChildByClassName(t,"NBGroupHeader");$common.addClickHandler(e,this._doHeaderClick,this),this._contentElement=$common.getFirstChildByClassName(t,"NBGroupBody"),this._iconElement=$common.getFirstChildByClassName(e,"NBIcon")},dispose:function(){this._headerElement&&($clearHandlers(this._headerElement),this._headerElement=null),Sys.UI.Controls.NavBarGroup.callBaseMethod(this,"dispose")},set_expanded:function(t){if(this.get_isInitialized()){if(t!=this._expanded){var e=this.get_groupName();e&&t&&this._collapseOther(e),$Dom.setCssClass(t,this._iconElement,"expand");var i=this.getAutoHeight();this._contentElement.style.height=t?i:0,$Dom.setCssClass(!t,this._contentElement,"collapse"),this._expanded=t}}else this._expanded=t},getAutoHeight:function(){return this._autoHeight?"auto":this._contentElement.scrollHeight+"px"},set_autoHeight:function(t){this._autoHeight=t},get_autoHeight:function(){return this._autoHeight},get_expanded:function(){return this._expanded},get_groupName:function(){return this._groupName},set_groupName:function(t){this._groupName=t},_collapseOther:function(t){for(var e=this.get_element().parentNode.childNodes,i=0,n=e.length;i<n;i++){var s=e[i].control;s&&s!=this&&s.get_groupName()==t&&s.set_expanded(!1)}},_doHeaderClick:function(t){this._enabled&&this.set_expanded(!this._expanded)}},Sys.UI.Controls.NavBarGroup.registerClass("Sys.UI.Controls.NavBarGroup",_Z_249),Sys.UI.Controls.NavBarItem=function(t){Sys.UI.Controls.NavBarItem.initializeBase(this,[t]),this._requireClick=!0;var e=this._tdElement=$common.getFirstChildByTagName(t,"td"),i=$Dom._getCurrentStyle(e);this._paddingLeft=parseInt(i.paddingLeft),this._paddingRight=parseInt(i.paddingRight),this._paddingTop=parseInt(i.paddingTop),this._paddingBottom=parseInt(i.paddingBottom)},Sys.UI.Controls.NavBarItem.prototype={doClick:function(t){Sys.UI.Controls.NavBarItem.callBaseMethod(this,"doClick",[t])},get_param:function(){return this._param},set_param:function(t){this._param=t}},Sys.UI.Controls.NavBarItem.registerClass("Sys.UI.Controls.NavBarItem",_Z_249),Sys.UI.Controls.HtmlEditor=function(t){Sys.UI.Controls.HtmlEditor.initializeBase(this,[t]),this._maxLength=-1,this._isIE=Sys.Browser.isIE,this._isVista=!1,this._isIE&&(this._isVista=navigator.userAgent.indexOf("Windows NT 6.0")>-1),this._html="<p></p>",this._saved=!1,this._htmlMode=!1,this._buttons=[],this._dropDownButtons=[],this._autoSave=!1,this._imgAutoResize=!0},Sys.UI.Controls.HtmlEditor.prototype={initialize:function(){Sys.UI.Controls.HtmlEditor.callBaseMethod(this,"initialize"),this._initResize()},dispose:function(){this._resizeAllImgInterval&&(clearInterval(this._resizeAllImgInterval),this._resizeAllImgInterval=null),$clearHandlers(this._getIframeDoc()),delete this._dropDownButtons,delete this._buttons,this._toggleHtmlButton=null,this._paraFormatList&&(this._paraFormatList.dispose(),this._paraFormatList=null),this._fontNameList&&(this._fontNameList.dispose(),this._fontNameList=null),this._fontSizeList&&(this._fontSizeList.dispose(),this._fontSizeList=null),Sys.UI.Controls.HtmlEditor.callBaseMethod(this,"dispose")},_initResize:function(){var t=this.get_id(),e=this._iframeElement=$get(t+"_iframe");this._bar2=$common.getPreviousSibling(e),this._bar1=$common.getPreviousSibling(this._bar2)},_saveBookMark:function(){var t=this;$addHandler(t._getIframeElement(),"beforedeactivate",function(){var e=t._getSelectionRange();e&&e.getBookmark&&(t.bookmark=e.getBookmark())}),$addHandler(t._getIframeElement(),"activate",function(){if(t.bookmark){var e=t._getIframeDoc().body.createTextRange();e.moveToBookmark(t.bookmark),e.select&&e.select(),t.bookmark=null}})},doFormInit:function(){this._initCommands();var t=this._getIframeDoc();this._getIframeWindow();$common.addClickHandler(t,this._doIframeClick,this),$common.addDblClickHandler(t,this._doIframeDblClick,this),$common.addMouseDownHandler(t,this._doIframeMouseDown,this),$common.addKeyDownHandler(t,this._doKeyDown,this),$common.addMouseEnterHandler(this._iframeElement,this._doMouseEnter,this),this._resizeAllImgInterval=setInterval($createDelegate(this,this._doResizeAllImg),2e3),this._startAutoSaveDoc();var e=this;asyncCall(function(){e._initHTMLDoc(),$craba._initEnabledlay(e),$addHandler(e._getIframeDoc(),"paste",$createDelegate(e,e._doContentPaste))})},_doMouseEnter:function(){$common.hideTips()},_initCommands:function(){var commands=this._commands,form=this.get_form();for(var buttonId in commands){var command=commands[buttonId],func=eval("this._"+command);if(!func)throw Error.invalidOperation("命令没有实现："+command);var button=form[buttonId];if(!button)throw Error.invalidOperation("命令按钮不存在："+buttonId);if(button.add_click($createDelegate(this,this._fireEvent(this,func))),"toggleHtml"!=command){switch(command){case"fontColor":this._fontColorButton=button,Array.add(this._dropDownButtons,button);break;case"bgColor":this._bgColorButton=button,Array.add(this._dropDownButtons,button);break;case"imgJustify":this._justifyBtn=button,Array.add(this._dropDownButtons,button);break;case"paraFormat":this._paraFormatButton=button,Array.add(this._dropDownButtons,button);break;case"template":this._templateButton=button,Array.add(this._dropDownButtons,button);break;case"fontName":this._fontNameButton=button,Array.add(this._dropDownButtons,button);break;case"fontSize":this._fontSizeButton=button,Array.add(this._dropDownButtons,button)}Array.add(this._buttons,button)}else this._toggleHtmlButton=button}},_initHTMLDoc:function(){var t='<html><head><style>body{font-size:12px;}</style></head><body spellcheck="false">'+(this._html?this._html:"")+"</body></html>",e=this._getIframeDoc();try{e.open(),e.write(t),e.close()}catch(i){}finally{this._isIE?e.body.contentEditable=!0:e.designMode="on"}this.bookmark=null,this._isIE&&this._saveBookMark()},_fireEvent:function(t,e){return function(i,n){t._saveRange(),e.apply(t,arguments)}},set_enabled:function(t){this._enabled!=t&&(this._enabled=t,this.get_isInitialized()&&$craba._initEnabledlay(this))},_getIdPrefix:function(){return this.get_id()+"_"},get_maxLength:function(){return this._maxLength},set_maxLength:function(t){this._maxLength=t},_doKeyDown:function(t){var e=t.keyCode||t.charCode;if(e==Sys.UI.Key.esc){var i=this.get_form();i.get_isModal()&&i.close()}else e==Sys.UI.Key.tab&&Sys.Browser.isIE&&(t.cancel(),this._doInsertHtml("&nbsp;&nbsp;"),Sys.Browser.version<9&&this.focus())},get_guid:function(){return this._guid},set_guid:function(t){this._guid=t},get_autoSave:function(){return this._autoSave},set_autoSave:function(t){this._autoSave=t},get_imgAutoResize:function(){return this._imgAutoResize},set_imgAutoResize:function(t){this._imgAutoResize=t},get_imgHostUrl:function(){return this._imgHostUrl},set_imgHostUrl:function(t){this._imgHostUrl=t},get_commands:function(){return this._commands},set_commands:function(t){this._commands=t},get_value:function(){return this._htmlMode&&this._toggleHtml(),this._getHtml()},set_value:function(t){this._html=t,this.get_isInitialized()&&(this._setHtml(""),this._doInsertHtml(t))},get_text:function(){return this.get_value()},set_text:function(t){this.set_value(t)},get_saved:function(){return this._saved},set_saved:function(t){t&&(this._clearAutoSavedDoc(),this._saved=!0)},canTabOnEnter:function(){return!1},_getIframeElement:function(){return this._iframeElement},_getIframeWindow:function(){return this._iframeElement.contentWindow},_getIframeDoc:function(){return this._iframeElement.contentWindow.document},_getIframeBody:function(){return this._iframeElement.contentWindow.document.body},_focusIframeWindow:function(){this._getIframeWindow().focus()},get_innerText:function(){return this._getIframeBody().innerText},_getHtml:function(){var t=this._getIframeBody().innerHTML;return t=t.replace(/<br><br>$/gi,"")},_setHtml:function(t){this._getIframeBody().innerHTML=t||"",this._getIframeBody().focus()},_getHtmlIsEmpty:function(){return this._doGetHtmlIsEmpty(this._getHtml())},_doGetHtmlIsEmpty:function(t){return""==(t=t.toLowerCase())||"<div>&nbsp;</div>"==t||"<div></div>"==t||"<p>&nbsp;</p>"==t||"<p></p>"==t},_doExecCmd:function(t,e){this._reloadRange(),this._getIframeDoc().execCommand(t,!1,e)},_execCmd:function(t,e){var i=this._getIframeWindow();i.focus(),this._doExecCmd(t,e),i.focus()},_doInsertHtml:function(t){this._reloadRange();var e=this._getIframeWindow(),i=this._getIframeDoc();if(i.selection)try{e.focus();(s=i.selection.createRange()).pasteHTML(t),s.collapse(!1),s.select(),e.focus()}catch(l){}else if(i.getSelection){e.focus();var n=i.getSelection();if(n.rangeCount>0){var s=n.getRangeAt(0),o=s.commonAncestorContainer,r=i.createElement("span");if(3==o.nodeType)s.surroundContents(r);else{var a=s.extractContents();r.appendChild(a),s.insertNode(r)}r.innerHTML=t}else this._execCmd("insertHTML",t)}else this._execCmd("insertHTML",t)},_execCmdIEOnly:function(t,e){this._isIE?this._execCmd(t,e):$common.showError("该浏览器不支持本功能")},_getLastUser:function(){return $common.getCookie("_HTED_User")},_setLastUser:function(t){t?$common.setCookie("_HTED_User",t,1e3):$common.removeCookie("_HTED_User")},_getLastSaved:function(){return $common.getCookie("_HTED_Saved")},_setLastSaved:function(t){t?$common.setCookie("_HTED_Saved","true",1):$common.removeCookie("_HTED_Saved")},_startAutoSaveDoc:function(){if(!this._autoSaveDocStarted&&this._guid&&this._autoSave){if(this._isIE){this._getIframeElement().addBehavior("#default#userData");var t=this._getLastUser();t&&t!=this._guid&&this._clearAutoSavedDoc(),setInterval($createDelegate(this,this._autoSaveDoc),2e3),setTimeout($createDelegate(this,this._autoRestoreDoc),500)}else this._clearAutoSavedDoc=this._autoRestoreDoc=function(){};this._autoSaveDocStarted=!0}},_autoSaveDoc:function(){var t=this._htmlMode?this._htmlElement.value:this._getHtml();if(!(!t||this._doGetHtmlIsEmpty(t)||t.length>5e3)){var e=this._getIframeElement();e.setAttribute("_html",t),e.save("_htmlStore"),this._setLastUser(this._guid),this._setLastSaved(!0)}},_autoRestoreDoc:function(){try{if(!this._getLastSaved())return;var t=this._getIframeElement();t.load("_htmlStore");var e=t.getAttribute("_html");if(null!=e&&""!=e){var i=this;$msg.confirm("您有一篇未完成的内容，是否恢复？",function(t){t&&(i._htmlMode?i._htmlElement.value=e:i._setHtml(e)),i._clearAutoSavedDoc()})}}catch(n){}},_clearAutoSavedDoc:function(){this._setLastSaved(!1),this._setLastUser(null);var t=this._getIframeElement();t.setAttribute("_html",""),t.save("_htmlStore")},_doResizeAllImg:function(){if(this._imgAutoResize){var t=this._getIframeElement();if(0!=t.offsetWidth)for(var e=this._getIframeDoc().getElementsByTagName("img"),i=0;i<e.length;i++){var n=e[i],s=n.width,o=n.height,r=t.offsetWidth-50;s>r&&(n.style.width=r+"px",n.style.height=Math.floor(o*(r/s))+"px")}}},_doIframeMouseDown:function(t){var e=t.target;if(e.tagName&&"img"==e.tagName.toLowerCase()&&this._imgAutoResize){var i=this._lastImg=e;i._width=i._tempWidth=i.offsetWidth,i._height=i._tempHeight=i.offsetHeight,this._lastImgResizeEnd=!1,this._lastImgResizeHandler=$common.addResizeHandler(i,this._doImgResizing,this)}},_doImgResizing:function(t){var e=this._lastImg;e._tempWidth==e.offsetWidth&&e._tempHeight==e.offsetHeight||this._lastImgResizeEnd||(setTimeout($createDelegate(this,this._doResizeImg),10),this._lastImgResizeEnd=!0,$common.removeResizeHandler(e,this._lastImgResizeHandler),this._lastImgResizeHandler=null)},_doResizeImg:function(){if(this._imgAutoResize){var t=this._lastImg;Math.abs(t._tempWidth-t.offsetWidth)>0&&(t.style.height=Math.floor(t._height*(t.offsetWidth/t._width))+"px"),Math.abs(t._tempHeight-t.offsetHeight)>0&&(t.style.width=Math.floor(t._width*(t.offsetHeight/t._height))+"px"),t._tempWidth=t.offsetWidth,t._tempHeight=t.offsetHeight}},add_paste:function(t){this.get_events().addHandler("_paste",t)},remove_paste:function(t){this.get_events().removeHandler("_paste",t)},_doContentPaste:function(t){this._pasteImage(t.rawEvent);var e=this,i=!1,n=function(){var t=e._cacheIframe;t||((t=e._cacheIframe=document.createElement("iframe")).style.visibility="hidden",t.style.position="absolute",document.body.appendChild(t));try{var n=t.contentWindow.document;n.open(),n.write("<body></body>"),n.close(),n.body.createTextRange().execCommand("Paste");var s=n.body.innerHTML;return 0==s.indexOf("&nbsp;")&&(s=s.replace(/\&nbsp;/i,"")),n.body.innerHTML="",s}catch(o){return i=!0,""}}();if(i)return!0;if(n&&n.length>0){if(/<\w[^>]*\sclass="?MsoNormal"?/gi.test(n)){e=this;$msg.confirm("文章有多余代码，可能影响顺利发表，是否确认清除？\r\n\r\n提示：您的文字将完整保留。",function(t){n=(n=(n=t?function(t){return t=t.replace(/<\/?SPAN[^>]*>/gi,""),t=t.replace(/<(\w[^>]*)\sclass=([^\s|>]*)([^>]*)/gi,"<$1$3"),t=t.replace(/<(\w[^>]*)\slang=([^\s|>]*)([^>]*)/gi,"<$1$3"),t=t.replace(/<\\?\?xml[^>]*>/gi,""),t=t.replace(/<\/?\w+:[^>]*>/gi,""),t=t.replace(/<img+\s[^>]*>/gi,""),t=t.replace(/<!--+\s[^>]*-->/gi,"")}(n):(n=(n=(n=n.replace(/<img+\s[^>]*>/gi,"")).replace(/<\/?\w+:imagedata[^>]*>/gi,"")).replace(/<\/?\w+:shape[^>]*>/gi,"")).replace(/<!--+\s[^>]*-->/gi,"")).replace(/<\/P>/gi,"")).replace(/<P>/gi,""),e._doInsertHtml(n)})}else n=(n=n.replace(/<\/P>/gi,"")).replace(/<P>/gi,""),this._doInsertHtml(n)}return!1},get_imgSavePath:function(){return this._imgSavePath},set_imgSavePath:function(t){this._imgSavePath=t},_pasteImage:function(t){if(t.clipboardData||t.originalEvent){var e=t.clipboardData||t.originalEvent.clipboardData;if(e.items){for(var i=e.items,n=i.length,s=null,o=0;o<n;o++)-1!==i[o].type.indexOf("image")&&(s=i[o].getAsFile());if(null!=s){var r=this._imgSavePath,a=this.get_events().getHandler("_paste"),l={};if(a&&(a(this,l),l.saveAPI&&(r=l.saveAPI)),r){r.startsWith("http")||(r=$common.getHostUrl()+r);var h=new FormData;h.append("Filedata",s,"clipboard.png");var _=this;$common.showUploading(),$common.ajax({url:r,data:h,complete:function(t){if($common.hideWaiting(),t.get_responseAvailable()){var e=t.get_statusCode();if(e>=200&&e<300){var i=t.get_responseData();l.callback&&(i=l.callback(i)),null!=_._imgHostUrl&&(i=_._imgHostUrl+i),i=i.replace(/\"/gi,""),_._doInsertImg("<p><img src='"+i+"'/></p><br/>")}else $common.showError("粘贴图片上传错误")}else $common.showWarn("粘贴图片上传失败")},ignoreHeader:["content-type"]})}else $common.showWarn("HtmlEditor需配置ImgSavePath地址才可以粘贴图片哦!")}}}},_removeFormat:function(){this._execCmd("removeformat")},_bold:function(){this._execCmd("bold")},_italic:function(){this._execCmd("italic")},_underline:function(){this._execCmd("underline")},_undo:function(){this._execCmdIEOnly("undo")},_redo:function(){this._execCmdIEOnly("redo")},_cut:function(){this._execCmdIEOnly("cut")},_copy:function(){this._execCmdIEOnly("copy")},_paste:function(){this._execCmdIEOnly("paste")},_justifyLeft:function(){this._execCmd("justifyleft")},_justifyCenter:function(){this._execCmd("justifycenter")},_justifyRight:function(){this._execCmd("justifyright")},_justifyFull:function(){this._execCmd("justifyfull")},_outdent:function(){this._execCmd("outdent")},_indent:function(){this._execCmd("indent")},_orderedList:function(){this._execCmd("insertorderedlist")},_unorderedList:function(){this._execCmd("insertunorderedlist")},_doSetFont:function(t,e){if(this._isIE&&Sys.Browser.version<11){"楷体"!=e||this._isVista||(e="楷体_GB2312"),this._doExecCmd("fontname","__TempFontName");var i=this._getIframeDoc();i.body._lastFont||(i.body._lastFont=new Object),"Text"!=i.selection.type?(i.body._lastFont[t]=e,i.body.onkeyup||(i.body.onkeyup=$createDelegate(this,this._doIframeBodyKeyUp))):this._replaceFontName(t,e)}else switch(t){case"fontname":this._doExecCmd("fontname",e);break;case"fontsize":this._doExecCmd("fontsize",e)}},_doIframeBodyKeyUp:function(t){var e=this._getIframeBody()._lastFont;e.fontname&&this._replaceFontName("fontname",e.fontname)},_replaceFontName:function(t,e){for(var i=this._getIframeDoc(),n=i.body._lastFont,s=i.body.getElementsByTagName("font"),o=0;o<s.length;o++){var r=s[o];"__TempFontName"==r.getAttribute("face")&&(this._removeInnerFont(r,t),this._setFontStyleValue(r,t,e),n[t]=null,n.fontsize||n.fontname||r.removeAttribute("face"))}},_removeInnerFont:function(t,e){for(var i=t.children,n=0;n<i.length;n++)this._setFontStyleValue(i[n],e,""),this._removeInnerFont(i[n],e),""==i[n].style.cssText&&("FONT"!=i[n].tagName&&"SPAN"!=i[n].tagName||(i[n].outerHTML=i[n].innerHTML))},_setFontStyleValue:function(t,e,i){switch(e){case"fontname":t.style.fontFamily=i;break;case"fontsize":t.style.fontSize=i}},_doParaFormat:function(t){this._execCmd("formatblock","<"+t+">")},_insertHr:function(){this._doInsertHtml("<div contentEditable = 'false' designMode='off' style='font-size:0;line-height:1px;height:1px;background-color:#ccc;width:100%;display:block;clear:both;'></div>")},doInsertImg:function(t){this._doInsertImg("<img src='"+t+"'/>")},_doInsertImg:function(t){this._doInsertHtml(t),this._doResizeAllImg()},_doInsertLink:function(t,e){var i="<a href='"+t+"' target='_blank'>"+e+"</a>";""==t?this._doInsertHtml(e):this._doInsertHtml(i)},_doInsertTable:function(t,e,i,n,s,o,r){s>0&&0==o&&(o=1);for(var a='<table width="'+n+(i?"%":"")+'" border="0" bgcolor="#cccccc" cellspacing="'+o+'" cellpadding="'+r+'">',l=0;l<t;l++){a+="<tr bgcolor='#ffffff'>";for(var h=0;h<e;h++)a+="<td>&nbsp;</td>";a+="</tr>"}a+="</table>",this._doInsertHtml(a)},_getSelectionRange:function(){var t=this._getIframeWindow(),e=t.document,i={};if(e.selection){(n=e.selection)&&(i=n.createRange())}else{var n=t.getSelection(),s=n.rangeCount-1;if(s<0)return i;(i=n.getRangeAt(s).cloneRange()).text=i.toString()}return i},_insertTextArea:function(){var t="<table style='border:1px solid #999;width:80%;font-size:12px;' align='center'><tr><td>"+(this._getSelectionRange().text||"请在文本框中输入文字")+"</td></tr></table>";this._doInsertHtml(t)},_insertSearch:function(){var t=this._getSelectionRange().text;t?this._doInsertLink("//www.baidu.com/s?cl=3&wd="+t,t):$common.showWarn("请选择一段文字后操作！")},_getSelectionElement:function(){var t,e,i=null,n=this._getIframeDoc();if(n.selection)switch((t=n.selection).type.toLowerCase()){case"none":case"text":i=(e=t.createRange()).parentElement();break;case"control":i=t.createRange().item(0)}else(t=this._getIframeWindow().getSelection()).rangeCount>0&&(i=(e=t.getRangeAt(0)).startContainer==e.endContainer?3!=e.startContainer.nodeType?e.startContainer.childNodes[e.startOffset]:e.startContainer:e.commonAncestorContainer),i&&3==i.nodeType&&(i=i.parentNode);return i},_doImgJustify:function(t){var e=this._getSelectionElement();if(e!=undefined&&"img"==e.tagName.toLowerCase()){var i=e.style;switch(t){case"left":i.margin="4px",$common.setStyleFloat(e,"left"),i.display="",i.textAlign="";break;case"center":i.margin="4px auto",i.display="block",$common.setStyleFloat(e,""),i.textAlign="center",e.setAttribute("align","");break;case"right":i.margin="4px",$common.setStyleFloat(e,"right"),i.display="",i.textAlign=""}}else $common.showInfo("请选中图片后操作！")},_togglePara:function(){for(var t=this._getIframeBody(),e=t.childNodes,i=0,n=e.length;i<n;i++){var s=e[i];s&&s.tagName?(-1!=s.innerHTML.indexOf("&nbsp;")&&(s.innerHTML=s.innerHTML.split("&nbsp;").join("№"),s.innerHTML=s.innerHTML.replace(/(^[\s|　|№]*)|([\s|　|№]*$)/g,""),s.innerHTML=s.innerHTML.split("№").join("&nbsp;")),s.style.textIndent?s.style.textIndent="":s.style.textIndent="2em"):t.innerHTML='<div style="text-indent:2em;">'+t.innerHTML.replace(/(^[\s|　]*)|([\s|　]*$)/g,"")}},_checkEditor:function(){return!this._getHtmlIsEmpty()||($common.showInfo("请先输入内容"),!1)},_preview:function(){if(this._checkEditor()){var t=this._getHtml();$common.preview(t)}},_toggleHtml:function(){var t=!this._htmlMode;this._htmlMode=t,this._toggleHtmlButton&&(this._toggleHtmlButton.set_pushed(t),this._toggleHtmlButton.set_hint(t?"隐藏源代码":"显示源代码"));for(var e=this._buttons,i=!t,n=0;n<e.length;n++){e[n].set_enabled(i)}var s=this._getIframeElement(),o=this._htmlElement;if(t){var r=$Dom.getBounds(s);$Dom.setVisible(s,!1),o?$Dom.setVisible(o,!0):((o=this._htmlElement=document.createElement("textarea")).className="HtmlEditorHtml",$common.setBounds(o,r.width-12,r.height-13),o.style.padding="5px",this.get_element().appendChild(o)),o.value=this._getHtml(),o.focus()}else o&&($Dom.setVisible(o,!1),$Dom.setVisible(s,!0),this._setHtml(o.value)),this._focusIframeWindow()},_imgJustify:function(t,e){this._justifyImg||(this._justifyImg=this._createJustify(),this._justifyBtn.set_popupElement(this._justifyImg)),this._toggleDroppedDown(this._justifyBtn),e.cancel()},_createJustify:function(){var t=$common.createDiv();$common.initPopupElement(t,!0,!0);return Array.forEach([{param:"left",icon:"aicon-pic-left",tips:"图片左对齐"},{param:"center",icon:"aicon-pic-center",tips:"居中对齐"},{param:"right",icon:"aicon-pic-right",tips:"图片右对齐"}],function(e,i){var n=$common.createClassSpan("HtmlArea "+e.icon);n.param=e.param,n.title=e.tips,t.appendChild(n)}),$common.addClickHandler(t,this._doImgJustifyClick,this),document.body.appendChild(t),t},_doImgJustifyClick:function(t){var e=t.target.param;e&&this._doImgJustify(e)},_fontColor:function(t,e){this._fontColorTableElement||(this._fontColorTableElement=this._createColorTable(this._doFontColorItemClick),this._fontColorButton.set_popupElement(this._fontColorTableElement)),this._toggleDroppedDown(this._fontColorButton),e.cancel()},_bgColor:function(t,e){this._bgColorTableElement||(this._bgColorTableElement=this._createColorTable(this._doBgColorItemClick),this._bgColorButton.set_popupElement(this._bgColorTableElement)),this._toggleDroppedDown(this._bgColorButton),e.cancel()},_createColorTable:function(t){var e=$common.createTable(1,0);$common.initPopupElement(e,!0,!0);for(var i=$common.createTBody(),n=["#FF9999","#FFFF80","#80FF80","#80FFFF","#0080FF","#FF80C0","#FF0000","#CCCC66","#00FF40","#0099CC","#9999CC","#FF00FF","#CC3333","#FF9933","#009999","#006699","#9999FF","#990033","#990000","#FF9900","#009900","#0000FF","#0000CC","#990099","#660000","#006666","#999900","#660099","#339999","#66CCCC","#000000","#494949","#767676","#A6A6A6","#C7C7C7","#FFFFFF"],s=0,o=0;s<6;s++){for(var r=$common.createTr(),a=0;a<6;a++){var l=$common.createTd(),h=$common.createGlyphDiv();$common.setBounds(h,14,14),h.className="HtmlEditorItemBorder";var _=n[o];h.style.backgroundColor=_,h.param=_,$common.addClickHandler(h,t,this),l.appendChild(h),r.appendChild(l),o++}i.appendChild(r)}return e.appendChild(i),document.body.appendChild(e),e},_doFontColorItemClick:function(t){var e=t.target.param;this._execCmd("forecolor",e)},_doBgColorItemClick:function(t){var e=t.target.param;this._execCmd(this._isIE?"backcolor":"hilitecolor",e)},_createList:function(t,e){var i=new _Z_111(t);return i.initialize(),i.add_selected($createDelegate(this,e)),i},_paraFormat:function(t,e){if(!this._paraFormatList){this._paraFormatList=this._createParaFormatList();var i=this._paraFormatList.get_element();$common.initPopupElement(i,!0,!0),document.body.appendChild(i),this._paraFormatButton.set_popupElement(i)}this._toggleDroppedDown(this._paraFormatButton),e.cancel()},_template:function(t,e){if(!this._templateList){this._templateList=this._createTemplateList();var i=this._templateList.get_element();$common.initPopupElement(i,!0,!0),document.body.appendChild(i),this._templateButton.set_popupElement(i)}this._toggleDroppedDown(this._templateButton),e.cancel()},_createListElement:function(){var t=$common.createGlyphDiv();return t.className="HtmlEditorListElement",t},_createTemplateList:function(){for(var t=[{t:"列表",p:"list"},{t:"代码风格",p:"code"}],e=t.length,i=new Array(e),n=0;n<e;n++){var s=t[n],o={};o.param=s.p;var r=this._createListElement();r.style.lineHeight="2",r.innerHTML=s.t,o.element=r,i[n]=o}return this._createList(i,this._doTemplateClick)},_createParaFormatList:function(){for(var t=[{p:"P",t:"取消段落",s:"14"},{p:"H1",t:"段落1",s:"32"},{p:"H2",t:"段落2",s:"24"},{p:"H3",t:"段落3",s:"18"},{p:"H4",t:"段落4",s:"16"},{p:"H5",t:"段落5",s:"12"},{p:"H6",t:"段落6",s:"10"}],e=t.length,i=new Array(e),n=0;n<e;n++){var s=t[n],o=new Object;o.param=s.p;var r=this._createListElement();r.style.fontSize=s.s+"px",r.innerHTML=s.t,o.element=r,i[n]=o}return this._createList(i,this._doParaFormatClick)},_doParaFormatClick:function(t){var e=t.get_selectedItem();this._doParaFormat(e.param)},_doTemplateClick:function(t){var e=t.get_selectedItem().param,i="<div class='craba_template'>";"list"==e?i+="<div class='craba_list_title1'>这是标题</div><div class=craba_list_content>这是内容,使用帮助如下：<ol><li>双击生成的模板,此时模板四周显示为可编辑状态;</li><li>ctrl+a全选模板中的标题和内容;</li><li>ctrl+c复制标题和内容；</li><li>鼠标点击文档末尾，换行，ctrl+v粘贴；</li><li>重复以上操作（可选）；</li><li>根据自己需要重新修改各标题和内容。</li></ol></div>":"code"==e&&(i+=""),i="<style>ol,ul{margin-top:5px;margin-left:3em;font-size:10.5pt;padding:0;}li{text-indent:0;}.craba_template{display:block;overflow:hidden;}.craba_list_title1{line-height:30px;height:30px;border-radius:4px;background-color: gray; padding-left: 5px; color: white; font-size: 20px; font-weight: bold;}.craba_list_content{text-indent:20px;display:block;font-size:16px;line-height:26px;}</style>"+(i+="</div>"),this._doInsertHtml(i)},_fontName:function(t,e){if(!this._fontNameList){this._fontNameList=this._createFontNameList();var i=this._fontNameList.get_element();$common.initPopupElement(i,!0,!0),document.body.appendChild(i),this._fontNameButton.set_popupElement(i)}this._toggleDroppedDown(this._fontNameButton),e.cancel()},_createFontNameList:function(){for(var t=["宋体","黑体","隶书","楷体","幼圆","Arial","Impact","Georgia","Verdana","Courier New","Times New Roman"],e=t.length,i=new Array(e),n=0;n<e;n++){var s=t[n],o=new Object;o.param=s;var r=this._createListElement();r.style.fontFamily=s,r.innerHTML=s,o.element=r,i[n]=o}return this._createList(i,this._doFontNameClick)},_doFontNameClick:function(t){var e=t.get_selectedItem();this._doSetFont("fontname",e.param)},_fontSize:function(t,e){if(!this._fontSizeList){this._fontSizeList=this._createFontSizeList();var i=this._fontSizeList.get_element();$common.initPopupElement(i,!0,!0),document.body.appendChild(i),this._fontSizeButton.set_popupElement(i)}this._toggleDroppedDown(this._fontSizeButton),e.cancel()},_createFontSizeList:function(){for(var t=[{p:"12px",t:1},{p:"13px",t:2},{p:"16px",t:3},{p:"18px",t:4},{p:"24px",t:5},{p:"32px",t:6}],e=t.length,i=new Array(e),n=0;n<e;n++){var s=t[n],o=new Object;o.param=s.p,o.size=s.t;var r=this._createListElement();r.style.fontSize=s.p,r.innerHTML="字号<span style='font-size:12px'>"+s.p+"</span>",o.element=r,i[n]=o}return this._createList(i,this._doFontSizeClick)},_doFontSizeClick:function(t){var e=t.get_selectedItem();this._doSetFont("fontsize",e.size)},_showDialog:function(t,e,i,n){var s;if(n){var o=new Sys.UI.Controls.CustomControl;o.set_form(this.get_form()),o.set_gspx(n),s=o.showModal(t)}else{s=new Sys.UI.Form(this);t=$common.getSysUIBaseURI()+"HtmlEditor/"+t;s.showModal(t)}i&&s.add_loaded(i),e&&s.add_ok(e);var r=this,a=this._getSelectionRange();s.add_close(function(){$common.hideWaiting(),r._focusIframeWindow();try{a.select&&a.select()}catch(t){}})},_insertImg:function(t,e){if(this._imgSavePath&&!$settings.CrabaServer){var i='<FileUpload WebMethod="'+this._imgSavePath+'"><VPanel><FileEdit ID="Filedata" Required="true" DataField="Filedata" Multiple="true" Label="图片" ButtonText="支持多选" Width="305" /><HPanel><Button ID="btnUpload" Text="上传"/><CancelButton/></HPanel></VPanel></FileUpload>';this._showDialog("插入图片",null,$createDelegate(this,this._uploadImgAjax),i)}else this._showDialog("InsertImg.gspx",null,$createDelegate(this,this._uploadImgPost))},_uploadImgAjax:function(t){var e=this;t.btnUpload.add_click(function(t){$uploader(t,$createDelegate(e,e._uploadedImg),null,null,{})})},_uploadImgPost:function(t){var e=this._getSelectionRange(),i=this;t.btnLink.add_click(function(n){var s=t.edImgSrc.get_text();t.close(),s&&"http://"!=s.toLowerCase()?i.doInsertImg(s):(i._focusIframeWindow(),e.select&&e.select())});t.btnUpload.add_click(function(n){t.Filedata.get_text()?$uploader(n,$createDelegate(i,i._uploadedImg)):(t.close(),i._focusIframeWindow(),e.select&&e.select())})},_uploadedImg:function(t,e){if(t.get_form().close(),"string"==typeof e){var i=this,n=e.split(","),s="";Array.forEach(n,function(t,e){t&&(null!=i._imgHostUrl&&(t=i._imgHostUrl+t),s+="<p><img src='"+t+"'/></p><br/>")}),s&&this._doInsertImg(s)}else $common.alert('保存图片的服务返回值统一用逗号分隔的字符串，如："xx/1.png,xx/2.png,xx/3.png"')},_insertLink:function(t,e){var i=this,n={},s=this._getSelectionRange();n.Text=s.text;var o=this._getSelectionElement();o&&"a"==o.tagName.toLowerCase()&&(n.Href=o.href),this._showDialog("插入超链接",function(t){var e=t.saveData(),n=e.Href;"http://"!=n.toLowerCase()?(e.Text||(e.Text=n),i._doInsertLink(n,e.Text)):(i._focusIframeWindow(),s.select&&s.select())},function(t){t.dataBind(n)},'<VPanel><TextEdit DataField="Href" Label="链接地址" Width="200"/><TextEdit DataField="Text" Label="链接文字" Width="200"/><VSpacer Height="20"/><HPanel><OkButton/><CancelButton/></HPanel></VPanel>')},_insertTable:function(t,e){var i=this;this._showDialog("插入表格",function(t){var e=t.saveData();i._doInsertTable(e.RowCount,e.ColumnCount,e.PercentWidth,e.Width,e.Border,e.CellSpacing,e.CellPadding)},null,'<Block><HBlock> <VPanel ShowBorder="true"> <HPanel> <SpinEdit DataField="RowCount" Label="行数" Width="50" Value="2" MinValue="1" MaxValue="100" /> </HPanel> <HPanel> <SpinEdit DataField="ColumnCount" Label="列数" Width="50" Value="2" MinValue="1" MaxValue="50" /> </HPanel> <HPanel> <SpinEdit DataField="Width" Label="表格宽度" Width="50" Value="200" MinValue="1" MaxValue="2048" Increment="10"/> <DropDownEdit DataField="PercentWidth" SelectedIndex="0" Width="60"> <ListItem Value="${false}" Text="像素" /> <ListItem Value="${true}" Text="百分比" /> </DropDownEdit> </HPanel> </VPanel> <HSpacer/> <VPanel ShowBorder="true"> <HPanel> <SpinEdit DataField="Border" Label="边框粗细" Width="50" Value="1" MinValue="0" MaxValue="100" /> <Label Text="像素" /> </HPanel> <HPanel> <SpinEdit DataField="CellSpacing" Label="单元格间距" Width="50" Value="0" MinValue="0" MaxValue="100" /> <Label Text="像素" /> </HPanel> <HPanel> <SpinEdit DataField="CellPadding" Label="单元格边距" Width="50" Value="2" MinValue="0" MaxValue="100" /><Label Text="像素" /></HPanel></VPanel></HBlock><HPanel><OkButton/><CancelButton/></HPanel></Block>')},_insertSwf:function(t,e){var i=this;this._showDialog("InsertMedia.gspx",null,function(t,e){var n=t.saveData(),s=n.url;if(0!=s.indexOf("http://")||!/^http[s]?:\/\/([^\/]+).*/.test(s)||s.length<20)return t.hintLabel.set_text("请您输入正确格式的链接"),t.hintBlock.popupAt(t.url),void e.set_canClose(!1);var o=s.lastIndexOf("."),r=!1;if(o>0){var a=s.substr(o).toLowerCase();r="*.mp4;*.flv;*.f4v;*.webm;*.m4v;*.mov;*.3gp;*.3g2;*.rm;*.rmvb;*.wmv;*.avi;*.asf;*.mpg;*.mpeg;*.mpe;*.ts;*.div;*.dv;*.divx;*.vob;*.dat;*.mkv;*.swf;*.lavf;*.cpk;*.dirac;*.ram;*.qt;*.fli;*.flc;*.mod;*.mp3;*.aac;*.ac3;*.wav;*.m4a;*.ogg;*.wma;*.ape;".indexOf(a+";")<0}else r=!0;if(r)return t.hintLabel.set_text("链接无效，只能插入视频链接"),t.hintBlock.popupAt(t.url),void e.set_canClose(!1);var l=null!=n.width?" width='"+n.width+"px' ":"",h=null!=n.height?" height='"+n.height+"px' ":"",_=n.auto,d="<embed "+l+h+' class="Media" src="'+s+'" type="application/x-shockwave-flash" wmode="opaque" videosource="'+s+'" showstatusbar="1" loop="'+n.loop+'" autostart="'+_+'" invokeurls="false" enablecontextmenu="False" allowscriptaccess="never" allownetworking="internal" allowfullscreen="true"/>';i._doInsertHtml(d)})},_toggleDroppedDown:function(t){this._closeUpDropDowns(t),t.toggleDroppedDown()},_closeUpDropDowns:function(t){var e=this._dropDownButtons;if(e)for(var i=0;i<e.length;i++){var n=e[i];t&&n==t||n.closeUp()}},_doIframeClick:function(t){this._closeUpDropDowns()},_doIframeDblClick:function(t){var e=t.target;e&&"IMG"==e.tagName&&$common.navigateUrl(e.src)},_reloadRange:function(){if(this._oldRange){if(window.getSelection){var t=this._getIframeWindow().getSelection();t.removeAllRanges(),t.addRange(this._oldRange)}else this._oldRange.select();this._oldRange=null}},_saveRange:function(){var t=null;if(window.getSelection){var e=this._getIframeWindow().getSelection();try{t=e?e.getRangeAt(0):null}catch(i){t=null}}else t=this._getIframeDoc().selection.createRange();this._oldRange=t},_getBarHeight:function(){return this._bar1.offsetHeight+this._bar2.offsetHeight},set_width:function(t){Sys.UI.Controls.HtmlEditor.callBaseMethod(this,"set_width",[t]);var e=this._iframeElement,i=Sys.Browser.isIE6?t-4:t-2;$common.setWidth(e,i)},set_height:function(t){Sys.UI.Controls.HtmlEditor.callBaseMethod(this,"set_height",[t]);var e=this._iframeElement;$common.setHeight(e,t-this._getBarHeight()-2)}},Sys.UI.Controls.HtmlEditor.registerClass("Sys.UI.Controls.HtmlEditor",_Z_233),Sys.UI.Controls.Chart=function(t){Sys.UI.Controls.Chart.initializeBase(this,[t]),this._zoomFactor=1},Sys.UI.Controls.Chart.prototype={get_mode:function(){return this._mode},set_mode:function(t){this._mode=t,this.get_isInitialized()&&this.refresh()},print:function(){this.get_form().printElement(this.get_element())},refresh:function(t){var e=this.get_element(),i=$common.getSysUIBaseURI()+"Chart/Image.gspx?ID="+e.id+"&Mode="+this._mode+"&IsValueVisible="+this._isValueVisible+"&ZoomFactor="+this._zoomFactor;i=$common.encodeUrlParams(i,t),e.src=i},get_isValueVisible:function(){return this._isValueVisible},set_isValueVisible:function(t){this._isValueVisible=t,this.get_isInitialized()&&this.refresh()},get_zoomFactor:function(){return this._zoomFactor},set_zoomFactor:function(t){if(this._zoomFactor=t,this.get_isInitialized()){var e=this.get_element().style;e.width&&(e.width="",e.height=""),this.refresh()}}},Sys.UI.Controls.Chart.registerClass("Sys.UI.Controls.Chart",Sys.UI.Control),Sys.UI.Controls.FlashChart=function(t){Sys.UI.Controls.FlashChart.initializeBase(this,[t]),this._title="",this._showPieLabel=!0,this._zoomFactor=1},Sys.UI.Controls.FlashChart.prototype={initialize:function(){Sys.UI.Controls.FlashChart.callBaseMethod(this,"initialize");var t=document.title,e=t.indexOf("#");e>0&&(t=t.substr(0,e),document.title=t),this._documentTitle=t,$common.addMouseUpHandler(this.get_element(),function(){document.title=this._documentTitle},this);var i=this.get_element();this._width=i.offsetWidth,this._height=i.offsetHeight,this.get_form().addRemoveSessionControls(this)},dispose:function(){var t=this.get_element().firstChild;if(t){var e=window.onerror;try{window.onerror=function(t){return!0},$removeNode(t)}finally{window.onerror=e}}document.title!=this._documentTitle&&(document.title=this._documentTitle),Sys.UI.Controls.FlashChart.callBaseMethod(this,"dispose")},get_title:function(){return this._title},set_title:function(t){this._title=t},get_mode:function(){return this._mode},set_mode:function(t){this._mode=t,this.get_isInitialized()&&this.refresh()},get_barStyle:function(){return this._barStyle},set_barStyle:function(t){this._barStyle=t,this.get_isInitialized()&&this.refresh()},refresh:function(t){var e=$common.getSysUIBaseURI()+"Chart/Data.gspx?ID="+this.get_id()+"&Mode="+this._mode+"&BarStyle="+this._barStyle+"&Title="+escape(this.get_title())+"&ShowPieLabel="+this._showPieLabel;e=$common.encodeUrlParams(e,t);var i=this._getFlash();try{i.reload(e)}catch(n){}},_getFlash:function(){var t=this.get_element(),e=t.firstChild;return e||(alert("正在初始化，点确定继续"),e=t.firstChild),(!Sys.Browser.isIE||Sys.Browser.isIE&&Sys.Browser.version>10)&&(e=$common.getChildByTagName(e,"embed")),e},postImage:function(){var t=$common.getSysUIBaseURI()+"Chart/ToImage.gspx",e=this.get_title()||this.get_form().get_caption();t=$common.addUrlParam(t,"Title",e);try{this._getFlash().post_image(t,"",!0)}catch(i){$common.showError("FlashChart保存图片出错:"+i)}},_dumpFunctions:function(){var t=this._getFlash();for(var e in t){var i=t[e];"function"==typeof i&&$debug.traceDump(e+" "+i)}},get_version:function(){return this._getFlash().get_version()},get_showPieLabel:function(){return this._showPieLabel},set_showPieLabel:function(t){this._showPieLabel=t,this.get_isInitialized()&&this.refresh()},get_zoomFactor:function(){return this._zoomFactor},set_zoomFactor:function(t){if(this._zoomFactor=t,this.get_isInitialized()){var e=this.get_element(),i=this._width*t,n=this._height*t;$common.setBounds(e,i,n)}}},Sys.UI.Controls.FlashChart.registerClass("Sys.UI.Controls.FlashChart",Sys.UI.Control),Sys.UI.Controls.ECharts=function(t){Sys.UI.Controls.ECharts.initializeBase(this,[t])},Sys.UI.Controls.ECharts.prototype={initialize:function(){Sys.UI.Controls.ECharts.callBaseMethod(this,"initialize");var t=this._echart=echarts.init(this.get_element());"2.2.7"==echarts.version&&t.setTheme("macarons")},dispose:function(){Sys.UI.Controls.ECharts.callBaseMethod(this,"dispose"),this._echart.dispose()},doFormResized:function(){this.get_echart().resize()},get_echart:function(){return this._echart},get_dataSource:function(){return this._dataSource},set_dataSource:function(t){this._dataSource=t,this.get_isInitialized()&&this._bindData()},add_beforeDataBind:function(t,e){this.get_events().addHandler("beforeDataBind",t,e)},remove_beforeDataBind:function(t){this.get_events().removeHandler("beforeDataBind",t)},doFormLoaded:function(){this._bindData()},_bindData:function(){var t=this.get_events().getHandler("beforeDataBind");t&&t(this)},get_width:function(){var t=this.get_element(),e=t.firstChild;return e.tagName?e.offsetWidth:t.offsetWidth},set_width:function(t){$common.setWidth(this.get_element(),t),this.get_echart().resize()},get_height:function(){var t=this.get_element(),e=t.firstChild;return e.tagName?e.offsetHeight:t.offsetHeight},set_height:function(t){$common.setHeight(this.get_element(),t),this.get_echart().resize()},set_title:function(t){this.get_echart().setOption({title:t})},set_itemStyle:function(t){for(var e=this.get_echart(),i=e.getSeries(),n=0,s=i.length;n<s;n++){i[n].itemStyle=t}e.setSeries(i)},get_defaultOption:function(){return Object.clone({title:{},tooltip:{trigger:"axis"},toolbox:{show:!0,feature:{mark:{show:!1},dataView:{show:!1,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:[],yAxis:[{type:"value"}],series:[]})}},Sys.UI.Controls.ECharts.registerClass("Sys.UI.Controls.ECharts",Sys.UI.Control),Sys.UI.Controls.Player=function(t){Sys.UI.Controls.Player.initializeBase(this,[t]),this._src=null,this._url=null,this._playing=!0},Sys.UI.Controls.Player.prototype={initialize:function(){Sys.UI.Controls.Player.callBaseMethod(this,"initialize"),$addHandler(this.get_element(),"play",$createDelegate(this,this._onPlay)),$addHandler(this.get_element(),"pause",$createDelegate(this,this._onPause)),$addHandler(this.get_element(),"ended",$createDelegate(this,this._onStop))},get_src:function(){return this._src},set_src:function(t){this._src=t,this._changed()},get_url:function(){return this._url},set_url:function(t){this._url=t,this._changed()},_changed:function(){if(this.get_isInitialized()){var t=this._src;this._url&&(t=$common.getResourceUrl(this._url,this)),t=this.get_form().convertUrl(t),this.get_element().src=t}},play:function(){!1!==$cache.get("MusicPlayer.AutoPlay")&&(this._playing=!0,this.get_element().play())},stop:function(t){this._playing=!1;var e=this.get_element();e.currentTime=0,e.pause()},pause:function(){this.get_element().pause()},_onStop:function(){var t=this.get_events().getHandler("stop");t&&t(this)},_onPause:function(){var t=this.get_events().getHandler("pause");t&&t(this)},_onPlay:function(){var t=this.get_events().getHandler("play");t&&t(this)},add_play:function(t){this.get_events().addHandler("play",t)},remove_play:function(t){this.get_events().removeHandler("play",t)},add_stop:function(t){this.get_events().addHandler("stop",t)},remove_stop:function(t){this.get_events().removeHandler("stop",t)},add_pause:function(t){this.get_events().addHandler("pause",t)},remove_pause:function(t){this.get_events().removeHandler("pause",t)}},Sys.UI.Controls.Player.registerClass("Sys.UI.Controls.Player",_Z_249),Sys.UI.Controls.IFrame=function(t){Sys.UI.Controls.IFrame.initializeBase(this,[t])},Sys.UI.Controls.IFrame.prototype={initialize:function(){Sys.UI.Controls.IFrame.callBaseMethod(this,"initialize");var t=this.get_element();this.get_form();$addHandler(t.contentWindow,"keydown",function(t){t.keyCode==Sys.UI.Key.esc&&$app._doHotkey(t)})}},Sys.UI.Controls.IFrame.registerClass("Sys.UI.Controls.IFrame",_Z_249),_Z_27=function(){throw Error.notImplemented()},_Z_27.prototype={hideLeft:0,hideRight:1,none:2},_Z_27.registerEnum("_Z_27"),_Z_26=function(){throw Error.notImplemented()},_Z_26.prototype={hideDown:0,hideUp:1,none:2},_Z_26.registerEnum("_Z_26"),_Z_186=function(t,e){_Z_186.initializeBase(this),this._oldValue=e,this._newValue=t},_Z_186.prototype={get_oldValue:function(){return this._oldValue},get_newValue:function(){return this._newValue},set_newValue:function(t){this._newValue=t}},_Z_186.registerClass("_Z_186",_Z_162),_Z_47=function(t){_Z_47.initializeBase(this,[t]),this._isExpanded=!0,this._allowDrag=!0,this._requireMouseDown=!0,this._requireDblClick=!0,this._ignoreIds=[],this._text=$settings.SplitterText},_Z_47.prototype={initialize:function(){_Z_47.callBaseMethod(this,"initialize"),this.initShape()},dispose:function(){this._shapeElement&&($clearHandlers(this._shapeElement),this._shapeElement=null),_Z_47.callBaseMethod(this,"dispose")},initShape:function(){var t=this._shapeElement=this._createShape(),e=this.get_element();e.appendChild(t);var i=e.title;if(this.set_hint(""),this._hasShape()){if(this._text)t.innerText="收起"+this._text;else{var n=$common.createClassSpan("arrow aicon-xiaojiantou");t.appendChild(n)}t.title=i,$common.addClickHandler(t,this.doClick,this)}},_hasShape:function(){return this._mode!=_Z_27.none},set_text:function(t){this._text=t},get_text:function(){return this._text},get_mode:function(){return this._mode},set_mode:function(t){this._mode=t},get_ignoreIds:function(){return this._ignoreIds},set_ignoreIds:function(t){this._ignoreIds=t.split(",")},get_isExpanded:function(){return this._isExpanded},set_isExpanded:function(t){this._isExpanded!=t&&(this._isExpanded=t,this._isLoaded&&(this._initShape(),this._initExpanded()))},_setExpanded:function(t){this._initShape(),t||this._initExpanded()},doClick:function(t){var e=this.get_isExpanded(),i=!e,n=new _Z_186(i,e),s=this.get_events().getHandler("_toggle");if(!s||(s(this,n),i=n.get_newValue(),!n.get_cancel()&&e!=i)){this.set_isExpanded(i);var o={AdjustOffset:this.adjustOffset,IsExpanded:i};this.get_form()._internalSaveControlConfig(this.get_idPart(),o)}},add_toggle:function(t){this.get_events().addHandler("_toggle",t)},remove_toggle:function(t){this.get_events().removeHandler("_toggle",t)},add_dragEnd:function(t){this.get_events().addHandler("_dragEnd",t)},remove_dragEnd:function(t){this.get_events().removeHandler("_dragEnd",t)},get_allowDrag:function(){return this._allowDrag},set_allowDrag:function(t){this._allowDrag=t,t?$Dom.removeCssClass(this.get_element(),"nodrag"):$Dom.addCssClass(this.get_element(),"nodrag")},setMDIPanelScroll:function(t){$common.hideEditEx(),$Dom.setCssClass(!t,document.body,"draging");var e=$common.getMainForm().__mainPanel;if(e){e._childsElement.style.overflow=t?"":"hidden"}},_bindEvent:function(t,e){if(t.cancel(),this._isTimeout=!0,_Z_238.IsDraging=!0,this._mouseMoveHandler||(this._mouseMoveHandler=$common.addMouseMoveHandler(document,this._startDrag,this),this._mouseUpHandler=$common.addMouseUpHandler(document,this._endDrag,this),this.setMDIPanelScroll(!1),$Dom.addCssClass(this.get_element(),"hover"),document.body.style.cursor=e),!$craba._cursorDiv){var i=$craba._cursorDiv=$common.createClassDiv("posabs");i.style.zIndex="9999999",$common.setBounds(i,300,300),document.body.appendChild($craba._cursorDiv)}},_clearEvent:function(){document.body.style.cursor="",this.setMDIPanelScroll(!0),$Dom.removeCssClass(this.get_element(),"hover"),this._isTimeout=!0,_Z_238.IsDraging=!1,this._mouseMoveHandler&&($common.removeMouseMoveHandler(document,this._mouseMoveHandler),$common.removeMouseUpHandler(document,this._mouseUpHandler),this._mouseMoveHandler=null),$craba._cursorDiv&&$dom.setVisible($craba._cursorDiv,!1)},_moveCursor:function(t){var e=$craba._cursorDiv;e&&($dom.setVisible(e,!0),e.style.left=$common.pix(t.clientX-150),e.style.top=$common.pix(t.clientY-150))},_endDrag:function(t,e){var i=null;0==e||isNaN(e)||(i={AdjustOffset:e}),this.get_form()._internalSaveControlConfig(this.get_idPart(),i);var n=this.get_events().getHandler("_dragEnd");n&&n(this)},doPageLoaded:function(t){this._isLoaded=!0,this._hasShape()&&($settings.GspxResolveCache?this._initShape():this._setExpanded(this._isExpanded)),this.setMDIPanelScroll(!0)},_doOtherResize:function(t){var e=this._getOtherControl(),i=this._getTargetControl(),n=i.get_parentElement?i.get_parentElement():i.get_element();$dom.hasClass(n,"Flex0")||$dom.addCssClass(n,"Flex0"),"function"==typeof i.doResized&&i.doResized(t),"function"==typeof e.doResized&&e.doResized(t)},set_saveOffset:function(t){this._saveOffset=t},get_saveOffset:function(){return this._saveOffset}},_Z_47.registerClass("_Z_47",_Z_249),Sys.UI.Controls.VSplitter=function(t){Sys.UI.Controls.VSplitter.initializeBase(this,[t]),this._minWidth=this._minWidth2=$settings.VSplitterMinWidth,this._mode=_Z_27.hideLeft},Sys.UI.Controls.VSplitter.prototype={_createShape:function(){return $common.createClassSpan("Shape LeftShape")},get_forLeft:function(){return this._forLeft},set_forLeft:function(t){this._forLeft=t},get_forRight:function(){return this._forRight},set_forRight:function(t){this._forRight=t},get_minWidth:function(){return this._minWidth},set_minWidth:function(t){"string"==typeof t&&(t=t.split(",")),this._minWidth=this._minWidth2=Number(t[0]),2==t.length&&(this._minWidth2=Number(t[1]))},_getIsHideLeft:function(){return this.get_mode()!=_Z_27.hideRight},_getTarget:function(){return this._getIsHideLeft()?this._leftControl.get_element():this._rightControl.get_element()},_getTargetControl:function(){return this._getIsHideLeft()?this._leftControl:this._rightControl},_getOtherControl:function(){return this._getIsHideLeft()?this._rightControl:this._leftControl},_checkControl:function(t){if(!t)throw Error.argumentNull("VSplitter的ForLeft或ForRight指定的控件不存在");return t.get_width&&t.set_width||(t._fixedSize=!0,this.set_allowDrag(!1)),t},doPageLoaded:function(t){var e=this.get_forLeft(),i=this.get_forRight();if(!e)throw Error.argumentNull("ForLeft");if(!i)throw Error.argumentNull("ForRight");this.setMDIPanelScroll(!1),this._leftControl=this._checkControl(t[e]),this._rightControl=this._checkControl(t[i]);var n=0,s=t._internalGetControlConfig(this.get_idPart());s&&(n=s.AdjustOffset,isNaN(n)&&(n=0),!1===s.IsExpanded&&(this._isExpanded=!1)),this.adjustOffset=n,$settings.GspxResolveCache&&this._saveOffset?this._getTargetControl().saveWidth=this._saveOffset:this._doControlWidth(this._getTargetControl(),n),Sys.UI.Controls.VSplitter.callBaseMethod(this,"doPageLoaded")},_initShape:function(){var t=this._shapeElement,e=this.get_isExpanded(),i=this._getIsHideLeft();this._text&&(t.innerHTML=(e?"收起":"展开")+this._text),t.className=i?e?"Shape LeftShape":"Shape RightShape":e?"Shape RightShape":"Shape LeftShape"},_initExpanded:function(){var t=this.get_isExpanded(),e=this._getTarget();t?(this._resetTargetVisible(e,!0),this.removeCssClass("collapse")):(this._resetTargetVisible(e,!1),this.addCssClass("collapse")),this._doOtherResize("width")},_resetTargetVisible:function(t,e){t.control&&t.control.set_positionVisible?t.control.set_positionVisible(e):("TD"==t.parentNode.tagName&&(t=t.parentNode),$Dom.setVisibleByPosition(t,e))},doMouseDown:function(t){if(this._allowDrag&&this.get_form()._allLoaded){this._clearEvent();this.get_bounds();this._mouseStartX=t.clientX,this._saveControlWidth(this._getTargetControl()),this._isExpanded&&(this._hasShape()&&"SPAN"==t.target.tagName||(this._leftWidth=this._leftControl.get_width(),this._rightWidth=this._rightControl.get_width(),this._bindEvent(t,"ew-resize")))}},_startDrag:function(t){if(t.cancel(),this._isTimeout&&!this.get_isDisposed()){this._moveCursor(t);var e=t.clientX-this._mouseStartX,i=this._rightWidth-e<this._minWidth2,n=this._leftWidth+e<this._minWidth;if(Math.abs(e)<2||n||i)n&&e<0?$common.showInfo("不能继续拖动，左侧最小宽度为:"+this._minWidth):i&&e>0&&$common.showInfo("不能继续拖动，右侧最小宽度为:"+this._minWidth2);else{$common.hideTips(),this._draging=!0,$common.hideToolTip(),this._isTimeout=!1;this._changeControlWidth(this._getTargetControl(),this._getIsHideLeft()?e:-1*e);var s=this;setTimeout(function(){s._isTimeout=!0},50)}}},_endDrag:function(t){if(this._clearEvent(),this._draging&&!this.get_isDisposed()){this._draging=!1;var e=this._getTargetControl();if(e){var i=e.get_width()-e.saveWidth;Sys.UI.Controls.VSplitter.callBaseMethod(this,"_endDrag",[t,i])}}},doDblClick:function(t){var e=this._getTargetControl();if(this._allowDrag&&this._isExpanded&&e){var i=-1*(e.get_width()-e.saveWidth);0!=i&&(this.setMDIPanelScroll(!1),this._changeControlWidth(e,i),this.setMDIPanelScroll(!0),this.get_form()._internalSaveControlConfig(this.get_idPart(),null))}},_saveControlWidth:function(t){t.oldWidth=t.get_realWidth?t.get_realWidth():t.get_width(),t.cachePadding=this._getIsHideLeft()?0:$common._getDomCachePadding(t.get_element(),!0)},_changeControlWidth:function(t,e){var i=this._getControlSaveWidth(t)+e;i<=10||t._fixedSize||(t.set_realWidth?t.set_realWidth(i):(t.set_width(i+t.cachePadding),this._doOtherResize("width")))},_doControlWidth:function(t,e){if(this.get_allowDrag()){var i=t.get_width();t.saveWidth=i,0==e||t._fixedSize||(t.set_width(i+e),this._doOtherResize("width"))}},_getControlSaveWidth:function(t){return t.oldWidth?t.oldWidth:t.get_width()}},Sys.UI.Controls.VSplitter.registerClass("Sys.UI.Controls.VSplitter",_Z_47),Sys.UI.Controls.HSplitter=function(t){Sys.UI.Controls.HSplitter.initializeBase(this,[t]),this._minHeight=this._minHeight2=$settings.HSplitterMinHeight,this._mode=_Z_26.hideDown},Sys.UI.Controls.HSplitter.prototype={_createShape:function(){return $common.createClassSpan("Shape DownShape")},get_forUp:function(){return this._forUp},set_forUp:function(t){this._forUp=t},get_forDown:function(){return this._forDown},set_forDown:function(t){this._forDown=t},get_minHeight:function(){return this._minHeight},set_minHeight:function(t){"string"==typeof t&&(t=t.split(",")),this._minHeight=this._minHeight2=Number(t[0]),2==t.length&&(this._minHeight2=Number(t[1]))},_getIsHideDown:function(){return this.get_mode()!=_Z_26.hideUp},_getTarget:function(){return this._getIsHideDown()?this._downControl.get_element():this._upControl.get_element()},_getTargetControl:function(){return this._getIsHideDown()?this._downControl:this._upControl},_getOtherControl:function(){return this._getIsHideDown()?this._upControl:this._downControl},_checkControl:function(t){if(!t)throw Error.argumentNull("HSplitter的ForUp或ForDown指定的控件不存在");return t.get_height&&t.set_height||(t._fixedSize=!0,this.set_allowDrag(!1)),t},doPageLoaded:function(t){var e=this.get_forUp(),i=this.get_forDown();if(!e)throw Error.argumentNull("ForUp");if(!i)throw Error.argumentNull("ForDown");this.setMDIPanelScroll(!1),this._upControl=this._checkControl(t[e]),this._downControl=this._checkControl(t[i]);var n=0,s=t._internalGetControlConfig(this.get_idPart());s&&(n=s.AdjustOffset,isNaN(n)&&(n=0),!1===s.IsExpanded&&(this._isExpanded=!1)),this.adjustOffset=n,$settings.GspxResolveCache&&this._saveOffset?this._getTargetControl().saveHeight=this._saveOffset:this._doControlHeight(this._getTargetControl(),n),Sys.UI.Controls.HSplitter.callBaseMethod(this,"doPageLoaded")},_initShape:function(){var t=this._shapeElement,e=this.get_isExpanded(),i=this._getIsHideDown();this._text&&(t.innerHTML=(e?"收起":"展开")+this._text),t.className=i?e?"Shape DownShape":"Shape UpShape":e?"Shape UpShape":"Shape DownShape"},_initExpanded:function(){var t=this.get_isExpanded(),e=this._getTarget();t?(this._resetTargetVisible(e,!0),this.removeCssClass("collapse")):(this._resetTargetVisible(e,!1),this.addCssClass("collapse")),this._doOtherResize("height")},_resetTargetVisible:function(t,e){t.control&&t.control.set_positionVisible?t.control.set_positionVisible(e):("TD"==t.parentNode.tagName&&(t=t.parentNode),$Dom.setVisibleByPosition(t,e))},doMouseDown:function(t){if(this._allowDrag){this._clearEvent();this.get_bounds();this._mouseStartY=t.clientY,this._saveControlsHeight(this._getTargetControl()),this._isExpanded&&(this._hasShape()&&"SPAN"==t.target.tagName||(this._upHeight=this._upControl.get_height(),this._downHeight=this._downControl.get_height(),this._bindEvent(t,"ns-resize")))}},_startDrag:function(t){if(t.cancel(),this._isTimeout&&!this.get_isDisposed()){this._moveCursor(t);var e=t.clientY-this._mouseStartY,i=this._upHeight+e<this._minHeight,n=this._downHeight-e<this._minHeight2;if(Math.abs(e)<2||i||n)i&&e<0?$common.showInfo("不能继续拖动，上方最小高度为:"+this._minHeight):n&&e>0&&$common.showInfo("不能继续拖动，下方最小高度为:"+this._minHeight2);else{$common.hideTips(),this._draging=!0,$common.hideToolTip(),this._isTimeout=!1;this._changeControlHeight(this._getTargetControl(),this._getIsHideDown()?-1*e:e);var s=this;setTimeout(function(){s._isTimeout=!0},50)}}},_endDrag:function(t){if(this._clearEvent(),this._draging&&!this.get_isDisposed()){this._draging=!1;var e=this._getTargetControl();if(e){var i=e.get_height()-e.saveHeight;Sys.UI.Controls.HSplitter.callBaseMethod(this,"_endDrag",[t,i])}}},doDblClick:function(t){var e=this._getTargetControl();if(this._allowDrag&&this._isExpanded&&e){var i=-1*(e.get_height()-e.saveHeight);0!=i&&(this.setMDIPanelScroll(!1),this._changeControlHeight(e,i),this.setMDIPanelScroll(!0),this.get_form()._internalSaveControlConfig(this.get_idPart(),null))}},_saveControlsHeight:function(t){t&&(t.oldHeight=t.get_realHeight?t.get_realHeight():t.get_height(),t.cachePadding=this._getIsHideDown()?$common._getDomCachePadding(t.get_element(),!0):0)},_changeControlHeight:function(t,e){var i=this._getControlSaveHeight(t)+e;i<=10||t._fixedSize||(t.set_realHeight?t.set_realHeight(i):(t.set_height(i+t.cachePadding),this._doOtherResize("height")))},_doControlHeight:function(t,e){if(this.get_allowDrag()){var i=t.get_height();t.saveHeight=i,0==e||t._fixedSize||(t.set_height(i+e),this._doOtherResize("height"))}},_getControlSaveHeight:function(t){return t.oldHeight?t.oldHeight:t.get_height()}},Sys.UI.Controls.HSplitter.registerClass("Sys.UI.Controls.HSplitter",_Z_47),Sys.UI.Controls.ProgressBar=function(t){Sys.UI.Controls.ProgressBar.initializeBase(this,[t]),this._value=0,this._showValue=!0,this._maxValue=100},Sys.UI.Controls.ProgressBar.prototype={initialize:function(){Sys.UI.Controls.ProgressBar.callBaseMethod(this,"initialize"),this._createValueBar(),this._refreshItems();var t=this;setTimeout(function(){t._refreshBar()},1)},_createValueBar:function(){var t=this.get_element(),e=this._valueBar=$common.createClassDiv("ProgressValue transition2");t.appendChild(e);var i=this._textBar=$common.createClassSpan("ProgressText");t.appendChild(i)},_refreshBar:function(){var t=this._getPercentValue(),e=t+"%";if(this._valueBar.style.width=e,this._items&&this._items.length>0){var i=100/this._items.length,n=this._textBar.childNodes;Array.forEach(n,function(e,n){$dom.setCssClass(t>n*i,e,"active")})}else{var s=this._textBar;s.innerText=this._getText(),s.style.lineHeight=this._valueBar.offsetHeight+"px",s.className=this._value>this._maxValue/2?"ProgressHighText":"ProgressText",$Dom.hasClass(this.get_element(),"ValueFloat")&&(s.style.left=Math.max(0,t-5)+"%"),this._value==this._maxValue&&this._owner&&this._owner.set_enabled&&(this._owner.set_enabled(!0),this._owner=null)}},_getPercentValue:function(){return Math.roundTo(100*this._value/this._maxValue,2)},set_items:function(t){this._items=t,this.get_isInitialized()&&this._refreshItems()},_refreshItems:function(){if(this._items&&0!=this._items.length){var t=this.get_element();$dom.addCssClass(t,"hasItems hasText");var e=this._textBar;e.innerHTML="",Array.forEach(this._items,function(t){var i=t[this.get_dataTextField()],n=$common.createClassDiv("Item");n.innerHTML=i,e.appendChild(n)},this)}},get_text:function(){return this._text},set_text:function(t){this._text=t,this.get_isInitialized()&&(this._textBar.innerText=this._getText())},_getText:function(){var t="";return this._text&&(t=this._text),this._showValue&&(t+=" "+this._getPercentValue()+"%"),t},set_showValue:function(t){this._showValue=t,this.get_isInitialized()&&this._refreshBar()},get_showValue:function(){return this._showValue},set_value:function(t){t>this._maxValue?t=this._maxValue:t<0&&(t=0),this._value=t,this.get_isInitialized()&&this._refreshBar()},get_value:function(){return this._value},set_maxValue:function(t){this._maxValue=t},get_maxValue:function(){return this._maxValue},set_owner:function(t){this._owner=t,t.set_enabled&&t.set_enabled(!1)}},Sys.UI.Controls.ProgressBar.registerClass("Sys.UI.Controls.ProgressBar",_Z_93);﻿Craba.Web.Script.PrintDataService=function(t){Craba.Web.Script.PrintDataService.initializeBase(this),this._request=null,this._target=t,this._enableUnsafeHeader=!1,this._enableClientLog=!1,this._isPrintService=!0,this._defaultPort=8989,this._defaultPortKey="CrabaPrintServicePort",this._queryStr="?",this._exePath="D:\\Grasp\\Print\\GraspReportSrv.exe",this._timeout=-1},Craba.Web.Script.PrintDataService.prototype={get_port:function(){var t=$common.getCookie(this._defaultPortKey);return t||(t=this._defaultPort),t},set_port:function(t){this._defaultPort=t,$common.setCookie(this._defaultPortKey,t)},get_path:function(){var t=this.get_port(),e="https:"==location.protocol;(Sys.Browser.isChrome||Sys.Browser.isFirefox)&&Sys.Browser.version>=55&&(e=!1),e&&(t+=1);var i="://127.0.0.1:"+t+"/"+this._queryStr;return e?"https"+i:"http"+i},_createUrl:function(t,e,i){return t+e},_jsonSerialize:function(t){return"string"==typeof t?t:Craba.Web.Script.PrintDataService.callBaseMethod(this,"_jsonSerialize",[t])},set_httpVerb:function(t){this._request=t,t._isPrint=!0,t.set_httpVerb("POST"),t.set_notThrowError(!0),t.set_withCredentials(!1)},get_request:function(){return this._request},isPrinting:function(t,e){$cache.get("isPrintMenu")&&($cache.set("isPrintMenu",!1),this.endPrint());var i="get=IsPrinting";null!=t&&(i="type="+t+"&"+i);var r=0!=this.invokeCommand(i);return r&&e&&$common.alert("打印窗体已经打开或正在打印，请关闭打印窗体后重试!"),r},isPrintingSync:function(t,e){var i="get=IsPrinting";null!=t&&(i="type="+t+"&"+i),this.invokeCommandSync(i,null,e)},beginPrint:function(t){var e="method=BeginPrint";null!=t&&(e="type="+t+"&"+e),this.invokeCommand(e)},endPrint:function(t,e){if(!$cache.get("isPrintMenu")){var i="method=EndPrint";null!=t&&(i="type="+t+"&"+i),this.invokeCommand(i,null,e)}},_makeParams:function(t,e){if(e)return e;var i=t.indexOf(":")+1;return i>0&&(e=unescape(t.substring(i))),e},invokeCommandSync:function(t,e,i){e=this._makeParams(t,e),this._invoke(t,e,i,this._reqFailed)},invokeCommand:function(t,e,i){$debug.log("方法："+t),e=this._makeParams(t,e);try{return this._invoke(t,e,!1,this._reqFailed)}catch(r){$print._showPrintError(r.message,t,e,i,this)}},_reqFailed:function(t,e,i){var r="<p>服务形式打印出错啦，错误详情如下:</p><p>调用接口:<font color=blue>"+i+"</font></p><p>出错信息:<font color=red>"+t+"</font></p><p>如果重复出现类似问题，请您联系我们客服.</p>";$app.showError(Sys.ErrorType.servicePrint,r,!0)}},Craba.Web.Script.PrintDataService.registerClass("Craba.Web.Script.PrintDataService",Sys.Net.WebServiceProxy),Craba.Web.Script.PrintDataService.create=function(t){var e=new Craba.Web.Script.PrintDataService(t);return e.set_enableShowWaiting(!1),e},$print=function(){},$print.uploadAllStyle=function(t){this._checkToken("uploadAllStyle");var e=!1,i=null,r=Craba.Web.Script.PrintDataService.create();r._queryStr="";try{(s=r._invoke("GetVersion",{},!1,r._reqFailed))&&"object"==typeof s||(e=!0),e?i=$common.alert(String.format(Sys.Res.printTips.old,$print._getDownloadUrl())):$print._compareVersion(s.data,"1.1.0.12")<0&&(i="上传样式接口调用失败，当前版本"+s.data+"，请升级Teemo打印管理器到1.1.0.12及以上版本。")}catch(o){i="上传样式失败，需安装并启动Teemo版本的打印管理器。"}$common.checkError(null!=i,i);var n={printType:"Command",appName:$settings.CloudPrintAppName,method:"UploadAllStyle",methodParams:""},s=$print._localRequest(n,"uploadAllStyle");return!!s.success||(s.msg&&$common.alert(s.msg),!1)},$print.getPrintStyles=function(t,e,i){var r={tokenType:0,requestor:"craba",productType:i,templateName:t,styleName:"",styleType:0,getStyleFormatType:e,accessToken:$common.__cloudPrintAccessToken};return $print._request("GetReportStyleList",r)},$print.getAccessCode=function(t){var e={tokenType:0,requestor:"craba",accessToken:$common.__cloudPrintAccessToken};return $print._request("GetAccessCode",e,t)},$print.getPrintClients=function(t){var e={tokenType:0,requestor:"craba",accessToken:$common.__cloudPrintAccessToken};return $print._request("GetClientOptions",e,t)},$print.getLocalClients=function(t){var e=$print._localRequest({get:"PrinterNames",printType:"express"},"getLocalClients"),i=$print._getResult(e,1);return $print._toPrinters(i)},$print.convertAndNewStyle=function(t,e){var i={tokenType:0,accessToken:$common.__cloudPrintAccessToken,styles:[{action:t.actionName||"clone",templateName:t.templateName,styleName:t.styleName,productType:t.productType,styleType:t.styleType||3,desStyleType:t.desStyleType||3,defaultStyle:0,ignoreDuplicate:t.ignoreDuplicate,bizStyleId:t.bizStyleId,srcBizStyleId:t.srcBizStyleId}]};return $print._request("ConvertAndNewStyle",i,e)},$print.showRemoteConfig=function(t){var e=new Sys.UI.Form($common.getMainPanel());e.add_ok($createDelegate(this,function(e){t&&t(e.result)})),e.showModal($common.getSysUIBaseURI()+"Print/ClientSelector.gspx")},$print._saveRemoteClients=function(t){$craba.checkConfig("print","remoteClients",t)},$print._getRemoteClients=function(){return window.userConfigData,window.userConfigData.remoteClients},$print.getServerUrl=function(){var t=$common.__cloudPrintServiceUrl;return t?(t.startsWith("//")&&(t=location.protocol+t),t.trimEndChar("/")+"/ReportService.gspx"):""},$print._getExpressDetailData=function(t){var e="",i=[],r=t,n=function(t,r){for(var n in t)if("物流公司"!=n){var s={name:n,caption:n,dataField:n,columnWidth:2e3,section:r};i.push(s)}else e=t[n]};return t instanceof Array?(r={},Array.forEach(t,function(t){var e=t.section;delete t.section,Object.copyTo(t,r),n(t,e)})):n(t),{name:e,detailFields:i,printData:r}},$print._getDetailData=function(t,e,i){for(var r=[],n=[],s={},o=t.length,a=0;a<o;a++){var l="field"+a,c={name:t[a],caption:t[a],dataField:l,columnWidth:e[a]};s[l]=null,r.push(c)}for(var a=0,d=i.length/o;a<d;a++){i[a];var h=a*o,p=Object.clone(s);for(var u in p)p[u]=i[h++];n.push(p)}return{detailFields:r,detailData:n}},$print._hasServicePrint=function(){return $settings.AllPrintUseService},$print.checkVersion=function(t,e,i){var r=Craba.Web.Script.PrintDataService.create();try{return r._invoke("type=Command&method=CheckVersion:"+t+","+e+","+i,null,!1,r._reqFailed),!0}catch(n){return r.get_request().abort(),!1}},$print._getDownloadUrl=function(){var t=$common.getSysUIBaseURI()+"Report/SetupDownload.gspx",e=$settings.ReportConfig;return $print.LastPrint&&$print.LastPrint._reportConfig&&(e=$print.LastPrint._reportConfig),e&&e.DownloadUrl&&(t=e.DownloadUrl,$print.LastPrint&&(t=$craba.makeHost($print.LastPrint.__form,t))),t},$print._getPrintPopupMenu=function(t){$print.LastPrint=t;var e=$common.getMainForm(),i=$print._printPopupMenu;if(i)return e.__exportBtn.set_visible(t._showExport),i;var r=$createControl("PopupBlock",{ID:"__PrintPopup",CssClass:"PrintMenuPopup",OnHide:"__doEndPrint"},e);return $createControl("Button",{Text:Sys.Res.printTips.print,CssClass:"PrimaryButton aicon-dayin",OnClick:"__doPrint"},e,r),$createControl("Button",{Text:Sys.Res.printTips.preview,CssClass:"PrimaryButton aicon-yulan",OnClick:"__doPreview"},e,r),$createControl("Button",{Text:Sys.Res.printTips.design,OnClick:"__doDesign",CssClass:"aicon-bianji1"},e,r),$createControl("Button",{Text:Sys.Res.printTips.style,ID:"__changeStyleBtn",OnClick:"__changeStyle",OnRightIconClick:"__changeStyle"},e,r),$createControl("Button",{ID:"__exportBtn",Text:Sys.Res.printTips["export"],Visible:t._showExport,CssClass:"aicon-daochu",OnClick:"__doExport"},e,r),$createControl("Button",{Text:Sys.Res.printTips.manage,CssClass:"aicon-dayinhetong",OnClick:"__doStyleManage"},e,r),$createControl("Button",{Text:Sys.Res.printTips.quit,CssClass:"DangerButton aicon-tuichu",OnClick:"__cancelPrint"},e,r),$createControl(Craba.UI.CheckBox,{Text:Sys.Res.printTips.autoHide,Checked:!1!==$cache.get("printCloseStatus"),ID:"chkPrintStatus",OnChange:"__doChangeStatus"},e,r),e.get_action().__doPrint=function(t){$print.LastPrint.__doPrint(t),$print.LastPrint._hidePrintPopup()},e.get_action().__doPreview=function(t){$print.LastPrint.__doPreview(t),$print.LastPrint._hidePrintPopup()},e.get_action().__doDesign=function(t){$print.LastPrint.__doDesign(t),$print.LastPrint._hidePrintPopup()},e.get_action().__changeStyle=function(t,e){var i=$Dom.getBounds(t._rightBtn);($print.LastPrint._oldPrinter?$print.LastPrint._oldPrinter._styleMenu:$print.LastPrint._styleMenu).popupAt(i.x,i.y+i.height,i.width,i.height),e.stopPropagation()},e.get_action().__doExport=function(t){$print.LastPrint.__doExport(t),$print.LastPrint._hidePrintPopup()},e.get_action().__doStyleManage=function(t){$print.LastPrint.__doStyleManage(t),$print.LastPrint._hidePrintPopup()},e.get_action().__cancelPrint=function(t){$print.LastPrint._hidePrintPopup(!0,"cancel")},e.get_action().__doChangeStatus=function(t){$cache.set("printCloseStatus",t.get_checked())},e.get_action().__doEndPrint=function(t){$print.LastPrint.__doEndPrint(t),delete $print.__hideType},r.appendTo(document.body),i=$print._printPopupMenu=e.__PrintPopup},$print._showPrintServicePortForm=function(t){var e=$app.get_forms()[0];if(!this._portPopup){var i=$createControl("PopupBlock",{ID:"portPopup",CssStyle:"padding:20px;"},e),r=$createControl("HPanel",null,e,i);$createControl("NumberEdit",{ID:"portEdit",Required:"true",Label:"端口号:",ShowCalculator:!1,MaxValue:999999},e,r),$createControl("Button",{Text:"确定",ID:"portButton"},e,r),i.appendTo(document.body),this._portPopup=e.portPopup,btn=e.portButton,$common.addClickHandler(btn.get_element(),function(t){var i=e.portEdit.get_value();i<1e3||i>9999?$common.alert("请输入1000到9999以内的端口号"):i!=$print.LastPrint.get_port()&&$print.LastPrint.set_port(i),e.portPopup.hide()})}e.portEdit.set_value($print.LastPrint.get_port());var n=$app.getPopupElementZIndex()+1;this._portPopup.popupAt(t.target),this._portPopup.get_popup()._zIndex=n,this._portPopup.get_popup().get_element().style.zIndex=n},$print.checkRun=function(t,e){var i=Craba.Web.Script.PrintDataService.create();i._queryStr="";try{return i._invoke("GetVersion",null,!1),t&&($common.alert("打印管理器连接成功，您可以继续操作打印任务。"),$print._lastForm&&$print._lastForm.close()),!0}catch(r){return t&&$common.alert("打印管理器连接失败，请"+(e?"联系官网客服解决。":"执行下一步操作。")),!1}},$print._startPrintClient=function(t){location.href="grasp://message/?method=_Restart",$common.showInfo('<div class="FlexCenter">如果客户端没有启动成功，请手动从桌面启动它<div class="PrintErrorBox" style="margin:10px 0;display:inline-block;"><div style="width:40px;" class="bicon iconNew"></div></div></div>')},$print._compareVersion=function(t,e){if(!t||!e)return-1;var i=function(t){for(var e=t.split("."),i=[],r=0,n=e.length;r<n;r++)Array.add(i,parseInt(e[r]));return i},r=i(t),n=i(e),s=r[0]-n[0];return 0==s&&0==(s=r[1]-n[1])&&0==(s=r[2]-n[2])&&(s=r[3]-n[3]),s},$print._writeNewServiceData=function(t,e,i,r,n,s){var o=$print.toJsonData(i,r,n,s);t.invokeCommand("type="+e+"&method=AddData",o)},$print.toJsonData=function(t,e,i,r){for(var n={tableName:t,dataFields:[],dataList:{itemCount:1,itemList:[]}},s=e.length,o=0;o<s;o++){var a=i[o]?parseInt(i[o]):256,l=e[o],c={name:l,caption:l,dataField:l,width:a,hidden:"nPrintBarCount"==l};n.dataFields.push(c)}var d=r.length/s;n.dataList.itemCount=d;for(var o=0,h=d;o<h;o++){var p={};n.dataList.itemList.push(p);for(var u=0;u<s;u++){p[e[u]]=r[o*s+u]}}return n},$print._writeServiceData=function(t,e,i,r,n,s,o){if("billprint"==e&&$print._compareVersion(o,"1.8.8.1051")>0)return $print._writeNewServiceData(t,e,i,r,n,s);if("barcode"==e&&$print._compareVersion(o,"1.8.8.1054")>0)return $print._writeNewServiceData(t,e,i,r,n,s);var a=r.length;t.invokeCommand("type="+e+"&method=AddDataTable");for(l=0;l<a;l++){h=r[l]+","+(n[l]?n[l]:256);t.invokeCommand("type="+e+"&method=AddDataColumn:"+h)}for(var l=0,c=s.length/a;l<c;l++){t.invokeCommand("type="+e+"&method=AddDataRow");for(var d=0;d<a;d++){var h=d+","+s[l*a+d];h=escape(h),t.invokeCommand("type="+e+"&method=SetRowStr:"+h)}}t.invokeCommand("type="+e+"&method=SaveDataTable:"+i)},$print._doPrev=function(t,e){var i=t.target;if(!$Dom.hasClass(i,"disabled")){var r=$common.getFirstParentByClassName(i,"_Content"),n=$common.getFirstChildByClassName(r,"_Body"),s=n.getAttribute("index");s==undefined&&(s=0),s=parseInt(s);var o=n.childNodes,a=o[s];$Dom.addCssClass(a,e?"HidedPrev":"Hided");var l=s;e?s++:s--;var c=o[s],d=o.length;$Dom.removeCssClass(c,e?"Hided":"HidedPrev");var h=r.firstChild,p=r.lastChild;$Dom.setCssClass(s<=0,h,"disabled"),$Dom.setCssClass(s>=d-1,p,"disabled"),n.setAttribute("index",s);var u=$craba.getForm(i);if(u){u.bar.set_value((s+1)/3*100);var _=$common.getFirstChildByClassName(r.parentNode,"_Progress"),m=$common.getElementsByClassName(_,"icon");$Dom.removeCssClass(m[l],"cur"),$Dom.addCssClass(m[s],"cur")}}},$print._doNext=function(t){this._doPrev(t,!0)},$print.isRemotePrint=function(){return!!$settings.ReportConfig&&($settings.ReportConfig.PrintMode==_Z_29.remote||$settings.ReportConfig.PrintMode==_Z_29.remoteAndManageStyle)},$print._checkToken=function(t){$common.checkError(!$common.__cloudPrintAccessToken,t+"调用失败，打印Token还没初始化，请刷新后重试")},$print._localRequest=function(t,e){var i=t;t.serverUrl||(i={tokenType:0,accessToken:$common.__cloudPrintAccessToken,printMode:$settings.ReportConfig.PrintMode,serverUrl:$print.getServerUrl(),params:t});try{var r=Craba.Web.Script.PrintDataService.create();r._queryStr="";return r._invoke("ExecutePrint",i,!1,r._reqFailed)}catch(n){r.get_request().abort(),$print._showPrintError(n.message,e,null,!0)}},$print._toPrinters=function(t){for(var e=t.split("\r\n"),i=[],r=0;r<e.length;r++)""!=e[r]&&i.push(e[r]);return i},$print._getResult=function(t,e){var i="";if(!t||"string"==typeof t)return i;30001==t.code&&$common.checkError(!0,t.msg);try{if(!t.success)return $common.alert(t.msg),i;if(!(t=JSON.parse(t.data)).success)return $common.alert(t.msg),i;e=e||0,i=t.params.results[e].result}catch(r){console.log(r)}return i},$print._request=function(t,e,i){this._checkToken(t);var r=Craba.Web.Script.NewPrintService.create();try{var n=r._invoke(t,e,!!i&&function(t){return t&&"object"==typeof t&&t.success?void i(t.params):i(null)},r._reqFailed);if(!i)return n&&"object"==typeof n&&n.success?n.params:null}catch(s){return r.get_request().abort(),$common.showError(t+"调用失败,可能是打印服务中心异常。请稍后再试！"),null}},$print._showPrintError=function(t,e,i,r,n){if(n){if(n.get_request().abort(),$print.LastPrint=n._target,$print.LastPrint.isShowError)return}else $print.LastPrint=new Sys.UI.Actions.ReportPrintService,$print.LastPrint._showExport=!1;$debug._lastPrintErrorLog="打印错误信息如下:\r\n调用方法:"+e+"\r\n调用参数:"+(n?n._jsonSerialize(i):"")+"\r\n错误消息:"+t;var s=Sys.Browser.isIE&&"https:"==location.protocol,o="<div class='PrintErrMsg'>";if(o+="<div class='TitleBlock'>",o+="<div class='Title1' onclick=\"$debug.traceDump($debug._lastPrintErrorLog);\" title='开发者使用,点击查看错误详情'>打印发生异常",s||(o+='，请按照以下<span style="color:#ff0000">三步</span>排查问题。'),o+="</div></div>",s?o+='<div class="mb20">当前浏览器不支持执行https的打印，请切换非IE内核浏览器或http模式下使用打印功能。</div>':(o+='<div class="_Content">',o+='<div class="Arrow aicon-back disabled" onclick="$print._doPrev(event);"></div>',o+='<div class="_Body">',o+='<div class="_Step transition2">',o+='<div class="bword">第一步：使用打印功能需要安装打印组件哟，若您的桌面存在以下软件，则说明您已经成功安装打印客户端，请查看<a href="javascript:;" onclick="$print._doNext(event);">第二步</a>。</div>',o+='<div class="iconBar mb20">',$settings.CrabaServer&&(o+='<div class="bicon iconOld">管家婆打印组件</div>'),o+='<div class="bicon iconNew">管家婆云打印</div></div>',o+='<div>若尚未安装请先下载并安装<a href="'+$print._getDownloadUrl()+'" target="_blank">点击下载</a>，若已经安装请勿重复操作！</div>',o+="</div>",o+='<div class="_Step Hided transition2">',o+='<div class="mb20">第二步：请确认打印管理器是否已经启动，若未启动，请点击下方按钮启动！<br/>若点击按钮后打印管理器还是没显示，请返回上一步安装最新打印客户端。<br/>若启动了还是不能打印，请查看<a href="javascript:;" onclick="$print._doNext(event);">第三步</a></div>',o+='<div class="FelxBlock FlexCenter"><button class="Button BButton small aicon-play-circle" onclick="$print._startPrintClient(event);return false;">点击启动</button>',o+='<button class="Button small RButton aicon-gongju" onclick="$print.checkRun(event);return false;">功能检测</button></div>',o+="</div>",o+='<div class="_Step Hided transition2">',o+='<div class="mb20">第三步：请确保Web端口与打印管理器程序端口一致，当前web端口为：'+$print.LastPrint.get_port()+"。<br/>可通过下方按钮设置！</div>",o+='<div class="FelxBlock FlexCenter">',o+='<button class="Button small BButton aicon-diannao1" onclick="$print._showPrintServicePortForm(event);return false;">设置web端口</button>',o+='<a class="Button small BButton MovieBg aicon-bangzhu" target="_blank" href="http://crabadoc.mygjp.com/Default.gspx#Pages/Content.gspx?id=889">设置程序端口</a>',o+='<button class="Button RButton small aicon-gongju" onclick="$print.checkRun(event, true);return false;">功能检测</button></div>',o+="</div>",o+="</div>",o+='<div class="Arrow aicon-more" onclick="$print._doNext(event);"></div>',o+="</div>",o+='<div class="_Progress"><div class="_ProgressX"><div class="icon cur">1</div><div class="icon">2</div><div class="icon">3</div></div></div>'),o+='<div class="_Bottom">',$settings.CustomHelpQQ&&(o+='<button class="Button BButton aicon-kefu3"><a href="'+$settings.CustomHelpQQ+'" target="_blank">联系客服</a></button>'),$print.LastPrint.doAfterExecute&&($print.LastPrint.isShowError=!0,$print.LastPrint.doAfterExecute(),$print.LastPrint.isShowError=!1),$print.LastPrint&&$print.LastPrint._showError&&($print.LastPrint._showError(Sys.ErrorType.servicePrint,o,r),!$print.LastPrint.get_isDisposed()&&$print.LastPrint._showExport&&(o+='<button class="Button BButton aicon-daochu" onclick="$common.exportServiceToExcel();">导出数据</button>')),o+="</div></div>",!1===r)throw o;throw Error.abort(o,{boxClass:"PrintErrorBox",iconVisible:!1,onLoad:s?null:function(t){var e=t.get_contentElement(),i=$common.getFirstChildByClassName(e,"_Progress",!0);$createControl("ProgressBar",{ID:"bar",Height:"2",CssClass:"NoBorder",ShowValue:!1},t).appendTo(i),$print._lastForm=t}})},$print._pullData=function(t,e,i,r,n){if(!t||"null"==t)return i(e);var s=0==r?e.params.data.detailParams:e.params.data.detailParams1;$common.ajax({url:t,data:s,waiting:"正在拉取打印数据",headers:{reporting:!0,__IsReporting:!0},success:function(t){t=$settings.CrabaServer?$craba._changeDataToList(t.itemList,this):t.data.list,0==r?(e.params.data.detailParams={},e.params.data.detailDataUrl="",e.params.data.detailData={itemCount:t.length,itemList:convertGridData(e.params.data.detailFields,t,n)}):(e.params.data.detailParams1={},e.params.data.detailDataUrl1="",e.params.data.detailData1={itemCount:t.length,itemList:convertGridData(e.params.data.detailFields,t,n)}),$print._pullData(e.params.data.detailDataUrl1,e,i,1,n)},error:function(t,e){t?$common.alert(t.message||t.Message||e.get_responseData()):$common.alert("拉取打印数据失败")}})},$print._checkLoadTeemoJs=function(t){"undefined"==typeof $TeemoApp&&t._useWebTool&&$settings.ReportConfig.TeemoJsUrl&&$common.loadScript($settings.ReportConfig.TeemoJsUrl,null,function(){$print._checkTeemoJs()})},$print._checkTeemoJs=function(){$common.checkError(!$settings.ReportConfig.TeemoJsUrl,Sys.Res.printTips.teemoJs2),$common.checkError("undefined"==typeof $TeemoApp,Sys.Res.printTips.teemoJs1)},Type.registerNamespace("Sys.UI.Actions"),_Z_187=function(t){_Z_187.initializeBase(this),this._action=t},_Z_187.prototype={get_printTimes:function(){return this._action.get_printTimes()},get_exportTimes:function(){return this._action.get_exportTimes()}},_Z_187.registerClass("_Z_187",Sys.EventArgs),_Z_285=function(t){_Z_285.initializeBase(this),this._report=t,this._styleNames=[]},_Z_285.prototype={get_styleNames:function(){return this._styleNames},set_styleNames:function(t){this._styleNames=t},get_reportName:function(){return this._report.get_reportName()},get_report:function(){return this._report}},_Z_285.registerClass("_Z_285",Sys.EventArgs),Sys.UI.Actions.ReportMode=function(){throw Error.notImplemented()},Sys.UI.Actions.ReportMode.prototype={defaultReport:0,currentPage:1,fullData:2},Sys.UI.Actions.ReportMode.registerEnum("Sys.UI.Actions.ReportMode"),_Z_30=function(){throw Error.notImplemented()},_Z_30.prototype={_default:0,printer:1,pdf:2},_Z_30.registerEnum("_Z_30"),_Z_29=function(){throw Error.notImplemented()},_Z_29.prototype={local:0,remote:1,localAndCloudStyle:2,localAndManageStyle:3,remoteAndManageStyle:4},_Z_29.registerEnum("_Z_29"),_Z_46=function(){throw Error.notImplemented()},_Z_46.prototype={_default:-1,pdf:1,printer:0,web:2},_Z_46.registerEnum("_Z_46"),_Z_45=function(){throw Error.notImplemented()},_Z_45.prototype={report:0,express:1,bill:2,barcode:3},_Z_45.registerEnum("_Z_45"),Sys.UI.Actions.PrintType=function(){throw Error.notImplemented()},Sys.UI.Actions.PrintType.prototype={print:1,design:2,preview:3,"export":4,pdf:5,style:8},Sys.UI.Actions.PrintType.registerEnum("Sys.UI.Actions.PrintType"),_Z_44=function(){throw Error.notImplemented()},_Z_44.prototype={string:0,number:1,image:2},_Z_44.registerEnum("_Z_44"),_Z_188=function(t){_Z_188.initializeBase(this),this._masterFields=t,this._data=null},_Z_188.prototype={get_masterFields:function(){return this._masterFields},clearMasterFields:function(){Array.clear(this._masterFields)},addMasterField:function(t,e,i,r,n,s){var o={name:t,dataField:e,isFooter:!!r,hidden:!!i,value:s};n&&(o.dataType=n),Array.add(this._masterFields,o)},addField:function(t){Array.add(this._masterFields,t)},get_data:function(){return this._data},set_data:function(t){this._data=t}},_Z_188.registerClass("_Z_188",_Z_162),_Z_189=function(t){_Z_189.initializeBase(this),this._dataObj=t,this._detailFields=t.detailFields,this._masterFields=t.masterFields,this._detailData=t.detailData},_Z_189.prototype={get_detailFields:function(){return this._detailFields},set_detailFields:function(t){this._detailFields=t,this._detailFieldsChanged=!0},get_masterFields:function(){return this._masterFields},set_masterFields:function(t){this._masterFields=t,this._masterFieldsChanged=!0},get_detailData:function(){return this._detailData},set_detailData:function(t){this._detailData=t,this._detailDataChanged=!0},get_data:function(){return this._dataObj},get_detailSumTexts:function(){return this._dataObj.datailSumTexts},set_detailSumTexts:function(t){this._dataObj.datailSumTexts=t,this._detailSumTextsChanged=!0}},_Z_189.registerClass("_Z_189",_Z_162),Sys.UI.Actions.GetPrintDataEventArgs=function(t){Sys.UI.Actions.GetPrintDataEventArgs.initializeBase(this),this._dataObj=t,this._detailFields=t.params.data.detailFields,this._masterFields=t.params.data.masterFields,this._detailData=t.params.data.detailData},Sys.UI.Actions.GetPrintDataEventArgs.prototype={get_detailFields:function(){return this._detailFields},set_detailFields:function(t){this._detailFields=t,this._detailFieldsChanged=!0},get_masterFields:function(){return this._masterFields},set_masterFields:function(t){this._masterFields=t,this._masterFieldsChanged=!0},get_detailData:function(){return this._detailData},set_detailData:function(t){this._detailData=t,this._detailDataChanged=!0},get_data:function(){return this._dataObj},get_detailSumTexts:function(){return this._dataObj.datailSumTexts},set_detailSumTexts:function(t){this._dataObj.datailSumTexts=t,this._detailSumTextsChanged=!0}},Sys.UI.Actions.GetPrintDataEventArgs.registerClass("Sys.UI.Actions.GetPrintDataEventArgs",_Z_162),_Z_190=function(t,e,i,r){_Z_190.initializeBase(this),this._reportAction=t,this._masterFields=i,this._detailFields=r,this._fieldMap=[],this._expandItem=null,this._grid=e},_Z_190.prototype={dispose:function(){this._expandItem=null},get_expandItem:function(){return this._expandItem},get_detailFields:function(){return this._detailFields},get_masterFields:function(){return this._masterFields},addFieldMap:function(t,e,i){var r={dataField:e,caption:i,name:i};Array.add(this._fieldMap,r)},expandColumn:function(t,e){this._checkParams(t,e);var i=this._clearGroupExpandInfoAndReturnIndex(t);if(-1==i)throw Error.invalidOperation("没有找到需要扩展的组信息");this._addMasterFields(e,e,"");var r=this._addDetailFields(i,t,e);this._expandItem={expandNameList:r,groupName:t,groupCaption:e}},_checkParams:function(t,e){if(!t)throw Error.invalidOperation("扩展名组名错误");if(!e)throw Error.invalidOperation("组全名错误");if(!this._fieldMap||0==this._fieldMap)throw Error.invalidOperation("请调用addFieldMap设置扩展信息")},_clearGroupExpandInfoAndReturnIndex:function(t){for(var e=-1,i=0,r=this._detailFields.length;i<r;i++)this._detailFields[i].groupName==t&&(-1!=e?(Array.remove(this._detailFields,this._detailFields[i]),r--,i--):e=i);return e},_addMasterFields:function(t,e,i){var r={name:t,dataField:e,isFooter:!1,hidden:!1,value:i};Array.add(this._masterFields,r)},_addDetailFields:function(t,e,i){var r=[],n=this._detailFields[t];Array.remove(this._detailFields,n);h={name:i,caption:i,footer:n.footer,calcSum:n.calcSum,replaceText:n.replaceText,decimalDigits:n.decimalDigits,decimalScale:n.decimalScale,displayThousandseperator:n.displayThousandseperator,columnWidth:n.columnWidth,headerAlign:n.headerAlign,textAlign:n.textAlign,groupName:n.groupName,isDynamic:n.isDynamic,displayEmptyForZero:n.displayEmptyForZero};Array.insert(this._detailFields,t,h),t++;for(var s=0,o=this._fieldMap.length;s<o;s++){var a=this._fieldMap[s],l=a.caption,c=a.caption;this._grid.get_columnRealCaption&&(l=this._grid.get_columnRealCaption(s,l)),c="expandqtysize"+s.toString();var d=n.columnWidth;s>0&&(d+=1);var h={name:c,dataField:a.dataField,caption:l,footer:n.footer,calcSum:n.calcSum,replaceText:n.replaceText,decimalDigits:n.decimalDigits,decimalScale:n.decimalScale,displayThousandseperator:n.displayThousandseperator,columnWidth:d,headerAlign:n.headerAlign,textAlign:n.textAlign,groupName:n.groupName,isDynamic:n.isDynamic,displayEmptyForZero:n.displayEmptyForZero};Array.insert(this._detailFields,t,h),Array.add(r,h.name),this._addMasterFields(c,h.dataField,l),t++}return r}},_Z_190.registerClass("_Z_190",Sys.EventArgs),_Z_191=function(){_Z_191.initializeBase(this)},_Z_191.prototype={get_params:function(){return this._params},set_params:function(t){this._params=t},get_callBackUrl:function(){return this._url},set_callBackUrl:function(t){this._url=t}},_Z_191.registerClass("_Z_191",Sys.EventArgs),_Z_103=function(){_Z_103.initializeBase(this),this._event="click",this._useService=$settings.AllPrintUseService,this._reportConfig=$settings.ReportConfig,this._showExport=$settings.ShowExportButton,$settings.ReportConfig&&(this._printMode=$settings.ReportConfig.PrintMode)},_Z_103.prototype={initialize:function(){_Z_103.callBaseMethod(this,"initialize"),this._styleMenuId=this.get_idPart()+"_stylePopup"},dispose:function(){this._doExecute=null,_Z_103.callBaseMethod(this,"dispose")},get_useService:function(){return this._useService},set_useService:function(t){this._useService=t},set_tab:function(t){this._tab=t},get_tab:function(){return this._tab},doFormInit:function(){var t=this.get_control();if(t){var e=this._event;t["add_"+e]instanceof Function&&(this._doExecute=$createDelegate(this,this._internalExecute),t["add_"+e](this._doExecute),t.set_reportAction&&t.set_reportAction(this))}},add_beforeExecute:function(t,e){return this.get_events().addHandler("beforeExecute",t,e)},remove_beforeExecute:function(t){this.get_events().removeHandler("beforeExecute",t)},add_afterExecute:function(t){this.get_events().addHandler("afterExecute",t)},remove_afterExecute:function(t){this.get_events().removeHandler("afterExecute",t)},_internalExecute:function(t,e){var i=this.get_control(),r=i&&i.isPrintButton&&i.isPrintButton();this._isNormalButton=!r,this._method&&"function"==typeof this[this._method]?this[this._method].apply(this):(r=r||1==this._directPrint||this._enabledPDF,this._beforeExecute(t,r?Sys.UI.Actions.PrintType.print:null))},doBeforeExecute:function(t){delete $print.__hideType;var e=new _Z_162;e.executeAction=t;var i=this.get_events().getHandler("beforeExecute");i&&i(this,e);var r=e.get_cancel();return r&&($print.__hideType="cancel"),r},doAfterExecute:function(){if("cancel"!=$print.__hideType&&"esc"!=$print.__hideType){var t=this.get_events().getHandler("afterExecute");if(t){t(this,new _Z_187(this))}}},doExecute:function(t){var e=this.get_events().getHandler("execute");e&&e(this,t)},add_execute:function(t){this.get_events().addHandler("execute",t)},remove_execute:function(t){this.get_events().removeHandler("execute",t)},add_popupInit:function(t){this.get_events().addHandler("popupInit",t)},remove_popupInit:function(t){this.get_events().removeHandler("popupInit",t)},get_control:function(){return this.findControl()},findControl:function(){var t=null,e=this._controlId;if(e){(t=this.get_form()[e])||(this._onlyReport=!0)}return t},get_controlId:function(){return this._controlId},set_controlId:function(t){this._controlId=t},get_event:function(){return this._event},set_event:function(t){this._event=t},get_method:function(){return this._method},set_method:function(t){this._method=t},_initPrintMenu:function(t){if(!this._popupMenuID){var e=this._makePrintItems(!0),i=this.get_events().getHandler("popupInit");i&&i(this,{items:e});var r=this._popupMenuID=t._popupMenu=t.get_idPart()+"_printPopup",n=this._menu=Sys.UI.Controls.Menu.create(t.get_form(),{id:r,cssClass:"PrintMenu",items:e});n.btn=t,n.add_beforeSubMenu(this._onClickMenu,this)}},_makePrintItems:function(t){return[{id:"dyyl",properties:{text:Sys.Res.printTips.preview,icon:"aicon-yulan",visible:t},events:{click:$createDelegate(this,this._preview)}},{id:"dysj",properties:{text:Sys.Res.printTips.design,icon:"aicon-bianji1",visible:t},events:{click:$createDelegate(this,this._design)}},{id:"dyys",properties:{text:Sys.Res.printTips.style,icon:"aicon-yangshi",subMenu:this._styleMenuId}},{id:"ysgl",properties:{text:Sys.Res.printTips.manage,icon:"aicon-shezhi2",visible:t},events:{click:$createDelegate(this,this._styleManage)}},{id:"dcsj",properties:{visible:this._showExport,text:Sys.Res.printTips["export"],icon:"aicon-daochu"},events:{click:$createDelegate(this,this._export)}}]},_onClickMenu:function(t,e){this.get_form();var i=e[0].get_subMenu();if(i&&i==this._styleMenuId)try{this._createStyleMenu()}catch(r){t.hide()}},_createStyleMenu:function(t){var e=this.get_form()[this._popupMenuID+"_dyys"];this._createStylePopupMenu(e,t)},_clearStyleMenu:function(){if(this._styleMenu){for(var t=this.get_form(),e=this._styleMenu.get_idPart(),i=0;i<this._styleMenu.itemCount;i++){var r=t[e+"_"+i];t.removeControl(r)}t.removeControl(this._styleMenu,!0),this._styleMenu=null}},_checkStyleItemEnabled:function(t){if(t){t.setIcon("aicon-check");var e=this.get_form()[this._styleMenu.get_idPart()+"_"+this._styleIndex];e&&t!=e&&e.setIcon(null)}},_preview:function(t,e){this._menu.hide(),this.preview()},_design:function(t,e){this._menu.hide(),this.design()},_export:function(t,e){this._menu&&this._menu.hide(),this.exportData()},_styleManage:function(t,e){this._menu.hide(),this.styleManage()},_pdfPrint:function(t,e){this._menu.hide(),this.pdfPrint()},get_showExport:function(){return this._showExport},set_showExport:function(t){this._showExport=t},setPrinter:function(t){this._printerName=t}},_Z_103.registerClass("_Z_103",_Z_242),_Z_104=function(){_Z_104.initializeBase(this),this._formWidth=197,this._formHeight=235,this._styleIndex=0,this._copies=1,this._showModal=!0,this._reportNumber=-1,this._showMasterFields=!0,this._showDetailHeader=!0,this._isGetAll=$settings.PrintAllFields,this._createReport=$settings.PrintDefaultCreateReport,this._directPrint=!1,this._ajaxMode=!1,this._reportMode=Sys.UI.Actions.ReportMode.defaultReport,this._usePrintPopup=$settings.DefaultUsePrintPopup,this._useWebTool=$settings.AllPrintUseWebTool,this._requiredVersion=$settings.RequiredCPrintVersion||"10.2.0.410",this._batchPrint=!1,this._allowExport=!1,this._defaultUseNewDesignForm=!0,this._printTimesLimit=-1,this._cloudStoreVersion="10.3.0.102",this._mergePrintVersion="10.3.0.151",this._printTimesCallBackVersion="10.3.0.156",this._styleManageVersion="10.3.0.165",this._pageWidth=0,this._expandedHeaderInfo={},this._enabledPDF=$settings.PrintDefaultUsePDF&&!$settings.PrintDefaultDisabledPDF,this._disabledPDF=$settings.PrintDefaultDisabledPDF},_Z_104.prototype={initialize:function(){_Z_104.callBaseMethod(this,"initialize"),this._disabledPDF||(this._printOutDevice==_Z_30.printer?this._enabledPDF=!1:this._printOutDevice==_Z_30.pdf&&(this._enabledPDF=!0)),this._printOutDevice=_Z_30._default,$print._checkLoadTeemoJs(this)},set_styleName:function(t){this._styleName=t},get_styleName:function(){return this._styleName},set_createStyle:function(t){this._createStyle=t},get_createStyle:function(){return this._createStyle},set_disabledPDF:function(t){this._disabledPDF=t},get_disabledPDF:function(){return this._disabledPDF},set_copies:function(t){this._copies=t},get_copies:function(){return this._copies},set_bizStyleId:function(t){this._bizStyleId=t},get_bizStyleId:function(){return this._bizStyleId},_showError:function(t,e,i){var r=this.get_events().getHandler("_error");if(r&&r(this),!1===i)throw e},get_printOutDevice:function(){return this._printOutDevice},set_printOutDevice:function(t){this._printOutDevice=t},get_printMode:function(){return this._printMode},set_printMode:function(t){this._printMode=t},get_formUrl:function(){return this._formUrl},set_formUrl:function(t){this._formUrl=t},get_formWidth:function(){return this._formWidth},set_formWidth:function(t){this._formWidth=t},get_formHeight:function(){return this._formHeight},set_formHeight:function(t){this._formHeight=t},get_gridId:function(){return this._gridId},set_gridId:function(t){this._gridId=t},get_showModal:function(){return this._showModal},set_showModal:function(t){this._showModal=t},_skipExtensionGroup:function(t){return t.hidden||this._expandItem&&t.name==this._expandItem.groupCaption},get_reportName:function(t){if(!t||!$settings.CPrintUseClound||!this.isSupportCloudStore())return this._reportName;var e=this._getDataService().GetCloundPrintInfo(this._reportName,!1,Function.emptyMethod);if(Object.isEmpty(e))return this._reportName;if(e.templatename=this._reportName,delete e.PrintTimes,delete e.ExportTimes,delete e.ClientParams,delete e.ReportName,!e.Token)throw new Error.abort("服务打印获取云样式Token失败，方法：GetCloundPrintInfo");this.doGetReportName(e);return $crabaJSON.serialize(e)},doGetReportName:function(t,e){var i=this.get_events().getHandler("getReportName");if(i&&this.isSupportPrintTimes()){var r=new _Z_191;i(this,r);var n=r.get_callBackUrl()||$common.getHostUrl()+$getRootURI()+"Craba.Web/Craba.Web.Script.DataService.ajax/Printing";if(e)return t.url=n,t.cookie=this.get_cookie(),void(t.clientParams=r.get_params());t.CallBackUrl=n,t.Cookie=this.get_cookie(),t.ClientParams=r.get_params()}},_getDataService:function(){var t=this._dataService;return t||(t=this._dataService=Craba.Web.Script.DataServiceBase.create(this.get_form())),t},set_reportName:function(t){this._reportName=t},isSupportCloudStore:function(){var t=this.getVersion();return $print._compareVersion(t,this._cloudStoreVersion)>=0},isSupportMergePrint:function(){var t=this.getVersion();return $print._compareVersion(t,this._mergePrintVersion)>=0},isSupportPrintTimes:function(){var t=this.getVersion();return $print._compareVersion(t,this._printTimesCallBackVersion)>=0},isSupportStyleManage:function(){var t=this.getVersion();return $print._compareVersion(t,this._styleManageVersion)>=0},get_reportNumber:function(){return this._reportNumber},set_reportNumber:function(t){this._reportNumber=t},get_masterFields:function(){return this._masterFields},set_masterFields:function(t){this._masterFields=t},get_detailFields:function(){return this._detailFields},set_detailFields:function(t){this._detailFields=t},get_printTimesLimit:function(){return this._printTimesLimit},set_printTimesLimit:function(t){this._printTimesLimit=t},appendCookie:function(t){t.cookie=this.get_cookie()},get_cookie:function(){var t=this._cookie,e=$common.getCookie("SERVERID");return""!=e&&(t=t+";SERVERID="+e),t},set_cookie:function(t){this._cookie=t},get_setupUrl:function(){return this._setupUrl},set_setupUrl:function(t){this._setupUrl=t},get_requiredVersion:function(){var t=this._requiredVersion,e=this._reportConfig;return e&&e.RequiredVersion&&(t=e.RequiredVersion),t},get_showMasterFields:function(){return this._showMasterFields},set_showMasterFields:function(t){this._showMasterFields=t},get_showDetailHeader:function(){return this._showDetailHeader},set_showDetailHeader:function(t){this._showDetailHeader=t},get_createReport:function(){return this._createReport},set_createReport:function(t){this._createReport=t},get_directPrint:function(){return this._directPrint},set_directPrint:function(t){this._directPrint=t},get_ajaxMode:function(){return this._ajaxMode},set_ajaxMode:function(t){this._ajaxMode=t},get_reportMode:function(){return this._reportMode},set_reportMode:function(t){this._reportMode=t},get_rowNoExpr:function(){return this._rowNoExpr},set_rowNoExpr:function(t){this._rowNoExpr=t},get_masterDetailKeyFields:function(t){return this._masterDetailKeyFields},set_masterDetailKeyFields:function(t){this._masterDetailKeyFields=t},get_productName:function(){return this._productName},set_productName:function(t){this._productName=t},get_allowPrint:function(t){return this._allowPrint},set_allowPrint:function(t){this._allowPrint=t},get_allowExport:function(t){return this._allowExport},set_allowExport:function(t){this._allowExport=t},get_defaultUseNewDesignForm:function(t){return this._defaultUseNewDesignForm},set_defaultUseNewDesignForm:function(t){this._defaultUseNewDesignForm=t},doPopupHide:function(){var t=this.get_events().getHandler("popupHide");t&&t(this,{type:$print.__hideType?$print.__hideType:"esc"})},get_usePrintPopup:function(){return this._usePrintPopup},set_usePrintPopup:function(t){this._usePrintPopup=t},add_popupHide:function(t){this.get_events().addHandler("popupHide",t)},remove_popupHide:function(t){this.get_events().removeHandler("popupHide",t)},add_getStyleNames:function(t){this.get_events().addHandler("getStyleNames",t)},remove_getStyleNames:function(t){this.get_events().removeHandler("getStyleNames",t)},add_getMasterData:function(t){this.get_events().addHandler("getMasterData",t)},remove_getMasterData:function(t){this.get_events().removeHandler("getMasterData",t)},add_getReportName:function(t){this.get_events().addHandler("getReportName",t)},remove_getReportName:function(t){this.get_events().removeHandler("getReportName",t)},add_error:function(t){this.get_events().addHandler("_error",t)},remove_error:function(t){this.get_events().removeHandler("_error",t)},add_getDetailData:function(t){this.get_events().addHandler("getDetailData",t)},remove_getDetailData:function(t){this.get_events().removeHandler("getDetailData",t)},add_getPrintData:function(t){this.get_events().addHandler("getPrintData",t)},remove_getPrintData:function(t){this.get_events().removeHandler("getPrintData",t)},add_interceptorBeforePrint:function(t){this.get_events().addHandler("interceptorBeforePrint",t)},remove_interceptorBeforePrint:function(t){this.get_events().removeHandler("interceptorBeforePrint",t)},add_initDetailData:function(t){this.get_events().addHandler("initDetailData",t)},remove_initDetailData:function(t){this.get_events().removeHandler("initDetailData",t)},add_initDetailList:function(t){this.get_events().addHandler("initDetailList",t)},remove_initDetailList:function(t){this.get_events().removeHandler("initDetailList",t)},get_grids:function(){var t=[],e=this._gridId,i=this.get_form();if(e&&i)for(var r=e.split(","),n=0,s=r.length;n<s;n++){var o=r[n].trim();o&&Array.add(t,$craba.findControl(o,i))}return t},get_grid:function(){var t=this.get_grids();return t.length>0?t[0]:null},getGridByIndex:function(t){var e=this.get_grids();return e.length>t?e[t]:null},_internalExportXls:function(){if(this.get_isDisposed())$common.showError("窗体已经关闭，不能导出数据.");else try{$common._internalExportXls(this.getReportData(!0,!0))}catch(t){handleError(t)}},_adjustFieldsOrder:function(t,e){for(var i=null,r=null,n=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];if(n.name==e||n.dataField==e)return i}return-1},s=0,o=e.length;s<o;s++){var a=e[s];if(!a.hidden){var l=a.after;if(l?(i=l,r=a.name):i&&(i=l=r,r=a.name),l){for(var c=0,d=t.length;c<d;c++){if(t[c].dataField===a.dataField){Array.removeAt(t,c);break}}var h=Object.clone(a),p=n(t,l);p<0?Array.add(t,h):p==t.length-1?Array.add(t,h):Array.insert(t,p+1,h)}}}},_initDetailHeader:function(t,e){var i=t._header;if(i){var r=null!=t._headerSpacer,n=$common.getTableBody(i).childNodes,s=e.rowCount=n.length,o=e.rowsCells=[];e.rowColCount=[],e.colCount=0;for(var a=0,l=0;l<s;l++){var c=0,d=n[l].childNodes,h=d.length;0==l&&r&&h--;for(var p=0;p<h;){var u=d[p];if($Dom.getVisible(u)){var _=u.firstChild,m="";m=_.firstChild&&_.firstChild.tagName?"TABLE"==_.firstChild.tagName?_.firstChild.innerText:_.firstChild.innerHTML:_.innerHTML,m=1==l&&this._expandItem&&this._isExpandColumnCell(u,t)?this._expandItem.groupCaption:m;u._colSpan,p+=1;var g=1;u.rowSpan&&(g=parseInt(u.rowSpan));var f=u.align||"",y=u.offsetWidth;u._colSpan&&(y=y*parseInt(u._colSpan)+u._colSpan-1),this._addDetailHeaderCells(o,l,g,1,m,y,f),c+=1}else p++}e.rowColCount[l]=c,a=Math.max(c,a)}e.colCount=a}},_isExpandColumnCell:function(t,e){if(!this._hasColumnExpand())return!1;for(var i=e.get_columns(),r=0,n=i.length;r<n;r++){var s=i[r];if(s.expanded&&0!=s.expanded.length&&s.expanded[0]._elements){if(s.expanded[0]._elements.header==t)return t._colSpan=s.expanded.length,!0;for(var o=1;o<s.expanded.length&&s.expanded[o]._elment;o++)if(s.expanded[o]._elment.header==t)return!1}}return!1},_addDetailHeaderCells:function(t,e,i,r,n,s,o){for(var a=0;a<r;a++)for(var l,c=e,d=0;d<i;d++,c++){var h=t[c];void 0===h&&(h=t[c]=[]);var p={};if(0==d&&0==a?((i>1||r>1)&&(p.rowSpan=i,p.colSpan=r),p.text=n):p.text="",p.width=1==r?s:(s-r+1)/r,p.align=o,p.rowIndex=e,0==d){l=0;for(var u=0,_=h.length;u<_&&"undefined"!=typeof h[l];u++)l++}h[l]=p,p.colIndex=l}},_toReportHAlign:function(t){return"center"==t?1:"right"==t?2:0},_subByteStr:function(t,e,i){var r=t.length;if(e>=r)return"";for(var n=e,s=0;n<r&&s<i;){if((s+=t.charCodeAt(n)>127?2:1)>i)break;n++}return n==e?"":t.substr(e,n-e)},_getFieldName:function(t){return this._subByteStr(t,0,29)},_setEnabled:function(t,e){t&&t.set_enabled&&t.set_enabled(e)},set_dataUrl:function(t){this._dataUrl=t},get_dataUrl:function(t){return this._dataUrl?this._dataUrl:t?location.protocol+"//"+location.host+t.get_service().get_path()+"/GetPagerData":null},getMasterSlaveData:function(t,e){for(var i=t.detailFields,r=t.masterFields,n=this.get_grids(),s=n.length,o=this.get_events().getHandler("initDetailData"),a=this.get_events().getHandler("initDetailList"),l=0;l<s;l++){var c=this.getGridByIndex(l);if(c){var d={};d.itemCount=0,d.itemList=[];var h=c.findPager(),p={};p.pagerId=h?h.get_id():0;var u=h?Object.clone(h.get_queryParams()):[];u||(u={}),p.queryParams=u,p.orders=null,p.filter=null,p.first=0,p.count=h?h.get_itemCount():0,0==l?($export.initDetailFields(n[l],i,!0,r,this),$export.initColumnExpands(n[l],t),t.detailDataUrl=h?this.get_dataUrl(h):"",t.detailData=$export.getGridsData([c],o,a,this,i),t.detailParams=p):($export.initDetailFields(n[l],e,!0,r,this),$export.initColumnExpands(n[l],t),t.detailDataUrl1=h?location.protocol+"//"+location.host+h.get_service().get_path()+"/GetPagerData":"",t.detailData1=$export.getGridsData([c],o,a,this,e),t.detailParams1=p);var _=this.get_reportMode();t.fullDataMode=_==Sys.UI.Actions.ReportMode.fullData,t.fullDataMode&&(p.count=-1)}}return this._doGetDetailData(t)?(t.rowNoExpr=this.get_rowNoExpr()||"",$debug.log(t),t):null},getMasterFields:function(){var t=this.get_grid(),e=this.get_masterFields(),i=e?Object.clone(e):[];if(!this.get_showMasterFields())return i;if($export.initMasterFields(this.get_rootForm(),t,i,this),!e)return i;this._adjustFieldsOrder(i,e);for(var r=0;r<i.length;r++){var n=i[r];if(n.after&&r>0){i[r-1].isFooter&&(n.isFooter=!0)}}return i},getReportData:function(t,e){var i=this.get_grid(),r=this.getMasterFields();if(!this._getMasterData(r))return null;var n={};n.zone=$common.getLocalUtc(),n.reportName=this.get_reportName(!e),n.reportNumber=this.get_reportNumber(),$settings.CPrintDataDirName&&(n.dataDirName=$settings.CPrintDataDirName),n.masterFields=r;var s=this.get_detailFields(),o=s?Object.clone(s):[];n.detailFields=o,i&&i.get_showPrintSummaryText()?n.datailSumTexts=this.get_datailSumTexts(i):n.datailSumTexts=[],this.appendCookie(n);var a=this.get_masterDetailKeyFields();if(null!=a){var l=s?Object.clone(s):[];return n.detailFields1=l,n.masterDetailKeyFields=a,this.getMasterSlaveData(n,l)}return this.buildGridDatas(n,t),s&&this._adjustFieldsOrder(o,s),n.rowNoExpr=this.get_rowNoExpr()||"",this._doGetDetailData(n)?($debug.log(n),n):null},buildGridDatas:function(t,e){var i=t.detailFields,r=t.masterFields,n=this.get_grid();if(!n){if(t.detailDataUrl="",0==i.length){var s={};s.name="行号",s.caption=s.name,s.dataField=s.name,s.hidden=!0,Array.add(i,s)}return t.detailData={itemCount:0,itemList:[]},t}var o=this.get_reportMode(),a=o==Sys.UI.Actions.ReportMode.currentPage,l=o==Sys.UI.Actions.ReportMode.fullData,c=o!=Sys.UI.Actions.ReportMode.fullData,d=n.findPager();t.detailDataUrl=d?this.get_dataUrl(d):"",d&&e&&d.get_showAll()&&c&&(e=!1);var h,p=!1;!d||a?h=!0:l?(h=!1,p=!0):h=d.get_pageCount()<2;var u=this.get_grids(),_=u.length;if(1==_)t.dataGroupField=u[0].get_dataGroupField(),$export.initDetailFields(u[0],i,!0,r,this),$export.initColumnExpands(u[0],t);else{var m=Array.clone(u);if(2==_&&m[1].get_visibleColumnCount()>m[0].get_visibleColumnCount()){var g=m[1];m[1]=m[0],m[0]=g}for(var f=0;f<_;f++)$export.initDetailFields(m[f],i,!1,r,this)}if(n.get_maxHeaderLevel()>=2){var y=this.get_events().getHandler("interceptorBeforePrint");if(y){var v=new _Z_190(this,n,t.masterFields,t.detailFields);y(this,v),this._expandItem=v.get_expandItem()}var S=t._detailHeaders={};this._initDetailHeader(n,S)}else this._expandItem=null;if(h){var P=this.get_events().getHandler("initDetailData"),C=this.get_events().getHandler("initDetailList");t.detailData=$export.getGridsData(u,P,C,this,i),t.detailDataUrl=""}if(d&&!h){var D={};e?(t.detailPagerId=n.get_pagerClientId(),o==Sys.UI.Actions.ReportMode.fullData&&(t.fullDataMode=!0)):(t.detailParams=this._buildDetailParams(D,d,p,h,t),D=t.detailParams),t.fullDataMode&&(D.count=-1)}return t},getReportFields:function(){return this.getReportData()},_buildDetailParams:function(t,e,i,r,n){t.pagerId=e.get_id();var s=null;return i&&((s=Object.clone(e.get_queryParams()))||(s={}),n.fullDataMode=!0),t.queryParams=s,t.orders=null,t.filter=null,t.first=0,t.count=e.get_itemCount(),t},_getMasterData:function(t){var e=this.get_events().getHandler("getMasterData");if(!e)return!0;var i=new _Z_188(t);if(e(this,i),i.get_cancel())return!1;var r=i.get_data();if(!r)return!0;for(var n=0;n<t.length;n++){var s=t[n],o=s.dataField;if(o){var a=r[o];s.hasValue||null==a||(s.value=a)}}return!0},_doGetDetailData:function(t){var e=this.get_events().getHandler("getDetailData");if(!e)return!0;var i=new _Z_189(t);if(e(this,i),i.get_cancel())return!1;if(i._detailFieldsChanged&&(t.detailFields=i.get_detailFields()),i._masterFieldsChanged&&(t.masterFields=i.get_masterFields()),i._detailDataChanged&&(t.detailData=i.get_detailData()),i._detailSumTextsChanged)for(var r=t.datailSumTexts,n=t.detailFields,s=0;s<r.length;s++){var o=r[s];o.sumText=o.sumText.toString();for(var a=0;a<n.length;a++){var l=n[a];if(l.name==o.name){l.footer=o.sumText;break}}}return!0},_checkGroupWidth:function(t,e,i,r,n){if(null==t.qtyExpandName){t.widthSum=0,t.groupWidthSum=0,t.groupSum=0;var s=this.get_grid();t.qtyExpandName=s&&s._qtyExpandName?s._qtyExpandName:""}var o=0;if(n==i-1)o=this.get_pageWidth()-t.widthSum;else if(o=Math.round(e.columnWidth*r),e.dataField&&e.dataField.startsWith(t.qtyExpandName)||e.groupName&&this._expandItem&&e.groupName==this._expandItem.groupName){if(t.groupSum+=1,this._expandItem&&this._expandItem.expandNameList&&this._expandItem.expandNameList.length==t.groupSum){var a=this.get_expandedHeaderInfo()[this._expandItem.groupCaption];a&&(o=a-t.groupWidthSum)}t.groupWidthSum+=o}return t.widthSum+=o,o},_hasColumnExpand:function(){return this._expandItem&&this._expandItem.groupName&&this._expandItem.expandNameList&&this._expandItem.expandNameList.length>0},get_datailSumTexts:function(t){if(!t||0===t.get_columnCount()||!t.get_showFooter())return[];for(var e=[],i=t.get_columns(),r=0,n=i.length;r<n;r++){var s=i[r],o=s.get_footer(!0);if(""!=o&&s.get_reportVisible()&&s.get_visible()){var a=$export.get_reportField(s),l={dataField:s.get_dataField(),name:a,sumText:o};e.push(l)}}return e},execute:function(t,e){this._beforeExecute(t,e),this._directPrint=0},directPrint:function(){this._beforeExecute(null,Sys.UI.Actions.PrintType.print)},design:function(){this._beforeExecute(null,Sys.UI.Actions.PrintType.design)},preview:function(){this._beforeExecute(null,Sys.UI.Actions.PrintType.preview)},exportData:function(){this._beforeExecute(null,Sys.UI.Actions.PrintType["export"])},pdfPrint:function(){this._beforeExecute(null,Sys.UI.Actions.PrintType.pdf)},styleManage:function(){if(!this.isSupportStyleManage())return Sys.UI.MessageBox.alert(String.format('<div class="StyleCheckContent"><p class="Title">请升级打印客户端版本后才能使用该功能</p><p>当前版本:{0}</p><p>支持该功能的版本为：{1}</p></div>',this.getVersion(),this._styleManageVersion));this._beforeExecute(null,Sys.UI.Actions.PrintType.style)},_isInstalledOk:function(t){$print.version=null;var e=this.getVersion();return $print._compareVersion(e,this.get_requiredVersion())>=0},checkInstall:function(t){return!!this._isInstalledOk(t)||(!1!==t&&$print._showPrintError("检查是否安装打印管理器","checkInstall",null,!0),!1)},getPrintType:function(){return this._saveAction},_beforeExecute:function(t,e){(e==Sys.UI.Actions.PrintType["export"]||this.checkInstall())&&(this._saveAction=e,Object.isUndefinedOrNull(e)||!this.doBeforeExecute(e)?this.doReport(t,1==this._directPrint?1:e):delete $print.__hideType)},doReport:function(t,e){var i=new Sys.EventArgs;if(i.executeAction=e,"execute"!=this._event)try{this.doExecute(i)}catch(r){if(r.isAbort)return;throw r}this._execute(t,e)},showPrintMenu:function(){var t=$print._getPrintPopupMenu(this);$print.LastPrint._createStylePopupMenu($common.getMainForm().__changeStyleBtn),t.popupAt(document.body,!0,!1)},__doPrint:function(t){this.doBeforeExecute(Sys.UI.Actions.PrintType.print)||this._command("method=PrintWithoutDialog")},__doPreview:function(t){this.doBeforeExecute(Sys.UI.Actions.PrintType.preview)||this._command("method=Preview")},__doDesign:function(t){this.doBeforeExecute(Sys.UI.Actions.PrintType.design)||this._command("method=Design")},__doExport:function(t){this.doBeforeExecute(Sys.UI.Actions.PrintType["export"])||this._command("method=ExportData")},__doStyleManage:function(t){this.doBeforeExecute(Sys.UI.Actions.PrintType.style)||this._command("method=StyleManage")},__doEndPrint:function(t){$cache.set("isPrintMenu",!1);try{$print.LastPrint._service.endPrint(null,!1),$print.LastPrint.doAfterExecute()}catch(e){}finally{$print.LastPrint.doPopupHide()}},_hidePrintPopup:function(t,e){($common.getMainForm().chkPrintStatus.get_checked()||t)&&(e||(e=$print.__hideType||"print"),$print.__hideType=e,$print._printPopupMenu.hide(),delete $print.__hideType)},_throwReportError:function(t){var e="不能打印，请检查打印管理器是否正确安装："+(t.message?t.message:t),i=Sys.UI.Actions.Report.isInstanceOfType(this);$app.showError(i?Sys.ErrorType.ocxPrint:Sys.ErrorType.servicePrint,e,!0,null,{iconVisible:!1})},_processReportColumnExpand:function(t){this._hasColumnExpand()&&this._expandPageRow(t)},_mergeCellDetail:function(t,e,i){if(this._expandItem&&this._expandItem.expandNameList){var r=this._expandItem.expandNameList.length;if(!(r<=1)){var n=t,s=e,o=t,a=e+r-1;i?i.MergeCell(n,s,o,a):this._command("method=MergeCell:"+n+","+s+","+o+","+a)}}},_expandPageRow:function(t){if(this._expandItem){for(var e="",i=this._expandItem.expandNameList,r=0,n=i.length;r<n;r++)e.length>0?e+=","+i[r]:e=i[r];t?t.ExpandPageRow(this._expandItem.groupCaption,e,!0,!0,!0):this._command("method=ExpandPageRow:"+this._expandItem.groupCaption+","+e+",true,true,true")}},_getMultiDetailHeaderRowStartIndex:function(t,e){var i=e._header;if(!i)return 0;var r=$common.getTableBody(i).childNodes;if(r.length<=t)throw Error.abort("准备打印获取多表头开始索引时出错");var n=r[t].childNodes;return 0==n.length?0:this._getHeaderCellIndex(n[0],e)},_getHeaderCellIndex:function(t,e){for(var i=e.get_columns(),r=0,n=i.length;r<n;r++){var s=i[r];if(s.expanded&&0!=s.expanded.length&&s.expanded[0]._elements&&s.expanded[0]._elements.header==t)return r}return 0},get_pageWidth:function(){return this._pageWidth},set_pageWidth:function(t){this._pageWidth=t},get_expandedHeaderInfo:function(){return this._expandedHeaderInfo},set_expandedHeaderInfo:function(t){this._expandedHeaderInfo=t},_doCreateReport:function(t){var e=this.get_masterDetailKeyFields(),i=t.detailFields;null!=e&&(i=t.detailFields1);var r=i.length,n=0,s=0;if(r>0)for(D=0;D<r;D++){A=i[D];this._skipExtensionGroup(A)||(s++,A.columnWidth||(A.columnWidth=A.size?12*(A.size+1):60),n+=A.columnWidth)}var o=Math.round(96/25.4*190),a=Math.round(96/25.4*277),l=n<2*o;this._command("method=CreateReport:"+escape(t.reportName)+","+(l?0:1)),this._command("method=SetReportMargin:10,10,10,10");var c=l?o:a;this.set_pageWidth(c);var d=0;this._command("method=AddLine:2");var h=Math.round(c/2);this._command("method=AddCell:"+escape("`日期")+","+h+",9,0,1,0,1,0,1,0,1,1,-1,0,1"),this._command("method=AddCell:"+escape("`总页码")+","+h+",9,0,1,0,1,0,1,0,1,1,-1,2,1"),this._command("method=EndLine"),d++;var p=this.get_reportName();this._command("method=AddLine:1"),this._command("method=AddCell:"+escape(p)+","+c+", 20, 0, 1, 0, 1, 0, 1, 0, 1, 1, -1, 1, 1"),this._command("method=SetCellFont:宋体, 20, 1, 0, 0, 0"),this._command("method=EndLine"),d++,this._addEmptyLine(c),d++;var u=t.masterFields;null!=e&&(u=t.detailFields);var _=[],m=[],g=u.length,f=null;if(g>0){f=new Array(g);for(D=0;D<g;D++){(A=u[D]).hidden?Array.add(f,A.name):A.isFooter?Array.add(m,A):Array.add(_,A)}}if(_.length>0){d+=this._addHeaderFooter(c,_,f),this._addEmptyLine(c,18),d++}if(s>0){var y=c/(n>0?n:1);if(this.get_showDetailHeader()){var v=t._detailHeaders;v?(this._addMultiDetailHeader(y,d,v),delete t._detailHeaders):this._addSingleDetailHeader(y,r,s,i,u)}this._command("method=AddLine:"+s),d+=2;var S=new Array;S.length=r;for(var P=-1,C=new Object,D=0;D<r;D++){if(!(A=i[D]).hidden){w=-1;"Number"==A.columnType&&A.decimalDigits>0&&(w=A.decimalDigits);var I=this._getFieldName(A.name);S[D]=I;for(var x=0,b=0;b<D;b++)S[b]==I&&x++;if(x>=99)throw Error.create("截短后明细重名字段“"+I+"”不能超过99个");x>0&&(I+=x+1),A.newName=I,A.groupName&&this._expandItem&&A.groupName==this._expandItem.groupName&&-1==P&&(P=D,I=this._expandItem.groupCaption,A.columnWidth=A.columnWidth,D++);N=this._checkGroupWidth(C,A,r,y,D);this._command("method=AddCell:"+escape("#"+I)+","+N+", 9, 1, 1, 1, 1, 1, 1, 1, 1, 1, "+w+", "+this._toReportHAlign(A.textAlign)+", 1")}}this._command("method=EndLine"),this._mergeCellDetail(d,P),this._processReportColumnExpand();for(var U=!1,D=0;D<r;D++){if(!(A=i[D]).hidden&&A.footer){U=!0;break}}if(U){this._command("method=AddLine:"+s),d+=1,C.widthSum=0,C.groupWidthSum=0,C.groupSum=0;for(D=0;D<r;D++){var A=i[D];if(!this._skipExtensionGroup(A)){var w=-1,$=A.footer||"";if($&&A.name){var T=!isNaN(parseFloat($));"Number"==A.columnType||"Percent"==A.columnType?T?($="@"+(A.newName?A.newName:A.name),A.decimalDigits>0&&(w=A.decimalDigits)):$="":T&&($="")}var N=this._checkGroupWidth(C,A,r,y,D);this._command("method=AddCell:"+escape($)+","+N+", 9, 1, 1, 1, 1, 1, 1, 1, 1, 1, "+w+", "+this._toReportHAlign(A.textAlign)+", 1")}}this._command("method=EndLine"),this._mergeCellDetail(d,P)}}m.length>0&&(this._addEmptyLine(c,18),this._addHeaderFooter(c,m,f)),this._endReport()},_endReport:function(){this._command("method=EndReport")},_command:function(t,e,i){if(!this._startMerge)return this._service.invokeCommand(t,e,i);var r=t.split(":"),n={method:r[0].split("=")[1],data:unescape(r[1])};this._methods.push(n)},_addEmptyLine:function(t,e){this._command("method=AddLine:1"),e||(e=15),this._command("method=AddCell:,"+t+","+(e-7)+", 0, 1, 0, 1, 0, 1, 0, 1, 1, -1, 1, 1"),this._command("method=EndLine")},_addMultiDetailHeader:function(t,e,i){for(var r=i.rowCount,n=i.colCount,s=i.rowColCount,o=i.rowsCells,a=0;a<r;a++){p=o[a];this._command("method=AddLine:"+n);for(var l=0,c=0;c<n;c++){if(_=p[c]){var d=0;if(d=c==n-1?this.get_pageWidth()-l:Math.round(_.width*t),l+=d,this._expandItem&&a>0&&_.text==this._expandItem.groupCaption){this.get_expandedHeaderInfo()[_.text]=d,_.text="@"+_.text}this._command("method=AddCell:"+escape(_.text)+","+d+",9, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, "+this._toReportHAlign(_.align)+", 1"),this._command("method=SetCellFont:宋体, 9, 1,0, 0, 0")}}this._command("method=EndLine")}for(var h=this.get_grid(),a=0;a<r;a++){var p=o[a],u=s[a],c=0;for(this._hasColumnExpand()&&(u+=c=this._getMultiDetailHeaderRowStartIndex(a,h));c<u;c++){var _=p[c];if(_){var m=_.rowIndex,g=_.colIndex,f=_.rowSpan,y=_.colSpan;if(f>1||y>1){var v=e+m,S=g,P=e+m+f-1,C=g+y-1;this._command("method=MergeCell:"+v+","+S+","+P+","+C)}}}}},_addHeaderFooter:function(t,e,i){var r=0,n=!0,s=Math.round(t/4),o=e.length;if(1==o)return this._command("method=AddLine:2"),this._addHeaderFooterField(e[0].name,e[0].name,2*s),this._command("method=EndLine"),1;for(var a=0;a<o;a++){var l=e[a];if(!(this._expandItem&&this._expandItem.expandNameList&&(Array.indexOf(this._expandItem.expandNameList,l.name)>=0||this._expandItem.groupCaption==l.name))){a%2==0&&(r++,this._command("method=AddLine:4"),n=!1);for(var c=this._getFieldName(l.name),d=0,h=0,p=i.length;h<p;h++)i[h]==c&&d++;if(Array.add(i,c),d>=99)throw Error.create("截短后主表重名字段“"+c+"”不能超过99个");d>0&&(c+=d+1),this._addHeaderFooterField(l.name,c,s),a%2==1&&(this._command("method=EndLine"),n=!0)}}return n||(this._command("method=AddCell:,"+s+",9, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, 0, 1"),this._command("method=AddCell:,"+s+",9, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, 0, 1"),this._command("method=EndLine")),r},_addHeaderFooterField:function(t,e,i){this._command("method=AddCell:"+escape(t)+","+i+",9, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, 0, 1"),this._command("method=SetCellFont:宋体, 9, 1,0, 0, 0"),this._command("method=AddCell:"+escape("@"+e)+","+i+",9, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, 0, 1")},_addSingleDetailHeader:function(t,e,i,r,n){this._command("method=AddLine:"+i);for(var s=0,o=0;o<e;o++){var a=r[o];if(!a.hidden){var l=a.caption;l||(l=a.name);var c=$export.findMasterField(n,"_"+a.name);c&&c.value&&(l="@_"+a.name);var d=0;s+=d=o==e-1?this.get_pageWidth()-s:Math.round(a.columnWidth*t);this._command("method=AddCell:"+escape(l)+","+d+",9, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, "+this._toReportHAlign(a.headerAlign)+", 1"),this._command("method=SetCellFont:宋体, 9, 1,0, 0, 0")}}this._command("method=EndLine")}},_Z_104.registerClass("_Z_104",_Z_103),Sys.UI.Actions.ReportPrintService=function(){Sys.UI.Actions.ReportPrintService.initializeBase(this),this._servicePrint=!0,this._service=Craba.Web.Script.PrintDataService.create(this),this._showExport=$settings.CrabaServer&&$settings.ShowExportButton},Sys.UI.Actions.ReportPrintService.prototype={get_port:function(){return this._service.get_port()},set_port:function(t){this._service.set_port(t)},_createStylePopupMenu:function(t,e){this.get_form();var i=[],r=this.getStyleNames();if(r&&0!=r.split(",").length&&!r.startsWith("<HTML")){var n=this._styleIndex=this.get_styleIndex(),s=-1===r.indexOf(":");-1==n&&(n=this._styleIndex=0),r=r.split(",");for(var o=0;o<r.length;o++){var a=r[o].split(":"),l="",c=0;1===a.length?(l=a[0],s&&(c=o)):(c=a[0],l=a[1]);var d={text:l,param:c};c==n&&(d.icon="aicon-check");var h={properties:d,events:{click:$createDelegate(this,this._clickStyle)}};i.push(h)}this._makeStyleMenu(i,e)}else this._makeStyleMenu(i,e)},_makeStyleMenu:function(t,e){var i=this.get_form();this._clearStyleMenu(),0==t.length&&(t=[{properties:{text:"(无)",param:-1},events:{click:$createDelegate(this,this._clickStyle)}}]);(this._styleMenu=Sys.UI.Controls.Menu.create(i,{id:this._styleMenuId,items:t})).itemCount=t.length},_clickStyle:function(t,e){var i=t.get_param();-1!=i&&this._styleIndex!=i&&(this._checkStyleItemEnabled(t),this._styleIndex=i,this.set_styleIndex(i),this._popupMenuID&&e.cancel())},_setTemplateCommand:function(){this._command("set=TemplateName:"+escape(this.get_reportName()),null)},_startMergeMethods:function(){this.isSupportMergePrint()&&(this._methods=[],this._startMerge=!0)},_postMergeMethods:function(){this._startMerge&&(this._startMerge=!1,this._command("method=CreateStyle",this._methods),this._methods=null)},get_service:function(){return this._service},getVersion:function(){if($print.version)return $print.version;var t=this._service.invokeCommand("get=Version");return/\d+\.\d+\.\d+\.\d+/.test(t)&&($print.version=t),$print.version},getClientInfo:function(t){return this._command("method=GetClientInfo",t)},getStyleNames:function(){return this._setTemplateCommand(),this._command("get=StyleNames")},get_styleIndex:function(){return this._setTemplateCommand(),this._command("get=StyleIndex")},set_styleIndex:function(t){return this._setTemplateCommand(),this._command("set=StyleIndex:"+t)},get_printTimes:function(){return this._command("get=PrintTimes")},get_exportTimes:function(){return this._command("get=ExportTimes")},_execute:function(t,e){var i=!1;t&&t.get_enabled&&(i=t.get_enabled()),i&&this._setEnabled(t,!1);var r=null;try{if(!1===this._executeReport(t,e))return}catch(n){r=!0,n.message?$common.alert(n.message):"string"==typeof n&&$common.alert(n)}finally{!this.get_ajaxMode()&&i&&this._setEnabled(t,!0)}if(r)throw Error.abort();Object.isUndefinedOrNull(e)||this.doAfterExecute()},_executeReport:function(t,e){if(this._service.isPrinting(null,!0))return!1;try{this._service.beginPrint();var i=this.getReportData();if(!i)return!1;if(this.get_ajaxMode()){var r=this.get_grid();r.findPager()&&this._ajaxShowReport(t,r,i)}else this._showReport(i,e)}catch(n){throw n}finally{this._service.endPrint()}return!0},_ajaxShowReport:function(t,e,i){$common.showLoading(e.get_element());var r=e.get_pager();r.get_service().GetPagerData(r.get_id(),null,null,null,0,r.get_itemCount(),$createDelegate(this,function(e){i.detailData=e,$common.hideLoading(),this._showReport(i),this._setEnabled(t,!0),this._command("method=EndPrint")}),$createDelegate(this,function(e){$common.hideLoading(),$common.alert(Sys.Net.WebServiceProxy.formatWebServiceFailedServerError(e.get_message())),this._setEnabled(t,!0),this._command("method=EndPrint")}))},_showReport:function(t,e){this._command("set=DefaultUseNewDesignForm:"+this._defaultUseNewDesignForm),this._allowPrint?this._command("set=AllowPrint:"+!0):"undefined"!=typeof $settings.reportPrintButtonVisible&&this._command("set=AllowPrint:"+$settings.reportPrintButtonVisible),this._allowExport&&this._command("set=AllowExport:"+!0);var i=0==this._command("method=LoadDataFromCarpa3",t);if(i&&this.get_createReport())try{this._startMergeMethods(),this._doCreateReport(t)}catch(r){throw r}finally{this._postMergeMethods(),this.get_printTimesLimit()>-1&&(this._command("set=PrintTimesLimit:"+this.get_printTimesLimit()),this._printTimesLimit=-1)}i&&($settings.CPrintExecuteDirectPreview||e==Sys.UI.Actions.PrintType.design?this._command("method=Design"):e==Sys.UI.Actions.PrintType.print||this.get_directPrint()?this._command("method=PrintWithoutDialog"):e==Sys.UI.Actions.PrintType.preview?this._command("method=Preview"):e==Sys.UI.Actions.PrintType["export"]?this._command("method=ExportData"):e==Sys.UI.Actions.PrintType.style?this._command("method=StyleManage"):!e&&this.get_usePrintPopup()?(this.showPrintMenu(),$cache.set("isPrintMenu",!0)):this._command("method=Execute"))},beginBatchPrint:function(){if(this._service.isPrinting())throw Error.abort("批量打印已启动，禁止连续操作");try{this._service.beginPrint();var t=!0;try{t=0==this._command("method=BeginBatchPrint")}catch(e){this._throwReportError(e)}if(!t)throw Error.abort();this._batchPrint=!0,this._lastDataObj=null}finally{this._service.endPrint()}},batchPrint:function(){if(!this._batchPrint)throw Error.abort("还没有调用 beginBatchPrint()");var t=this.getReportData(),e=!0;try{e=0==this._command("method=LoadDataFromCarpa3",t)}catch(i){this._throwReportError(i)}if(!e)throw Error.abort();this._lastDataObj=t},endBatchPrint:function(){if(!this._batchPrint)throw Error.abort("还没有调用 beginBatchPrint()");var t=this._lastDataObj;this._batchPrint=!1,this._lastDataObj=null;try{t&&(this._doCreateReport(t),this._command("set=TemplateName:"+escape(t.reportName)),this._command("method=EndBatchPrint"))}catch(e){this._throwReportError(e)}finally{this._command("method=EndPrint")}},get_isGetAll:function(){return!1}},Sys.UI.Actions.ReportPrintService.registerClass("Sys.UI.Actions.ReportPrintService",_Z_104),Craba.Web.Script.NewPrintService=function(t,e,i,r){Craba.Web.Script.NewPrintService.initializeBase(this),this._request=null,this._target=t,this._isLocalPrint=e,this._deviceType=i,this._queryStr="",this._dataVersion=r,this._exePath="D:\\Grasp\\TeemoClient\\Teemo.Client.exe",this._form=t?t.get_form():null},Craba.Web.Script.NewPrintService.prototype={get_path:function(t){if(!this._isLocalPrint){var e=$print.getServerUrl()+"?method="+t+"&accessToken="+$common.__cloudPrintAccessToken;return this._deviceType&&(e+="&device="+this._deviceType),e}return Craba.Web.Script.NewPrintService.callBaseMethod(this,"get_path")},_createUrl:function(t,e){return this._isLocalPrint?t+e:t},_invokeMethod:function(t,e,i,r){try{return this._invoke(t,e,i,this._reqFailed,!1)}catch(n){$print._showPrintError(n.message,t,e,r,this)}},getVersion:function(t){return this._invokeMethod("GetVersion",{},!1,t)},executePrint:function(t,e){var i=t.params.data,r=i.detailDataUrl,n=i.masterDetialKeyFields?i.masterDetialKeyFields.split(","):[];n.push(i.dataGroupField);var s=this,o=this._target;$print._pullData(r,t,function(){o._doGetPrintData(t)&&s._invokeMethod("ExecutePrint",t,e)},0,n)},getStyleNames:function(t){var e=this._invokeMethod("ExecutePrint",{tokenType:0,printMode:$settings.ReportConfig.PrintMode,params:{printType:"reportv10",templateName:t,appName:$settings.CloudPrintAppName,get:"StyleNames"}},!1),i=[],r=!1;if(e&&e.success&&e.data)for(var n=JSON.parse(e.data),s=0;s<n.params.results.length;s++){var o=n.params.results[s];if("get=StyleNames"==o.cmd){if(!o.result)continue;for(var a=o.result.split(","),l=0;l<a.length;l++)"基本样式"===a[l]&&(r=!0),i.push({styleName:a[l],styleFomatType:_Z_46.printer})}}return r||0!=i.length||i.push({styleName:"(无)",styleFomatType:_Z_46.printer}),i},_reqFailed:function(t,e,i){var r="<p>服务形式打印出错啦，错误详情如下:</p><p>调用接口:<font color=blue>"+i+"</font></p><p>出错信息:<font color=red>"+t+"</font></p><p>如果重复出现类似问题，请您联系我们客服.</p>";$app.showError(Sys.ErrorType.cloudPrint,r,!0,null,{iconVisible:!1})}},Craba.Web.Script.NewPrintService.registerClass("Craba.Web.Script.NewPrintService",Craba.Web.Script.PrintDataService),Craba.Web.Script.NewPrintService.create=function(t,e,i,r){var n=new Craba.Web.Script.NewPrintService(t,e,i,r);return n.set_enableShowWaiting(!1),t||(n._queryStr=""),n},Sys.UI.Actions.ReportPrintClound=function(){Sys.UI.Actions.ReportPrintClound.initializeBase(this),this._cloundService=!0,this._pageSetting=null,this._styleIndex=0,this._styleNames=[],this._printTimes=0,this._exportTimes=0,this._pluginName=""},Sys.UI.Actions.ReportPrintClound.prototype={dispose:function(){Sys.UI.Actions.ReportPrintClound.callBaseMethod(this,"dispose"),this._oldPrinter&&(this._oldPrinter.dispose(),this._oldPrinter=null)},set_styleName:function(t){this._styleName=t,this._styleInfo={},this._isSetStyle=!0},get_port:function(){return this._getLocalService().get_port()},set_port:function(t){this._getLocalService().set_port(t)},setPageSetting:function(t){this._pageSetting=t},__doPrint:function(t){this.execute(t,Sys.UI.Actions.PrintType.print)},__doPreview:function(t){this.execute(t,Sys.UI.Actions.PrintType.preview)},__doDesign:function(t){this.execute(t,Sys.UI.Actions.PrintType.design)},__doExport:function(t){if(this._isOldClient)return this._initOldPrinter(),void this._oldPrinter._export(t);this.execute(t,Sys.UI.Actions.PrintType["export"])},__doStyleManage:function(t){this.execute(t,Sys.UI.Actions.PrintType.style)},__doEndPrint:function(t){$cache.set("isPrintMenu",!1),$print.LastPrint.doPopupHide()},_internalExportXls:function(){this.exportData()},doFormInit:function(){Sys.UI.Actions.ReportPrintClound.callBaseMethod(this,"doFormInit"),$common.__cloudPrintServiceUrl||Craba.Web.Script.DataServiceBase.initCloudInfo(this.get_form());var t=this.get_id();this._enabledPDF=$cache.get("enabledPdfCache"+t,{defaultValue:this._enabledPDF}),this._styleName=$cache.get("styleNameCache"+t,{defaultValue:"基本样式"})},_doGetPrintData:function(t){var e=this.get_events().getHandler("getPrintData");if(!e)return!0;var i=new Sys.UI.Actions.GetPrintDataEventArgs(t);return e(this,i),!i.get_cancel()&&(i._detailFieldsChanged&&(t.params.data.detailFields=i.get_detailFields()),i._masterFieldsChanged&&(t.params.data.masterFields=i.get_masterFields()),i._detailDataChanged&&(t.params.data.detailData=i.get_detailData()),!0)},get_printTimes:function(){return this._printTimes},get_exportTimes:function(){return this._exportTimes},isSupportPrintTimes:function(){return!0},_execute:function(t,e){if(this._printTimes=0,this._exportTimes=0,this._saveAction=e,e!=Sys.UI.Actions.PrintType["export"]){this.get_printOutDevice();var i=this.get_printMode();i!==_Z_29.local||this._enabledPDF?$common.__cloudPrintServiceUrl&&$common.__cloudPrintAccessToken?this._enabledPDF?this._doPrint(!1,null,"pdf"):i!==_Z_29.remote||e!==Sys.UI.Actions.PrintType.print?this._doLocalPrint(t,e):this._doRemotePrint(t):$app.showError(Sys.ErrorType.cloudPrint,Sys.Res.printTips.noService,!0,null,{iconVisible:!1}):this._doLocalPrint(t,e)}else this._doPrint(!1,null,"excel")},_doRemotePrint:function(t){this._directPrint=0;var e=new Sys.UI.Form(t);e.PanelContainer=this,e.add_ok($createDelegate(this,this._executeReport)),e.add_close($createDelegate(this,this._clientClose)),e.showModal($common.getSysUIBaseURI(this.get_form())+"Print/ClientSelector.gspx")},_doLocalPrint:function(t,e){var i=!1,r=this.get_printMode()==_Z_29.remote||this.get_printMode()==_Z_29.remoteAndManageStyle,n=!(this._isNormalButton&&Object.isUndefinedOrNull(e));try{i=this.isNewClient(n)}catch(s){return void(n||this.showPrintMenu())}if(n||!this._isOldClient){if(i)return e?(this._printTimes=1,void this._doPrint(!0)):void this.showPrintMenu();if(r||$settings.ReportConfig.MustNewClient&&this._isOldClient)return this.doAfterExecute(),void $common.alert(String.format(Sys.Res.printTips.old,$print._getDownloadUrl()));console.log("老客户端打印"),this._initOldPrinter();this._oldPrinter._execute(t,e)}else this.showPrintMenu()},_initOldPrinter:function(){var t=["gridId","reportName","tab","dataUrl","reportMode","masterFields","masterDetailKeyFields","showMasterFields","detailFields","createReport","allowPrint","allowExport","defaultUseNewDesignForm","useService","cookie"],e=this._oldPrinter;this._oldPrinter||((e=this._oldPrinter=new Sys.UI.Actions.ReportPrintService).set_idPart(this.get_idPart()),e.set_form(this.get_form()),e._events=this._events,e.initialize());for(var i=0,r=t.length;i<r;i++){var n=t[i],s=e["set_"+n],o=this["get_"+n].apply(this);s.apply(e,[o])}},_doPrint:function(t,e,i){var r=this._getCloudData(e,t,i);if(!r)return this.doAfterExecute();this._getPrintService(t,i).executePrint(r,$createDelegate(this,this._doPrintCompleted))},_clientClose:function(t,e){this.doAfterExecute()},_doPrintCompleted:function(t){return t?t.success?("pdf"===t.type?(this._printTimes=1,$common.openwin(t.base+"/render?key="+t.key)):"excel"===t.type&&(this._downloadExcel(t),this._exportTimes=1),void this.doAfterExecute()):(this.doAfterExecute(),void $common.alert(t.msg||t.Message||Sys.Res.printTips.apiError)):(this.doAfterExecute(),void $common.alert(Sys.Res.printTips.apiError))},_downloadExcel:function(t){var e=this,i=t.base+"/state?key="+t.key+"&t="+(new Date).getTime(),r=$common.showProgress({className:"ValueFloat",opacity:50});r.set_value(Math.min(r.get_value()+10,95)),r.set_text("导出进度"),$common.ajax({url:i,type:"GET",error:function(){$common.hideProgress(),$common.showError("导出失败")},success:function(i,n){if(!i.success)return $common.hideProgress(),void $common.alert(i.msg);if(202!==i.status){var s=Math.floor(11*Math.random())+5;return r.set_value(Math.min(r.get_value()+s,95)),void setTimeout(function(){e._downloadExcel(t)},500)}r.set_value(98),r.set_text("下载进度..");var o=(new Date)._format("yyyyMMddHHmmss"),a=e.get_reportName(!1)+"_"+o+".xlsx",l=t.base+"/file?key="+t.key;$common.ajax({type:"get",complete:function(){$common.hideProgress()},responseType:"blob",fileName:a,url:l})}})},_isInstalledOk:function(t){return!(!this._enabledPDF&&this.get_printMode()!=_Z_29.remote&&this.get_printMode()!=_Z_29.remoteAndManageStyle)||(this.isNewClient(t),!0)},isVersion37:function(){var t=this.getVersion(!0);return $print._compareVersion(t,"1.1.0.37")>=0},getVersion:function(t){return t&&this._version?this._version:this._version=this._getLocalService().getVersion().data},getVersionResult:function(t){return this._getLocalService().getVersion(t)},isNewClient:function(t){var e=this.getVersionResult(t);if(!e||"object"!=typeof e)return this._isOldClient=!0,!1;this._isOldClient=!1;var i=this._version=e.data;return $print._compareVersion(i,"1.1.0.8")>=0},_getPrintService:function(t,e){var i=1;return"excel"!=e&&"pdf"!=e&&(i=this.isVersion37()?1:0),Craba.Web.Script.NewPrintService.create(this,t,e,i)},_getLocalService:function(){return this._localService?this._localService:this._localService=Craba.Web.Script.NewPrintService.create(this,!0)},_executeReport:function(t){this._doPrint(!1,t.result)},get_reportName:function(){return this._reportName},get_isGetAll:function(){return this._saveAction!==Sys.UI.Actions.PrintType["export"]&&$settings.PrintAllFields},_getCloudData:function(t,e,i){var r=this.getReportData();return r?(this._pageSetting&&(r.pageSetting=this._pageSetting),this._cloudRequestData(r,t)):null},_makeStyle:function(t){if(this._isSetStyle)delete this._isSetStyle;else if(!this._bizStyleId){t||this._saveAction===Sys.UI.Actions.PrintType.style||(this._styleNames=this.getStyleNames());var e=this._isExistStyleName(this._styleName);!e&&t&&this._saveAction!==Sys.UI.Actions.PrintType.style&&(this._styleNames=this.getStyleNames(),e=this._isExistStyleName(this._styleName)),e?this._styleInfo=e:(this._styleName="基本样式",this._styleInfo={})}},_cloudRequestData:function(t,e){var i=this.get_printMode()==_Z_29.localAndManageStyle,r=!this._enabledPDF&&(this.get_printMode()==_Z_29.local||i),n=this._saveAction==Sys.UI.Actions.PrintType["export"];n||this._makeStyle(r);var s=$common.__cloudPrintAccessToken;!r||i||n||(s="");var o={};this.doGetReportName(o,!0);var a=[];n||(a=this._createStyleMethods(t));var l={resultMode:1,tokenType:0,accessToken:s,clientTokenList:e||[],printMode:$settings.ReportConfig.PrintMode,serverUrl:$print.getServerUrl(),pluginName:this._pluginName,params:{printType:"reportv10",printerName:e?"":this._printerName,appName:$settings.CloudPrintAppName,templateName:this._customStyle?this._styleInfo.templateName:t?t.reportName:this.get_reportName(),styleName:this._customStyle?this._styleInfo.styleName:this._styleName,bizStyleId:this._customStyle?this._styleInfo.styleId:this._bizStyleId||"",defaultUseNewDesignForm:this.get_defaultUseNewDesignForm(),printTimesLimt:this.get_printTimesLimit(),allowExport:this.get_allowExport(),allowPrint:this.get_allowPrint(),method:this._getMethodName(this._saveAction),methodParams:"",createStyleAction:a,data:t,styleInfo:r?{}:this._styleInfo,callBack:o,copies:this._copies}};return $debug.log(l),l},_createStyleMethods:function(t){try{this._methods=[],this._startMerge=!0,this._doCreateReport(t)}catch(e){throw e}finally{this._startMerge=!1}return this._methods},_endReport:function(){this._command("method=SetReplace:"+(this._createStyle?1:0)),this._command("method=EndReport")},_isExistStyleName:function(t){if(!this._styleNames||0===this._styleNames.length)return!1;for(var e=0;e<this._styleNames.length;e++){var i=this._styleNames[e];if(i.styleName===t)return i}return!1},_getMethodName:function(t){switch(t){case Sys.UI.Actions.PrintType.print:return"PrintWithoutDialog";case Sys.UI.Actions.PrintType.design:return"Design";case Sys.UI.Actions.PrintType.preview:return"Preview";case Sys.UI.Actions.PrintType["export"]:return"ExportData";case Sys.UI.Actions.PrintType.style:return"StyleManage";default:return"Execute"}},getStyleNames:function(){var t=this.get_events().getHandler("getStyleNames");if(t){this._customStyle=!0;var e=new _Z_285(this);return t(this,e),e.get_styleNames()}var i=this.get_printMode();if(!this._enabledPDF&&i!=_Z_29.localAndCloudStyle&&i!=_Z_29.remoteAndManageStyle&&i!=_Z_29.remote&&this.isNewClient()){return this._getLocalService().getStyleNames(this._reportName)}if(this._isOldClient)return null;var r=this.get_printOutDevice()===_Z_30.pdf||this._enabledPDF?_Z_46.pdf:_Z_46.printer,n=$print.getPrintStyles(this._reportName,r,_Z_45.report),s=!1;if(n instanceof Array)for(var o=0;o<n.length;o++)"基本样式"===n[o].styleName&&(s=!0);else n=[];return s||0!=n.length||Array.insert(n,0,{templateName:"",styleName:"(无)",styleFomatType:r}),n},_export:function(t,e){if(this._menu.hide(),this._saveAction=Sys.UI.Actions.PrintType["export"],!this.doBeforeExecute(Sys.UI.Actions.PrintType["export"])){if(this._isInstalledOk(!0),this._isOldClient)return this._initOldPrinter(),void this._oldPrinter._export(t);this._doPrint(!1,null,"excel")}},_styleManage:function(t,e){this._menu.hide(),this._beforeExecute(null,Sys.UI.Actions.PrintType.style)},_makePrintItems:function(t){var t=!this._enabledPDF,e=Sys.UI.Actions.ReportPrintClound.callBaseMethod(this,"_makePrintItems",[t]);return e.push({id:"qypdf",properties:{visible:!this._disabledPDF,text:Sys.Res.printTips.pdf},events:{click:$createDelegate(this,this._clickEnabledPDF)}}),this._enabledPDF&&(e[e.length-1].properties.icon="aicon-check"),e},_clickEnabledPDF:function(t,e){this._enabledPDF=!this._enabledPDF;var i=null,r=this._popupMenuID,n=r+"_dyyl",s=r+"_dysj",o=r+"_ysgl",a=this.get_form();a[n].set_visible(!this._enabledPDF),a[s].set_visible(!this._enabledPDF),a[o].set_visible(!this._enabledPDF),this._enabledPDF&&(i="aicon-check"),t.setIcon(i),$cache.set("enabledPdfCache"+this.get_id(),this._enabledPDF),this._createStyleMenu(),e.cancel();var l=this._menu,c=l.btn._rightBtn,d=$Dom.getBounds(c);l.popupAt(d.x,d.y+d.height,d.width,d.height)},_createStylePopupMenu:function(t){var e=this._styleNames=this.getStyleNames(),i=this.get_printMode(),r=!this._enabledPDF&&i!=_Z_29.remoteAndManageStyle&&i!=_Z_29.remote;if(this._isOldClient&&r)return this._clearStyleMenu(),this._initOldPrinter(),void this._oldPrinter._createStylePopupMenu(t);this._oldPrinter&&this._oldPrinter._clearStyleMenu(),this._styleIndex=0,this._clearStyleMenu();for(var n=null,s=[],o=0;o<e.length;o++){var a=e[o],l=this._customStyle?a.templateName:a.styleName,c={properties:{text:l,param:{index:o,info:a}},events:{click:$createDelegate(this,this._clickStyle)}};l===this._styleName&&(this._styleIndex=o,this._styleInfo=a,n=c),s.push(c)}if(!n){if(0==e.length){c={properties:{text:"(无)"}};this._styleName="(无)",this._styleInfo={},s.push(c),n=s[0]}else{n=s[0];"(无)"==(a=this._styleInfo=e[0]).styleName&&(a.styleName="基本样式"),this._styleName=a.styleName}$cache.set("styleNameCache"+this.get_id(),this._styleName)}n.properties.icon="aicon-check",t.set_visible(!0);var d=this.get_form();(this._styleMenu=Sys.UI.Controls.Menu.create(d,{id:this._styleMenuId,items:s})).itemCount=s.length},_clickStyle:function(t,e){var i=t.get_param().index;-1!=i&&this._styleIndex!=i&&(this._styleName=t.get_text(),$cache.set("styleNameCache"+this.get_id(),this._styleName),this._styleInfo=t.get_param().style,this._checkStyleItemEnabled(t),this._styleIndex=i,e.cancel())}},Sys.UI.Actions.ReportPrintClound.registerClass("Sys.UI.Actions.ReportPrintClound",_Z_104),Sys.UI.Actions.ReportPrintWeb=function(){Sys.UI.Actions.ReportPrintWeb.initializeBase(this),this._printer=new Sys.UI.Controls.WebPrintBase(this),this._printer._printType="reportv10"},Sys.UI.Actions.ReportPrintWeb.prototype={set_useWebTool:function(t){this._useWebTool=t},get_useWebTool:function(t){return this._useWebTool},checkInstall:function(){return!0},print:function(){this.directPrint()},_execute:function(t,e){this._saveAction=e,e==Sys.UI.Actions.PrintType.print?(this._printer._checkPrint(),this._printer.exec("Print")):e==Sys.UI.Actions.PrintType.preview||e==Sys.UI.Actions.PrintType.design?(this._printer._checkPrint(),this._printer.exec("Preview")):e==Sys.UI.Actions.PrintType["export"]&&this._doPrint(!1,null,"excel"),this.doAfterExecute()},get_data:function(){var t=this.getReportData();return this.convertNewData(t),this._styleName=t.reportName,this._templateName=t.reportName,t},convertNewData:function(t){if(t.detailData1)t.masterData=t.detailData,t.detailData=t.detailData1,t.masterFields=t.detailFields,t.detailFields=t.detailFields1,delete t.detailFields1,delete t.detailData1;else{t.masterData={itemCount:1,itemList:[]};var e={};t.masterData.itemList.push(e);var i=[];Array.forEach(t.masterFields,function(t){var r={};r.name=t.name,r.caption=t.name,r.dataField=t.dataField,r.section=t.section,i.push(r),e[t.dataField]=t.value}),t.masterFields=i}}},Sys.UI.Actions.ReportPrintWeb.registerClass("Sys.UI.Actions.ReportPrintWeb",Sys.UI.Actions.ReportPrintClound),Sys.UI.Controls.OtherPrintBase=function(t){Sys.UI.Controls.OtherPrintBase.initializeBase(this,[t]),this._copies=1,this._useWebTool=$settings.AllPrintUseWebTool,this._styleName="",this._templateName=""},Sys.UI.Controls.OtherPrintBase.prototype={initialize:function(){Sys.UI.Controls.OtherPrintBase.callBaseMethod(this,"initialize"),$print._checkLoadTeemoJs(this)},get_templateName:function(){return this._templateName},set_templateName:function(t){this._templateName=t},get_styleName:function(){return this._styleName},set_styleName:function(t){this._styleName=t},set_useWebTool:function(t){this._useWebTool=t},get_useWebTool:function(){return this._useWebTool},set_copies:function(t){this._copies=t},get_copies:function(){return this._copies},set_bizStyleId:function(t){this._bizStyleId=t},get_bizStyleId:function(){return this._bizStyleId},set_masterDetailKeyFields:function(t){this._masterDetailKeyFields=t},get_masterDetailKeyFields:function(){return this._masterDetailKeyFields},setPrinter:function(t){this._printerName=t},set_masterFields:function(t){this._masterFields=t,Array.forEach(t,function(t){t.name||(t.name=t.caption)})},set_masterData:function(t){this._masterData=t},set_detailFields:function(t){this._detailFields=t,Array.forEach(t,function(t){t.name||(t.name=t.caption)})},set_detailData:function(t){this._detailData=t}},Sys.UI.Controls.OtherPrintBase.registerClass("Sys.UI.Controls.OtherPrintBase",Sys.UI.Control),Sys.UI.Controls.WebPrintBase=function(t){this._target=t},Sys.UI.Controls.WebPrintBase.prototype={_checkPrint:function(){$print._checkTeemoJs(),$print._checkToken("Web打印"),this._checkBizStyleId()},_checkBizStyleId:function(){$common.checkError(!this._target._bizStyleId,"调用web设计器前业务必须设置BizStyleId")},_getProp:function(t){return this._target[t]},get_masterDetailData:function(t){var e={itemCount:0,itemList:[]};return t&&(e.itemCount=t.length,e.itemList=t),e},_getPrintData:function(t){var e=this.get_data(),i=this._templateName||this._getProp("_templateName");return{resultMode:1,tokenType:0,clientTokenList:$print._getRemoteClients(),accessToken:$common.__cloudPrintAccessToken,printMode:$settings.ReportConfig.PrintMode,serverUrl:$print.getServerUrl(),pluginName:"tmprint",params:{printType:this._printType,appName:$settings.CloudPrintAppName,printerName:this._getProp("_printerName"),method:t,templateName:this._styleName||this._getProp("_styleName")||i,styleName:i,bizStyleId:this._getProp("_bizStyleId")||"",copies:this._getProp("_copies")||1,styleInfo:{},dataVersion:1,data:e}}},get_data:function(){return this._target.get_data()},_checkRemotePrint:function(t){if("Print"==t&&$print.isRemotePrint()&&!$print._getRemoteClients()){var e=$createDelegate(this,function(t){this.exec("Print")}),i={title:"授权提示",buttons:["立即授权","下次再说"],handler:function(t){1!=t&&$print.showRemoteConfig(e)}};$common.checkError(!0,"第一次远程打印需要先授权打印机哟！",i)}},exec:function(t){this._checkRemotePrint(t);var e=this._getPrintData(t);$debug.testLog(e);var i=e.params.data,r=i.masterDetialKeyFields?i.masterDetialKeyFields.split(","):[];r.push(i.dataGroupField);var n=this;$print._pullData(i.detailDataUrl,e,function(){n._invokeMethod(t,e)},0,r)},_invokeMethod:function(t,e){if("Print"==t)if($print.isRemotePrint())$print._request("ExecutePrint",e);else{var i=$print._localRequest(e,"Web打印");$print._getResult(i)}else $TeemoApp.ShowPage($common.__cloudPrintAccessToken,e,null,null,$print.getServerUrl())}},Sys.UI.Controls.WebPrintBase.registerClass("Sys.UI.Controls.WebPrintBase",Sys.UI.Control),_Z_6=function(t,e){_Z_6.initializeBase(this),this._request=null,this._isLocalPrint=e,this._target=t,this._form=t.get_form(),this._queryStr="",this._exePath="D:\\Grasp\\TeemoClient\\Teemo.Client.exe"},_Z_6.prototype={get_path:function(){return this._isLocalPrint?_Z_6.callBaseMethod(this,"get_path"):$print.getServerUrl()+"?method=ExecutePrint&accessToken="+$common.__cloudPrintAccessToken},_createUrl:function(t,e){return this._isLocalPrint?t+e:t},_invokeMethod:function(t,e,i){try{return this._invoke("ExecutePrint",t,e,this._reqFailed,!1)}catch(r){$print._showPrintError(r.message,"ExecutePrint",t,i,this)}},_reqFailed:function(t,e,i){var r="云打印出错啦，错误详情如下:&nbsp;&nbsp;&nbsp;<br/><br/>调用接口:<font color=blue>"+i+"</font><br/><br/>出错信息:<font color=red>"+t+"</font><br/><br/>如果重复出现类似问题，请您联系我们客服.";$app.showError(Sys.ErrorType.cloudPrint,r,!0,null,{iconVisible:!1})}},_Z_6.registerClass("_Z_6",Craba.Web.Script.PrintDataService),_Z_6.create=function(t,e){var i=new _Z_6(t,e);return i.set_enableShowWaiting(!1),i},_Z_7=function(t,e){this._service=_Z_6.create(t,e),this.version="",this.printType="",this._target=t},_Z_7.prototype={getService:function(){return this._service},_getProp:function(t){return this._target._target[t]},get_port:function(){return this.getService().get_port()},invoke:function(t,e,i){return this.getService()._invokeMethod(t,e,i)},invokeParams:function(t,e,i,r){var n={resultMode:1,tokenType:0,clientTokenList:e||[],bizStyleId:this._getProp("_bizStyleId")||"",printMode:$settings.ReportConfig.PrintMode,clientTagName:e?e.clientTagName:"",accessToken:this.getAccessToken(),serverUrl:$print.getServerUrl(),requestor:"craba",pluginName:this._getProp("_useWebTool")?"tmprint":"",params:t};return this.invoke(n,i,r)},invokeSync:function(t,e,i){var r=this.invokeParams(t,e,!1);if(!r.success)throw Error.abort(r.msg);return $print._getResult(r,i||1)},getVersion:function(t){var e=this.invoke({params:{printType:this.printType,get:"Version"}},!1,t);return this.version=$print._getResult(e),this.setVersion(),this.version},getNewVersion:function(){try{return this.getService()._invoke("GetVersion",{},!1)}catch(t){return 0}},setVersion:function(t){},getAccessToken:function(){return this._printMode===_Z_29.local?"":$common.__cloudPrintAccessToken},getAppName:function(){return $settings.CloudPrintAppName},_getDataService:function(){var t=this._dataService;return t||(t=this._dataService=Craba.Web.Script.DataServiceBase.create(this._target.get_form())),t},_getStyleInfo:function(t,e,i){if(this._getProp("_bizStyleId"))return{};if($settings.ReportConfig.PrintMode==_Z_29.local)return{};var r=_Z_46.printer,n=$print.getPrintStyles(e,r,i),s={};if(n instanceof Array&&n.length>0)for(var o=0,a=n.length;o<a;o++){var l=n[o];if(l.styleName==e){s=l;break}}return s}},_Z_7.registerClass("_Z_7"),_Z_8=function(t,e){this._newClientVersion="1.1.0.8",this.serviceImplement=e,_Z_8.initializeBase(this,[t]),this._target=t,$settings.ReportConfig&&(this._printMode=$settings.ReportConfig.PrintMode),this.printMethod="Print",this.dependPrintService=!0},_Z_8.prototype={_getProp:function(t){return this._target[t]},_checkError:function(){this.checkInstall(!0)||$common.checkError(!0,String.format(Sys.Res.printTips.old,$print._getDownloadUrl()))},isNewClient:function(){if(this._printMode===_Z_29.remote)return!0;var t=this.getLocalService().getNewVersion();if(!t||"object"!=typeof t)return!1;var e=t.data;return $print._compareVersion(e,this._newClientVersion)>=0},checkInstall:function(t){if(this.get_printMode()==_Z_29.remote&&!t)return!0;return!!this.getLocalService().getVersion(t)},isVersion37:function(){var t=this.getLocalService().getNewVersion();return!(!t||"object"!=typeof t)&&$print._compareVersion(t.data,"1.1.0.37")>=0},get_printMode:function(){return this._printMode},get_port:function(){return this.getLocalService().get_port()},set_printMode:function(t){this._printMode=t},getLocalService:function(t){return this._localService||(this._localService=new this.serviceImplement(this,!0,!0,t)),this._localService},getCloudService:function(){if(!this._cloudService){var t=!(this._printMode==_Z_29.remote||this._printMode==_Z_29.remoteAndManageStyle);this._cloudService=new this.serviceImplement(this,t)}return this._cloudService},execute:function(t,e){var i=this.get_printMode(),r=null;if(i===_Z_29.local)return r=this.getLocalService(),void t(r);if($common.__cloudPrintServiceUrl&&$common.__cloudPrintAccessToken){if(i===_Z_29.localAndCloudStyle||i===_Z_29.localAndManageStyle)return r=this.getLocalService(),void t(r);if(this.dependPrintService)return r=this.getLocalService(),void t(r);var n=new Sys.UI.Form(this);n.PanelContainer=this,n.add_ok($createDelegate(this,function(e){r=this.getCloudService(),t(r,e.result)})),e=e||"ClientSelector.gspx",n.showModal($common.getSysUIBaseURI(this.get_form())+"Print/"+e),this.dependPrintService=!0}else $app.showError(Sys.ErrorType.cloudPrint,Sys.Res.printTips.noService,!0,null,{iconVisible:!1})}},_Z_8.registerClass("_Z_8",Sys.UI.Control),Sys.UI.Controls.BarcodePrint=function(t){Sys.UI.Controls.BarcodePrint.initializeBase(this,[t]);var e=null;e=$settings.AllPrintUseService&&!$print.isRemotePrint()?new _Z_11(this):new _Z_10(this),this._printProvider=e},Sys.UI.Controls.BarcodePrint.prototype={initialize:function(){Sys.UI.Controls.BarcodePrint.callBaseMethod(this,"initialize"),this._printProvider.__form=this.__form},preview:function(t,e,i){this.config.apply(this,[t,e,i,!0])},design:function(t,e,i){this.config.apply(this,arguments)},config:function(t,e,i,r){this._styleName=e,this._templateName=i,this._getProvider(!0).config(t,e,i,r)},writeData:function(t,e,i){if(i.length%t.length!=0||t.length!=e.length)throw Error.abort("条码打印数据格式不正确：\n\n1、标题数据源与列宽数据源长度不匹配.\n\n2、条码数据源长度不是标题长度的整数倍");this._getProvider(!0).writeData(t,e,i)},print:function(t,e,i,r){"number"==typeof t&&(e=t,t=null),this._styleName=i,this._templateName=r,this._getProvider(!0).print(t,e||this._copies,i,r)},getNDIV:function(){return this._getProvider().getNDIV()},_getProvider:function(t){if(this._useWebTool&&t)return this._webProvider||(this._webProvider=new Sys.UI.Controls.BarcodePrintWeb(this)),this._webProvider;var e=this._printProvider;return this._printProvider.isNewClient&&!this._printProvider.isNewClient()&&((e=new _Z_11(this)).__form=this.__form),e}},Sys.UI.Controls.BarcodePrint.registerClass("Sys.UI.Controls.BarcodePrint",Sys.UI.Controls.OtherPrintBase),Sys.UI.Controls.BarcodePrintWeb=function(t){Sys.UI.Controls.BarcodePrintWeb.initializeBase(this,[t]),this._printType="barcode"},Sys.UI.Controls.BarcodePrintWeb.prototype={writeData:function(t,e,i){var r=$print.toJsonData("table_m.cds",t,e,i);r.detailFields=r.dataFields,r.detailData=r.dataList,delete r.dataFields,delete r.dataList,delete r.tableName,this._data=r},print:function(t,e,i,r){this._checkPrint(),t&&this.writeData(["条码"],[256],t),this.exec("Print")},config:function(t,e,i,r){this._checkPrint(),t&&this.writeData(["条码"],[256],t),this.exec("Preview")},get_data:function(){if(!this._data){return{reportName:-1,reportNumber:-1,masterDetailKeyFields:this._target._masterDetailKeyFields,masterFields:this._target._masterFields,masterData:this.get_masterDetailData(this._target._masterData),detailFields:this._target._detailFields,detailData:this.get_masterDetailData(this._target._detailData)}}return this._data}},Sys.UI.Controls.BarcodePrintWeb.registerClass("Sys.UI.Controls.BarcodePrintWeb",Sys.UI.Controls.WebPrintBase),_Z_11=function(){_Z_11.initializeBase(this,[this]),this._enableShowWaiting=!1},_Z_11.prototype={getVersion:function(){return $print.barcodeVersion?$print.barcodeVersion:$print.barcodeVersion=this.invokeCommand("type=barcode&method=Version")},config:function(t){try{t&&this._writeData(t),this.beginPrint("barcode");this.invokeCommand("type=barcode&method=BarConfigCds:table_m.cds")}catch(e){throw e}finally{this.endPrint("barcode")}},print:function(t,e){t&&this._writeData(t);try{this.beginPrint("barcode"),this.invokeCommand("type=barcode&method=PrintBarOutEx:"+e)}catch(i){throw i}finally{this.endPrint("barcode")}},_writeData:function(t){this.writeData(["条码"],[256],t)},writeData:function(t,e,i){if(this.isPrinting("barcode",!0))return null;$print._writeServiceData(this,"barcode","table_m.cds",t,e,i,this.getVersion())},getNDIV:function(){return this.invokeCommand("type=barcode&method=getNDIV")}},_Z_11.registerClass("_Z_11",Craba.Web.Script.PrintDataService),_Z_10=function(t){_Z_10.initializeBase(this,[t,_Z_9])},_Z_10.prototype={config:function(t,e,i,r){t&&this.writeData(["条码"],[256],t),this._checkError(),this.getLocalService().design(this.printData,e,i,r)},writeData:function(t,e,i){this.printData=this.getCloudService().getData(t,e,i)},print:function(t,e,i,r){t&&this.writeData(["条码"],[256],t);var n=this.printData;this.get_printMode();this.dependPrintService=!1,this.execute(function(t,s){s?t.print(n,e,i,r,s):(t.getVersion(),t.print(n,e,r,i))})},getNDIV:function(){return this.getLocalService().getNDIV()}},_Z_10.registerClass("_Z_10",_Z_8),_Z_9=function(t,e){_Z_9.initializeBase(this,[t,e]),this.printType="barcode",this.version=$print.barcodeVersion},_Z_9.prototype={setVersion:function(){$print.barcodeVersion=this.version},design:function(t,e,i,r){e=e||"基本样式",i=i||"默认模板";var n=this._getStyleInfo(e,i,_Z_45.barcode),s={printType:this.printType,printerName:this._getProp("_printerName"),appName:this.getAppName(),templateName:i,styleName:e,bizStyleId:this._getProp("_bizStyleId")||"",copies:this._getProp("_copies")||1,method:r?"Preview":"Design",data:t||{},styleInfo:n};this.invokeParams(s,null,function(t){t.success||(console.log(t),$common.alert(t.msg))})},getData:function(t,e,i){return $print.toJsonData("table_m.cds",t,e,i)},print:function(t,e,i,r,n){e=e||1,i=i||"基本样式",r=r||"默认模板";var s=this._getStyleInfo(i,r,_Z_45.barcode),o={printType:this.printType,printerName:this._getProp("_printerName"),appName:this.getAppName(),templateName:r,styleName:i,bizStyleId:this._getProp("_bizStyleId")||"",copies:e,method:"Print",data:t,styleInfo:s};this.invokeParams(o,n,function(t){t.success||(console.log(t),$common.alert(t.msg))})},getNDIV:function(){if($print._compareVersion(this.getVersion(),"1.8.8.1054")<0)return null;var t=this.invoke({params:{printType:"barcode",method:"GetNDIV"}},!1);return $print._getResult(t)}},_Z_9.registerClass("_Z_9",_Z_7),Sys.UI.Controls.PosPrint=function(t){Sys.UI.Controls.PosPrint.initializeBase(this,[t]);var e=null;e=$settings.AllPrintUseService&&!$print.isRemotePrint()?new _Z_12(this):new _Z_14(this),this._printProvider=e,this._title=-1,this._headData=[],this._endData=[],this._colTitles=[],this._colWidths=[],this._rowData=[],this._writeTimes=0},Sys.UI.Controls.PosPrint.prototype={initialize:function(){Sys.UI.Controls.PosPrint.callBaseMethod(this,"initialize"),this._printProvider.__form=this.__form},_getProvider:function(t){if(this._useWebTool&&t)return this._webProvider||(this._webProvider=new Sys.UI.Controls.PosPrintWeb(this)),this._webProvider;var e=this._printProvider;return this._printProvider.isNewClient&&!this._printProvider.isNewClient()&&((e=new _Z_12(this)).__form=this.__form),e},preview:function(t){this.posBillPrint(t,"Preview")},config:function(){this._getProvider().showPosCfg()},print:function(){this.posBillPrint(null,"Print")},posBillPrint:function(t,e,i){this._useWebTool||1!=this._writeTimes||(this._writeTimes++,this._writeData()),this._getProvider(!0).posBillPrint(t,e,i||this._copies)},writeMasterData:function(t,e){this._headData=t,this._endData=e,this._writeData()},writeDetailData:function(t,e,i){if(e.length<1||t.length!=e.length)throw Error.abort("小票打印数据格式不正确：\n\n1、标题数据源与列宽数据源长度不匹配.");this._colTitles=t,this._colWidths=e,this._rowData=i,this._writeData()},_writeData:function(){this._writeTimes++,this._writeTimes<2||(this._writeTimes=0,this._getProvider(!0).writeDetailData(this._colTitles,this._colWidths,this._rowData,this._headData,this._endData))},hideConfigPage:function(t){this._getProvider().hideConfigPage(t)},openCashBox:function(){this._getProvider().openCashBox()},screenOut:function(t,e){this._getProvider().screenOut(t,e)}},Sys.UI.Controls.PosPrint.registerClass("Sys.UI.Controls.PosPrint",Sys.UI.Controls.OtherPrintBase),Sys.UI.Controls.PosPrintWeb=function(t){Sys.UI.Controls.PosPrintWeb.initializeBase(this,[t]),this._printType="billprint"},Sys.UI.Controls.PosPrintWeb.prototype={posBillPrint:function(t,e){this._checkPrint(),t&&(this._templateName=t),this.exec(e)},get_data:function(){if(!this._data){return{reportName:-1,reportNumber:-1,masterDetailKeyFields:this._target._masterDetailKeyFields,masterFields:this._target._masterFields,masterData:this.get_masterDetailData(this._target._masterData),detailFields:this._target._detailFields,detailData:this.get_masterDetailData(this._target._detailData)}}return this._data}},Sys.UI.Controls.PosPrintWeb.registerClass("Sys.UI.Controls.PosPrintWeb",Sys.UI.Controls.WebPrintBase),_Z_12=function(){_Z_12.initializeBase(this,[this]),this._enableShowWaiting=!1},_Z_12.prototype={getVersion:function(){return $print.posVersion?$print.posVersion:$print.posVersion=this.invokeCommand("type=billprint&method=Version")},showPosCfg:function(){this.hideConfigPage(1);try{this.beginPrint("billprint"),this.invokeCommand("type=posdriver&method=ShowPosCfg")}catch(t){throw t}finally{this.endPrint("billprint")}},hideConfigPage:function(t){this.invokeCommand("type=posdriver&method=HidePage:"+t)},posBillPrint:function(t,e){try{this.beginPrint("billprint"),this.invokeCommand("type=billprint&method=PosBillPrint:"+escape(t)+","+!!e+",1")}catch(i){throw i}finally{this.endPrint("billprint")}},writeDetailData:function(t,e,i,r,n){this._writeTableData(r,e,0),$print._writeServiceData(this,"billprint","billdetail.cds",t,e,i,this.getVersion()),this._writeTableData(n,e,2)},_writeTableData:function(t,e,i){var r=0==i?"表头":"表尾";if(!t||0==t.length)throw Error.abort("小票打印，["+r+"]数据不能为空");for(var n=[],s=[],o=0;o<t.length;o++){var a=t[o],l=a.indexOf(":");if(l<0)throw Error.abort("小票打印，["+r+"]数据格式不正确");n.push(a.substring(0,l)),s.push(a.substring(l+1))}var c=0==i?"billhead.cds":"billtail.cds";$print._writeServiceData(this,"billprint",c,n,e,s,this.getVersion())},openCashBox:function(){this.invokeCommand("type=posdriver&method=PosOpenCashBox")},screenOut:function(t,e){this.invokeCommand("type=posdriver&method=PosScreenOut:"+t+","+e)}},_Z_12.registerClass("_Z_12",Craba.Web.Script.PrintDataService),_Z_13=function(t,e){_Z_13.initializeBase(this,[t,e]),this.printType="billprint",this.version=$print.posVersion},_Z_13.prototype={setVersion:function(){$print.posVersion=this.version},showPosCfg:function(){this.getVersion();var t=this.invoke({tokenType:0,accessToken:this.getAccessToken(),serverUrl:$print.getServerUrl(),params:{printType:"posdriver",displayBarScale:!1,method:"ShowPosCfg",pageIndex:1}},!1);if(!t.success)throw Error.abort(t.msg)},hideConfigPage:function(t){this.getVersion();var e=this.invoke({tokenType:0,accessToken:this.getAccessToken(),serverUrl:$print.getServerUrl(),params:{printType:"posdriver",method:"HidePage",pageIndex:t}},!1);if(!e.success)throw Error.abort(e.msg)},openCashBox:function(t){var e=this.invoke({resultMode:1,tokenType:0,printMode:t?0:1,clientTagName:t?t.clientTagName:"",accessToken:this.getAccessToken(),serverUrl:$print.getServerUrl(),requestor:"",params:{printType:"posdriver",printerName:t?t.printerName:this._getProp("_printerName"),appName:this.getAppName(),method:"PosOpenCashBox"}},!1);e.success||(console.log(e),$common.alert(e.msg))},screenOut:function(t,e,i){var r=this.invoke({resultMode:1,tokenType:0,printMode:i?0:1,clientTagName:i?i.clientTagName:"",accessToken:this.getAccessToken(),serverUrl:$print.getServerUrl(),requestor:"",params:{printType:"posdriver",printerName:i?i.printerName:this._getProp("_printerName"),appName:this.getAppName(),method:"PosScreenOut",data:t+","+e}},!1);r.success||(console.log(r),$common.alert(r.msg))},posBillPrint:function(t,e,i,r,n){e&&this.getVersion();var s=e?!0===e?"Design":"Preview":"Print",o=this._getStyleInfo("",t,_Z_45.bill),a={printType:this.printType,appName:this.getAppName(),method:s,templateName:t,copies:n,bizStyleId:this._getProp("_bizStyleId")||"",printerName:r?r.printerName:this._getProp("_printerName"),styleInfo:o,data:i};this.invokeParams(a,r,function(t){t.success||(console.log(t),$common.alert(t.msg))})}},_Z_13.registerClass("_Z_13",_Z_7),_Z_14=function(t){_Z_14.initializeBase(this,[t,_Z_13]),this._title=-1,this._headData=[],this._endData=[],this._colTitles=[],this._colWidths=[],this._rowData=[],this._writeTimes=0},_Z_14.prototype={showPosCfg:function(){this._checkError(),this.getLocalService().showPosCfg()},hideConfigPage:function(t){this._checkError(),this.getLocalService().hideConfigPage(t)},openCashBox:function(){this._checkError(),this.execute(function(t,e){t.openCashBox(e)})},screenOut:function(t,e){this._checkError(),this.execute(function(i,r){i.screenOut(t,e,r)})},_getData:function(){return{headData:this._checkData(this._headData,0),detailData:$print.toJsonData("billdetail.cds",this._colTitles,this._colWidths,this._rowData),tailData:this._checkData(this._endData,1)}},_checkData:function(t,e){var i=0==e?"表头":"表尾";if(!t||0==t.length)throw Error.abort("小票打印，["+i+"]数据不能为空");for(var r=[],n=[],s=0;s<t.length;s++){var o=t[s],a=o.indexOf(":");if(a<0)throw Error.abort("小票打印，["+i+"]数据格式不正确");r.push(o.substring(0,a)),n.push(o.substring(a+1))}var l=0==e?"billhead.cds":"billtail.cds";return $print.toJsonData(l,r,this._colWidths,n)},posBillPrint:function(t,e,i){var r=this._getData();if(e)return this._checkError(),void this.getLocalService().posBillPrint(t,e,r,null,i);this.dependPrintService=!1,this.execute(function(n,s){n.posBillPrint(t,e,r,s,i)})},writeMasterData:function(t,e){this._headData=t,this._endData=e},writeDetailData:function(t,e,i,r,n){if(e.length<1||t.length!=e.length)throw Error.abort("小票打印数据格式不正确：\n\n1、标题数据源与列宽数据源长度不匹配.");this._colTitles=t,this._colWidths=e,this._rowData=i,this._headData=r,this._endData=n}},_Z_14.registerClass("_Z_14",_Z_8),Sys.UI.Controls.ExpressPrint=function(t){Sys.UI.Controls.ExpressPrint.initializeBase(this,[t]);var e=null;e=$settings.AllPrintUseService&&!$print.isRemotePrint()?new _Z_15(this):new _Z_17(this),this._printProvider=e},Sys.UI.Controls.ExpressPrint.prototype={initialize:function(){Sys.UI.Controls.ExpressPrint.callBaseMethod(this,"initialize"),this._printProvider.__form=this.__form},set_styleName:function(t){this._styleName=t},get_styleName:function(){return this._styleName},getPrinters:function(){return this._getProvider().getPrinters()},getCurPrinter:function(t){return this._getProvider().getCurPrinter(t)},writeData:function(t,e){this._getProvider(!0).writeData(t,e)},designReport:function(t,e,i){return this._getProvider(!0).designReport(t,e,i)},print:function(t,e){return this._getProvider(!0).print(t,e)},batchPrint:function(t,e,i,r){return this._getProvider(!0).batchPrint(t,e,i,r)},preview:function(t,e){return this._getProvider(!0).preview(t,e)},getPrinterDriver:function(t,e){return this._getProvider().getPrinterDriver(t,e)},_getProvider:function(t){if(this._useWebTool&&t)return this._webProvider||(this._webProvider=new Sys.UI.Controls.ExpressPrintWeb(this)),this._webProvider;var e=this._printProvider;return this._printProvider.isNewClient&&!this._printProvider.isNewClient()&&((e=new _Z_15(this)).__form=this.__form),e},get_freightName:function(){return this._freightName},set_freightName:function(t){this._freightName=t,this._templateName=t},checkInstall:function(){try{return this._getProvider().checkInstall()}catch(t){return!1}},isSupportCloudStore:function(){return this._getProvider().isSupportCloudStore()},modifyFields:function(t,e,i){this._getProvider().modifyFields(t,e,i)},checkTemplateExist:function(t){return this._getProvider().checkTemplateExist(t)},createNewTemplate:function(t,e,i){return this._getProvider().createNewTemplate(t,e,i)},_writeData:function(t,e,i){var r={};r.reportName=-1,r.reportNumber=-1,r.masterFields=null,r.detailFields=t,r.detailDataUrl="http://",r.detailData={itemCount:e.length,itemList:e},i._data=r},_getTemplateName:function(t,e){if("string"==typeof t)return t;if(!t)return this._freightName;var i=$print._getExpressDetailData(t);return this._writeData(i.detailFields,[i.printData],e),this._freightName?this._freightName:i.name}},Sys.UI.Controls.ExpressPrint.registerClass("Sys.UI.Controls.ExpressPrint",Sys.UI.Controls.OtherPrintBase),Sys.UI.Controls.ExpressPrintWeb=function(t){Sys.UI.Controls.ExpressPrintWeb.initializeBase(this,[t]),this._printType="express"},Sys.UI.Controls.ExpressPrintWeb.prototype={batchPrint:function(t,e,i){this.print(t[0])},print:function(t,e){this._checkBizStyleId(),this._target._templateName=this._target._getTemplateName(t,this),this.exec("Print")},writeData:function(t,e){this._target._writeData(t,e,this)},preview:function(t,e){this._checkPrint(),this._target._templateName=this._target._getTemplateName(t,this),this.exec("Preview")},designReport:function(t,e,i){this._checkPrint();var r=$print._getExpressDetailData(e);this._target._writeData(r.detailFields,[r.printData],this),this._target._templateName=t||r.name,this.exec("Design")},get_data:function(){if(!this._data){return t={reportName:-1,reportNumber:-1,masterDetailKeyFields:this._target._masterDetailKeyFields,masterFields:this._target._masterFields,masterData:this.get_masterDetailData(this._target._masterData),detailFields:this._target._detailFields,detailData:this.get_masterDetailData(this._target._detailData)}}var t=this._data;return t.masterFields=t.detailFields,t.masterData=t.detailData,this._target._detailData?(t.detailFields=this._target._detailFields,t.detailData=this.get_masterDetailData(this._target._detailData)):(delete t.detailFields,delete t.detailData),delete t.detailDataUrl,t}},Sys.UI.Controls.ExpressPrintWeb.registerClass("Sys.UI.Controls.ExpressPrintWeb",Sys.UI.Controls.WebPrintBase),_Z_15=function(t){_Z_15.initializeBase(this,[this]),this._enableShowWaiting=!1,this._control=t,this._dataVersion="1.0.1.97",this._cloudStoreVersion="1.0.1.118"},_Z_15.prototype={checkInstall:function(){return this.invokeCommand("type=express&get=Version"),!0},getPrinters:function(){var t=this.invokeCommand("type=express&method=GetPrinterNames");return $print._toPrinters(t)},getCurPrinter:function(t,e){var i=this.invokeCommand("type=express&method=GetCurPrinter:"+escape(t));return e?e(i):i},writeData:function(t,e){var i=this.invokeCommand("type=express&get=Version");if($print._compareVersion(i,this._dataVersion)>=0){var r={};r.reportName=-1,r.reportNumber=-1,r.masterFields=null,r.detailFields=t,r.detailDataUrl="http://",r.detailData={itemCount:e.length,itemList:e};var n=Sys.Serialization.JavaScriptSerializer.serialize(r);this.invokeCommand("type=express&method=LoadDataFromJson",n)||$common.alert("服务形式-快递单打印写数据出错")}else{for(var s=[],o=[],a=[],l=0,c=t.length;l<c;l++){var d=t[l];s.push(d.name),o.push(d.columnWidth)}for(var l=0,c=e.length;l<c;l++){var h=e[l];for(var p in h)"物流公司"!=p&&a.push(h[p])}$print._writeServiceData(this,"express","table_m.cds",s,o,a)}},isSupportCloudStore:function(){var t=this.invokeCommand("type=express&get=Version");return $print._compareVersion(t,this._cloudStoreVersion)>=0},getPrinterDriver:function(t){return this.invokeCommand("type=express&method=GetPrinterDriver:"+escape(t))},modifyFields:function(t,e){this.invokeCommand("type=express&set=DisplayFields:"+t),this.invokeCommand("type=express&set=DataFields:"+e)},checkTemplateExist:function(t){return this.invokeCommand("type=express&method=CheckTemplateExist:"+escape(t))},setPrinter:function(t){this.invokeCommand("type=express&method=SetPrinter:"+escape(t))},createNewTemplate:function(t,e){return this.invokeCommand("type=express&method=CreateNewTemplate:"+escape(t)+","+escape(e))},print:function(t){if(this.isPrinting("express",!0))return null;try{this.beginPrint("express");var e=this._createDataAndSelectModal(t,!0);return this.invokeCommand("type=express&method=Print:"+escape(e))}catch(i){throw i}finally{this.endPrint("express")}},batchPrint:function(t,e,i){if(!this.isPrinting("express",!0))try{this.beginPrint("express");var r=$print._getExpressDetailData(t[0]);e&&this.setPrinter(e),this.writeData(r.detailFields,r.printData);var n=i||r.name;return this.invokeCommand("type=express&method=Print:"+escape(n))}catch(s){throw s}finally{this.endPrint("express")}},preview:function(t){if(this.isPrinting("express",!0))return null;try{this.beginPrint("express");var e=this._createDataAndSelectModal(t,!0);return this.invokeCommand("type=express&method=Preview:"+escape(e))}catch(i){throw i}finally{this.endPrint("express")}},designReport:function(t,e,i){if(t=this.getTemplateName(t),!this.isPrinting("express",!0))try{this.beginPrint("express"),e&&this._createDataAndSelectModal(e);var r=this.invokeCommand("type=express&method=DesignReport:"+escape(t));if(!i)return r;i(r)}catch(n){throw n}finally{this.endPrint("express")}},_createDataAndSelectModal:function(t,e){if("string"==typeof t)return e?this.getTemplateName(t):t;if(!t)return"";var i=$print._getExpressDetailData(t),r=[];return r.push(i.printData),this.writeData(i.detailFields,r),e?this.getTemplateName(i.name):i.name},getTemplateName:function(t){if($settings.CPrintUseClound&&this.isSupportCloudStore()){var e=this._dataService;e||(e=this._dataService=Craba.Web.Script.DataServiceBase.create());var i=e.GetCloundPrintInfo(t,!1,Function.emptyMethod);if(Object.isEmpty(i))return t;this._control.get_freightName()?(i.templatename=this._control.get_freightName(),i.stylename=t):i.templatename=t;return Sys.Serialization.JavaScriptSerializer.serialize(i)}return t}},_Z_15.registerClass("_Z_15",Craba.Web.Script.PrintDataService),_Z_16=function(t,e){_Z_16.initializeBase(this,[t,e]),this.printType="express",this.version=$print.expressVersion},_Z_16.prototype={setVersion:function(){$print.expressVersion=this.version},getPrinterDriver:function(t,e){var i={printType:this.printType,printerName:t,appName:this.getAppName(),get:"PrinterDriver"};return this.invokeSync(i,e)},checkTemplateExist:function(t){var e={printType:this.printType,appName:this.getAppName(),method:"CheckTemplateExist",templateName:t};return this.invokeSync(e,null,2)},getCurPrinter:function(t){var e={printType:this.printType,appName:this.getAppName(),get:"CurPrinterName",templateName:t};return this.invokeSync(e,null,2)},createNewTemplate:function(t,e,i){var r={printType:this.printType,appName:this.getAppName(),method:"CreateNewTemplate",templateName:e,oldTemplateName:t};return this.invokeSync(r,i,2)},executePrint:function(t,e,i,r,n,s){var o=this._getStyleInfo("",i,_Z_45.express),a={printType:this.printType,appName:this.getAppName(),method:t,templateName:i,bizStyleId:this._getProp("_bizStyleId")||"",printerName:r,styleInfo:o,data:e};this.invokeParams(a,n,function(t){if(s)s(t);else if(!t.success)throw Error.abort(t.msg)})}},_Z_16.registerClass("_Z_16",_Z_7),_Z_17=function(t){_Z_17.initializeBase(this,[t,_Z_16]),this.dependPrintService=!0},_Z_17.prototype={getPrinters:function(){return $print.getLocalClients()},writeData:function(t,e){this._target._writeData(t,e,this)},getCurPrinter:function(t,e){return this.getLocalService().getCurPrinter(t)},designReport:function(t,e,i){this._checkError(),this._printMethod="Design";var r=this;this.execute(function(n,s){var o=$print._getExpressDetailData(e);r._target._writeData(o.detailFields,[o.printData],r),t=t||o.name,n.executePrint(r._printMethod,r._data,t,r._getProp("_printerName"),s,i)})},preview:function(t,e){this._checkError(),this._printMethod="Preview";var i=this;this.execute(function(r,n){var s=i._target._getTemplateName(t,i);r.executePrint(i._printMethod,i._data,s,i._getProp("_printerName"),n,e)})},isSupportCloudStore:function(){return!0},getPrinterDriver:function(t,e){this.execute(function(i,r){var n=i.getPrinterDriver(t,r);e(n)},"OnlyClientSelector.gspx")},modifyFields:function(t,e){},checkTemplateExist:function(t){return this.getLocalService().checkTemplateExist(t)},createNewTemplate:function(t,e,i){this.execute(function(r,n){var s=r.createNewTemplate(t,e,n);i(s)},"OnlyClientSelector.gspx")},print:function(t,e){this._printMethod="Print",this.dependPrintService=!1;var i=this,r=i._getProp("_printerName");this.execute(function(n,s){if(s&&s.length>0){var o=s[0];r=o.printerName}var a=i._target._getTemplateName(t,i);n.executePrint(i._printMethod,i._data,a,r,s,e)})},batchPrint:function(t,e,i,r){if(0!==t.length){this._printMethod="Print",this.dependPrintService=!1;var n=this;this.execute(function(s,o){var a=$print._getExpressDetailData(t[0]),l=i||a.name;n._target._writeData(a.detailFields,[a.printData],n),s.executePrint(n._printMethod,n._data,l,e,o,r)})}}},_Z_17.registerClass("_Z_17",_Z_8),Sys.UI.Controls.BarScale=function(t){Sys.UI.Controls.BarScale.initializeBase(this,[t]),this._scaleProvider=new _Z_18(this)},Sys.UI.Controls.BarScale.prototype={checkInstall:function(){return $print.checkRun()},dhConfig:function(){this._scaleProvider.dhConfig()},khConfig:function(){this._scaleProvider.khConfig()},dhSendPlu:function(){this._scaleProvider.dhSendPlu()},khSendPlu:function(){this._scaleProvider.khSendPlu()},loadPlu:function(t){this._scaleProvider.loadPlu(t)}},Sys.UI.Controls.BarScale.registerClass("Sys.UI.Controls.BarScale",Sys.UI.Control),_Z_18=function(t){_Z_18.initializeBase(this,[this]),this._enableShowWaiting=!1,this._control=t},_Z_18.prototype={dhConfig:function(){this.invokeCommand("type=BarScale&method=Config:dhbarscale")},khConfig:function(){this.invokeCommand("type=BarScale&method=Config:khbarscale")},dhSendPlu:function(){this.invokeCommand("type=BarScale&method=SendPlu:dhbarscale")},khSendPlu:function(){this.invokeCommand("type=BarScale&method=SendPlu:khbarscale")},loadPlu:function(t){this.invokeCommand("type=BarScale&method=LoadPlu",t)}},_Z_18.registerClass("_Z_18",Craba.Web.Script.PrintDataService),Sys.UI.Controls.EScanAction=function(t){Sys.UI.Controls.EScanAction.initializeBase(this,[t]),this._defaultPort="com1",this._defaultInterval=10,this._escanProvider=null,this._hasPrintService=!0,this._escanProvider=new _Z_19(this),this._isStart=!1},Sys.UI.Controls.EScanAction.prototype={dispose:function(){if(this._isStart)try{this.stop()}catch(t){}Sys.UI.Controls.EScanAction.callBaseMethod(this,"dispose")},checkInstall:function(){return $print.checkRun()},config:function(){this._escanProvider.config()},start:function(t,e){e==undefined&&(e=this._defaultInterval),t==undefined&&(t=this._defaultPort),this._escanProvider.start(t,e),this._isStart=!0},stop:function(){this._escanProvider.stop(),this._isStart=!1},getData:function(){return this._escanProvider.getData()},startByConfig:function(t){t==undefined&&(t=this._defaultInterval),this._escanProvider.startByConfig(t)}},Sys.UI.Controls.EScanAction.registerClass("Sys.UI.Controls.EScanAction",Sys.UI.Control),_Z_19=function(t){_Z_19.initializeBase(this,[this]),this._enableShowWaiting=!1,this._control=t,this._port="com1"},_Z_19.prototype={config:function(){this.invokeCommand("type=EScan&method=Config")},start:function(t,e){this.invokeCommand("type=EScan&method=Start:"+t+","+e)},stop:function(){this.invokeCommand("type=EScan&method=Stop")},getData:function(){return this.invokeCommand("type=EScan&method=GetData")},startByConfig:function(t){return this.invokeCommand("type=EScan&method=StartByConfig:"+t)}},_Z_19.registerClass("_Z_19",Craba.Web.Script.PrintDataService),function(){function t(t){return null===t||t===undefined||""===t}function e(t){return n(t,"decimalDigits")}function i(t){return n(t,"decimalScale")}function r(t){return function(t,e){var i=o(t,e);return null!==i&&Boolean.convert(i)}(t,"displayThousandSeperator")}function n(t,e){var i=o(t,e);return null!==i?parseInt(i):-1}function s(t,e){var i=o(t,e);return null!==i?i.toString():null}function o(t,e){var i=t[e];return i!=undefined&&null!==i?i:null}window.convertGridData=function(t,u,_){if(!t||0==t.length)return u;if(!u||0==u.length)return u;for(var m=t.length,g=[],f=[],y=0;y<m;y++){var v=t[y];g.push(s(v,"dataField")),f.push(function(t){var u=null,_=s(t,"replaceText");if(_)u=new a(_);else switch(s(t,"columnType")){case"Number":var m=e(t),g=i(t),f=n(t,"upperCaseKind"),y=s(t,"formatNumber");u=f<=0?new d(m,g,r(t),!1,y):new c(m>0?m:g,f,y);break;case"Percent":u=new d(e(t),i(t),r(t),!0,s(t,"formatNumber"));break;case"Date":u=new l(!0);break;case"DateTime":u=new l(!1);break;case"Boolean":u=new h;break;case"DropDown":u=new p(o(t,"itemData"))}return u}(v))}for(var S=[],P=u.length,y=0;y<P;y++){for(var C=u[y],D={},I=0;I<m;I++){var x=g[I],b=f[I],U=C[x];D[x]=b?b.Format(U):U}Array.forEach(_,function(t){t&&(D[t]=C[t])}),S.push(D)}return S};var a=function(t){this.replaceText=t};a.prototype={Format:function(t){return this.replaceText}};var l=function(t){this.isDate=t};l.prototype={Format:function(e){if(t(e))return"";if(!(e instanceof Date)){var i=/^\/Date\((-?[\d.]+?)\)\/$/.exec(e);e=i?new Date(Number(i[1])):new Date(e)}return this.isDate?Date.dateToStr(e):Date.dateTimeToStr(e)}};var c=function(t,e){this.decimalDigits=t,this.upperCaseKind=e};c.prototype={Format:function(t){return t}};var d=function(t,e,i,r,n){this.decimalDigits=t,this.decimalScale=e,this.displayThousandSeperator=i,this.isPercent=r,this.formatNumber=n};d.prototype={Format:function(t){return this.formatNumber&&(t=$common.formatNumber({value:t,decimalDigits:this.decimalDigits,decimalScale:this.decimalScale,displayThousandSeperator:this.displayThousandSeperator,isPrint:!0})),this.isPercent&&(t+="%"),t}};var h=function(t){this.replaceText=t};h.prototype={Format:function(e){return t(e)?"×":(e=Boolean.convert(e))?"√":"×"}};var p=function(t){this.itemData=t};p.prototype={Format:function(e){if(t(e))return"";var i=e.toString();return this.itemData?this.itemData[i]!==undefined?this.itemData[i]:("boolean"==typeof e&&(i=e?1:0),this.itemData[i]!==undefined?this.itemData[i]:e):e}}}();﻿Sys.WorkMode=function(){throw Error.notImplemented()},Sys.WorkMode.prototype={normal:0,design:1},Sys.WorkMode.registerEnum("Sys.WorkMode"),_Z_266=function(t,e,i,s,n){this._options=e,this._work=t,this._source=i,this._addType=s,this._prevItem=n},_Z_266.prototype={get_addType:function(){return this._addType},get_options:function(){return this._options},set_left:function(t){this._options.x=t},get_left:function(){return this._options.x},set_top:function(t){this._options.y=t},get_top:function(){return this._options.y},set_distance:function(t){this._options.distance=t},get_source:function(){return this._source},get_data:function(){return this._options.data},set_data:function(t){this._options.data=t},set_text:function(t){this._options.text=t},get_text:function(){return this._options.text},set_cssClass:function(t){this._options.cssClass=t},get_prevData:function(){return this._prevItem?this._prevItem.get_data(!0):null},getItem:function(){return this._item},addItem:function(){return Object.isUndefinedOrNull(this._options.self)&&(this._options.self=!1),this._item=this._work.addItem(this._options),this.callback&&this.callback(this._item),this._item}},_Z_266.registerClass("_Z_266",Sys.EventArgs),_Z_267=function(t){this._item=t},_Z_267.prototype={get_data:function(){return Object.clone(this._item.options.data)},set_data:function(t){this._item.options.data=t},get_type:function(){return this._item.get_type()},set_text:function(t){this._item.set_text(t)},set_cssClass:function(t){this._item.options.cssClass=t;this._item.get_element().className=$skin.joinCssClass(this._item.defaultCssName(),t)},get_options:function(){return this._item.options},get_text:function(){return this._item.get_text()},get_item:function(){return this._item},modifyItem:function(t,e){this.set_data(e),this._item.set_text(t)},set_lineColor:function(t){t&&(this._item.options.lineColor=t,this._item._lineColor=this._item._defaultLineColor=t)},set_arrowType:function(t){Object.isUndefinedOrNull(t)||(this._item.options.arrowType=t,this._item._arrowType=this._item.defaultArrowType=t)},set_dash:function(t){this._item.options.dash=t}},_Z_267.registerClass("_Z_267",Sys.EventArgs),_Z_269=function(t){this._line=t},_Z_269.prototype={get_prevData:function(){return this._line.get_item().options.data},get_nextData:function(){var t=this._line.get_nextItem();return t?t.options.data:null}},_Z_269.registerClass("_Z_269",_Z_267),_Z_268=function(t){this._item=t},_Z_268.prototype={get_item:function(){return this._item},get_data:function(){return Object.clone(this._item.options.data)},set_data:function(t){this._item.options.data=t},set_text:function(t){this._item.set_text(t)},get_text:function(){return this._item.get_text()},get_type:function(){return this._item.get_type()}},_Z_268.registerClass("_Z_268",Sys.EventArgs),Craba.UI.Workflow=function(t){Craba.UI.Workflow.initializeBase(this,[t]),this._hAlign=-1,this._vAlign=-1,this._mode=Sys.WorkMode.normal,this._allowDrag=!1,this._allowDrop=!1,this._allowResize=!1,this._allowDraw=!1,this._useFragment=!0,this._isDash=!1},Craba.UI.Workflow.prototype={get_cssClass:function(){var t="FlexBlock Workflow";return this._allowResize||(t+=" NoResize"),this._allowDraw||(t+=" NoLine"),t},endRender:function(t){t.writeEnd()},initScript:function(){Craba.UI.Workflow.callBaseMethod(this,"initScript"),this.addProp("hAlign",this._hAlign,-1),this.addProp("vAlign",this._vAlign,-1),this.addProp("mode",this._mode,Sys.WorkMode.normal)},typeName:function(){return"Workflow"},set_mode:function(t){this._mode=this.get_enumTypeValue(Sys.WorkMode,t)},set_hAlign:function(t){this._hAlign=this.get_enumTypeValue(_Z_250,t)},set_vAlign:function(t){this._vAlign=this.get_enumTypeValue(_Z_251,t)}},Craba.UI.Workflow.registerClass("Craba.UI.Workflow",Craba.UI.WebControl),Sys.UI.Controls.Workflow=function(t){Sys.UI.Controls.Workflow.initializeBase(this,[t]),this._allowDrop=!1,this._allowDrag=!1,this._allowResize=!1,this._useFragment=!0,this._enabled=!0,this._items=[],this._selectedItems=[],this._mode=Sys.WorkMode.normal,this._vAlign=-1,this._hAlign=-1,this._index=1,this._lineColor="#999",this._itemDistanse=60},Sys.UI.Controls.Workflow.prototype={initialize:function(){Sys.UI.Controls.Workflow.callBaseMethod(this,"initialize"),this.bindEvent()},dispose:function(){this.dragBlock&&(this.dragBlock.dispose(),this.dragBlock=null),Array.forEach(this._items,function(t,e){t.dispose()}),delete this._selectedItems,delete this._items,Sys.UI.Controls.Workflow.callBaseMethod(this,"dispose")},set_enabled:function(t){this._enabled=t,$dom.setCssClass(!t,this._element,"disabled"),t||this.hideResizer()},get_enabled:function(){return this._enabled},set_lineColor:function(t){this._lineColor=t},get_lineColor:function(){return this._lineColor},set_isDash:function(t){this._isDash=t},get_isDash:function(){return this._isDash},set_useFragment:function(t){this._useFragment=t},get_useFragment:function(){return this._useFragment},bindEvent:function(){this._mode==Sys.WorkMode.design&&this.fireEvent(),this._bindOtherEnvet()},fireEvent:function(){var t=this.get_element();if(this._mode==Sys.WorkMode.design){if(this._binded)return;this._binded=!0,t.unselectable="on",$common.addMouseDownHandler(t,this._doMouseDown,this),$common.addMouseMoveHandler(t,this._doMouseMove,this),$common.addContextMenuHandler(t,this._doMenu,this)}else this._binded=!1,$clearHandlers(t),t.unselectable="",this._bindOtherEnvet();Array.forEach(this._items,function(t,e){t.fireEvent()})},_bindOtherEnvet:function(){var t=this.get_element();$common.addMouseUpHandler(t,this._doMouseUp,this),$common.addDblClickHandler(t,this._doDblClick,this)},get_allowDrag:function(){return this._allowDrag},set_allowDrag:function(t){this._allowDrag=t},get_allowDraw:function(){return this._allowDraw},set_allowDraw:function(t){this._allowDraw=t},get_allowResize:function(){return this._allowResize},set_allowResize:function(t){this._allowResize=t},set_hAlign:function(t){this._hAlign=t},get_hAlign:function(){return this._hAlign},set_vAlign:function(t){this._vAlign=t},get_vAlign:function(){return this._vAlign},set_showGrid:function(t){$Dom.setCssClass(t,this.get_element(),"ShowGrid")},get_showGrid:function(t){return $Dom.hasClass(this.get_element(),"ShowGrid")},set_menuCssClass:function(t){this._menuCssClass=t},get_menuCssClass:function(){return this._menuCssClass},doFormLoaded:function(t){this.get_form().get_fullWindow()||(this._isBinded=!0,this.refresh(this._dataSource))},doFormResized:function(){if(!this._isBinded)return this._isBinded=!0,this.refresh(this._dataSource);this.alignItems()},addItem:function(t){var e=new _Z_271(t);return this._items.push(e),e.set_flow(this),e.paint(),e},saveData:function(t){var e=[];return Array.forEach(this._items,function(i,s){e.push(i.saveData(!1,t))}),e.length>0&&(e=Object.clone(e)),e},findItem:function(t){if(!this._dataKeyField)throw Error.abort("必须先设置DataKeyField主键字段");for(var e=0,i=this._items.length;e<i;e++){var s=this._items[e];if(s.options.data&&s.options.data[this._dataKeyField]==t)return s;for(var n=0,o=s._lines.length;n<o;n++){var r=s._lines[n];if(r.options.data&&r.options.data[this._dataKeyField]==t)return r}}return null},modifyItem:function(t){if(!this._dataKeyField)throw Error.abort("必须先设置DataKeyField主键字段");var e=t[this._dataKeyField];if(e===undefined)throw Error.abort("主键值不能为空");var i=this.findItem(e);if(!i)return!1;if(i.set_data(t),this._dataTextField){var s=t[this._dataTextField];i.set_text(s)}return i},set_dataTextField:function(t){this._dataTextField=t},get_dataTextField:function(){return this._dataTextField},set_dataKeyField:function(t){this._dataKeyField=t},get_dataKeyField:function(){return this._dataKeyField},get_selectedItems:function(){var t=this.getItemsData(this._selectedItems);return this._curLine&&t.push(this._curLine.saveData()),t},getItemsData:function(t){var e=[];return Array.forEach(t,function(t,i){e.push(t.saveData())}),Object.clone(e)},refresh:function(t){this.clear(),t&&(this._convertListAlign(t),this._useFragment&&(this.fragment=$common.createFragment()),Array.forEach(t,function(t,e){this.addItem(t)},this),this.fragment&&this.get_element().appendChild(this.fragment),delete this.fragment,delete this._relationLines)},isBinding:function(){return this.fragment!==undefined},clear:function(){Array.forEach(this._items,function(t,e){t.dispose()}),this._crossLineV=null,this.get_element().innerHTML="",this._items=[],this._selectedItems=[]},hideResizer:function(t){Array.forEach(this._selectedItems,function(e,i){t!=e&&e.hideResizer(!0)}),this._selectedItems=[]},changeLocation:function(t,e,i){i&&this._moveCrossLine(i),Array.forEach(this._selectedItems,function(s,n){i!=s&&(s._startPos||(s._startPos=$Dom.getLocation(s.get_element())),s.location(s._startPos.x+t,s._startPos.y+e))})},removeSelectedItems:function(){if(this.removeItems(this._selectedItems),this._curLine){var t=this._curLine;t.get_item().removeLine(t),t.dispose(!0),delete this._curLine}this._selectedItems=[]},removeItems:function(t){if(this._showAddIcon()){var e=t[0],i=e._lines[0],s=e._rlines[0];if(i){var n=i._nextItem;n&&(n.removeRLine(i),s&&(n.addRLine(s),s._nextItem=n,s.dragResizerEnd()),this.locationNext(e,!1)),e._rlines=[]}else s&&(s.get_item().removeLine(s),s.dispose(!0))}return Array.forEach(t,function(t,e){Array.remove(this._items,t),t.dispose(!0)},this),!0},textAlign:function(t,e){Array.forEach(t,function(t,i){t.textAlign(e)})},itemColor:function(t,e,i){Array.forEach(t,function(t,s){t.setColor(e,i)})},_checkMouseLine:function(t,e,i){for(var s=!1,n=0,o=this._items.length;n<o;n++)for(var r=this._items[n],h=0,a=r._lines.length;h<a;h++){var l=r._lines[h];if(s)l.setBottom();else{var _=this.convertPos(t,e,l);(s=l._checkMouseLine(_,i))?l.setTop():l.setBottom()}}},_buildIndex:function(){return this._index++},_addRelation:function(t,e){if(this._relationLines||(this._relationLines=[]),t)for(var i=0,s=this._relationLines.length;i<s;i++){(e=this._relationLines[i]).options.next==t.options.index&&(t.addRLine(e,!0),e._nextItem=t)}else{for(var n=e.options.next,i=0,s=this._items.length;i<s;i++){if(n==(t=this._items[i]).options.index){t.addRLine(e,!0),e._nextItem=t;break}}this._relationLines.push(e)}},_doMenu:function(t){if(this._enabled){var e=this._menu;e||(e=this._careateMenu()),e.popupAt(t.clientX,t.clientY),t.cancel()}},_showAddIcon:function(){return $Dom.hasClass(this.get_element(),"Radius")},_doMouseDown:function(t){if(this._enabled)if(this._startSelectPos)this._doMouseUp(t);else{var e=t.target;this._curLine&&this._curLine.set_selected(!1),e._item?e._item._doMouseDown(t):0==t.button&&this.hideResizer(),0==t.button&&e==this.get_element()?this._startSelectPos={x:t.clientX,y:t.clientY}:delete this._startSelectPos,this._colorBlock&&this._colorBlock.set_visible(!1)}},_doMouseMove:function(t){if(this._enabled){var e=t.target;if(this._startSelectPos){var i={x:t.clientX,y:t.clientY};this._renderRect(this._startSelectPos,i)}else this.eventTarget?this.eventTarget._doMouseMove(t):e._item&&e._item._doMouseMove(t)}},_doMouseUp:function(t){if(this._enabled){this._startSelectPos&&(this._selectRectDom&&(this._doSelectItems(),$Dom.setVisible(this._selectRectDom,!1)),delete this._startSelectPos),this.eventTarget&&(this.eventTarget._doMouseUp(t),delete this.eventTarget);var e=t.target;if(!e.noclick){var i=e._item;if(i){if(!i.get_type){if(!i.get_item)return;i=i.get_item()}var s=this.get_events().getHandler("itemClick");if(s){var n=new _Z_268(i);n.event=t,s(this,n)}}}}},_createRectDom:function(){return this._selectRectDom?$Dom.setVisible(this._selectRectDom,!0):this._selectRectDom=$common.createClassDiv("SelectRect"),this.get_element().appendChild(this._selectRectDom),this._selectRectDom},_doSelectItems:function(){var t=this._selectRectDom.style,e=parseFloat(t.left),i=parseFloat(t.top),s={x1:e,y1:i,x2:e+this._selectRectDom.offsetWidth,y2:i+this._selectRectDom.offsetHeight};Array.forEach(this._items,function(t){var e=t.getBounds();(e.x>=s.x1||e.x+e.width>=s.x1)&&e.x<=s.x2&&(e.y>=s.y1||e.y+e.height>=s.y1)&&e.y<=s.y2&&t.showResizer()},this)},_renderRect:function(t,e){var i=this._createRectDom(),s=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),o=Math.min(t.x,e.x),r=Math.min(t.y,e.y),h=this.convertPos(o,r);i.style.cssText=$common.styleToCssText({left:$common.pix(h.x),top:$common.pix(h.y),width:$common.pix(s),height:$common.pix(n)})},_doDblClick:function(t){this._enabled&&t.target._item&&t.target._item._doDblClick(t)},_careateMenu:function(){var t=this.get_id();window[t]=this;var e=this.get_form(),i=this.get_idPart()+"_menu",s=$createControl(Craba.UI.PopupMenu,{ID:i,CssClass:$skin.joinCssClass("WorkflowMenu",this._menuCssClass),OnPopup:t+"._menuPopup"},e);$createControl("MenuItem",{Text:"新建",Icon:"aicon-add",CssClass:"item_xj",Visible:this._allowDrag,OnClick:t+"._itemCreate"},e,s),$createControl("MenuItem",{ID:"workItemDel",Text:"删除",CssClass:"item_sc",Icon:"aicon-shanchu",OnClick:t+"._itemDel"},e,s),$createControl("MenuItem",{ID:"workItemModify",Text:"修改",CssClass:"item_xg",Icon:"aicon-bianji1",OnClick:t+"._itemModify"},e,s),$createControl("MenuItem",{ID:"workItemCopy",Text:"复制",CssClass:"item_fz",Icon:"aicon-iconset0121",Visible:this._allowDrag,OnClick:t+"._itemCopy"},e,s),$createControl("MenuItem",{ID:"workItemPaste",Text:"粘贴",CssClass:"item_zt",Visible:this._allowDrag,Icon:"aicon-zhuanru",OnClick:t+"._itemPaste"},e,s);var n=$createControl("MenuItem",{ID:"workItemAlign",Text:"元素对齐",CssClass:"item_ysdq",BeginGroup:!0,Visible:this._allowDrag,Icon:"aicon-menu"},e,s);$createControl("MenuItem",{Text:"相同大小",Param:"size",Icon:"aicon-fenlei",OnClick:t+"._itemAlign"},e,n),$createControl("MenuItem",{Text:"相同宽度",Param:"width",Icon:"aicon-fenlei",OnClick:t+"._itemAlign"},e,n),$createControl("MenuItem",{Text:"相同高度",Param:"height",Icon:"aicon-fenlei",OnClick:t+"._itemAlign"},e,n),$createControl("MenuItem",{Text:"左对齐",Param:"left",Icon:"aicon-verticalright",BeginGroup:!0,OnClick:t+"._itemAlign"},e,n),$createControl("MenuItem",{Text:"水平均分",Param:"horzAvg",Icon:"aicon-column-width",OnClick:t+"._itemAlign"},e,n),$createControl("MenuItem",{Text:"右对齐",Param:"right",Icon:"aicon-verticalleft",OnClick:t+"._itemAlign"},e,n),$createControl("MenuItem",{Text:"顶部对齐",Param:"top",Icon:"aicon-vertical-align-top",OnClick:t+"._itemAlign",BeginGroup:!0},e,n),$createControl("MenuItem",{Text:"垂直均分",Param:"vertAvg",Icon:"aicon-colum-height",OnClick:t+"._itemAlign"},e,n),$createControl("MenuItem",{Text:"底部对齐",Param:"bottom",Icon:"aicon-vertical-align-botto",OnClick:t+"._itemAlign"},e,n);var o=$createControl("MenuItem",{ID:"workTextAlign",Text:" 文本对齐 ",CssClass:"item_wbdq",Enabled:!1,Visible:this._allowDrag,Icon:"aicon-align-left"},e,s);$createControl("MenuItem",{Icon:"aicon-align-left",Text:"文本左对齐",Param:"flex-start",OnClick:t+"._textAlign"},e,o),$createControl("MenuItem",{Text:"文本居中",Icon:"aicon-align-center",Param:"center",OnClick:t+"._textAlign"},e,o),$createControl("MenuItem",{Text:"文本右对齐",Icon:"aicon-align-right",Param:"flex-end",OnClick:t+"._textAlign"},e,o),$createControl("MenuItem",{Text:"文本竖向",Icon:"aicon-line-height",BeginGroup:!0,Param:"vert",OnClick:t+"._textAlign"},e,o),$createControl("MenuItem",{Text:"文本横向",Icon:"aicon-column-width",Param:"horz",OnClick:t+"._textAlign"},e,o);var r=$createControl("MenuItem",{ID:"workItemStyle",Text:"样式",CssClass:"item_ys",Enabled:!1,Visible:this._allowDrag,Icon:"aicon-bg-colors",OnSubMenu:t+"._stylePopup"},e,s);return $createControl("MenuItem",{Text:"文本色",Icon:"aicon-font-colors",Param:"color",OnClick:t+"._itemStyle"},e,r),$createControl("MenuItem",{Text:"背景色",Icon:"aicon-bg-colors",Param:"backgroundColor",OnClick:t+"._itemStyle"},e,r),$createControl("MenuItem",{Text:"边框色",Icon:"aicon-number",Param:"borderColor",OnClick:t+"._itemStyle"},e,r),$createControl("MenuItem",{ID:"workItemLineStyle",Text:"线条和箭头色",Icon:"aicon-rise",Param:"lineColor",Enabled:!1,OnClick:t+"._itemStyle"},e,r),r=$createControl("MenuItem",{Text:"另存为图片",CssClass:"item_lcwtp",Icon:"aicon-image-fill",Visible:this._allowDrag,BeginGroup:!0},e,s),$createControl("MenuItem",{Text:"带网格的图片",Param:"grid",OnClick:t+"._saveImg"},e,r),$createControl("MenuItem",{Text:"白色背景的图片",Param:"white",OnClick:t+"._saveImg"},e,r),$createControl("MenuItem",{Text:"透明背景的图片",Param:"transparent",OnClick:t+"._saveImg"},e,r),$createControl("MenuItem",{Text:"切换网格",CssClass:"item_qhwg",Visible:this._allowDrag,Icon:"aicon-number",OnClick:t+"._showGridBg"},e,s),$createControl("MenuItem",{Text:"清空画布",CssClass:"item_qkhb",Icon:"aicon-close",OnClick:t+".clear"},e,s),s.appendTo(document.body),this._menu=e[i]},_menuPopup:function(t,e){this._doMenuEvent(window.event);var i=this.get_form(),s=this._selectedItems.length;i.workItemDel.set_enabled(s>0||this._curLine),i.workItemModify.set_enabled(1==s),i.workItemAlign.set_enabled(s>1),i.workTextAlign.set_enabled(s>0),i.workItemStyle.set_enabled(s>0||this._curLine),i.workItemCopy.set_enabled(s>0),i.workItemPaste.set_enabled(this._copyItems!=undefined)},_stylePopup:function(t,e){this.get_form().workItemLineStyle.set_enabled(!!this._curLine)},_doMenuEvent:function(t){if((t=window.event)&&t.target){this._savePos={x:t.clientX,y:t.clientY};var e=t.target.control;e&&_Z_271.isInstanceOfType(e)&&(e.isResizer()||(this.hideResizer(e),e.showResizer()))}},_itemCreate:function(t,e){var i=this._savePos?this._savePos:{x:e.clientX,y:e.clientY};this._doBeforeAdd(e,i,this,"menu")},_emitDragLeave:function(t,e){this._draging=!1},_doBeforeAdd:function(t,e,i,s,n,o){var r=this.get_events().getHandler("beforeAdd");if(!r){var h=this.addItem(e);return o&&o(h),h}var a=new _Z_266(this,e,i,s,n);return a.event=t,a.callback=o,r(this,a),a.getItem()},set_viewPoint:function(t,e){this._startX=t,this._startY=e},get_item:function(t){return this._items[t]},alignItems:function(){if(!(this._items.length<1)){var t=this._calcNewPoint();if(t){$Dom.addCssClass(this.get_element(),"Ani"),Array.forEach(this._items,function(e,i){e.changeOffset(t.x,t.y),Array.forEach(e._lines,function(e,i){e.changeOffset(t.x,t.y)})});var e=this.get_element();setTimeout(function(){$Dom.removeCssClass(e,"Ani")},300)}}},_convertListAlign:function(t){if(0!=this.get_element().offsetWidth){var e=this._calcNewPoint(t);e&&Array.forEach(t,function(t,i){t.x-=e.x,t.y-=e.y,Array.forEach(t.lines,function(t,i){t.x-=e.x,t.y-=e.y})})}},_calcNewPoint:function(t){if(this.get_mode()==Sys.WorkMode.design)return null;if(-1==this._hAlign&&-1==this._vAlign)return null;var e=!t,i=this.get_element(),s=e?i.offsetWidth:i.scrollWidth,n=e?i.offsetHeight:i.scrollHeight;if(0==s||0==n)return null;console.log(s),console.log(n),e&&(t=this.saveData());var o=this._calcViewBounds(t),r=0;this._hAlign==_Z_250.left?r=o.x:this._hAlign==_Z_250.center?(r=Math.max(0,(s-o.width)/2),r=o.x-r):this._hAlign==_Z_250.right&&(r=Math.max(0,s-o.width),r=o.x-r);var h=0;return this._vAlign==_Z_251.top?h=o.y:this._vAlign==_Z_251.middle?(h=Math.max(0,(n-o.height)/2),h=o.y-h):this._vAlign==_Z_251.bottom&&(h=Math.max(0,n-o.height),h=o.y-h),{x:r,y:h}},_toViewportBounds:function(t){var e=this.get_element();if(t.width=e.scrollWidth,t.height=e.scrollHeight,!(Object.isUndefinedOrNull(this._startX)&&Object.isUndefinedOrNull(this._startY)||0==t.length)){var i=this._calcViewBounds(t);Array.forEach(t,function(t,e){t.x-=i.x,t.y-=i.y,Array.forEach(t.lines,function(t,e){t.x-=i.x,t.y-=i.y})}),t.width=i.width,t.height=i.height}},_calcViewBounds:function(t){var e=99999999,i=99999999,s=0,n=0;return Array.forEach(t,function(t,o){e=Math.min(t.x,e),i=Math.min(t.y,i),s=Math.max(t.x+t.width,s),n=Math.max(t.y+t.height,n)},this),n+=10,s+=10,e-=10,i-=10,{x:e,y:i,width:s-e,height:n-i}},_saveImg:function(t,e){var i=t.get_param();this["export"](i)},"export":function(t){var e=this._toCanvas(t),i=this.get_events().getHandler("saveImage"),s={};i&&i(this,s);var n=".jpg",o="image/jpeg";if("transparent"==t&&(n=".png",o="image/png"),s.fileName)s.fileName=s.fileName+n;else{var r=new Date;s.fileName=r._format("yyyyMMddHHmmss")+n}var h=e.toDataURL(o);$common.saveImage(h,s.fileName)},_toCanvas:function(t){var e=document.createElement("canvas"),i=(this.get_element(),this.saveData(!0));this._toViewportBounds(i);var s=i.width,n=i.height;e.width=s,e.height=n;var o=e.getContext("2d");if("transparent"!=t&&(o.fillStyle="#fff",o.fillRect(0,0,s,n)),"grid"==t){o.beginPath();for(r=15;r<n-15;r+=15)o.moveTo(0,r),o.lineTo(s,r);for(var r=15;r<s-15;r+=15)o.moveTo(r,0),o.lineTo(r,n);o.lineWidth=.8,o.lineJoin="round",o.strokeStyle="#eee",o.stroke()}return Array.forEach(i,function(t,e){o.beginPath(),o.rect(t.x,t.y,t.width,t.height),o.strokeStyle=t.borderColor,o.lineWidth=1,o.stroke(),o.beginPath(),o.fillStyle=t.backgroundColor,o.fillRect(t.x,t.y,t.width,t.height),o.font="normal 12px 微软雅黑",o.textAlign="center",o.textBaseline="middle",o.fillStyle=t.color,o.fillText(t.text,t.x+t.width/2,t.y+t.height/2);var i=t.lines;Array.forEach(i,function(e,i){o.beginPath(),this._paintLine(o,e.points,e.x,e.y),o.lineWidth=1,o.lineJoin="round",o.strokeStyle="#999",o.stroke(),o.beginPath(),this._paintLine(o,e.arrowPoints,e.x,e.y),o.fillStyle="#999",o.fill(),o.font="normal 12px 微软雅黑",o.textAlign="left",o.textBaseline="top",o.fillStyle=t.color,o.fillText(e.text,e.textPos.x+e.x,e.textPos.y+10+e.y)},this)},this),e},_itemDel:function(t,e){this._doRemove(this._selectedItems)},_doRemove:function(t){var e=this.get_events().getHandler("beforeDelete");if(!e)return this.removeItems(t);var i=new _Z_162;return i.data=this.getItemsData(t),e(this,i),!i.get_cancel()&&this.removeItems(t)},locationNext:function(t,e){if(!(t._lines.length<1)){var i=t._lines[0];i.dragResizerEnd();var s=i._nextItem;if(s){var n=t.getBounds(),o=s.getBounds(),r=n.height+this._itemDistanse;e||(r*=-1),s.location(o.x,o.y+r,!0),this.locationNext(s,e)}}},_itemModify:function(t,e){this._selectedItems[0].doModify()},_itemCopy:function(t,e){this._copyItems=this._selectedItems},_itemPaste:function(t,e){this.hideResizer(),Array.forEach(this._copyItems,function(t,e){var i=t.saveData(!0);i.x+=10,i.y+=10,i.notSelected=!0;this.addItem(i).showResizer()},this),delete this._copyItems},_itemAlign:function(t,e){var i=this._selectedItems[0],s=i.getBounds();i._isSelf=!0;var n=t.get_param();if("size"==n)Array.forEach(this._selectedItems,function(t,e){t!=i&&t.setBounds(s.width,s.height)});else if("height"==n)Array.forEach(this._selectedItems,function(t,e){t!=i&&t.setBounds(null,s.height)});else if("width"==n)Array.forEach(this._selectedItems,function(t,e){t!=i&&t.setBounds(s.width,null)});else if("left"==n)Array.forEach(this._selectedItems,function(t,e){t!=i&&t.location(s.x,null,!0)});else if("horzAvg"==n){h=[];Array.addRange(h,this._selectedItems),h.sort(function(t,e){var i=t.getBounds(),s=e.getBounds();return i.x>s.x}),i=h[0];a=h[h.length-1];s=i.getBounds();var o=(l=a.getBounds().x-s.x)/(h.length-1),r=s.x;Array.forEach(h,function(t,e){t!=i&&t!=a&&(r+=o,t.location(r,null,!0))})}else if("right"==n)Array.forEach(this._selectedItems,function(t,e){if(t!=i){var n=t.getBounds(),o=s.x+s.width-n.width;t.location(o,null,!0)}});else if("top"==n)Array.forEach(this._selectedItems,function(t,e){t!=i&&t.location(null,s.y,!0)});else if("vertAvg"==n){var h=[];Array.addRange(h,this._selectedItems),h.sort(function(t,e){var i=t.getBounds(),s=e.getBounds();return i.y>s.y}),i=h[0];var a=h[h.length-1];s=i.getBounds();var l=a.getBounds().y-s.y,o=l/(h.length-1),_=s.y;Array.forEach(h,function(t,e){t!=i&&t!=a&&(_+=o,t.location(null,_,!0))})}else"bottom"==n&&Array.forEach(this._selectedItems,function(t,e){if(t!=i){var n=t.getBounds(),o=s.y+s.height-n.height;t.location(null,o,!0)}});delete i._isSelf},_textAlign:function(t,e){var i=t.get_param();this.textAlign(this._selectedItems,i)},_itemStyle:function(t,e){var i=t.get_param(),s=this._colorPopup();s.set_visible(!0);var n=getClientBounds(),o=s.get_element();$Dom.setLocation(o,n.width/2-150,n.height/2-100),this._styleName=i},_colorPopup:function(){var t=this._colorBlock;if(t)return this._colorBlock;var e=this.get_id(),i=this.get_idPart()+"_colorBlock",s=this.get_form();$createControl(Craba.UI.ColorBlock,{ID:i,Width:300,OnChange:e+"._selectColor",CssClass:"WorkColorPopup",CssStyle:"z-index:"+$app.getPopupElementZIndex()},s).appendTo(document.body),t=this._colorBlock=s[i],this.dragBlock=new Sys.DragBlock({self:!0,cachePos:!1,id:i+"drag",control:t});var n=$common.createDiv();return n.style.cssText="color:#aaa;padding:5px;text-align:center;",n.innerText="双击任意色块或点击空白处可关闭取色器",t.get_element().appendChild(n),$common.addDblClickHandler(t.get_element(),this._selectColor,this),t},_selectColor:function(t){var e=this._colorBlock;t.get_text||e.set_visible(!1),this._curLine?this._curLine.setColor(this._styleName,e.get_text()):this.itemColor(this._selectedItems,this._styleName,e.get_text())},_paintLine:function(t,e,i,s){Array.forEach(e,function(e,n){var o=e.x,r=e.y;i&&(o+=i),s&&(r+=s),0==n?t.moveTo(o,r):t.lineTo(o,r)})},_showGridBg:function(t,e){$Dom.toggleCssClass(this.get_element(),"ShowGrid")},_itemSelected:function(t,e){Array.remove(this._selectedItems,t),e&&Array.add(this._selectedItems,t)},_itemEndDrag:function(t,e){Array.forEach(this._selectedItems,function(t,e){delete t._startPos}),this._hideCrossLine()},_appendDom:function(t){if(!this.fragment)return this.get_element().appendChild(t);this.fragment.appendChild(t)},_dragClass:function(t,e){$Dom.setCssClass(t,this._element,e)},_emitDragMove:function(t,e){},_emitDragEnd:function(t,e){var i={x:t.clientX,y:t.clientY};this._doBeforeAdd(t,i,e,"drag")},_hideCrossLine:function(){$Dom.removeCssClass(this.get_element(),"ShowLine")},_showCrossLine:function(){$Dom.addCssClass(this.get_element(),"ShowLine"),this._crossLineV||(this._crossLineV=this._createLine("CrossLine Vert"),this._crossLineV2=this._createLine("CrossLine Vert"),this._crossLineH=this._createLine("CrossLine Horz"),this._crossLineH2=this._createLine("CrossLine Horz"))},_createLine:function(t){var e=$common.createClassDiv(t);return this.get_element().appendChild(e),e},_moveCrossLine:function(t){if(this._crossLineV){var e=t.getBounds(),i=this.get_element();this._crossLineV.style.left=e.x+"px",this._crossLineV.style.top=i.scrollTop+"px",this._crossLineH.style.top=e.y+"px",this._crossLineH.style.left=i.scrollLeft+"px",this._crossLineV2.style.left=e.x+e.width-1+"px",this._crossLineV2.style.top=i.scrollTop+"px",this._crossLineH2.style.top=e.y+e.height-1+"px",this._crossLineH2.style.left=i.scrollLeft+"px"}},convertPos:function(t,e,i){i=i||this;var s=$Dom.getLocation(i.get_element());return t-=s.x,e-=s.y,{x:t,y:e}},doLineDragEnd:function(t){var e=this.get_events().getHandler("lineDragEnd");if(e){e(this,new _Z_269(t))}},set_mode:function(t){this._mode=t,this.get_isInitialized()&&this.fireEvent()},get_mode:function(){return this._mode},set_dataSource:function(t){this._dataSource=t},get_dataSource:function(){return this._dataSource},get_allowDrop:function(){return this._allowDrop},set_allowDrop:function(){return this._allowDrop},add_itemClick:function(t){this.get_events().addHandler("itemClick",t)},remove_itemClick:function(t){this.get_events().removeHandler("itemClick",t)},add_itemRendering:function(t){this.get_events().addHandler("itemRendering",t)},remove_itemRendering:function(t){this.get_events().removeHandler("itemRendering",t)},add_beforeAdd:function(t){this.get_events().addHandler("beforeAdd",t)},remove_beforeAdd:function(t){this.get_events().removeHandler("beforeAdd",t)},add_lineDragEnd:function(t){this.get_events().addHandler("lineDragEnd",t)},remove_lineDragEnd:function(t){this.get_events().removeHandler("lineDragEnd",t)},add_beforeDelete:function(t){this.get_events().addHandler("beforeDelete",t)},remove_beforeDelete:function(t){this.get_events().removeHandler("beforeDelete",t)},add_beforeModify:function(t){this.get_events().addHandler("beforeModify",t)},remove_beforeModify:function(t){this.get_events().removeHandler("beforeModify",t)},add_saveImage:function(t){this.get_events().addHandler("saveImage",t)},remove_saveImage:function(t){this.get_events().removeHandler("saveImage",t)}},Sys.UI.Controls.Workflow.registerClass("Sys.UI.Controls.Workflow",Sys.UI.Control),_Z_270=function(t){_Z_270.initializeBase(this),this.options=t},_Z_270.prototype={dispose:function(t){this._resizer&&this._resizer.dispose(),this._dragHelper&&this._dragHelper.dispose(),this._element&&$clearHandlers(this._element),t&&$removeNode(this.get_element()),_Z_270.callBaseMethod(this,"dispose")},setPos:function(t,e){var i=this.get_element();null!==t&&(i.style.left=(t>=0?t:2)+"px"),null!==e&&(i.style.top=(e>=0?e:2)+"px")},setColor:function(t,e){this.options[t]=e,this.initStyle(!0)},get_index:function(){return this._index?this._index:this._index=this.get_flow()._buildIndex()},set_flow:function(t){this._flow=t},get_flow:function(){return this._flow},get_element:function(){return this._element},get_textElement:function(){return this.get_element().textNode},get_text:function(){return this.get_textElement().innerHTML},set_text:function(t){var e;if(this._inited&&"item"==this.get_type()&&this.get_flow()._showAddIcon()&&(e=this.getBounds()),this.options.text=t,this.get_textElement().innerHTML=t,e){var i=this.getBounds(),s=i.x+(e.width-i.width)/2;this.setPos(s,e.y)}},set_data:function(t){this.options.data=t},get_data:function(t){return t?Object.clone(this.options.data):this.options.data},getBounds:function(t){var t=t||this.get_element(),e={};return e.width=t.offsetWidth,e.height=t.offsetHeight,e.x=parseInt(t.style.left),e.y=parseInt(t.style.top),e},changeOffset:function(t,e){var i=this.get_element();i.style.left=parseInt(i.style.left)-t+"px",i.style.top=parseInt(i.style.top)-e+"px"},_doMouseMove:function(t){},_doDblClick:function(t){this.doModify()},doModify:function(){var t=this.get_flow(),e=t.get_events().getHandler("beforeModify");if(e){e(t,new _Z_267(this))}},_doSaveItemText:function(t){if(null!==t)return""==t?$common.showError("修改无效，不能输入空值",{dispose:!1}):void(t!=this.get_text()&&this.set_text(t))},doItemRender:function(){var t=this.get_flow().get_events().getHandler("itemRendering");if(t){t(this,new _Z_268(this))}}},_Z_270.registerClass("_Z_270",_Z_242),_Z_271=function(t){this.options=Object.copyTo(t,{text:"新建节点",self:!0,x:20,y:20}),this._lines=[],this._rlines=[],_Z_271.initializeBase(this,[this.options])},_Z_271.prototype={dispose:function(t){Array.forEach(this._lines,function(e,i){e.dispose(t)}),Array.forEach(this._rlines,function(t,e){t._nextItem=null}),this._lines=null,this._rlines=null,_Z_271.callBaseMethod(this,"dispose",[t])},get_type:function(){return"item"},saveData:function(t,e){this.get_element();var i=this.getBounds(),s={},n=this._domStyle(e);return Object.copyTo(i,s),s.type=this.get_type(),s.text=this.get_text(),s.textAlign=this.options.textAlign,s.textVert=this.options.textVert,n.backgroundColor&&(s.backgroundColor=n.backgroundColor),n.borderColor&&(s.borderColor=n.borderColor),n.color&&(s.color=n.color),s.radius=n.radius,s.index=this.get_index(),s.data=this.options.data,s.cssClass=this.options.cssClass,t?Object.clone(s):(s.lines=this.saveLines(),s)},_domStyle:function(t){if(!t)return{backgroundColor:this.options.backgroundColor||"",borderColor:this.options.borderColor||"",color:this.options.color||"",radius:4};var e=$Dom._getCurrentStyle(this.get_element());return{backgroundColor:e.backgroundColor,borderColor:e.borderColor,color:e.color,radius:e.borderRadius}},defaultCssName:function(){return"WorkItem"},paint:function(){if(!this._inited){var t=this.get_flow()._showAddIcon()&&this.options.lines&&this.options.lines.length>0?"HasNext":null,e=$skin.joinCssClass(this.defaultCssName(),this.options.cssClass,t),i=this._element=$common.createClassDiv(e);i.control=this,i._item=this;var s=$common.createClassDiv("ItemText");s.innerHTML=this.options.text,s.control=this,i.textNode=s,i.textNode._item=this,i.appendChild(s),this.initTextAlign(),this.initStyle(),(this.get_flow().get_allowResize()||$dom.hasClass(i,"Group"))&&(this.options.width&&$common.setWidth(i,this.options.width),this.options.height&&$common.setHeight(i,this.options.height)),this.setPos(this.options.x,this.options.y);var n=this.get_flow();n._appendDom(i),this.options.index&&n._addRelation(this),this.drawLines(),n.isBinding()||n.get_mode()!=Sys.WorkMode.design||this.options.notSelected||(n.hideResizer(this),this.showResizer()),this.fireEvent(),this.doItemRender(),this._inited=!0}},fireEvent:function(){if(this.get_flow().get_mode()==Sys.WorkMode.design){if(this._dragHelper)return;if(!this.get_flow().get_allowDrag())return;var t=this.get_element(),e=this._dragHelper=_Z_52.create(t,t);e.add_beforeDrag(this._beforeDrag,this),e.add_startDrag(this._startDrag,this),e.add_moveDrag(this._moveDrag,this),e.add_endDrag(this._endDrag,this)}else this._dragHelper&&(this._dragHelper.dispose(),delete this._dragHelper,this.hideResizer())},locationItem:function(t,e,i){if(i)this._isSelf=!0;else{var s=this.get_flow().convertPos(t,e);t=s.x,e=s.y,delete this._isSelf,this._beforeMoveLine()}this.setPos(t,e),i&&this._beforeMoveLine()},location:function(t,e,i){this.locationItem(t,e,i),this._moveLine()},drawLines:function(){var t=this.options.lines;t&&Array.forEach(t,function(t,e){this.createLine(t)},this)},createLine:function(t,e){t&&(e=t.dot);var i=new _Z_272(this,e);return i.set_flow(this.get_flow()),i.init(t),this.addLine(i),i},setBounds:function(t,e){var i=this.get_element();t&&$common.setWidth(i,t),e&&$common.setHeight(i,e)},textAlign:function(t){"vert"==t?this.options.textVert=!0:"horz"==t?this.options.textVert=!1:this.options.textAlign=t,this.initTextAlign()},initTextAlign:function(){var t=this.get_element();this.options.textVert?t.textNode.style.width="18px":t.textNode.style.width="auto",this.options.textAlign&&(t.style.justifyContent=this.options.textAlign)},initStyle:function(){var t=this.get_element();this.options.backgroundColor&&(t.style.backgroundColor=this.options.backgroundColor),this.options.borderColor&&(t.style.borderColor=this.options.borderColor),this.options.color&&(t.style.color=this.options.color)},addLine:function(t){this._lines.push(t),this.get_flow()._showAddIcon()&&this._checkLineCss(t)},addRLine:function(t,e){this.removeRLine(t),this._rlines.push(t),e&&this.get_flow()._showAddIcon()&&$Dom.addCssClass(this.get_element(),"HasPrev")},removeLine:function(t){if(Array.remove(this._lines,t),this.get_flow()._showAddIcon()){$Dom.setCssClass(this._lines.length>0,this.get_element(),"HasNext");var e=!1,i=!1;Array.forEach(this._lines,function(t,s){"right"==t._startPosType?e=!0:"bottom"==t._startPosType&&(i=!0)},this),$Dom.setCssClass(e,this.get_element(),"HasRight"),$Dom.setCssClass(i,this.get_element(),"HasBottom")}},_checkLineCss:function(t,e){var i="";"right"==t._startPosType?i="HasRight":"bottom"==t._startPosType&&(i="HasBottom"),$Dom.addCssClass(this.get_element(),i)},removeRLine:function(t){Array.remove(this._rlines,t),this.get_flow()._showAddIcon()&&$Dom.setCssClass(this._rlines.length>0,this.get_element(),"HasPrev")},saveLines:function(){var t=[];return Array.forEach(this._lines,function(e,i){t.push(e.saveData())}),t},_beforeDrag:function(t,e){this.get_flow().get_enabled()?e.target._isWorkResizer&&(e.hasCancel=!0):e.hasCancel=!0},_startDrag:function(t){this.get_flow().get_enabled()&&this.get_flow()._showCrossLine()},_moveDrag:function(t,e){this.get_flow().get_enabled()&&(this.location(e.elementPos.x+e.offsetX,e.elementPos.y+e.offsetY),this.isResizer()&&this.get_flow().changeLocation(e.offsetX,e.offsetY,this),e.event.preventDefault())},_moveLine:function(){Array.forEach(this._lines,function(t,e){t.isLock()||t.move()}),Array.forEach(this._rlines,function(t,e){t.move()})},_beforeMoveLine:function(){Array.forEach(this._lines,function(t,e){t.isLock()||t.beforeMove()}),Array.forEach(this._rlines,function(t,e){t.beforeMove(!0)})},_endDrag:function(t){this.get_flow()._itemEndDrag()},_doMouseDown:function(t){this.isResizer()||(t.ctrlKey||this.get_flow().hideResizer(this),this.showResizer())},hideResizer:function(t){this._resizer&&(this._resizer.hide(),!0!==t&&this.get_flow()._itemSelected(this,!1))},isResizer:function(){return!!this._resizer&&this._resizer.isShow()},showResizer:function(){if(this.get_flow().get_enabled()){var t=this._resizer;this._resizer||(t=this._resizer=new _Z_273(this)),this.get_flow()._itemSelected(this,!0),t.show()}},doAddNext:function(t,e,i){var s={x:100,y:100,self:!0},n=this.getBounds(),o=this.get_flow(),r=o._itemDistanse;"right"==e?(s.x=n.x+n.width+r,s.distance=r,s.y=n.y):"bottom"==e&&(s.x=n.x,s.y=n.y+n.height+r,s.distance=r),o._doBeforeAdd(t,s,o,e,this,i)}},_Z_271.registerClass("_Z_271",_Z_270),_Z_272=function(t,e){_Z_272.initializeBase(this),this._item=t,this._startPosType=e,this._nextDot,this._selected=!1,this._lineWidth=1,this._minHeight=20,this._minWidth=20,this._startWidth=20,this._arrowHeight=8,this._startXY=5,this._selectedLineColor="#666",this._defaultLineColor=t.get_flow().get_lineColor(),this._lineColor=this._defaultLineColor,this._arrowType=0,this.points=[],this.arrowPoints=[],this.options={dash:t.get_flow().get_isDash()}},_Z_272.prototype={dispose:function(t){t&&this._nextItem&&this._nextItem.removeRLine(this),_Z_272.callBaseMethod(this,"dispose",[t])},setTop:function(){this.get_element().style.zIndex=4},setBottom:function(){this.get_element().style.zIndex=3},set_item:function(t){this._item=t},get_type:function(){return"line"},set_text:function(t){_Z_272.callBaseMethod(this,"set_text",[t]);var e=this.get_textElement();$Dom.setCssClass(!t,e,"dnone")},defaultCssName:function(){return"WorkLine"},saveData:function(t){this.get_element();var e=this.getBounds(),i={};return Object.copyTo(e,i),i.type=this.get_type(),i.text=this.get_text(),i.dot=this._startPosType,i.points=this.points,i.arrowPoints=this.arrowPoints,i.textPos=this.getTextPos(),i.data=this.options.data,i.index=this.get_index(),i.lineColor=this.options.lineColor,i.cssClass=this.options.cssClass,i.arrowType=this.options.arrowType,i.textX=parseInt(this.get_textElement().style.left),i.textY=parseInt(this.get_textElement().style.top),i.next=this.get_nextItem()?this.get_nextItem().get_index():null,i.dash=this.options.dash,t?Object.clone(i):i},initStyle:function(t){var e=this.get_textElement();this.options.backgroundColor&&(e.style.backgroundColor=this.options.backgroundColor),this.options.borderColor&&(e.style.borderColor=this.options.borderColor),this.options.color&&(e.style.color=this.options.color),this.options.lineColor&&(this._lineColor=this._defaultLineColor=this.options.lineColor),this.options.arrowType&&(this._arrowType=this.options.arrowType),t&&this.paint(this.getBounds())},getTextPos:function(){var t={};return t.x=parseInt(this.get_textElement().style.left),t.y=parseInt(this.get_textElement().style.top),t},init:function(t){if(!this._inited){var e=$skin.joinCssClass(this.defaultCssName(),this.options.cssClass),i=this._element=$common.createClassDiv(e);i.unselectable="on";var s=this._line=document.createElement("canvas");s.className="Line",i.appendChild(s),s._item=this;var n=i.textNode=$common.createClassDiv("Text dnone");n._item=this,i.appendChild(n),this.ctx=s.getContext("2d"),this.get_flow()._appendDom(i),this.initStartPos(),this.renderByOptions(t),this.doItemRender(),this._inited=!0}},renderByOptions:function(t){if(t){t.cssClass&&$Dom.addCssClass(this.get_element(),t.cssClass),this.options=t,this.points=t.points,this.arrowPoints=t.arrowPoints,this._startWidth=this._calcStartWidth();var e={};e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this.initStyle(),this.set_text(t.text),this.set_width(e.width),this.set_height(e.height),this.paint(e),t.next&&this.get_flow()._addRelation(null,this)}else this.options={}},_doDblClick:function(t){var e=this._cursor;e&&"inherit"!=e&&this.get_flow().get_allowDrag()&&this.doModify()},_doMouseDown:function(t){var e=this.get_flow();this.set_selected(this._cursor&&"inherit"!=this._cursor&&!e._showAddIcon()),this._spliting=!1,this._draging=!1,this._textDraging=!1,"grab"==this._cursor?(this._textDraging=!0,e.eventTarget=this,this.initTextPos(t)):"move"==this._cursor?(this._draging=!0,e.get_element().style.cursor="move",this.initStartPos(),e.eventTarget=this):"ew-resize"!=this._cursor&&"ns-resize"!=this._cursor||(this._spliting=!0,this._splitValue=this._isVert()?t.clientY:t.clientX,e.eventTarget=this),e.hideResizer()},_isVert:function(){return"top"==this._startPosType||"bottom"==this._startPosType},_doMouseMove:function(t){if(this._spliting){this._splitingOk=!0;var e=this.getBounds();if("bottom"==this._startPosType){i=t.clientY-this._splitValue;i=this._startWidth+i,i=Math.max(15,i),i=Math.min(e.height-15,i),this.points[1].y=i,this.points[2].y=i}else if("right"==this._startPosType){i=t.clientX-this._splitValue;i=this._startWidth+i,i=Math.max(15,i),i=Math.min(e.width-15,i),this.points[1].x=i,this.points[2].x=i}else if("top"==this._startPosType){i=t.clientY-this._splitValue;i=e.height-this._startWidth+i,i=Math.max(15,i),i=Math.min(e.height-15,i),this.points[1].y=i,this.points[2].y=i}else if("left"==this._startPosType){var i=t.clientX-this._splitValue;i=e.width-this._startWidth+i,i=Math.max(15,i),i=Math.min(e.width-15,i),this.points[1].x=i,this.points[2].x=i}this.paint(e)}else if(this._draging){!this._startDrag&&this._nextItem&&(this._startDrag=!0,this._nextItem.removeRLine(this),delete this._nextItem);var s=this.get_flow().convertPos(t.clientX,t.clientY);this.repaint(this._startPos,s)}else{if(this._textDraging){var n=t.clientX-this._startTextPos.x,o=t.clientY-this._startTextPos.y,r=this._startTextPos.bounds.x+n,h=this._startTextPos.bounds.y+o;return this.options.textX=r,this.options.textY=h,void this.locationText(this.options.textX,this.options.textY)}this._timer&&(clearTimeout(this._timer),this._timer=null);var a={x:t.offsetX,y:t.offsetY},l=this;this._timer=setTimeout(function(){l._checkMouseLine(a,t)||l.get_flow()._checkMouseLine(t.clientX,t.clientY,t)},50)}},_checkMouseLine:function(t,e){var i="inherit",s={};return this._checkMouseInText(e)?i="grab":this._checkMouseInArrow(t)?i="move":(e&&e.target==this.get_textElement()||this._checkMouseInLine(t,s))&&(i=s.split?this._isVert()?"ns-resize":"ew-resize":"pointer"),this._cursor=i,this.get_element().style.cursor=i,"inherit"!=i},_calcStartWidth:function(){return this._isVert()?Math.abs(this.points[0].y-this.points[1].y):Math.abs(this.points[0].x-this.points[1].x)},_doMouseUp:function(t){delete this.get_flow().eventTarget,this._spliting&&(delete this._spliting,this._splitingOk&&(delete this._splitingOk,this._startWidth=this._calcStartWidth())),this._textDraging&&(this._textDraging=!1,this.get_flow().get_element().style.cursor=""),this._draging&&(this.get_flow().get_element().style.cursor="",this._draging=!1,this.dragResizerEnd())},set_selected:function(t){var e=this.get_flow()._curLine;e&&e!=this&&e.set_selected(!1),t!=this._selected&&(this._selected=t,t?(this._lineColor=this._selectedLineColor,this.get_flow()._curLine=this):(this._lineColor=this._defaultLineColor,delete this.get_flow()._curLine),this.paint(this.getBounds()))},_checkMouseInText:function(t){return t.target==this.get_textElement()},_checkMouseInArrow:function(t){var e=this.arrowPoints[0],i=this.arrowPoints[1],s=this.arrowPoints[2],n=(i.y-s.y)*(e.x-s.x)+(s.x-i.x)*(e.y-s.y),o=((i.y-s.y)*(t.x-s.x)+(s.x-i.x)*(t.y-s.y))/n,r=((s.y-e.y)*(t.x-s.x)+(e.x-s.x)*(t.y-s.y))/n,h=1-o-r;return o>=0&&o<=1&&r>=0&&r<=1&&h>=0&&h<=1},_checkMouseInLine:function(t,e){for(var i=!1,s=0,n=this.points.length;s+1<n;s++){var o=this.points[s],r=this.points[s+1],h=Math.abs(o.y-r.y),a=Math.abs(o.x-r.x),l=Math.abs(t.y-r.y),_=Math.abs(t.x-r.x);if(_<=a&&l<=h||_<=a+4&&l<=h+4){i=!0;break}}return 1==s&&i&&(e.split=!0),i},set_width:function(t){$common.setWidth(this._element,t),this._line.width=t},set_height:function(t){$common.setHeight(this._element,t),this._line.height=t},initTextPos:function(t){var e=this.getBounds(this.get_textElement());this._startTextPos={x:t.clientX,y:t.clientY,bounds:e}},initStartPos:function(){var t=this.get_item().getBounds(),e=t.x,i=t.y;this._startPos={left:e,top:i},"top"==this._startPosType?e+=t.width/2-this._lineWidth:"right"==this._startPosType?(e+=t.width,i+=t.height/2-this._lineWidth):"bottom"==this._startPosType?(e+=t.width/2-this._lineWidth,i+=t.height):i+=t.height/2-this._lineWidth,this._startPos.x=e,this._startPos.y=i,this._itemHeight=t.height,this._itemWidth=t.width},dragResizerEnd:function(){this.get_flow().doLineDragEnd(this),this.get_flow()._showAddIcon()&&$Dom.addCssClass(this.get_item().get_element(),"HasNext"),this._nextItem&&(this.get_flow()._showAddIcon()&&$Dom.setCssClass(this._nextItem._rlines.length>0,this._nextItem.get_element(),"HasPrev"),this.beforeMove(!0),this.move())},isLock:function(){return this._nextItem&&this._nextItem.isResizer()&&this.get_item().isResizer()&&!this._nextItem._isSelf&&!this.get_item()._isSelf},move:function(){if(this.isLock())return this.moveLocation();this.initStartPos(),this.repaint(this._startPos,this._lastPos,!0)},moveLocation:function(){var t=this.getBounds(),e=this.get_nextItem().getBounds(),i=e.x-(this._lastPos.x0!==undefined?this._lastPos.x0:this._lastPos.x),s=e.y-(this._lastPos.y0!==undefined?this._lastPos.y0:this._lastPos.y);this.location(t.x+i,t.y+s)},beforeMove:function(t){if(t||this._nextItem){var e=this.get_nextItem().getBounds();"right"==this._startPosType?this._lastPos={x:e.x,y:e.y+e.height/2+this._arrowHeight/2*(this._startPos.y>e.y?-2:1),x0:e.x,y0:e.y}:"bottom"==this._startPosType?this._lastPos={x:e.x+e.width/2-this._lineWidth,y:e.y,x0:e.x,y0:e.y}:"left"==this._startPosType?this._lastPos={x:e.x+e.width,y:e.y+e.height/2+this._arrowHeight/2*(this._startPos.y>e.y?-2:1),x0:e.x,y0:e.y}:"top"==this._startPosType&&(this._lastPos={x:e.x+e.width/2-this._lineWidth,y:e.y+e.height,x0:e.x,y0:e.y})}else this._lastPos||this.initLastPos()},initLastPos:function(){this.initStartPos();var t=this._startPos,e=this.getBounds(),i={},s=e.x+e.width;t.x<s?i.x=s:i.x=e.x;var n=e.y+e.height;t.y+2*this._lineWidth>=n?i.y=e.y:i.y=n,this._lastPos=i},get_item:function(){return this._item},get_nextItem:function(){return this._nextItem},_searchNext:function(t){var e=this._getEventItem();if(!e)return this._nextItem&&this._nextItem.removeRLine(this),this._nextItem=null;this._nextItem=e,e.addRLine(this)},_getEventItem:function(){for(var t=null,e=window.event.target;e&&"BODY"!=e.tagName;){if(e.control&&$Dom.hasClass(e,"WorkItem")){t=e.control;break}e=e.parentNode}return t},repaint:function(t,e,i){this.points=[],this.arrowPoints=[],i||this._searchNext(e);var s;"right"==this._startPosType?s=this._caclRight(t,e):"bottom"==this._startPosType?s=this._caclBottom(t,e):"left"==this._startPosType?s=this._caclLeft(t,e):"top"==this._startPosType&&(s=this._caclTop(t,e)),s&&(this.calcArrow(s),this.paint(s))},_caclRight:function(t,e){var i=this._startWidth,s=this._startXY,n=this._lineWidth,o=this._arrowHeight,r=Math.max(this._minHeight,Math.abs(t.x-e.x)),h=Math.max(this._minHeight,Math.abs(t.y-e.y));i>r&&(i=this._startWidth=this._minWidth);var a,l,_,c,d,m,g,u,f,y,p=t.y>e.y,x=t.x+i>e.x,v=this._startPos.x,C=this._startPos.y;if(!x&&h<=this._minHeight)h=this._minHeight,C=C-o+this._lineWidth,a=i,l=n=o,_=r-o,c=n;else if(x&&p){if(r+=i,s=r-i+s,n=h-this._lineWidth,a=r-this._lineWidth,l=n,_=a,c=o/2,h<this._itemHeight/2+i){w=h;n=(h=Math.max(h,this._itemHeight/2+i))-this._lineWidth,l=h-this._lineWidth,u=c,f=g=Math.max(0,_-this._itemWidth-2*i),d=o,m=y=h-w+o/2,C=C-h+2*this._lineWidth}else d=o,m=o/2,C=C-h+2*this._lineWidth;v-=s}else if(x&&!p)if(r+=i,s=r-i+s,v-=s,a=r-this._lineWidth,l=this._lineWidth,_=a,c=h-o/2,h<this._itemHeight/2+i){var w=h;c=this._itemHeight/2+i-this._lineWidth,h=Math.max(h,this._itemHeight/2+i),u=c,f=g=Math.max(0,_-this._itemWidth-2*i),d=o,m=y=w-o/2}else d=o,m=h-o/2;else p&&!x?(n=h-this._lineWidth,C=C-h+2*this._lineWidth,a=i,l=n,_=i,c=o/2,d=r-o,m=o/2):(a=i,l=this._lineWidth,_=a,c=h-o/2,d=r-o,m=h-o/2);this.set_width(r),this.set_height(h),this.points.push({x:s,y:n}),this.points.push({x:a,y:l}),this.points.push({x:_,y:c}),null!=g&&this.points.push({x:g,y:u}),null!=f&&this.points.push({x:f,y:y}),null!=d&&this.points.push({x:d,y:m});return{x:v,y:C,width:r,height:h}},_caclBottom:function(t,e){var i,s,n,o,r,h,a,l,_,c,d=this._startWidth,m=this._lineWidth,g=this._startXY,u=this._arrowHeight,f=Math.max(this._minHeight,Math.abs(t.x-e.x)),y=Math.max(this._minHeight,Math.abs(t.y-e.y)),p=t.y>e.y,x=t.x>e.x,v=this._startPos.x,C=this._startPos.y;if(!p&&f<=this._minHeight)f=this._minHeight,v=v-u+this._lineWidth,i=m=u,s=d,n=m,o=y-u;else if(x&&p){if(g=y-u-this._lineWidth,s=g+u,n=u,o=s,f<this._itemWidth/2+d){w=f;i=m=(f=Math.max(f,this._itemWidth/2+d))-this._lineWidth,a=n,c=l=Math.max(0,o-this._itemHeight-2*d),r=_=f-w+u/2,h=u}else i=m=f-this._lineWidth,r=u,h=u/2;v=v-m+this._lineWidth,C=C-y+u+this._lineWidth}else if(x&&!p)m=(f+=u/2+this._lineWidth)-this._lineWidth,v=v-f+2*this._lineWidth-.5,i=m,o=s=d,r=n=u/2,h=y-u;else if(p&&!x){if(m=this._lineWidth,g=y-u-this._lineWidth,i=m,s=g+u,o=s,f<this._itemWidth/2+d){var w=f;a=n=(f=Math.max(f,this._itemWidth/2+d))-u/2,c=l=Math.max(0,o-this._itemHeight-2*d),r=_=w-u/2,h=u}else r=n=f-u/2,h=u/2;C=C-y+u+this._lineWidth}else i=m,o=s=d,r=n=(f+=u/2+this._lineWidth)-u/2,h=y-u;this.set_width(f),this.set_height(y),this.points.push({x:m,y:g}),this.points.push({x:i,y:s}),this.points.push({x:n,y:o}),null!=a&&this.points.push({x:a,y:l}),null!=_&&this.points.push({x:_,y:c}),null!=r&&this.points.push({x:r,y:h});var I={x:v,y:C,width:f,height:y};return console.log(I),I},_caclLeft:function(t,e){var i,s,n,o,r,h,a,l,_,c,d=this._startWidth,m=this._lineWidth,g=this._arrowHeight,u=Math.max(this._minHeight,Math.abs(t.x-e.x)),f=Math.max(this._minHeight,Math.abs(t.y-e.y)),y=u,p=t.y>e.y,x=t.x>e.x,v=this._startPos.x-u,C=this._startPos.y-f;if(x&&f<=this._minHeight)f=this._minHeight,C=C+g+this._lineWidth,i=u-d,s=m=g,n=g,o=m;else if(x&&p)m=f-this._lineWidth,C+=2*this._lineWidth,s=m,n=i=u-d,o=g/2,r=g,h=g/2;else if(x||p)if(p&&!x){if(u+=d,v=v+u-2*d,y=d,i=this._lineWidth,n=i,o=g/2,f<this._itemHeight/2+d){w=f;C+=f,C-=f=Math.max(f,this._itemHeight/2+d),l=o,_=a=Math.min(u-g/2,n+this._itemWidth+2*d),r=u-g,h=c=f-w+g/2}else r=u-g,h=g/2;s=m=f-this._lineWidth,C+=2*this._lineWidth}else C+=f,i=u-d,s=this._lineWidth,n=i,r=g,h=o=f-g/2;else if(u+=d,y=d,v=v+u-2*d,C+=f,i=this._lineWidth,s=m,n=i,o=f-g/2,f<this._itemHeight/2+d){var w=f;o=this._itemHeight/2+d-this._lineWidth,f=Math.max(f,this._itemHeight/2+d),l=o,_=a=Math.min(u-g/2,n+this._itemWidth+2*d),r=u-g,h=c=w-g/2}else r=u-g,h=f-g/2;this.set_width(u),this.set_height(f),this.points.push({x:y,y:m}),this.points.push({x:i,y:s}),this.points.push({x:n,y:o}),null!=a&&this.points.push({x:a,y:l}),null!=_&&this.points.push({x:_,y:c}),null!=r&&this.points.push({x:r,y:h});return{x:v,y:C,width:u,height:f}},_caclTop:function(t,e){var i,s,n,o,r,h,a,l,_,c,d=this._startWidth,m=this._lineWidth,g=this._arrowHeight,u=Math.max(this._minHeight,Math.abs(t.x-e.x)),f=Math.max(this._minHeight,Math.abs(t.y-e.y)),y=f,p=t.y>e.y,x=t.x>e.x,v=this._startPos.x,C=this._startPos.y-f;if(p&&u<=this._minHeight)u=this._minHeight,v=v-g+this._lineWidth,i=m=g,s=d,n=m,o=0;else if(x||p)if(x&&p)v=v-(u+=g/2)+2*this._lineWidth,i=m=u-this._lineWidth,o=s=f-d,r=n=g/2,h=0;else if(!p&&x){if(m=u-this._lineWidth,y=d,i=m,s=this._lineWidth,o=s,u<this._itemWidth/2+d){w=u;u=Math.max(u,this._itemWidth/2+d),a=n=g/2,c=l=o+this._itemHeight+2*d,r=_=w-g/2,h=f-g}else r=n=g/2,h=f-g;v=v-m+this._lineWidth,C=C+f-d-this._lineWidth}else i=m,o=s=f-d,r=n=(u+=g/2)-g/2,h=0;else{if(y=d,m=this._lineWidth,i=m,s=this._lineWidth,o=s,h=f-g,u<this._itemWidth/2+d){var w=u;a=n=(u=Math.max(u,this._itemWidth/2+d))-g,c=l=Math.min(f,o+this._itemHeight+2*d),r=_=g/2}else r=n=u-g/2;v=v-m+this._lineWidth,C=C+f-d-this._lineWidth}this.set_width(u),this.set_height(f),this.points.push({x:m,y:y}),this.points.push({x:i,y:s}),this.points.push({x:n,y:o}),null!=a&&this.points.push({x:a,y:l}),null!=_&&this.points.push({x:_,y:c}),null!=r&&this.points.push({x:r,y:h});var I={x:v,y:C,width:u,height:f};return console.log(I),I},calcArrow:function(t){var e,i,s,n,o,r,h=this.points[0],a=this.points[this.points.length-1],l=this._arrowHeight,_=l/2,c=8;"bottom"==this._startPosType||"top"==this._startPosType?(h.y>a.y&&(c*=-1),e=a.x-_,i=a.y-c,h.y>a.y?(n=a.y-l-c,t.top-=l):n=a.y+l-c,s=a.x,o=a.x+_,r=i):"right"!=this._startPosType&&"left"!=this._startPosType||(h.x>a.x&&(c*=-1),e=a.x-c,i=a.y-_,s=h.x>a.x?a.x-l-c:a.x+l-c,n=a.y,o=e,r=a.y+_),this.arrowPoints.push({x:e,y:i}),this.arrowPoints.push({x:s,y:n}),this.arrowPoints.push({x:o,y:r})},location:function(t,e){this.setPos(t,e)},paint:function(t){this.location(t.x,t.y),this.paintText();var e=this.ctx;if(e.clearRect(0,0,t.width,t.height),e.closePath(),e.beginPath(),this.get_flow()._paintLine(e,this.points),this.options.dash&&e.setLineDash([8,8]),e.lineWidth=this._lineWidth,e.lineJoin="round",e.strokeStyle=this._lineColor,e.stroke(),e.beginPath(),e.setLineDash([]),1==this._arrowType)this.get_flow()._paintLine(e,this.arrowPoints),e.lineWidth=this._lineWidth,e.strokeStyle=this._lineColor,e.stroke();else if(2==this._arrowType){var i=this.arrowPoints[1].x-3,s=this.arrowPoints[1].y;e.arc(i,s,3,0,2*Math.PI),e.lineWidth=this._lineWidth,e.strokeStyle=this._lineColor,e.stroke(),e.beginPath(),e.arc(i,s,2,0,2*Math.PI),e.fillStyle="#fff",e.fill()}else this.get_flow()._paintLine(e,this.arrowPoints),e.fillStyle=this._lineColor,e.fill()},paintText:function(){if(Object.isUndefinedOrNull(this.options.textX)){var t=this.points[0],e=this.points[1],i=this.points[2],s=e.x,n=i.y,o=(this._lineWidth,this.get_textElement());s=t.x<i.x?t.y==i.y?e.x:i.x:i.x-o.offsetWidth,n=i.y-o.offsetHeight,this.locationText(s,n)}else this.locationText(this.options.textX,this.options.textY)},locationText:function(t,e){this.get_textElement().style.left=t+"px",this.get_textElement().style.top=e+"px"}},_Z_272.registerClass("_Z_272",_Z_270),_Z_273=function(t){_Z_273.initializeBase(this),this._item=t,this._draging=!1,this._minWidth=30,this._minHeight=20,this.initialize()},_Z_273.prototype={initialize:function(){_Z_273.callBaseMethod(this,"initialize"),this.createResizer()},dispose:function(){this._element&&$clearHandlers(this._element),_Z_273.callBaseMethod(this,"dispose")},get_element:function(){return this._element},get_item:function(){return this._item},get_flow:function(){return this.get_item().get_flow()},createResizer:function(){this._frag=$common.createFragment(),this._createDot("FLeftTop FResizer DotResizer","nw-resize"),this._createDot("FRightTop FResizer DotResizer","ne-resize"),this._createDot("FLeftBottom FResizer DotResizer","sw-resize"),this._createDot("FRightBottom FResizer DotResizer","se-resize"),this._createDot("FLeft FResizer LineResizer","crosshair","left"),this._createDot("FRight FResizer LineResizer","crosshair","right"),this._createDot("FTop FResizer LineResizer","crosshair","top"),this._createDot("FBottom FResizer LineResizer","crosshair","bottom"),this.get_flow()._showAddIcon()&&(this._createDot("Add bottom aicon-add","pointer","bottom","新增竖直方向的下级",!0),this._createDot("Add del aicon-shanchu6","pointer","del","删除下级",!0));var t=this._element=$common.createClassDiv("WorkResizer");t._item=this,t.appendChild(this._frag),this.get_item().get_element().appendChild(t)},_createDot:function(t,e,i,s,n){var o=$common.createClassDiv(t);return o._isWorkResizer=!0,o.style.cursor=e,s&&(o.title=s),o.type=i,o._item=this,o.noclick=n,this._frag.appendChild(o),o},show:function(){$Dom.setVisible(this._element,!0)},hide:function(){$Dom.setVisible(this._element,!1)},isShow:function(){return $Dom.getVisible(this._element)},toggle:function(){this.isShow()?this.hide():this.show()},_doMouseDown:function(t){var e=t.target;if(e._isWorkResizer){this.get_flow().eventTarget=this,this._curResizer=e;"pointer"!=e.style.cursor&&(this._draging=!0,this._startPos={x:t.clientX,y:t.clientY},this._startSize=$Dom.getBounds(this.get_item().get_element()))}},_doMouseMove:function(t){if(this._draging&&!this.get_isDisposed()){var e={x:t.clientX,y:t.clientY};if(!(Math.abs(e.x-this._startPos.x)<5&&Math.abs(e.y-this._startPos.y)<5)){var i=this._curResizer.style.cursor;if("crosshair"==i)return this._curLine||(this._curLine=this.get_item().createLine(null,this._curResizer.type)),this._doPaintLine(this._startPos,e);var s=e.x-this._startPos.x,n=e.y-this._startPos.y,o=this._startSize.x-1,r=this._startSize.y-1;"nw-resize"==i?(o=s+o,r=n+r,s*=-1,n*=-1):"sw-resize"==i?(o=s+o,s*=-1):"ne-resize"==i&&(r=n+r,n*=-1),s=this._startSize.width+s,n=this._startSize.height+n,s=Math.max(s,this._minWidth),n=Math.max(n,this._minHeight);var h=this.get_item().get_element();$common.setWidth(h,s),$common.setHeight(h,n),this.get_item().location(o,r)}}},_doMouseUp:function(t){this.get_isDisposed()||(this._draging=!1,"pointer"!=this._curResizer.style.cursor?this._curLine&&(this._curLine.dragResizerEnd(),delete this._curLine):this._doButtonClick(t))},_doButtonClick:function(t){var e=this._curResizer.type;if("del"!=e){var i=this.get_item(),s=i.getBounds(),n=s.x+s.width/2,o=s.y+s.height/2,r=this.get_flow();i.doAddNext(t,e,function(t){var s;i._lines.length>0&&(s=i._lines.pop(),t.addLine(s),s.set_item(t),s.dragResizerEnd());var h=i.createLine(null,e);h._nextItem=t,t.addRLine(h),h.dragResizerEnd();var a=i.getBounds(),l=t.getBounds(),_=a.x,c=a.y,d=l.x,m=l.y;"right"==e?(c=o-a.height/2,m=o-l.height/2,d=a.x+a.width+t.options.distance):"bottom"==e&&(_=n-a.width/2,d=n-l.width/2,m=a.y+a.height+t.options.distance),i.location(_,c,!0),t.location(d,m,!0),r.locationNext(t,!0)})}else this.get_flow()._doRemove([this.get_item()])},_doPaintLine:function(t,e){this._curLine.repaint(t,e)},_doDblClick:function(t){this.get_item()._doDblClick(t)}},_Z_273.registerClass("_Z_273",_Z_242);﻿Type.registerNamespace("Sys.Dress"),Sys.Dress.DressDisplayMode=function(){throw Error.notImplemented()},Sys.Dress.DressDisplayMode.prototype={master:0,standard:1,detail:2},Sys.Dress.DressDisplayMode.registerEnum("Sys.Dress.DressDisplayMode"),Sys.Dress.StandardSizeSortEventArgs=function(e){Sys.Dress.StandardSizeSortEventArgs.initializeBase(this),this._sizes=e},Sys.Dress.StandardSizeSortEventArgs.prototype={get_sizes:function(){return this._sizes},set_sizes:function(e){this._sizes=e}},Sys.Dress.StandardSizeSortEventArgs.registerClass("Sys.Dress.StandardSizeSortEventArgs",Sys.EventArgs),Sys.Dress.MergeEventArgs=function(){Sys.Dress.MergeEventArgs.initializeBase(this),this._mergeFields=[]},Sys.Dress.MergeEventArgs.prototype={get_mergeFields:function(){return this._mergeFields},add_mergeField:function(e){e&&Array.add(this._mergeFields,e)}},Sys.Dress.MergeEventArgs.registerClass("Sys.Dress.MergeEventArgs",Sys.EventArgs),Sys.Dress.MergingEventArgs=function(e,t){Sys.Dress.MergingEventArgs.initializeBase(this),this._mergedRowData=e,this._items=t},Sys.Dress.MergingEventArgs.prototype={get_mergedRowData:function(){return this._mergedRowData},get_items:function(){return this._items}},Sys.Dress.MergingEventArgs.registerClass("Sys.Dress.MergingEventArgs",Sys.EventArgs),Sys.UI.Controls.FzDressGrid=function(e){Sys.UI.Controls.FzDressGrid.initializeBase(this,[e]),this._qtyExpandName="qtyExpand",this._displayMode=Sys.Dress.DressDisplayMode.detail,this._maxSizeCount=0,this._sizeInfoListCache={},this._isDress=!0,this._isTree=!1,this._modeReadOnly={0:!0},this._gridSetting={PtypeIdField:"ptypeid",SizeIdField:"sizeid",SizeNameField:"sizename",ColorIdField:"colorid",ColorNameField:"colorname",SizeGroupFieId:"sizegroup",QtyField:"qty",PriceField:"price",TotalField:"total"}},Sys.UI.Controls.FzDressGrid.prototype={initialize:function(){Sys.UI.Controls.FzDressGrid.callBaseMethod(this,"initialize")},dispose:function(){Sys.UI.Controls.FzDressGrid.callBaseMethod(this,"dispose")},_refreshDisplay:function(e){if(this._lastDisplayMode=this._displayMode,this._displayMode=e,this.get_isInitialized()){this._displayModeChanged=!0;var t=this.findPager();if(t){this.clearSortFlag(),this._doExpandColumn();var i={};i.Command="UpdateMode",i.Data=e,t._internalRefreshState(i)}else this._refreshExpand();this._displayModeChanged=!1}},_doExpandData:function(){this._doInitSizeCache();var e=this._doExpandDataSource();this._saveDataSource(e,!0)},_doExpandColumn:function(){this._gridSetting&&(this._displayMode==Sys.Dress.DressDisplayMode.master?(this.set_maxHeaderLevel(1),this._showSizeColorColumn(!1)):this._displayMode==Sys.Dress.DressDisplayMode.standard?(this.set_maxHeaderLevel(2),this._showSizeColorColumn(!0),this._doStandardColumn()):(this.set_maxHeaderLevel(1),this._showSizeColorColumn(!0)))},_refreshExpand:function(){this.clearSortFlag(),this._doExpandData(),this._doExpandColumn(),this.dataChanged()},_showStandardColumn:function(e){var t=this._header,i=$common.getTableBody(t),s=$common.getChildrenByTagName(i,"tr")[1];if(s&&(s.style.height=e?"":"0px",this._standardTdBand)){this._standardTdBand.style.display=e?"":"none";var a=this._standardTdBand.expandColumn,r=a.expanded,n=this.get_realMaxSizeCount()-r.length;if(n>0){for(o=r.length;n>0;n--){var d=this._addNewColumn(a,o,"",this._getExpandFieldName(o),o+"");d._isExpandNew=!0,r[o]=d,o++}this._set_standardTdBandWidth(r.length)}for(var o=0,h=r.length;o<h;o++){var l=r[o];l.set_visible(e),e&&h+n<=o&&l.set_visible(!1)}this._set_standardTdBandWidth(Math.min(h,h+n))}},_set_standardTdBandWidth:function(e){var t=65*e;this._standardTdBand.style.width=t+"px";try{this._standardTdBand.colSpan=e}catch(i){}},_doInitSizeCache:function(){if(this._lastDisplayMode==Sys.Dress.DressDisplayMode.detail||this.get_displayMode()==Sys.Dress.DressDisplayMode.standard){var e=this._getSizeData();this._sizeInfoListCache={};for(var t=e?e.length:0,i=0;i<t;i++){var s=e[i];if(s[this._gridSetting.SizeNameField]){var a=s[this._gridSetting.PtypeIdField],r=s[this._gridSetting.SizeNameField],n=s[this._gridSetting.SizeIdField];this._sizeInfoListCache[a]||(this._sizeInfoListCache[a]=[]),Array.contains(this._sizeInfoListCache[a],r)||Array.add(this._sizeInfoListCache[a],r),this._sizeIdCache||(this._sizeIdCache={}),this._sizeIdCache[r]||(this._sizeIdCache[r]=n)}}this._doSizeSortEvent()}},_doExpandDataSource:function(){if(!this._gridSetting)return[];if(this._displayMode==Sys.Dress.DressDisplayMode.master)return this._doMasterData();if(this._displayMode==Sys.Dress.DressDisplayMode.standard)return this._doStandardData();var e=this.getDetails();return e||(e=[]),this._doMergingEvent("detailMerging",e,[]),e},_changeColumnCaption:function(){if(this._displayMode==Sys.Dress.DressDisplayMode.standard&&this._standardTdBand){var e=this._dataCache;if(e&&0!=e.length){var t=this.get_selectedRowData(),i=(t=t||e[0])[this._gridSetting.PtypeIdField],s=this._getSizeCacheById(i);if(s){for(var a=s.length,r=this._standardTdBand.expandColumn.expanded,n=r.length,d=0;d<a&&d<n;d++){(o=r[d]).set_caption(s[d])}for(d=a;d<n;d++){var o=r[d];o.set_caption(" ")}}}}},_getPtypeId:function(e,t,i){var s=e;return Array.forEach(t,function(e,t){s+="_"+i[e]}),s},_doStandardData:function(){for(var e=this.getDetails(),t=Object.clone(e),i=[],s=[],a=[],r=this._doMergeEvent("standardMerge"),n=0,d=t.length;n<d;n++){var o=t[n],h=o[this._gridSetting.PtypeIdField]+"_"+o[this._gridSetting.ColorIdField],l=this._getPtypeId(h,r,o);if(Array.contains(s,l)){var g=Array.indexOf(s,l);Array.add(a[g],o)}else{var _=[];Array.add(_,o),Array.add(a,_),Array.add(s,l),i.push(o)}}return Array.forEach(i,function(e,t){var i=e[this._gridSetting.PtypeIdField],s=this._getSizeCacheById(i);if(s){var r=a[t];e.temp_qty=0,Array.forEach(s,function(t,i){var s=0;Array.forEach(r,function(e){if(e[this._gridSetting.SizeNameField]==t){var i=e[this._gridSetting.QtyField];i&&(s+=i)}},this),0!==s&&(e[this._getExpandFieldName(i)]=s),e.temp_qty+=s},this),e[this._gridSetting.QtyField]=e.temp_qty,delete e.temp_qty,this._validateNumberColumnData(e)}},this),this._doMergingEvent("standardMerging",i,a),i},_doMasterData:function(){for(var e=this.getDetails(),t=Object.clone(e),i=[],s=[],a=[],r=this._doMergeEvent("masterMerge"),n=0,d=t.length;n<d;n++){var o=t[n],h=o[this._gridSetting.PtypeIdField],l=this._getPtypeId(h,r,o);if(Array.contains(s,l)){var g=Array.indexOf(s,l);Array.add(a[g],o)}else{var _=[];Array.add(_,o),Array.add(a,_),Array.add(s,l),i.push(o)}}return Array.forEach(i,function(e,t){var i=0,s=a[t];Array.forEach(s,function(e){var t=e[this._gridSetting.QtyField];t&&(i+=t)},this),e[this._gridSetting.QtyField]=i},this),this._doMergingEvent("masterMerging",i,a),i},_gridSaveData:function(e){return this._dataBinding?this._dataCache:this.get_dataController().save()},_getSizeData:function(){if(!this.get_isInitialized())return[];var e=this._gridSaveData();if(e=e||[],!this._displayModeChanged&&this._displayMode==Sys.Dress.DressDisplayMode.standard){for(var t=[],i=0,s=e.length;i<s;i++){var a=e[i],r=a[this._gridSetting.PtypeIdField];a[this._gridSetting.SizeNameField],a[this._gridSetting.SizeIdField];if(this._sizeInfoListCache[r])for(var n=this._sizeInfoListCache[r],d=0,o=n.length;d<o;d++){var h=Object.clone(a);if(t.push(h),"undefined"==typeof a[this._getExpandFieldName(d)])break;h[this._gridSetting.SizeNameField]=n[d],h[this._gridSetting.SizeIdField]=this._getSizeIdByName(n[d])}else t.push(Object.clone(e[i]))}return t}return this._lastDisplayMode==Sys.Dress.DressDisplayMode.master&&(e=this.getDetails()),e},_clearQtyExpandItem:function(e){for(var t in e)t.startsWith(this._qtyExpandName)&&delete e[t]},_doDetailData:function(){var e=this._gridSaveData();if(!e)return[];for(var t=[],i=0;i<e.length;i++){var s=e[i],a=s[this._gridSetting.PtypeIdField],r=this._getSizeCacheById(a),n=s[this._gridSetting.PriceField],d=!0;for(var o in s)if(o.startsWith(this._qtyExpandName)){d=!1;var h=r[o.substr(this._qtyExpandName.length+1)],l=s[o];t.push(this._bindDetailData(n,l,h,a,s))}if(d)for(var g=0,_=r?r.length:0;g<_;g++){h=r[g];if(!s[this._gridSetting.SizeNameField]||!r[g]||s[this._gridSetting.SizeNameField]==r[g]){0!==(l=s[this._gridSetting.QtyField])&&t.push(this._bindDetailData(n,l,h,a,s))}}}return t},_bindDetailData:function(e,t,i,s,a){var r=Object.clone(a);return this._clearQtyExpandItem(r),r[this._gridSetting.PtypeIdField]=s,r[this._gridSetting.PfullnameField]=a[this._gridSetting.PfullnameField],r[this._gridSetting.ColorIdField]=a[this._gridSetting.ColorIdField],r[this._gridSetting.ColorNameField]=a[this._gridSetting.ColorNameField],r[this._gridSetting.SizeIdField]=this._getSizeIdByName(i),r[this._gridSetting.SizeNameField]=i,r[this._gridSetting.QtyField]=t,r[this._gridSetting.PriceField]=e,this._validateNumberColumnData(r),r},_showSizeColorColumn:function(e){this._showColorColumn(e),this._showSizeColumn(e),this._lastDisplayMode==Sys.Dress.DressDisplayMode.standard&&this._showStandardColumn(!1)},_validateNumberColumnData:function(e){this._validateFieldData(this._gridSetting.QtyField,e),this._validateFieldData(this._gridSetting.PriceField,e),this._validateFieldData(this._gridSetting.TotalField,e)},_validateFieldData:function(e,t){return!(!t||"undefined"==typeof t[e]||"undefined"==typeof t[this._gridSetting.PtypeIdField])&&(isNaN(t[e])&&(t[e]=0),!0)},_showSizeColumn:function(e){var t=this._gridSetting.SizeIdField,i=this._gridSetting.SizeNameField,s=this.findColumn(t);s&&s.set_visible(e);var a=this.findColumn(i);a&&a.set_visible(e)},_showColorColumn:function(e){var t=this._gridSetting.ColorIdField,i=this._gridSetting.ColorNameField,s=this.findColumn(t);s&&s.set_visible(e);var a=this.findColumn(i);a&&a.set_visible(e)},_doStandardColumn:function(){var e=this._dataCache;e&&0!=e.length&&(this._showColorColumn(!0),this._showSizeColumn(!1),this._standardTdBand?this._showStandardColumn(!0):this._expandQtyColumns())},_getExpandFieldName:function(e){return this._qtyExpandName+"_"+e},_getSizeCacheById:function(e){return this._sizeInfoListCache&&this._sizeInfoListCache[e]||this._doInitSizeCache(),this._sizeInfoListCache[e]},_expandQtyColumns:function(){var e=this.findColumn(this._gridSetting.SizeNameField);if(!e)throw new Error.message("服装grid必须指定尺码列");var t=e.get_index(),i=e.get_headerElement(),s=this._header,a=$common.getTableBody(s),r=a.firstChild,n=this.get_maxSizeCount();if(0!=n){var d=this._insertTd(i,0,i.innerHTML,!0);d.align="center",d.width=65*n,d.colSpan=n,this._standardTdBand=d;for(var o=$common.getChildrenByTagName(r,"td"),h=0,l=o.length;h<l;h++){var g=o[h];g!=d&&(g.rowSpan=2)}var _=$common.createTr();_.className="GridHeaderRow",a.appendChild(_);var S={width:65,align:"center",colSpan:1,rowSpan:1},c=this._createHeaderTd(S,"",!0);_.appendChild(c);var u=null,y=e.get_footerElement();y&&(u=this._insertTd(y,0,"",!1));var f={type:Sys.UI.Controls.NumberColumn,properties:{name:"size_0",dataField:"size_0",allowResize:!1,allowConfig:!1,allowSort:!this._sizeCacheCurPage,allowFilter:!this._sizeCacheCurPage,designCaption:"",designWidth:65,headerAlign:"center",textAlign:"right",filterType:1}},C=this._insertColumn(t,f,"","size_0",c,u);C.set_minValue(0);var m={};m.name="sizeband",m.captions=[],m.dataFields=[],m.reportFields=[];for(h=0;h<n;h++)Array.add(m.captions,""),Array.add(m.dataFields,this._getExpandFieldName(h)),Array.add(m.reportFields,"尺码"+h);this._expandColumn(C,m),this._standardTdBand.expandColumn=C}},_getSizeIdByName:function(e){return this._sizeIdCache[e]},saveData:function(){return Object.clone(this.getDetails())},get_displayMode:function(){return this._displayMode},set_displayMode:function(e){this._displayMode!=e&&this._refreshDisplay(e)},set_gridSetting:function(e){Object.copyTo(e,this._gridSetting)},get_gridSetting:function(){return this._gridSetting},getField:function(e){return this._gridSetting[e]},getCacheData:function(){return this._dataCache},getDetails:function(){if(!this.get_isInitialized())return this._dataCache||[];if(this._lastDisplayMode==Sys.Dress.DressDisplayMode.master)return this._dataCache||[];var e=[];return e=this._lastDisplayMode==Sys.Dress.DressDisplayMode.standard?this._doDetailData():this._gridSaveData(),this._dataCache=e},getExpandName:function(){return this._qtyExpandName},get_maxSizeCount:function(){var e=this._maxSizeCount;if(0==e){for(var t in this._sizeInfoListCache){var i=this._sizeInfoListCache[t];i.length>e&&(e=i.length)}this._maxSizeCount=e}return e},set_maxSizeCount:function(e){this._maxSizeCount=e},get_realMaxSizeCount:function(){return this.set_maxSizeCount(0),this.get_maxSizeCount()},get_sizeInfoListCache:function(){return this._sizeInfoListCache},set_sizeInfoListCache:function(e){this._sizeInfoListCache=e},get_sizeInfoListCurPage:function(){return this._sizeInfoListCache},set_sizeInfoListCurPage:function(e){this._sizeInfoListCache=e,this._sizeCacheCurPage=!0,this.get_isInitialized()&&(this._sizeCacheChanged=!0)},set_sizeCacheCurPage:function(e){this._sizeCacheCurPage=e},get_sizeCacheCurPage:function(){return this._sizeCacheCurPage},set_modeReadOnly:function(e,t){this._modeReadOnly[e]=t},_doCellBeginEdit:function(e,t,i){if(this._modeReadOnly[this._displayMode])return!1;var s=i?this._getRowIndex(i):this.get_selectedRowIndex(),a=this.isEmptyRow(s),r=e.get_dataField();if(r&&r.startsWith(this._qtyExpandName)&&!a){if(r.length<this._qtyExpandName.length+1)return!1;var n=r.substr(this._qtyExpandName.length+1),d=this.getRowData(s)[this._gridSetting.PtypeIdField],o=this._getSizeCacheById(d);if(parseInt(n)>=o.length)return!1}return Sys.UI.Controls.FzDressGrid.callBaseMethod(this,"_doCellBeginEdit",[e,t,i])},doSelectionChanged:function(){this._changeColumnCaption(),Sys.UI.Controls.FzDressGrid.callBaseMethod(this,"doSelectionChanged")},set_dataSource:function(e){this.get_pagerId();Sys.UI.Controls.FzDressGrid.callBaseMethod(this,"set_dataSource",[e]),this._dataCache=this._dataSource},_initDataRows:function(){(this._init||this._displayMode==Sys.Dress.DressDisplayMode.detail)&&Sys.UI.Controls.FzDressGrid.callBaseMethod(this,"_initDataRows")},doFormLoaded:function(){this._displayMode!=Sys.Dress.DressDisplayMode.detail&&this._refreshExpand(),Sys.UI.Controls.FzDressGrid.callBaseMethod(this,"doFormLoaded")},add_standardSizeSort:function(e){this.get_events().addHandler("standardSizeSort",e)},remove_standardSizeSort:function(e){this.get_events().removeHandler("standardSizeSort",e)},_doSizeSortEvent:function(){if(this.get_displayMode()==Sys.Dress.DressDisplayMode.standard){var e=this.get_events().getHandler("standardSizeSort");if(e){var t=new Sys.Dress.StandardSizeSortEventArgs(this._sizeInfoListCache);e(this,t),this._sizeInfoListCache=t.get_sizes()}}},add_masterMerge:function(e){this.get_events().addHandler("masterMerge",e)},remove_masterMerge:function(e){this.get_events().removeHandler("masterMerge",e)},add_standardMerge:function(e){this.get_events().addHandler("standardMerge",e)},remove_standardMerge:function(e){this.get_events().removeHandler("standardMerge",e)},_doMergeEvent:function(e){var t=this.get_events().getHandler(e);if(!t)return[];var i=new Sys.Dress.MergeEventArgs;return t(this,i),i.get_mergeFields()||[]},add_detailMerging:function(e){this.get_events().addHandler("detailMerging",e)},remove_detailMerging:function(e){this.get_events().removeHandler("detailMerging",e)},add_masterMerging:function(e){this.get_events().addHandler("masterMerging",e)},remove_masterMerging:function(e){this.get_events().removeHandler("masterMerging",e)},add_standardMerging:function(e){this.get_events().addHandler("standardMerging",e)},remove_standardMerging:function(e){this.get_events().removeHandler("standardMerging",e)},_doMergingEvent:function(e,t,i){var s=this.get_events().getHandler(e);if(s)for(var a=0,r=t.length;a<r;a++){s(this,new Sys.Dress.MergingEventArgs(t[a],i[a]))}}},Sys.UI.Controls.FzDressGrid.registerClass("Sys.UI.Controls.FzDressGrid",Sys.UI.Controls.TreeGrid),Sys.UI.Controls.FzDressTreeGrid=function(e){Sys.UI.Controls.FzDressTreeGrid.initializeBase(this,[e]),this._isTree=!0},Sys.UI.Controls.FzDressTreeGrid.prototype={initialize:function(){Sys.UI.Controls.FzDressTreeGrid.callBaseMethod(this,"initialize")},dispose:function(){Sys.UI.Controls.FzDressTreeGrid.callBaseMethod(this,"dispose")}},Sys.UI.Controls.FzDressTreeGrid.registerClass("Sys.UI.Controls.FzDressTreeGrid",Sys.UI.Controls.FzDressGrid);